<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>RailSimWeb</title>
    <!-- <link rel="stylesheet" href="rsw.css" /> -->
    <style type="text/css">
* {
    margin: 0em;
    padding: 0em;
    line-height: 1em;
    vertical-align: top;
}
body {
    background-color: #0080ff;
    overflow: hidden;
    /*position: fixed;*/ /* prevent android chrome addressbar hiding */
}
*.il-en, *.il-ja { display: none; }
*.ib-en, *.ib-ja { display: none; }
*.bl-en, *.bl-ja { display: none; }
body.lang-en *.il-en, body.lang-ja *.il-ja { display: inline; }
body.lang-en *.ib-en, body.lang-ja *.ib-ja { display: inline-block; }
body.lang-en *.bl-en, body.lang-ja *.bl-ja { display: block; }
p {
    line-height: 1.1em;
}
div.splash {
    margin: 2em auto;
    text-align: center;
    color: #ffffff;
}
div.splash a {
    color: #80ff80;
}
div.splash div.config {
    margin: 1em auto;
    width: 15em;
    padding: 0.5em;
    background-color: #e0e0e0;
    text-align: left;
    color: #000000;
}
div.splash h2 {
    text-align: center;
    color: #0000ff;
}
div.splash div.config p {
    margin: 0.5em;
}
div.splash div.config a {
    color: #0000ff;
}
div.splash div.config a:active {
    color: #ffffff;
}
div.splash label {
    display: inline-block;
}
div.splash p.loading {
    margin: 1em 0em;
    font-size: 1.5em;
}
div.info p.detail {
    padding-bottom: 0.5em;
    font-size: 0.5em;
    line-height: 2em;
}
p.detail span {
    display: inline-block;
    padding: 0.2em;
    line-height: 1.5em;
    vertical-align: middle;
    white-space: pre;
}
div.menu p {
    margin: 0.2em 0em;
    padding: 0.2em;
    border-radius: 0.4em;
    border: solid 1px #0000ff;
    background-color: #ffffff;
    text-align: left;
}
div.menu p.active {
    border-color: #ff0000;
    background-color: #ffe0e0;
}
a {
    text-decoration: none;
    color: #0000ff;
}
a.button, span.button a {
    border: dotted 1px #0000ff;
    padding: 0.2em;
    font-size: 0.5em;
    vertical-align: baseline;
}
/*div.menu a {
    display: block;
}*/
div.menu p.active a {
    color: #ff0000;
}
a:hover {
    text-decoration: underline;
}
a:active {
    background-color: #0000ff;
    color: #ffffff;
}
div.menu p.active a:active {
    background-color: #ff0000;
    color: #ffffff;
}
a.disabled:active {
    background-color: #ffffff;
}
a.disabled, span.disabled a {
    color: #c0c0c0;
    text-decoration: none;
}
a.disabled:active, span.disabled a:active {
    background-color: #ffffff;
}
div.menu, div.edit-pane, div.edit-pane h1, div.info h1, div.log h1, div.info, div.log {
    position: fixed;
    padding: 0.2em;
}
div.menu, div.edit-pane, div.log {
    background-color: #ffffffc0;
}
div.info, div.log {
    background-color: #00000040;
}
div.info, div.log {
    color: #ffffffc0;
}
div.info a, div.log a {
    color: #00ffff;
}
div.edit-foot {
    height: 0.2em;
}
div.hide h1, div.hide.menu {
    background-color: #ffffff;
}
div.hide.info h1, div.hide.log h1 {
    background-color: #00000040;
}
div.hide.info, div.hide.log {
    background-color: #00000000;
    overflow: hidden;
}
div.menu {
    z-index: 3;
    top: 0.2em;
    right: 0.2em;
    box-sizing: border-box;
    max-height: 50%;
    overflow-x: hidden;
    overflow-y: auto;
    text-align: right;
    white-space: nowrap;
}
body.menu-on div.menu {
    width: 7.4em;
}
div.edit-pane h1 {
    top: 0.2em;
    left: 0.2em;
    padding: 0.2em;
}
div.info h1, div.log h1 {
    bottom: 0.2em;
    padding: 0.2em;
}
div.info h1 { right: 0.2em; }
div.log h1 { left: 0.2em; }
div.edit-pane {
    z-index: 1;
    top: 0.2em;
    left: 0.2em;
    right: 7.8em;
    box-sizing: border-box;
    overflow-y: scroll;
    padding-top: 1.4em;
    padding-bottom: 0em;
}
div.edit-pane p.group {
    margin-top: 0.5em;
    border-top: solid 1px #000000;
    padding-top: 0.5em;
}
body.vertical div.edit-pane {
    bottom: auto;
    max-height: 50%;
}
body.menu-on.vertical div.edit-pane { right: 7.8em; }
body.menu-off.vertical div.edit-pane { right: 0.2em; }
body.horizontal div.edit-pane {
    right: auto;
    max-width: 50%;
}
body.log-on.horizontal div.edit-pane { bottom: 10.8em; }
body.log-off.horizontal div.edit-pane { bottom: 0.2em; }
body.vertical *.horizontal-only { display: none; }
body.horizontal *.vertical-only { display: none; }
div.info {
    bottom: 0.2em;
    right: 0.2em;
    text-align: right;
    z-index: 1;
}
div.log {
    z-index: 2;
    bottom: 0.2em;
    left: 0.2em;
    max-width: 50%;
    height: 10em;
    overflow-y: scroll;
}
div.log p {
    font-size: 0.7em;
    word-break: break-all;
}
div.info div, div.log div.log-body {
    padding-top: 0em;
    padding-bottom: 1.4em;
}
div.info div {
    padding-bottom: 1em;
}
div.menu h1, div.edit-pane h1, div.info h1, div.log h1 {
    line-height: 1em;
    font-size: 1em;
}
div.root-list div.list-elem {
    margin-top: 0.2em;
    padding: 0.2em;
    border: solid 1px #808080;
}
div.root-list div.list-elem div.car {
    display: inline-block;
    margin-top: 0em;
    margin-left: 0.2em;
    padding: 0.2em;
    border: solid 1px #808080;
}
span.ui-replace-block {
    display: inline-block;
}
span.ui-ctrl {
    letter-spacing: 0.3em;
}
a.selected, span.selected a {
    border: solid 1px #ff0000;
    background-color: #ffe0e0;
    color: #ff0000;
}
a.unselected, span.unselected a {
    border: solid 1px #0000ff;
    background-color: #e0e0ff;
}
*.ui-fix, *.ui-edit {
    display: inline-block;
    border-style: none;
    line-height: 1.2em;
}
*.ui-edit span.title {
    display: inline-block;
}
*.ui-edit, span.ui-array span.ui-array *.ui-edit {
    padding: 0.2em;
    background-color: #e0e0e0;
}
span.ui-array *.ui-edit, span.ui-array span.ui-array span.ui-array *.ui-edit {
    padding: 0.2em;
    background-color: #c0c0c0;
}
a.ui-color {
    border: solid 1px #000000;
    padding: 0.25em;
    font-size: 0.5em;
    line-height: 2em;
    vertical-align: bottom;
}
div.ui-color {
    display: inline-block;
    border: solid 1px #000000;
    width: 1em;
    height: 4.5em;
}
div.ui-slider-box {
    display: inline-block;
    text-align: center;
}
div.ui-slider-box p {
    font-size: 0.5em;
}
div.ui-slider-box p.min {
    float: left;
    text-align: left;
}
div.ui-slider-box p.max {
    float: right;
    text-align: right;
}
div.ui-slider-box p.range {
    width : 100%;
    text-align: center;
    letter-spacing: 0.5em;
}
div.ui-slider {
    display: inline-block;
    border-radius: 0.2em;
    border: solid 1px #000000;
    width: 8em;
    height: 1em;
    background-color: #ffffff;
}
div.ui-slider div {
    position: relative;
    width: 2px;
    height: 1em;
    background-color: #808080;
}
div.file-drop {
    left: 0px;
    right: 0px;
    margin-bottom: 0.5em;
    padding: 1em;
    border: dashed 1px #0000ff;
    text-align: center;
    color: #808080;
}
div.dropping {
    background-color: #8080ff;
}
input.file-hidden {
    display: none;
}
table.camera-guide {
    position: fixed;
    /*top: 0px; left: 0px;*/
    bottom: 0px; right: 0px;
    /*width: 100vw; height: 100vh;*/
    border-collapse: collapse;
}
table.camera-guide tr.edge { height: 20%; }
table.camera-guide td.edge { width: 20%; }
table.camera-guide td {
    border: solid 1px #ffffff;
    text-align: center;
    vertical-align: middle;
    color: #ffffff;
    word-break: break-all;
}
body.photo-on div.edit-pane, body.photo-on div.menu,
body.photo-on div.log, body.photo-on div.info,
body.photo-on table.camera-guide { display: none; }
canvas {
    display: block; /* prevents scrollbar */
    width: 100vw;
    height: 100vh;
}
    </style>
  </head>
  <body>
    <canvas id="canvas" style="display: none"></canvas>
    <div class="splash" id="splash">
      <h1>RailSimWeb</h1>
      <p>by <a href="https://www.aizentranza.com/">aizentranza.com</a></p>
      <p class="loading" id="loading">Loading...</p>
      <div class="config" id="splash-config" style="display: none">
        <h2>
          <a href="javascript:main('en');" title="Start in English">START</a>
          <a href="javascript:main('ja');" title="日本語で開始">スタート</a>
        </h2>
        <p>
          <label>Anti-alias
            <input type="checkbox" id="opt-aa"
                   title="Disable to improve FPS on low-end graphics." />
          </label>
        </p>
        <p>Resolution
          <label><input type="radio" name="opt-reso" value="full" checked /> Full</label>
          <label><input type="radio" name="opt-reso" value="half" /> 1/2</label>
          <label><input type="radio" name="opt-reso" value="third" /> 1/3</label>
          <label><input type="radio" name="opt-reso" value="quarter" /> 1/4</label>
        </p>
        <p>Undo stack size
          <input type="text" id="opt-undo-size" size="4"
                 title="Set small number to save memory. -1: infinity."/>
        </p>
      </div>
      <p id="splash-version"></p>
      <p>Licensed under <a href="https://www.gnu.org/licenses/gpl-3.0.html">GPLv3+</a></p>
    </div>
  </body>
  <!-- <script src="config.js"></script> -->
  <script>
'use strict';
//------------------------------------------------------------------------------
// Options available in splash screen:
var g_opt_enable_aa = true;
var g_opt_resolution = 'full';
var g_opt_undo_stack_size = 64;
var g_language = 'en';
//------------------------------------------------------------------------------
// Other options:
var g_is_auto_start = false;
var g_enable_load_data = true;
var g_is_show_log_default = false;
var g_is_confirm_navigation = true;
var g_max_calc_per_frame = 60;
var g_default_mode = 'Watch';
var g_max_focus_num = 3;
var g_default_camera_fov = 60;
var g_field_unit_min = 5;
var g_field_unit_max = 160;
  </script>
  <!-- <script src="lang.js"></script> -->
  <script>
'use strict'
var cLanguages = ['en', 'ja'];
var cLang = {
    // common
    cmn_sp        : [' '        , ''           ],
    cmn_enable    : ['enable'   , '有効'       ],
    cmn_none      : ['none'     , 'なし'       ],
    cmn_type      : ['type'     , '種類'       ],
    cmn_mode      : ['mode'     , 'モード'     ],
    cmn_width     : ['width'    , '幅'         ],
    cmn_height    : ['height'   , '高さ'       ],
    cmn_train     : ['train'    , '編成'       ],
    cmn_default   : ['default'  , '既定'       ],
    cmn_sec       : ['sec'      , '秒'         ],
    cmn_position  : ['position' , '位置'       ],
    cmn_offset    : ['offset'   , '補正'       ],
    cmn_angle     : ['angle'    , '角度'       ],
    cmn_direction : ['direction', '方向'       ],
    cmn_slope     : ['slope'    , '勾配'       ],
    cmn_cant      : ['cant'     , 'カント'     ],
    cmn_random    : ['random'   , 'ランダム'   ],
    cmn_left      : ['left'     , '左'         ],
    cmn_right     : ['right'    , '右'         ],
    cmn_apply     : ['apply'    , '適用'       ],
    cmn_cancel    : ['cancel'   , '中止'       ],
    cmn_delete    : ['delete'   , '削除'       ],
    cmn_turnout   : ['turnout'  , '分岐'       ],
    cmn_station   : ['station'  , '停車'       ],
    cmn_settings  : ['settings' , '設定'       ],
    cmn_true      : ['true'     , '有効'       ],
    cmn_false     : ['false'    , '無効'       ],
    cmn_name      : ['name'     , '名称'       ],
    cmn_comment   : ['comment'  , 'コメント'   ],
    cmn_label     : ['label'    , '表記'       ],
    cmn_value     : ['value'    , '値'         ],
    cmn_values    : ['values'   , '値'         ],
    cmn_id        : ['ID'       , 'ID'         ],
    cmn_ids       : ['ID(s)'    , 'ID (複数可)'],
    cmn_color     : ['color'    , '色'         ],
    cmn_colors    : ['colors'   , '色'         ],
    cmn_remove    : ['remove'   , '撤去'       ],
    cmn_switch    : ['switch'   , 'スイッチ'   ],
    cmn_switches  : ['switches' , 'スイッチ'   ],
    cmn_any       : ['any'      , '任意'       ],
    cmn_scale     : ['scale'    , 'スケール'   ],
    cmn_rotate    : ['rotate'   , '回転'       ],
    cmn_trans     : ['trans'    , '移動'       ],
    cmn_condition : ['condition', '条件'       ],
    cmn_parts     : ['parts'    , '部品'       ],
    cmn_model     : ['model'    , 'モデル'     ],
    cmn_checked   : ['checked'  , '選択'       ],
    cmn_depended  : ['depended' , '依存'       ],
    cmn_author    : ['author'   , '作者'       ],
    cmn_shape     : ['shape'    , '形状'       ],
    cmn_smokes    : ['smokes'   , '発煙'       ],
    // ui ctrl
    ui_copy          : ['copy'         , '複製'    ],
    ui_paste         : ['paste'        , '貼付'    ],
    ui_shorten_range : ['shorten range', '範囲縮小'],
    ui_extend_range  : ['extend range' , '範囲拡大'],
    // ui struct
    ui_select_all   : ['select all'     , '全選択'  ],
    ui_add_element  : ['add an element' , '要素追加'],
    ui_del_elements : ['delete elements', '要素削除'],
    ui_move_down    : ['move down'      , '下移動'  ],
    ui_move_up      : ['move up'        , '上移動'  ],
    // menu
    menu_undo         : ['Undo'        , '取消'      ],
    menu_redo         : ['Redo'        , '復帰'      ],
    menu_file         : ['File'        , 'ﾌｧｲﾙ'      ],
    menu_save         : ['Save'        , '保存'      ],
    menu_watch        : ['Watch Mode'  , '鑑賞モード'],
    menu_build_rail   : ['Build Track' , '線路設置'  ],
    menu_edit_rail    : ['Edit Track'  , '線路編集'  ],
    menu_schedule     : ['Schedule   ' , '運行設定'  ],
    menu_edit_model   : ['Part Model'  , '部品モデル'],
    menu_train_model  : ['Train Model' , '車輌モデル'],
    menu_train_list   : ['Train List'  , '編成管理'  ],
    menu_struct_model : ['Struct Model', '施設モデル'],
    menu_struct_list  : ['Struct List' , '施設管理'  ],
    menu_field_editor : ['Edit Field'  , '地形編集'  ],
    // headers
    head_log          : ['LOG'         , 'ログ'      ],
    head_info         : ['INFO'        , '情報'      ],
    head_menu         : ['MENU'        , '操作'      ],
    head_file         : ['FILE'        , 'ファイル'  ],
    head_watch        : ['WATCH MODE'  , '鑑賞モード'],
    head_rail         : ['TRACK'       , '線路'      ],
    head_schedule     : ['SCHEDULE'    , '運行設定'  ],
    head_edit_model   : ['PART MODEL'  , '部品モデル'],
    head_train_model  : ['TRAIN MODEL' , '車輌モデル'],
    head_train_list   : ['TRAIN LIST'  , '編成管理'  ],
    head_struct_model : ['STRUCT MODEL', '施設モデル'],
    head_struct_list  : ['STRUCT LIST' , '施設管理'  ],
    head_field_editor : ['EDIT FIELD'  , '地形編集'  ],
    // debug
    debug_draw     : ['Debug\nDraw', 'デバッグ\n描画'],
    debug_set_lang : ['Language'   , '言語切替'      ],
    // watch
    watch_pause        : ['pause'          , '一時停止'  ],
    watch_sim_speed    : ['sim speed'      , '再生速度'  ],
    watch_fix_camera   : ['fix camera'     , '視点固定'  ],
    watch_rot_focus    : ['rotate focus'   , '回転連動'  ],
    watch_zoom_focus   : ['zoom focus'     , 'ズーム連動'],
    watch_multi_focus  : ['multi focus'    , '複数注目'  ],
    watch_inspect_mode : ['inspection mode', '検査モード'],
    watch_photo_mode   : ['photograph mode', '撮影モード'],
    // camera guide
    cam_guide_open    : ['camera control guide'     , 'カメラ操作ガイド'  ],
    cam_guide_close   : ['close control guide'      , '操作ガイドを閉じる'],
    cam_guide_rotate  : ['rotate camera'            , 'カメラ回転'        ],
    cam_guide_pan     : ['move vertically'          , '垂直移動'          ],
    cam_guide_slide   : ['move horizontally'        , '水平移動'          ],
    cam_guide_forward : ['move forward/backward'    , '前後移動'          ],
    cam_guide_fov     : ['adjust field of view'     , '視野角調整'        ],
    cam_guide_offcent : ['adjust perspective center', '透視中心調整'      ],
    cam_key_rotate    : ['drag'             , 'ドラッグ'         ],
    cam_key_pan       : ['shift + alt(opt)' , 'shift + alt(opt)' ],
    cam_key_slide     : ['alt(opt)'         , 'alt(opt)'         ],
    cam_key_forward   : ['shift / wheel'    , 'shift / ホイール' ],
    cam_key_fov       : ['shift + ctrl(cmd)', 'shift + ctrl(cmd)'],
    cam_key_offcent   : ['ctrl(cmd)'        , 'ctrl(cmd)'        ],
    // rail properties
    track_field_setting : ['field setting', '地表設定'  ],
    track_field_height  : ['field height' , '地表高度'  ],
    track_elevated      : ['height'       , '高さ'      ],
    track_curve_factor  : ['curve factor' , 'カーブ係数'],
    track_rail          : ['rail'         , 'レール'    ],
    track_tie           : ['tie'          , '枕木'      ],
    track_girder        : ['girder'       , '橋桁'      ],
    track_pier          : ['pier'         , '橋脚'      ],
    track_interval      : ['interval'     , '間隔'      ],
    track_part          : ['part'         , 'パーツ'    ],
    // rail types
    rail_narrow   : ['1,067mm narrow gauge'  , '1,067mm 狭軌'     ],
    rail_standard : ['1,435mm standard gauge', '1,435mm 標準軌'   ],
    rail_safege   : ['SAFEGE monorail'       , 'サフェージュ式モノレール'],
    rail_alweg    : ['ALWEG monorail'        , 'アルヴェーグ式モノレール'],
    // tie types
    tie_ballast : ['ballast', 'バラスト'],
    tie_slab    : ['slab'   , 'スラブ'  ],
    // girder types
    girder_girder : ['girder', '橋桁'    ],
    girder_tunnel : ['tunnel', 'トンネル'],
    // pier types
    pier_center : ['center'    , '中央'],
    pier_both   : ['both side' , '両側'],
    pier_left   : ['left side' , '左側'],
    pier_right  : ['right side', '右側'],
    // rail parts types
    part_platform : ['platform', 'ホーム'],
    part_wall     : ['wall'    , '壁'    ],
    part_floor    : ['floor'   , '床'    ],
    // rail part metrics
    part_dimensions : ['dimensions', '寸法'],
    // schedule
    travel_dir : ['travel direction', '進行方向'],
    // turnout
    switch_dir_main : ['main'     , '主'      ],
    switch_dir_sub  : ['sub'      , '副'      ],
    switch_dir_alt  : ['alternate', '交互'    ],
    switch_dir_rnd  : ['random'   , 'ランダム'],
    // station
    station_signal_name : ['signal ID  ', '閉塞 ID'],
    station_dir_any     : ['all'        , '両方'   ],
    station_stop        : ['stop'       , '停車'   ],
    station_turnaround  : ['turnaround' , '折返し' ],
    station_time        : ['time'       , '時間'   ],
    station_model       : ['model'      , '形式'   ],
    // model
    model_draw_pass      : ['draw pass'     , '描画パス'      ],
    model_pass_field     : ['field'         , '地形'          ],
    model_pass_tunnel    : ['tunnel'        , 'トンネル'      ],
    model_pass_default   : ['default'       , 'デフォルト'    ],
    model_default_color  : ['default color' , 'デフォルト色'  ],
    model_override_color : ['override color', '上書き色'      ],
    model_default_value  : ['default value' , 'デフォルト値'  ],
    model_preview_value  : ['preview value' , 'プレビュー値'  ],
    model_compare        : ['compare'       , '比較'          ],
    model_value_ids      : ['value ID(s)'   , '値 ID (複数可)'],
    model_primitives     : ['primitives'    , '基本形状'      ],
    model_painters       : ['painters'      , '塗装'          ],
    model_face           : ['face'          , '面'            ],
    model_split          : ['split'         , '分割'          ],
    model_taper          : ['taper'         , 'テーパ'        ],
    model_base_color     : ['base color'    , '下地色'        ],
    model_solid          : ['solid'         , '充填'          ],
    model_slicers        : ['slicers'       , '切削'          ],
    model_reshapable     : ['reshapable'    , '再成形可能'    ],
    model_bound          : ['bound'         , '境界'          ],
    model_bounds         : ['bounds'        , '境界'          ],
    model_alt_color      : ['alt color'     , '色変更'        ],
    model_accept_focus   : ['accept focus'  , '注目可能'      ],
    // smoke
    smoke_life       : ['lifetime'   , '寿命'        ],
    smoke_scale_fin  : ['final scale', '最終スケール'],
    smoke_speed_damp : ['speed damp' , '速度減衰'    ],
    smoke_emit_ratio : ['emit ratio' , '放出率'      ],
    smoke_turbulence : ['turbulence' , '乱流'        ],
    // primitive types
    primitive_plane    : ['plane'   , '平面'  ],
    primitive_prism    : ['prism'   , '三角柱'],
    primitive_cube     : ['cube'    , '直方体'],
    primitive_cylinder : ['cylinder', '円柱'  ],
    primitive_sphere   : ['sphere'  , '球'    ],
    // face types
    face_front : ['front', '表面'],
    face_back  : ['back' , '裏面'],
    face_both  : ['both' , '両面'],
    // slicer types
    slicer_erase_lt   : ['erase <'  , '消去 <'  ],
    slicer_erase_gt   : ['erase >'  , '消去 >'  ],
    slicer_reshape_lt : ['reshape <', '再成形 <'],
    slicer_reshape_gt : ['reshape >', '再成形 >'],
    // painter types
    painter_mask_lt  : ['mask <'     , 'マスク <'],
    painter_mask_gt  : ['mask >'     , 'マスク >'],
    painter_paint_lt : ['paint <'    , '塗装 <'  ],
    painter_paint_gt : ['paint >'    , '塗装 >'  ],
    painter_alt_lt   : ['alt color <', '色変更 <'],
    painter_alt_gt   : ['alt color >', '色変更 >'],
    // painter shapes
    painter_shape_plane  : ['plane' , '平面'],
    painter_shape_circle : ['circle', '円'  ],
    painter_shape_sphere : ['sphere', '球'  ],
    // train
    train_length       : ['length'      , '全長'      ],
    train_railtype     : ['rail type'   , 'レール種別'],
    train_fixed_to     : ['fixed to'    , '固定先'    ],
    train_fixed_to_pos : ['fixed to pos', '固定先位置'],
    train_rod_length   : ['rod length'  , 'ロッド長'  ],
    train_go           : ['go'          , '運行'      ],
    train_back         : ['back'        , '後退'      ],
    train_speed        : ['speed'       , '速度'      ],
    train_accel        : ['acceleration', '加速度'    ],
    train_decel        : ['deceleration', '減速度'    ],
    train_model        : ['model'       , '形式'      ],
    train_flip         : ['flip'        , '反転'      ],
    train_cars         : ['cars'        , '車輌'      ],
    // train part type
    train_part_wheel     : ['wheel'       , '車輪'          ],
    train_part_bogie     : ['bogie'       , '台車'          ],
    train_part_body      : ['body'        , '車体'          ],
    train_part_rod_tri   : ['triangle rod', '三角ロッド'    ],
    train_part_rod_slide : ['slider rod'  , 'スライダロッド'],
    // struct
    struct_model         : ['model'           , '形式'      ],
    struct_field_setting : ['field setting'   , '地形設定'  ],
    struct_fs_none       : ['none'            , 'なし'      ],
    struct_fs_height     : ['position'        , '位置'      ],
    struct_fs_normal     : ['position & angle', '位置・角度'],
    struct_put_struct    : ['put struct'      , '施設配置'  ],
    // field
    field_layer        : ['layer'        , 'レイヤ'      ],
    field_draw         : ['draw'         , '描画'        ],
    field_draw_all     : ['all layers'   , '全レイヤ'    ],
    field_draw_current : ['current layer', '現在のレイヤ'],
    field_draw_others  : ['other layers' , '他のレイヤ'  ],
    field_mode_write   : ['write'        , '書込'        ],
    field_mode_erase   : ['erase'        , '消去'        ],
    field_mode_pick    : ['pick'         , '選択'        ],
    field_update_rail  : ['update track' , '線路更新'    ],
    field_grass  : ['grass' , '草'],
    field_desert : ['desert', '砂'],
    field_rock   : ['rock'  , '岩'],
    field_snow   : ['snow'  , '雪'],
    field_water  : ['water' , '水'],
    // actions
    act_build_track       : ['track built'         , '線路設置'        ],
    act_create_sw_point   : ['turnout created'     , '分岐作成'        ],
    act_ctrl_point        : ['control point'       , '制御点'          ],
    act_split_rail        : ['spilt track'         , '線路分割'        ],
    act_move_rail         : ['move point'          , '制御点移動'      ],
    act_delete_rail       : ['delete track'        , '線路削除'        ],
    act_set_rail_type     : ['set curve factor'    , 'カーブ係数指定'  ],
    act_toggle_rail       : ['toggle rail'         , 'レール切替'      ],
    act_set_rail_type     : ['set rail type'       , 'レール種類指定'  ],
    act_toggle_tie        : ['toggle tie'          , '枕木切替'        ],
    act_set_tie_type      : ['set tie type'        , '枕木種類指定'    ],
    act_toggle_girder     : ['toggle girder'       , '橋桁切替'        ],
    act_set_girder_type   : ['set girder type'     , '橋桁種類指定'    ],
    act_toggle_pier       : ['toggle pier'         , '橋脚切替'        ],
    act_set_pier_type     : ['set pier type'       , '橋脚種類指定'    ],
    act_set_pier_interval : ['set pier interval'   , '橋脚間隔指定'    ],
    act_set_pier_offset   : ['set pier position'   , '橋脚位置指定'    ],
    act_set_left_part     : ['set left part'       , '左パーツ指定'    ],
    act_set_right_part    : ['set right part'      , '右パーツ指定'    ],
    act_set_point_z       : ['set point Z'         , '制御点 Z 指定'   ],
    act_set_point_height  : ['set point height'    , '制御点高架指定'  ],
    act_set_point_dir     : ['set point dir'       , '制御点方向指定'  ],
    act_set_point_slope   : ['set point slope'     , '制御点勾配指定'  ],
    act_set_point_cant    : ['set point cant'      , '制御点カント指定'],
    act_set_sw_schedule   : ['set turnout schedule', '分岐運行設定'    ],
    act_set_signal_name   : ['set signal name'     , '閉塞名指定'      ],
    act_set_stn_schedule  : ['set station schecule', '停車運行設定'    ],
    act_create_field      : ['create field'        , '地形作成'        ],
    act_delete_field      : ['delete field'        , '地形削除'        ],
    // file
    file_undo : ['Undo', '元に戻す'],
    file_redo : ['Redo', 'やり直し'],
    file_new_scene : ['new scene', '新規シーン'],
    file_keep_model_data : ['keep model data', 'モデルデータ保持'],
    file_load_scene : ['load scene or model data', 'シーン・モデルデータ読込'],
    file_save_scene : ['save scene', 'シーン保存'],
    file_save_for_embedding : ['embed in RailSimWeb.html', 'RailSimWeb.html に埋め込む'],
    file_confirm_clear_scene : ['The scene is going to be cleared.', 'シーンは消去されます。'],
    file_export_data : ['export data', 'データ出力'],
    file_export_part_model : ['selected part models', '選択した部品モデル'],
    file_export_train_model : ['selected train models with depended part models',
                               '選択した車輌モデルおよび依存部品モデル'],
    file_export_struct_model : ['selected struct models with depended part models',
                                '選択した施設モデルおよび依存部品モデル'],
    file_export_train_form : ['selected train formations', '選択した列車編成'],
    file_download : ['download', 'ダウンロード'],
    file_layout_name : ['layout name', 'レイアウト名'],
    file_fov : ['field of view', '視野角'],
    file_reset_camera : ['reset camera', 'カメラリセット'],
    // descriptions
    desc_delete_last_ctrl_point : ['delete the last control point', '最終制御点削除'],
    desc_delete_selected_rail : ['delete selected track', '選択した線路を削除'],
    desc_select_rail_end : ['select track or control-point', '線路または制御点を選択'],
    desc_select_rail_switch : ['select track or turnout', '線路または分岐を選択'],
    desc_replaced_invalid_id : ['Replaced invalid ID', '不正な ID を置き換えました'],
    desc_valid_letters : ['Valid letters', '有効な文字'],
    desc_comma_separated : ['Multiple items can be specified separated by commas.',
                            'カンマ区切りで複数項目を指定できます。'],
    desc_cannot_paste : [
        'Cannot paste! Value type mismatch.', '型が異なるため貼り付けできません。'],
    desc_touch_device_mode : [
        'Enabled touch device mode.', 'タッチ操作モードが有効です。'],
    desc_save_data : ['Save data', 'データ保存'],
    desc_load_data : ['Load data', 'データ読込'],
    desc_import_data : ['Import data', 'データ入力'],
    desc_train_set : ['Train set', '編成設置'],
    desc_train_removed : ['Train removed', '編成撤去'],
    desc_remove_train : ['remove train from scene', 'シーンから編成を撤去'],
    desc_drop_file : ['drop a file here', 'ここにファイルをドロップ'],
    desc_invalid_data : ['Cannot load: invalid data', '読み込み失敗: 不正なデータ'],
    desc_embed_failed : ['Cannot embed: invalid file', '埋め込み失敗: 不正なファイル'],
    // errors
    error_tag : ['[ERROR] ', '[エラー] '],
    error_file_type : ['invalid file type', '不正なファイルタイプ'],
    error_file_version : ['unsupported version', 'サポート外のバージョン'],
    error_file_no_export_data : ['no data to export', '出力データなし'],
    error_not_deletable : ['not deletable', '削除不可'],
    error_used_by : ['used by', '使用中'],
    // warnings
    warn_tag : ['[WARNING] ', '[警告] '],
    warn_already_exist : ['data already exists', 'データが既に存在します'],
};
  </script>
  <!-- <script src="prim.js"></script> -->
  <script>
'use strict';
function CreateCallbackSet()
{
    return {
        mCallbacks : [],
        push : function(func)
        {
            this.mCallbacks.push(func);
        },
        invoke : function()
        {
            for (var i = 0; i < this.mCallbacks.length; ++i)
            {
                this.mCallbacks[i]();
            }
        },
    };
}
function CreateSingleton()
{
    return {};
}
function CreateInstance(inst)
{
    return inst || {};
}
function CreateIDMgr(mgr, is_uuid)
{
    mgr = CreateInstance(mgr);
    if (is_uuid) {
        mgr.mIsUUID = true;
        mgr.issueID = function(obj) {
            obj = CreateInstance(obj);
            if (!obj.uuid) {
                obj.uuid = getRandomUUID();
                //Log('issueID: ' + obj.uuid);
            }
            return obj;
        };
    } else {
        mgr.sID = 0;
        mgr.sLoadingID = -1;
        mgr.addID = function() {
            if (this.sLoadingID >= 0) {
                var ret = this.sLoadingID;
                this.sLoadingID = -1;
                return ret;
            }
            return this.sID++;
        };
    }
    mgr.saveInsts = function(f)
    {
        var entry = {
            insts : [],
        };
        if (!this.mIsUUID) {
            entry.cur_id = this.sID;
        }
        this.forEach(function(obj) {
            var inst = f.apply(this, [obj]);
            if (inst) { entry.insts.push(inst); }
        }, this);
        return entry;
    };
    mgr.loadInsts = function(entry, f) {
        if (!entry) { return; }
        if (!this.mIsUUID && entry.cur_id !== undefined) {
            this.sID = entry.cur_id;
        }
        entry.insts.forEach(f, this);
    };
    mgr.setLoadingID = function(id) { this.sLoadingID = id; };
    return mgr;
}
function CreateObjMgr(mgr)
{
    mgr = CreateIDMgr(mgr);
    mgr.sObjs = [];
    mgr.objNum = function() { return mgr.sObjs.length; };
    mgr.clear = function()
    {
        this.sID = 0;
        this.sObjs = [];
        if (this.onClear) { this.onClear(); }
    };
    mgr.createObj = function()
    {
        var obj = CreateInstance();
        obj.mID = mgr.addID();
        mgr.sObjs.push(obj);
        return obj;
    };
    mgr.pushObj = function(obj)
    {
        mgr.sObjs.push(obj);
    };
    mgr.eraseObj = function(obj)
    {
        for (var i = 0; i < this.sObjs.length; ++i)
        {
            if (this.sObjs[i] == obj) {
                this.sObjs.splice(i, 1);
                return true;
            }
        }
        return false;
    };
    mgr.searchObj = function(id)
    {
        for (var i = 0; i < this.sObjs.length; ++i)
        {
            if (this.sObjs[i].mID == id) { return this.sObjs[i]; }
        }
        return null;
    };
    mgr.forEach = function(f, a_this)
    {
        mgr.sObjs.forEach(f, a_this);
    };
    return mgr;
}
function HasValidValue(arr)
{
    if (!arr) { return false; }
    for (var i = 0; i < arr.length; ++i) { if (arr[i]) { return true; } }
    return false;
}
function ForEachReversed(arr, is_reverse, f, a_this)
{
    if (is_reverse) {
        for (var i = arr.length - 1; i >= 0; --i) { f.apply(a_this, [arr[i]]); }
    } else {
        for (var i = 0; i < arr.length; ++i) { f.apply(a_this, [arr[i]]); }
    }
}
var g_on_next_calc = [];
function OnNextCalc(f, a_this) { g_on_next_calc.push({ func : f, from : a_this, }); }
function ProcOnNextCalc() {
    var carry = [];
    g_on_next_calc.forEach(function(t) {
        if (t.func.apply(t.from)) { carry.push(t); }
    });
    g_on_next_calc = carry;
}
function parseIntWithDefault(v, def)
{
    var ret = parseInt(v);
    return isNaN(ret) ? def : ret;
}
function getRandomUUID() {
    var seed = new Date().getTime(), seed2 = 0, uuid = '';
    if (performance && performance.now) { seed2 = performance.now() * 1000; }
    for (var d = 0; d < 32; ++d) {
        if (8 <= d && d <= 20 && d % 4 == 0) { uuid += '-'; }
        if (d == 12) { uuid += '4'; continue; }
        var hex = Math.random() * 16;
        hex = Math.floor((seed + hex) % 16);
        seed = Math.floor(seed / 16);
        if (seed == 0) { seed = seed2; seed2 = 0; }
        if (d == 16) { hex = hex % 4 + 8; }
        uuid += hex.toString(16);
    }
    return uuid;
}
function FormatDateTimeImpl(date, d_sep, m_sep, t_sep)
{
    if (!d_sep) { d_sep = '/'; }
    if (!m_sep) { m_sep = ' '; }
    if (!t_sep) { t_sep = ':'; }
    function fmt(t) { return (t < 10 ? '0' : '') + t; }
    return date.getFullYear()
        + d_sep + fmt(date.getMonth() + 1)
        + d_sep + fmt(date.getDate())
        + m_sep + fmt(date.getHours())
        + t_sep + fmt(date.getMinutes())
        + t_sep + fmt(date.getSeconds());
}
function FormatDateTimeForLog (date) { return FormatDateTimeImpl(date, '/', ' ', ':'); }
function FormatDateTimeForFile(date) { return FormatDateTimeImpl(date, '-', '_', '-'); }
  </script>
  <!-- <script src="debug.js"></script> -->
  <script>
'use strict';
var DebugLog = CreateInstance();
DebugLog.cLogMax = 1000;
DebugLog.mCount = 0;
DebugLog.mTime = new Date;
DebugLog.initialize = function()
{
    this.mLogElem = CreateElement('div');
    //g_mouse.pushCoverElements(this.mLogElem);
    this.mLogElem.className = 'log';
    g_mouse.pushCoverElements(this.mLogElem);
    var div_on = CreateElement('div');
    div_on.id = 'log-on';
    this.mLogBody = CreateElement('div');
    this.mLogBody.className = 'log-body';
    div_on.append(this.mLogBody);
    this.mLogElem.append(div_on);
    var head = CreateElement('h1');
    function ToggleLog() {
        SetBodyClassName(BodyClassNameSlot.LogDisplay,
                         ToggleContent('log', 'log') ? 'log-on' : 'log-off');
        DebugLog.mLogElem.scrollBy(0, DebugLog.mLogBody.scrollHeight);
    }
    head.append(CreateScriptLink(cLang.head_log, ToggleLog));
    this.mLogElem.append(head);
    document.body.append(this.mLogElem);
    if (!g_is_show_log_default) { ToggleLog(); }
    // info
    this.mInfoElem = CreateElement('div');
    //g_mouse.pushCoverElements(this.mInfoElem);
    this.mInfoElem.className = 'info';
    var div_on = CreateElement('div');
    div_on.id = 'info-on';
    div_on.style.width = '7em';
    var p_fps = CreateElement('p');
    this.mSpanFPS = CreateElement('span');
    this.mSpanFPS.innerText = '0';
    p_fps.append(this.mSpanFPS);
    div_on.append(p_fps);
    var p_detail = CreateElement('p', 'detail');
    function ToggleDebugDraw() {
        CancelMouse();
        g_debug_draw.toggle();
    }
    p_detail.append(CreateScriptLink(cLang.debug_draw, ToggleDebugDraw), ' ');
    function ToggleLanguage() {
        CancelMouse();
        var next_lang = cLanguages[0];
        for (var il = 0; il < cLanguages.length; ++il) {
            if (cLanguages[il] == g_language) {
                g_language = cLanguages[(il + 1) % cLanguages.length];
                break;
            }
        }
        SetBodyClassName(BodyClassNameSlot.Language, 'lang-' + g_language);
    }
    p_detail.append(CreateScriptLink(LangJoin([
        cLang.debug_set_lang, '\n(', cLanguages, ')']), ToggleLanguage), ' ');
    div_on.append(p_detail);
    this.mInfoElem.append(div_on);
    var head = CreateElement('h1');
    function ToggleInfo() {
        ToggleContent('info');
    }
    head.append(CreateScriptLink(cLang.head_info, ToggleInfo));
    this.mInfoElem.append(head);
    document.body.append(this.mInfoElem);
};
DebugLog.show = function()
{
    ToggleContent('log', 'log', 'show');
    SetBodyClassName(BodyClassNameSlot.LogDisplay, 'log-on');
};
DebugLog.push = function(text)
{
    if (this.mCount >= this.cLogMax) {
        var old_obj = GetElement('log' + (this.mCount - this.cLogMax));
        old_obj.parentNode.removeChild(old_obj);
    }
    var prev_h = this.mLogBody.scrollHeight;
    this.mTime.setTime(Date.now());
    var log = CreateElement('p');
    log.id = 'log' + this.mCount;
    log.append(LangSpan(text));
    var t_time = '[' + FormatDateTimeForLog(this.mTime) + ']';
    if (this.mLastLogTime != t_time) {
        this.mLastLogTime = t_time;
        log.prepend(t_time, CreateBR());
    }
    this.mLogBody.appendChild(log);
    var diff_h = this.mLogBody.scrollHeight - prev_h;
    this.mLogElem.scrollBy(0, diff_h);
    ++this.mCount;
};
function Log(text) { DebugLog.push(text); }
function CapacityLog(text) { if (0) { DebugLog.push(text); } }
var g_toggle_debug_draw_callback = CreateCallbackSet();
var g_debug_draw = {
    mIsEnabled : false,
    toggle : function()
    {
        this.mIsEnabled = !this.mIsEnabled;
        //Log(LangAppend(cLang.debug_draw, ': ' + (this.mIsEnabled ? 'on' : 'off')));
        g_toggle_debug_draw_callback.invoke();
    },
};
function IsEnableDebugDraw() { return g_debug_draw.mIsEnabled; }
  </script>
  <!-- <script src="v2.js"></script> -->
  <script>
'use strict';
// Scalar F32 wrapper.
var v1 = {
    Make : function(x) {
        var dst = new Float32Array(1);
        dst[0] = x;
        return dst;
    },
    Dup : function(src) {
        var dst = new Float32Array(1);
        dst[0] = src[0];
        return dst;
    },
};
// 2D vector math functions.
var v2 = {
    set : function(dst, x, y) {
        dst[0] = x; dst[1] = y;
        return dst;
    },
    sets : function(dst, x) {
        dst[0] = dst[1] = x;
        return dst;
    },
    MakeUndef : function() {
        return new Float32Array(2);
    },
    Make : function(x, y) {
        var dst = new Float32Array(2);
        dst[0] = x; dst[1] = y;
        return dst;
    },
    Makes : function(x) {
        var dst = new Float32Array(2);
        dst[0] = dst[1] = x;
        return dst;
    },
    copy : function(dst, src) {
        dst[0] = src[0]; dst[1] = src[1];
        return dst;
    },
    Dup : function(src) {
        var dst = new Float32Array(2);
        dst[0] = src[0]; dst[1] = src[1];
        return dst;
    },
    neg : function(dst) {
        dst[0] = -dst[0];
        dst[1] = -dst[1];
        return dst;
    },
    Neg : function(src) {
        var dst = new Float32Array(2);
        dst[0] = -src[0];
        dst[1] = -src[1];
        return dst;
    },
    setX : function(dst, x) {
        dst[0] = x;
        return dst;
    },
    SetX : function(src, x) {
        var dst = new Float32Array(2);
        dst[0] = x;
        dst[1] = src[1];
        return dst;
    },
    setY : function(dst, y) {
        dst[1] = y;
        return dst;
    },
    SetY : function(src, y) {
        var dst = new Float32Array(2);
        dst[0] = src[0];
        dst[1] = y;
        return dst;
    },
    addX : function(dst, x) {
        dst[0] += x;
        return dst;
    },
    AddX : function(src, x) {
        var dst = new Float32Array(2);
        dst[0] = src[0] + x;
        dst[1] = src[1];
        return dst;
    },
    addY : function(dst, y) {
        dst[1] += y;
        return dst;
    },
    AddY : function(src, y) {
        var dst = new Float32Array(2);
        dst[0] = src[0];
        dst[1] = src[1] + y;
        return dst;
    },
    add : function(lhs, rhs) {
        lhs[0] += rhs[0];
        lhs[1] += rhs[1];
        return lhs;
    },
    Add : function(lhs, rhs) {
        var dst = new Float32Array(2);
        dst[0] = lhs[0] + rhs[0];
        dst[1] = lhs[1] + rhs[1];
        return dst;
    },
    sub : function(lhs, rhs) {
        lhs[0] -= rhs[0];
        lhs[1] -= rhs[1];
        return lhs;
    },
    Sub : function(lhs, rhs) {
        var dst = new Float32Array(2);
        dst[0] = lhs[0] - rhs[0];
        dst[1] = lhs[1] - rhs[1];
        return dst;
    },
    mul : function(lhs, rhs) {
        lhs[0] *= rhs[0];
        lhs[1] *= rhs[1];
        return lhs;
    },
    Mul : function(lhs, rhs) {
        var dst = new Float32Array(2);
        dst[0] = lhs[0] * rhs[0];
        dst[1] = lhs[1] * rhs[1];
        return dst;
    },
    muls : function(lhs, rhs) {
        lhs[0] *= rhs;
        lhs[1] *= rhs;
        return lhs;
    },
    Muls : function(lhs, rhs) {
        var dst = new Float32Array(2);
        dst[0] = lhs[0] * rhs;
        dst[1] = lhs[1] * rhs;
        return dst;
    },
    div : function(lhs, rhs) {
        lhs[0] /= rhs[0];
        lhs[1] /= rhs[1];
        return lhs;
    },
    Div : function(lhs, rhs) {
        var dst = new Float32Array(2);
        dst[0] = lhs[0] / rhs[0];
        dst[1] = lhs[1] / rhs[1];
        return dst;
    },
    divs : function(lhs, rhs) {
        lhs[0] /= rhs;
        lhs[1] /= rhs;
        return lhs;
    },
    Divs : function(lhs, rhs) {
        var dst = new Float32Array(2);
        dst[0] = lhs[0] / rhs;
        dst[1] = lhs[1] / rhs;
        return dst;
    },
    IsZero : function(src) {
        return src[0] == 0 && src[1] == 0;
    },
    IsEqual : function(lhs, rhs) {
        return lhs[0] == rhs[0] && lhs[1] == rhs[1];
    },
    Length : function(src) {
        return Math.sqrt(src[0] * src[0] + src[1] * src[1]);
    },
    CalcDist : function(lhs, rhs) {
        return v2.Length(v2.Sub(lhs, rhs));
    },
    normalize : function(dst) {
        var length = this.Length(dst);
        if (length != 0) {
            dst[0] = dst[0] / length;
            dst[1] = dst[1] / length;
        } else {
            dst[0] = dst[1] = 0;
        }
        return dst;
    },
    Normalize : function(src) {
        return v2.normalize(v2.Dup(src));
    },
    Dot : function(lhs, rhs) {
        return lhs[0] * rhs[0] + lhs[1] * rhs[1];
    },
    setMid : function(dst, lhs, rhs) {
        return v2.set(dst,
                      (lhs[0] + rhs[0]) * 0.5,
                      (lhs[1] + rhs[1]) * 0.5);
    },
    Mid : function(lhs, rhs) {
        return v2.Make((lhs[0] + rhs[0]) * 0.5,
                       (lhs[1] + rhs[1]) * 0.5);
    },
    setLerp : function(dst, lhs, rhs, f) {
        var f0 = 1 - f;
        return v2.set(dst,
                      lhs[0] * f0 + rhs[0] * f,
                      lhs[1] * f0 + rhs[1] * f);
    },
    Lerp : function(lhs, rhs, f) {
        var f0 = 1 - f;
        return v2.Make(lhs[0] * f0 + rhs[0] * f,
                       lhs[1] * f0 + rhs[1] * f);
    },
    Min : function(lhs, rhs) {
        return v2.Make(lhs[0] < rhs[0] ? lhs[0] : rhs[0],
                       lhs[1] < rhs[1] ? lhs[1] : rhs[1]);
    },
    Max : function(lhs, rhs) {
        return v2.Make(lhs[0] > rhs[0] ? lhs[0] : rhs[0],
                       lhs[1] > rhs[1] ? lhs[1] : rhs[1]);
    },
    Clamp : function(v, min, max) {
        return v2.Make(v[0] < min[0] ? min[0] : (max[0] < v[0] ? max[0] : v[0]),
                       v[1] < min[1] ? min[1] : (max[1] < v[1] ? max[1] : v[1]));
    },
    Clamps : function(v, min, max) {
        return v2.Make(v[0] < min ? min : (max < v[0] ? max : v[0]),
                       v[1] < min ? min : (max < v[1] ? max : v[1]));
    },
    ToArray : function(v) {
        return [v[0], v[1]];
    },
    FromArray : function(v) {
        return v2.Make(v[0], v[1]);
    },
    ToString : function(v) {
        return '(' + v[0] + ', ' + v[1] + ')';
    },
    ToFixed : function(v, d) {
        return '(' + v[0].toFixed(d)
            + ', ' + v[1].toFixed(d) + ')';
    },
};
v2.zero = v2.Makes(0);
v2.ones = v2.Makes(1);
v2.ex = v2.Make(1, 0);
v2.ey = v2.Make(0, 1);
  </script>
  <!-- <script src="v3.js"></script> -->
  <script>
'use strict';
// 3D vector math functions.
var v3 = {
    set : function(dst, x, y, z) {
        dst[0] = x; dst[1] = y; dst[2] = z;
        return dst;
    },
    sets : function(dst, x) {
        dst[0] = dst[1] = dst[2] = x;
        return dst;
    },
    MakeUndef : function() {
        return new Float32Array(3);
    },
    Make : function(x, y, z) {
        var dst = new Float32Array(3);
        dst[0] = x; dst[1] = y; dst[2] = z;
        return dst;
    },
    Makes : function(x) {
        var dst = new Float32Array(3);
        dst[0] = dst[1] = dst[2] = x;
        return dst;
    },
    MakeRandomRange : function(min, max) {
        var dst = new Float32Array(3);
        var range = max - min;
        dst[0] = min + Math.random() * range;
        dst[1] = min + Math.random() * range;
        dst[2] = min + Math.random() * range;
        return dst;
    },
    copy : function(dst, src) {
        dst[0] = src[0]; dst[1] = src[1]; dst[2] = src[2];
        return dst;
    },
    Dup : function(src) {
        var dst = new Float32Array(3);
        dst[0] = src[0]; dst[1] = src[1]; dst[2] = src[2];
        return dst;
    },
    neg : function(dst) {
        dst[0] = -dst[0];
        dst[1] = -dst[1];
        dst[2] = -dst[2];
        return dst;
    },
    Neg : function(src) {
        var dst = new Float32Array(3);
        dst[0] = -src[0];
        dst[1] = -src[1];
        dst[2] = -src[2];
        return dst;
    },
    setX : function(dst, x) {
        dst[0] = x;
        return dst;
    },
    SetX : function(src, x) {
        var dst = new Float32Array(3);
        dst[0] = x;
        dst[1] = src[1];
        dst[2] = src[2];
        return dst;
    },
    setY : function(dst, y) {
        dst[1] = y;
        return dst;
    },
    SetY : function(src, y) {
        var dst = new Float32Array(3);
        dst[0] = src[0];
        dst[1] = y;
        dst[2] = src[2];
        return dst;
    },
    setZ : function(dst, z) {
        dst[2] = z;
        return dst;
    },
    SetZ : function(src, z) {
        var dst = new Float32Array(3);
        dst[0] = src[0];
        dst[1] = src[1];
        dst[2] = z;
        return dst;
    },
    addX : function(dst, x) {
        dst[0] += x;
        return dst;
    },
    AddX : function(src, x) {
        var dst = new Float32Array(3);
        dst[0] = src[0] + x;
        dst[1] = src[1];
        dst[2] = src[2];
        return dst;
    },
    addY : function(dst, y) {
        dst[1] += y;
        return dst;
    },
    AddY : function(src, y) {
        var dst = new Float32Array(3);
        dst[0] = src[0];
        dst[1] = src[1] + y;
        dst[2] = src[2];
        return dst;
    },
    addZ : function(dst, z) {
        dst[2] += z;
        return dst;
    },
    AddZ : function(src, z) {
        var dst = new Float32Array(3);
        dst[0] = src[0];
        dst[1] = src[1];
        dst[2] = src[2] + z;
        return dst;
    },
    add : function(lhs, rhs) {
        lhs[0] += rhs[0];
        lhs[1] += rhs[1];
        lhs[2] += rhs[2];
        return lhs;
    },
    Add : function(lhs, rhs) {
        var dst = new Float32Array(3);
        dst[0] = lhs[0] + rhs[0];
        dst[1] = lhs[1] + rhs[1];
        dst[2] = lhs[2] + rhs[2];
        return dst;
    },
    sub : function(lhs, rhs) {
        lhs[0] -= rhs[0];
        lhs[1] -= rhs[1];
        lhs[2] -= rhs[2];
        return lhs;
    },
    Sub : function(lhs, rhs) {
        var dst = new Float32Array(3);
        dst[0] = lhs[0] - rhs[0];
        dst[1] = lhs[1] - rhs[1];
        dst[2] = lhs[2] - rhs[2];
        return dst;
    },
    mul : function(lhs, rhs) {
        lhs[0] *= rhs[0];
        lhs[1] *= rhs[1];
        lhs[2] *= rhs[2];
        return lhs;
    },
    Mul : function(lhs, rhs) {
        var dst = new Float32Array(3);
        dst[0] = lhs[0] * rhs[0];
        dst[1] = lhs[1] * rhs[1];
        dst[2] = lhs[2] * rhs[2];
        return dst;
    },
    muls : function(lhs, rhs) {
        lhs[0] *= rhs;
        lhs[1] *= rhs;
        lhs[2] *= rhs;
        return lhs;
    },
    Muls : function(lhs, rhs) {
        var dst = new Float32Array(3);
        dst[0] = lhs[0] * rhs;
        dst[1] = lhs[1] * rhs;
        dst[2] = lhs[2] * rhs;
        return dst;
    },
    div : function(lhs, rhs) {
        lhs[0] /= rhs[0];
        lhs[1] /= rhs[1];
        lhs[2] /= rhs[2];
        return lhs;
    },
    Div : function(lhs, rhs) {
        var dst = new Float32Array(3);
        dst[0] = lhs[0] / rhs[0];
        dst[1] = lhs[1] / rhs[1];
        dst[2] = lhs[2] / rhs[2];
        return dst;
    },
    divs : function(lhs, rhs) {
        lhs[0] /= rhs;
        lhs[1] /= rhs;
        lhs[2] /= rhs;
        return lhs;
    },
    Divs : function(lhs, rhs) {
        var dst = new Float32Array(3);
        dst[0] = lhs[0] / rhs;
        dst[1] = lhs[1] / rhs;
        dst[2] = lhs[2] / rhs;
        return dst;
    },
    IsZero : function(src) {
        return src[0] == 0 && src[1] == 0 && src[2] == 0;
    },
    IsEqual : function(lhs, rhs) {
        return lhs[0] == rhs[0] && lhs[1] == rhs[1] && lhs[2] == rhs[2];
    },
    Length : function(src) {
        return Math.sqrt(src[0] * src[0] + src[1] * src[1] + src[2] * src[2]);
    },
    CalcDist : function(lhs, rhs) {
        return v3.Length(v3.Sub(lhs, rhs));
    },
    normalize : function(dst) {
        var length = v3.Length(dst);
        if (length != 0) {
            dst[0] /= length;
            dst[1] /= length;
            dst[2] /= length;
        } else {
            dst[0] = dst[1] = dst[2] = 0;
        }
        return dst;
    },
    Normalize : function(src) {
        return v3.normalize(v3.Dup(src));
    },
    Dot : function(lhs, rhs) {
        return lhs[0] * rhs[0] + lhs[1] * rhs[1] + lhs[2] * rhs[2];
    },
    setCross : function(dst, lhs, rhs) {
        return v3.set(dst,
                      lhs[1] * rhs[2] - lhs[2] * rhs[1],
                      lhs[2] * rhs[0] - lhs[0] * rhs[2],
                      lhs[0] * rhs[1] - lhs[1] * rhs[0]);
    },
    Cross : function(lhs, rhs) {
        return v3.Make(lhs[1] * rhs[2] - lhs[2] * rhs[1],
                       lhs[2] * rhs[0] - lhs[0] * rhs[2],
                       lhs[0] * rhs[1] - lhs[1] * rhs[0]);
    },
    setMid : function(dst, lhs, rhs) {
        return v3.set(dst,
                      (lhs[0] + rhs[0]) * 0.5,
                      (lhs[1] + rhs[1]) * 0.5,
                      (lhs[2] + rhs[2]) * 0.5);
    },
    Mid : function(lhs, rhs) {
        return v3.Make((lhs[0] + rhs[0]) * 0.5,
                       (lhs[1] + rhs[1]) * 0.5,
                       (lhs[2] + rhs[2]) * 0.5);
    },
    setLerp : function(dst, lhs, rhs, f) {
        var f0 = 1 - f;
        return v3.set(dst,
                      lhs[0] * f0 + rhs[0] * f,
                      lhs[1] * f0 + rhs[1] * f,
                      lhs[2] * f0 + rhs[2] * f);
    },
    Lerp : function(lhs, rhs, f) {
        var f0 = 1 - f;
        return v3.Make(lhs[0] * f0 + rhs[0] * f,
                       lhs[1] * f0 + rhs[1] * f,
                       lhs[2] * f0 + rhs[2] * f);
    },
    Min : function(lhs, rhs) {
        return v3.Make(lhs[0] < rhs[0] ? lhs[0] : rhs[0],
                       lhs[1] < rhs[1] ? lhs[1] : rhs[1],
                       lhs[2] < rhs[2] ? lhs[2] : rhs[2]);
    },
    Max : function(lhs, rhs) {
        return v3.Make(lhs[0] > rhs[0] ? lhs[0] : rhs[0],
                       lhs[1] > rhs[1] ? lhs[1] : rhs[1],
                       lhs[2] > rhs[2] ? lhs[2] : rhs[2]);
    },
    Clamp : function(v, min, max) {
        return v3.Make(v[0] < min[0] ? min[0] : (max[0] < v[0] ? max[0] : v[0]),
                       v[1] < min[1] ? min[1] : (max[1] < v[1] ? max[1] : v[1]),
                       v[2] < min[2] ? min[2] : (max[2] < v[2] ? max[2] : v[2]));
    },
    Clamps : function(v, min, max) {
        return v3.Make(v[0] < min ? min : (max < v[0] ? max : v[0]),
                       v[1] < min ? min : (max < v[1] ? max : v[1]),
                       v[2] < min ? min : (max < v[2] ? max : v[2]));
    },
    ToArray : function(v) {
        return [v[0], v[1], v[2]];
    },
    FromArray : function(v) {
        return v3.Make(v[0], v[1], v[2]);
    },
    ToString : function(v) {
        return '(' + v[0] + ', ' + v[1] + ', ' + v[2] + ')';
    },
    ToFixed : function(v, d) {
        return '(' + v[0].toFixed(d)
            + ', ' + v[1].toFixed(d)
            + ', ' + v[2].toFixed(d) + ')';
    },
    ToColorCode : function(v) {
        var ret = '#';
        for (var i = 0; i < 3; ++i) {
            var t = Math.ceil(clamp(v[i], 0, 1) * 255).toString(16);
            ret += t.length < 2 ? '0' + t : t;
        }
        return ret;
    },
};
v3.zero = v3.Makes(0);
v3.ones = v3.Makes(1);
v3.ex = v3.Make(1, 0, 0);
v3.ey = v3.Make(0, 1, 0);
v3.ez = v3.Make(0, 0, 1);
  </script>
  <!-- <script src="v4.js"></script> -->
  <script>
'use strict';
// 4D vector math functions.
var v4 = {
    set : function(dst, x, y, z, w) {
        dst[0] = x; dst[1] = y; dst[2] = z; dst[3] = w;
        return dst;
    },
    sets : function(dst, x) {
        dst[0] = dst[1] = dst[2] = dst[3] = x;
        return dst;
    },
    MakeUndef : function() {
        return new Float32Array(4);
    },
    Make : function(x, y, z, w) {
        var dst = new Float32Array(4);
        dst[0] = x; dst[1] = y; dst[2] = z; dst[3] = w;
        return dst;
    },
    Makes : function(x) {
        var dst = new Float32Array(4);
        dst[0] = dst[1] = dst[2] = dst[3] = x;
        return dst;
    },
    copy : function(src, dst) {
        dst[0] = src[0]; dst[1] = src[1]; dst[2] = src[2]; dst[3] = src[3];
        return dst;
    },
    Dup : function(src) {
        var dst = new Float32Array(4);
        dst[0] = src[0]; dst[1] = src[1]; dst[2] = src[2]; dst[3] = src[3];
        return dst;
    },
    neg : function(dst) {
        dst[0] = -src[0];
        dst[1] = -src[1];
        dst[2] = -src[2];
        dst[3] = -src[3];
        return dst;
    },
    Neg : function(src) {
        var dst = new Float32Array(4);
        dst[0] = -src[0];
        dst[1] = -src[1];
        dst[2] = -src[2];
        dst[3] = -src[3];
        return dst;
    },
    setX : function(dst, x) {
        dst[0] = x;
        return dst;
    },
    SetX : function(src, x) {
        var dst = new Float32Array(4);
        dst[0] = x;
        dst[1] = src[1];
        dst[2] = src[2];
        dst[3] = src[3];
        return dst;
    },
    setY : function(dst, y) {
        dst[1] = y;
        return dst;
    },
    SetY : function(src, y) {
        var dst = new Float32Array(4);
        dst[0] = src[0];
        dst[1] = y;
        dst[2] = src[2];
        dst[3] = src[3];
        return dst;
    },
    setZ : function(dst, z) {
        dst[2] = z;
        return dst;
    },
    SetZ : function(src, z) {
        var dst = new Float32Array(4);
        dst[0] = src[0];
        dst[1] = src[1];
        dst[2] = z;
        dst[3] = src[3];
        return dst;
    },
    setW : function(dst, w) {
        dst[3] = w;
        return dst;
    },
    SetW : function(src, w) {
        var dst = new Float32Array(4);
        dst[0] = src[0];
        dst[1] = src[1];
        dst[2] = src[2];
        dst[3] = w;
        return dst;
    },
    addX : function(dst, x) {
        dst[0] += x;
        return dst;
    },
    AddX : function(src, x) {
        var dst = new Float32Array(4);
        dst[0] = src[0] + x;
        dst[1] = src[1];
        dst[2] = src[2];
        dst[3] = src[3];
        return dst;
    },
    addY : function(dst, y) {
        dst[1] += y;
        return dst;
    },
    AddY : function(src, y) {
        var dst = new Float32Array(4);
        dst[0] = src[0];
        dst[1] = src[1] + y;
        dst[2] = src[2];
        dst[3] = src[3];
        return dst;
    },
    addZ : function(dst, z) {
        dst[2] += z;
        return dst;
    },
    AddZ : function(src, z) {
        var dst = new Float32Array(4);
        dst[0] = src[0];
        dst[1] = src[1];
        dst[2] = src[2] + z;
        dst[3] = src[3];
        return dst;
    },
    addW : function(dst, w) {
        dst[3] += w;
        return dst;
    },
    AddW : function(src, w) {
        var dst = new Float32Array(4);
        dst[0] = src[0];
        dst[1] = src[1];
        dst[2] = src[2];
        dst[3] = src[3] + w;
        return dst;
    },
    add : function(lhs, rhs) {
        lhs[0] += rhs[0];
        lhs[1] += rhs[1];
        lhs[2] += rhs[2];
        lhs[3] += rhs[3];
        return lhs;
    },
    Add : function(lhs, rhs) {
        var dst = new Float32Array(4);
        dst[0] = lhs[0] + rhs[0];
        dst[1] = lhs[1] + rhs[1];
        dst[2] = lhs[2] + rhs[2];
        dst[3] = lhs[3] + rhs[3];
        return dst;
    },
    sub : function(lhs, rhs) {
        lhs[0] -= rhs[0];
        lhs[1] -= rhs[1];
        lhs[2] -= rhs[2];
        lhs[3] -= rhs[3];
        return lhs;
    },
    Sub : function(lhs, rhs) {
        var dst = new Float32Array(4);
        dst[0] = lhs[0] - rhs[0];
        dst[1] = lhs[1] - rhs[1];
        dst[2] = lhs[2] - rhs[2];
        dst[3] = lhs[3] - rhs[3];
        return dst;
    },
    mul : function(lhs, rhs) {
        lhs[0] *= rhs[0];
        lhs[1] *= rhs[1];
        lhs[2] *= rhs[2];
        lhs[3] *= rhs[3];
        return lhs;
    },
    Mul : function(lhs, rhs) {
        var dst = new Float32Array(4);
        dst[0] = lhs[0] * rhs[0];
        dst[1] = lhs[1] * rhs[1];
        dst[2] = lhs[2] * rhs[2];
        dst[3] = lhs[3] * rhs[3];
        return dst;
    },
    muls : function(lhs, rhs) {
        lhs[0] *= rhs;
        lhs[1] *= rhs;
        lhs[2] *= rhs;
        lhs[3] *= rhs;
        return lhs;
    },
    Muls : function(lhs, rhs) {
        var dst = new Float32Array(4);
        dst[0] = lhs[0] * rhs;
        dst[1] = lhs[1] * rhs;
        dst[2] = lhs[2] * rhs;
        dst[3] = lhs[3] * rhs;
        return dst;
    },
    div : function(lhs, rhs) {
        lhs[0] /= rhs[0];
        lhs[1] /= rhs[1];
        lhs[2] /= rhs[2];
        lhs[3] /= rhs[3];
        return lhs;
    },
    Div : function(lhs, rhs) {
        var dst = new Float32Array(4);
        dst[0] = lhs[0] / rhs[0];
        dst[1] = lhs[1] / rhs[1];
        dst[2] = lhs[2] / rhs[2];
        dst[3] = lhs[3] / rhs[3];
        return dst;
    },
    divs : function(lhs, rhs) {
        lhs[0] /= rhs;
        lhs[1] /= rhs;
        lhs[2] /= rhs;
        lhs[3] /= rhs;
        return lhs;
    },
    Divs : function(lhs, rhs) {
        var dst = new Float32Array(4);
        dst[0] = lhs[0] / rhs;
        dst[1] = lhs[1] / rhs;
        dst[2] = lhs[2] / rhs;
        dst[3] = lhs[3] / rhs;
        return dst;
    },
    IsZero : function(src) {
        return src[0] == 0 && src[1] == 0 && src[2] == 0 && src[3] == 0;
    },
    IsEqual : function(lhs, rhs) {
        return lhs[0] == rhs[0] && lhs[1] == rhs[1]
            && lhs[2] == rhs[2] && lhs[3] == rhs[3];
    },
    setMid : function(dst, lhs, rhs) {
        return v4.set(dst,
                      (lhs[0] + rhs[0]) * 0.5,
                      (lhs[1] + rhs[1]) * 0.5,
                      (lhs[2] + rhs[2]) * 0.5,
                      (lhs[3] + rhs[3]) * 0.5);
    },
    Mid : function(lhs, rhs) {
        return v4.Make((lhs[0] + rhs[0]) * 0.5,
                       (lhs[1] + rhs[1]) * 0.5,
                       (lhs[2] + rhs[2]) * 0.5,
                       (lhs[3] + rhs[3]) * 0.5);
    },
    setLerp : function(dst, lhs, rhs, f) {
        var f0 = 1 - f;
        return v4.set(dst,
                      lhs[0] * f0 + rhs[0] * f,
                      lhs[1] * f0 + rhs[1] * f,
                      lhs[2] * f0 + rhs[2] * f,
                      lhs[3] * f0 + rhs[3] * f);
    },
    Lerp : function(lhs, rhs, f) {
        var f0 = 1 - f;
        return v4.Make(lhs[0] * f0 + rhs[0] * f,
                       lhs[1] * f0 + rhs[1] * f,
                       lhs[2] * f0 + rhs[2] * f,
                       lhs[3] * f0 + rhs[3] * f);
    },
    Min : function(lhs, rhs) {
        return v4.Make(lhs[0] < rhs[0] ? lhs[0] : rhs[0],
                       lhs[1] < rhs[1] ? lhs[1] : rhs[1],
                       lhs[2] < rhs[2] ? lhs[2] : rhs[2],
                       lhs[3] < rhs[3] ? lhs[3] : rhs[3]);
    },
    Max : function(lhs, rhs) {
        return v4.Make(lhs[0] > rhs[0] ? lhs[0] : rhs[0],
                       lhs[1] > rhs[1] ? lhs[1] : rhs[1],
                       lhs[2] > rhs[2] ? lhs[2] : rhs[2],
                       lhs[3] > rhs[3] ? lhs[3] : rhs[3]);
    },
    Clamp : function(v, min, max) {
        return v4.Make(v[0] < min[0] ? min[0] : (max[0] < v[0] ? max[0] : v[0]),
                       v[1] < min[1] ? min[1] : (max[1] < v[1] ? max[1] : v[1]),
                       v[2] < min[2] ? min[2] : (max[2] < v[2] ? max[2] : v[2]),
                       v[3] < min[3] ? min[3] : (max[3] < v[3] ? max[3] : v[3]));
    },
    Clamps : function(v, min, max) {
        return v4.Make(v[0] < min ? min : (max < v[0] ? max : v[0]),
                       v[1] < min ? min : (max < v[1] ? max : v[1]),
                       v[2] < min ? min : (max < v[2] ? max : v[2]),
                       v[3] < min ? min : (max < v[3] ? max : v[3]));
    },
    ToArray : function(v) {
        return [v[0], v[1], v[2], v[3]];
    },
    FromArray : function(v) {
        return v4.Make(v[0], v[1], v[2], v[3]);
    },
    FromV3 : function(v, w) {
        return v4.Make(v[0], v[1], v[2], w);
    },
    ToString : function(v) {
        return '(' + v[0] + ', ' + v[1] + ', ' + v[2] + ', ' + v[3] + ')';
    },
    ToFixed : function(v, d) {
        return '(' + v[0].toFixed(d)
            + ', ' + v[1].toFixed(d)
            + ', ' + v[2].toFixed(d)
            + ', ' + v[3].toFixed(d) + ')';
    },
};
v4.zero = v4.Makes(0);
v4.ones = v4.Makes(1);
v4.ex = v4.Make(1, 0, 0, 0);
v4.ey = v4.Make(0, 1, 0, 0);
v4.ez = v4.Make(0, 0, 1, 0);
v4.ew = v4.Make(0, 0, 0, 1);
v4.cWhite   = v4.Make(1, 1, 1, 1);
v4.cBlack   = v4.Make(0, 0, 0, 1);
v4.cGray    = v4.Make(0.5, 0.5, 0.5, 1);
v4.cRed     = v4.Make(1, 0, 0, 1);
v4.cGreen   = v4.Make(0, 1, 0, 1);
v4.cBlue    = v4.Make(0, 0, 1, 1);
v4.cMagenta = v4.Make(1, 0, 1, 1);
v4.cCyan    = v4.Make(0, 1, 1, 1);
v4.cYellow  = v4.Make(1, 1, 0, 1);
  </script>
  <!-- <script src="aabb.js"></script> -->
  <script>
'use strict';
// 3D AABB
var aabb3 = {
    set : function(dst, min, max) {
        v3.copy(dst[0], min); v3.copy(dst[1], max);
        return dst;
    },
    MakeUndef : function() {
        return [v3.Makes(0), v3.Makes(-1)];
    },
    Make : function(min, max) {
        return [v3.Dup(min), v3.Dup(max)];
    },
    Move : function(min, max) {
        return [min, max];
    },
    copy : function(dst, src) {
        v3.copy(dst[0], src[0]); v3.copy(dst[1], src[1]);
        return dst;
    },
    Dup : function(src) {
        return [v3.Dup(src[0]), v3.Dup(src[1])];
    },
    IsValid : function(v) {
        return v[0][0] <= v[1][0];
    },
    extendWith : function(dst, v) {
        if (aabb3.IsValid(dst)) {
            dst[0] = v3.Min(dst[0], v);
            dst[1] = v3.Max(dst[1], v);
        } else {
            aabb3.set(dst, v, v);
        }
        return dst;
    },
    MulMtx : function(v, mtx) {
        if (!mtx) { return v; }
        return [m34.MulV3(mtx, v[0]), m34.MulV3(mtx, v[1])];
    },
    CalcCenter : function(v, mtx)
    {
        var ret = v3.Mid(v[0], v[1]);
        if (mtx) { ret = m34.MulV3(mtx, ret); }
        return ret;
    },
    CalcBoundingSphere : function(v, mtx)
    {
        var tmp = aabb3.MulMtx(v, mtx);
        var center = v3.Mid(tmp[0], tmp[1]);
        var radius = v3.Length(v3.Sub(center, tmp[0]));
        return v4.Make(center[0], center[1], center[2], radius);
    },
    ToFixed : function(v, d)
    {
        return '[' + v3.ToFixed(v[0], d) + ', ' + v3.ToFixed(v[1], d) + ']';
    },
};
  </script>
  <!-- <script src="dom.js"></script> -->
  <script>
'use strict';
var cAltEmptyText = 'N/A';
function GetElement(id) { return document.getElementById(id); }
function GetElements(name) { return document.getElementsByName(name); }
function CreateElement(tagName, className)
{
    var ret = document.createElement(tagName);
    if (className) { ret.className = className; }
    return ret;
}
function SetClass(node, name)
{
    if (node) { node.className = name; }
    return node;
}
function LangSpan(text, className, fill_default)
{
    if (!Array.isArray(text) && !className) { return text; }
    var ps = CreateElement('span');
    if (className) { ps.className = className; }
    if (Array.isArray(text)) {
        var def = '';
        if (fill_default) {
            for (var il = 0; il < cLanguages.length; ++il) {
                def = text[il];
                if (def) { break; }
            };
        }
        for (var il = 0; il < cLanguages.length; ++il) {
            var sp = CreateElement('span', 'il-' + cLanguages[il]);
            sp.innerText = text[il] || def;
            ps.append(sp);
        };
    } else {
        ps.innerText = text;
    }
    return ps;
}
function LangAppendTo(text, data)
{
    if (!Array.isArray(text)) {
        if (!Array.isArray(data)) { return text + data; }
        text = cLanguages.map(t => text);
    }
    for (var il = 0; il < cLanguages.length; ++il) {
        text[il] += Array.isArray(data) ? data[il] : data;
    };
    return text;
}
function LangAppend(text, data)
{
    text = Array.isArray(text) ? Array.from(text) : text;
    return LangAppendTo(text, data);
}
function LangJoin(texts)
{
    var ret = texts[0];
    for (var i = 1; i < texts.length; ++i) {
        ret = LangAppend(ret, texts[i]);
    }
    return ret;
}
function LangAppendSp(text, data)
{
    return LangJoin([text, cLang.cmn_sp, data]);
}
function LangGet(text)
{
    if (!Array.isArray(text)) { return text; }
    var ret = text[0];
    for (var i = 1; i < text.length; ++i) {
        if (g_language == cLanguages[i]) {
            var tmp = text[i];
            if (tmp !== null && tmp !== undefined) {
                ret = tmp;
                break;
            }
        }
    }
    return ret;
}
function LangAlert(text) { alert(LangGet(text)); }
function LangConfirm(text) { return confirm(LangGet(text)); }
function CreateLinkImpl(label, title, impl)
{
    if (!Array.isArray(label) && !(title && Array.isArray(title)))
    {
        var a = CreateElement('a');
        a.innerHTML = label;
        impl(a);
        if (title) { a.title = title; }
        return a;
    }
    var ps = CreateElement('span');
    for (var il = 0; il < cLanguages.length; ++il) {
        var link_text = label;
        if (Array.isArray(label)) {
            link_text = label[il];
            if (!link_text) {
                for (var il2 = 0; il2 < cLanguages.length; ++il2) {
                    link_text = label[il2];
                    if (link_text) { break; }
                }
            }
        }
        var a = CreateLinkImpl(
            link_text, title && Array.isArray(title) ? title[il] : title, impl);
        a.className = (a.className ? a.className + ' ' : '') + 'il-' + cLanguages[il];
        ps.append(a);
    };
    return ps;
}
function CreateLink(label, url, title)
{
    return CreateLinkImpl(label, title, function(a) {
        a.href = url;
        a.target = '_blank';
    });
}
function CreateScriptLink(label, f, title)
{
    return CreateLinkImpl(label, title, function(a) {
        a.href = 'javascript:void(0);';
        a.onclick = f;
    });
}
function CreateScriptLinkButton(label, f, title)
{
    return CreateLinkImpl(label, title, function(a) {
        a.href = 'javascript:void(0);';
        a.className = 'button';
        a.onclick = f;
    });
}
function CreateScriptLinkEdit(label, f, title)
{
    return CreateEditDiv(CreateScriptLink(label, f, title));
}
function ClearChildren(node)
{
    while (node.firstChild) { node.firstChild.remove() }
}
function ClearSelection()
{
    if (document.selection && document.selection.empty) {
        document.selection.empty();
    } else if (window.getSelection) {
        window.getSelection().removeAllRanges();
    }
}
function ToggleContent(id, mode, force_visible)
{
    if (typeof CancelMouse !== 'undefined') { CancelMouse(); }
    var obj_on = GetElement(id+'-on'), obj = obj_on.parentElement;
    if (obj_on.style.display == 'none' || force_visible == 'show') {
        obj_on.style.display = null/*'block'*/;
        obj.className = obj.className.replace(/ *hide/, '');
        if (mode == 'left') { obj.style.right = obj.style.bottom = null; }
        else if (mode == 'right') { obj.style.left = obj.style.bottom = null; }
        else if (mode == 'log') { obj.style.height = null; }
        return true;
    } else {
        obj_on.style.display = 'none';
        obj.className += ' hide';
        if (mode == 'left') { obj.style.right = obj.style.bottom = 'auto'; }
        else if (mode == 'right') { obj.style.left = obj.style.bottom = 'auto'; }
        else if (mode == 'log') { obj.style.height = 'auto'; }
        return false;
    }
}
function ToggleLinkColor(id, f)
{
    var elem = GetElement(id);
    elem.className = f ? '' : 'disabled';
}
var BodyClassNameSlot = {
    MenuDisplay  : 0,
    LogDisplay   : 1,
    VerticalMode : 2,
    Language     : 3,
    PhotoMode    : 4,
    Num          : 5,
};
var g_body_class_names = [
    'menu-on', 'log-on', 'horizontal', 'en', 'photo-off',
];
function GetBodyClassName(slot)
{
    return g_body_class_names[slot];
}
function SetBodyClassName(slot, name)
{
    if (slot !== undefined) { g_body_class_names[slot] = name; }
    var tmp = '';
    for (var i = 0; i < BodyClassNameSlot.Num; ++i) {
        tmp += (tmp == '' ? '' : ' ') + g_body_class_names[i];
    }
    document.body.className = tmp;
}
function CreateEditDiv(cont)
{
    var div_edit = CreateElement('div', 'ui-edit');
    div_edit.append(cont);
    return div_edit;
};
function CreateEditPane(name, title, f, a_this)
{
    var div_list = CreateElement('div');
    g_mouse.pushCoverElements(div_list);
    div_list.className = 'edit-pane';
    div_list.style.display = 'none';
    var head = CreateElement('h1');
    var f_toggle = function() { ToggleContent(name, 'left'); };
    head.append(CreateScriptLink(title, f_toggle));
    div_list.append(head);
    var div_on = CreateElement('div');
    div_on.id = name + '-on';
    div_on.style.width = '100%';
    div_on.style.display = 'none';
    f.apply(a_this, [div_on]);
    var foot = CreateElement('div');
    foot.className = 'edit-foot';
    div_on.append(foot);
    div_list.append(div_on, CreateBR('horizontal-only'));
    document.body.append(div_list);
    f_toggle();
    return div_list;
}
function CreateBR(className) { return CreateElement('br', className); }
function CreateHBR(vert_txt)
{
    var ret = CreateElement('span');
    ret.append(CreateBR('horizontal-only'));
    var vert = CreateElement('span', 'vertical-only');
    vert.append(vert_txt || ' ');
    ret.append(vert);
    return ret;
}
function CreateHBRVSL() { return CreateHBR(' / '); }
  </script>
  <!-- <script src="ui_ctrl.js"></script> -->
  <script>
'use strict';
var UI_KeyCode = {
    Enter : 13,
    Esc   : 27,
};
var UI_Radios = CreateSingleton();
UI_Radios.createMgr = function(args)
{
    var mgr = CreateInstance();
    mgr.mName = args.name;
    mgr.mTitle = args.title;
    mgr.createInstance = function(args)
    {
        var inst = CreateInstance();
        var node = CreateElement('input');
        inst.mParentNode = args.parent;
        inst.mNode = node;
        node.type = 'radio';
        node.name = this.mName;
        node.value = args.id;
        node.title = mgr.mTitle;
        if (args.prepend) {
            args.parent.prepend(node, ' ');
        } else {
            args.parent.append(' ', node);
        }
        return inst;
    };
    mgr.updateCheck = function()
    {
        var first_inst = null, is_checked = false;
        this.forEach(function(inst) {
            if (!first_inst) { first_inst = inst; }
            if (UI_Radios.isChecked(inst)) { is_checked = true; }
        });
        if (!is_checked && first_inst) {
            UI_Radios.setCheck(first_inst);
        }
    };
    mgr.getChecked = function()
    {
        var ret = null;
        this.forEach(function(inst) {
            if (!inst) { debugger; }
            if (UI_Radios.isChecked(inst)) { ret = inst; }
        });
        return ret;
    };
    mgr.getValue = function()
    {
        var inst = this.getChecked();
        return inst && inst.mNode.value;
    };
    mgr.forEach = args.for_each;
    return mgr;
};
UI_Radios.isChecked = function(inst) { return inst.mNode.checked; };
UI_Radios.setCheck = function(inst) { inst.mNode.checked = true; };
var UI_Replace = CreateSingleton();
UI_Replace.createMgr = function(args)
{
    var mgr = CreateInstance();
    console.assert(args.fixed || args.disable_undo ? !args.name : args.name);
    mgr.mValueName = args.name;
    if (args.parent_mgr) { mgr.mParentMgr = args.parent_mgr; }
    if (args.fixed) { mgr.mIsFixed = args.fixed; mgr.mIsDisableUndo = true; }
    if (args.root) { mgr.mIsRoot = args.root; }
    else if (args.disable_undo) { mgr.mIsDisableUndo = args.disable_undo; }
    mgr.mControlSpan = CreateElement('span');
    mgr.mControlSpan.className = 'ui-ctrl';
    function ctrl_br() {
        if (!args.no_ctrl_br) { mgr.mControlSpan.append(CreateBR()); }
    }
    mgr.mEditArea = CreateElement('span');
    mgr.mEditObj = CreateElement('span');
    if (args.is_block) { mgr.mEditObj.className = 'ui-replace-block'; }
    if (args.is_break_title) { mgr.mBreakTitle = CreateBR(); }
    mgr.mEditArea.append(mgr.mEditObj);
    if (!mgr.mIsFixed) {
        ctrl_br();
        if (!args.no_apply_button) {
            mgr.mControlSpan.append(' ', CreateScriptLink('&check;', function() {
                mgr.activate(mgr.mActiveInst);
            }, cLang.cmn_apply));
        }
        mgr.mControlSpan.append(' ', CreateScriptLink('&times;', function() {
            mgr.activate(null);
        }, cLang.cmn_cancel));
    }
    mgr.mClipName = args.clip_name;
    if (mgr.mClipName) {
        ctrl_br();
        mgr.mCopyLink = CreateScriptLinkButton('C', function() {
            mgr.copyValue()
        }, cLang.ui_copy);
        mgr.mPasteLink = CreateScriptLinkButton('P', function() {
            mgr.pasteValue();
        }, cLang.ui_paste);
        mgr.mControlSpan.append(' ', mgr.mCopyLink, ' ', mgr.mPasteLink);
    }
    if (args.on_activate) { mgr.mOnActivate = args.on_activate; }
    mgr.mActiveInst = null;
    mgr.mOldValue = null;
    mgr.onCreateInstance = null;
    mgr.onUpdateValue = null;
    if (args.on_create_instance) { mgr.mOnCreateInstance = args.on_create_instance; }
    if (args.on_update) { mgr.mOnUpdate = args.on_update; }
    mgr.isActive = function(inst) { return this.mActiveInst == inst; };
    mgr.isVisible = function() { return this.mEditObj.offsetWidth > 0; };
    mgr.copyValue = function()
    {
        if (this.mClipName) {
            SetClipboard(this.mClipName, this.dupValue(this.getValue()));
        }
    };
    mgr.pasteValue = function()
    {
        if (this.mClipName) {
            var v = GetClipboard(this.mClipName);
            if (v) {
                var new_v = this.dupValue(v);
                if (this.mActiveInst.mValue.user_data !== undefined) {
                    new_v.user_data = this.mActiveInst.mValue.user_data;
                }
                this.updateValue(this.mActiveInst, new_v);
            } else {
                Log(cLang.desc_cannot_paste);
            }
        }
    };
    mgr.onKeyPress = function(ev)
    {
        if (!this.mActiveInst) { return; }
        if (ev.keyCode === UI_KeyCode.Enter) {
            var t_mgr = mgr;
            while (t_mgr.mParentMgr && t_mgr.mIsFixed) { t_mgr = t_mgr.mParentMgr; }
            if (!t_mgr.mIsFixed) { t_mgr.activate(t_mgr.mActiveInst); }
        }
    };
    mgr.createInstance = function(args)
    {
        var inst = CreateInstance();
        inst.mValue = args.value === null ? this.makeDefaultValue() : args.value;
        inst.mDiv = CreateElement(mgr.mIsDivLabel ? 'label' : 'div');
        inst.mDiv.className = 'ui-fix';
        inst.mTitleObj = CreateElement('span');
        inst.mTitleObj.className = 'title';
        inst.mDiv.append(inst.mTitleObj, ' ');
        if (args.title) { inst.mTitleObj.append(LangSpan(args.title)); }
        if (!this.mIsFixed) {
            inst.mLabelObj = CreateScriptLink('', function() { mgr.activate(inst); });
            inst.mDiv.append(' ', inst.mLabelObj);
        }
        args.parent.append(' ', inst.mDiv);
        this.updateLabel(inst);
        if (this.onCreateInstance) { this.onCreateInstance(inst); }
        if (this.mOnCreateInstance) { this.mOnCreateInstance(inst); }
        if (this.onUpdateValue) { this.onUpdateValue(inst); }
        if (this.mOnUpdate) { this.mOnUpdate(inst); }
        return inst;
    };
    mgr.createActiveInstance = function(args)
    {
        var inst = this.createInstance(args);
        this.activate(inst);
        return inst;
    };
    mgr.activate = function(inst)
    {
        var prev_inst = this.mActiveInst;
        if (prev_inst) {
            if (inst) {
                var new_value = this.getValue();
                if (new_value !== null && !this.isEqual(this.mOldValue, new_value)) {
                    var old_value = this.saveValueForUndo(this.mOldValue);
                    if (!this.mIsDisableUndo) {
                        PushUndo(function() {
                            mgr.updateValue(prev_inst, old_value);
                        }, function() {
                            mgr.updateValue(prev_inst, new_value);
                        }, 'edit value: ' + mgr.mValueName
                                 //+ ' = ' + this.getLabel(old_value)
                                 //+ ' => ' + this.getLabel(new_value)
                                );
                    }
                    this.updateValue(prev_inst, new_value, true);
                }
            } else {
                this.updateValue(prev_inst, this.mOldValue, true);
            }
        }
        this.mActiveInst = null;
        if (prev_inst) {
            prev_inst.mDiv.className = 'ui-fix';
            if (prev_inst.mLabelObj) { prev_inst.mLabelObj.style.display = 'inline'; }
        }
        if (prev_inst == inst || !inst) {
            prev_inst.mTitleObj.removeChild(this.mControlSpan);
            if (this.mBreakTitle) { prev_inst.mDiv.removeChild(this.mBreakTitle); }
            prev_inst.mDiv.removeChild(this.mEditArea);
            this.mActiveInst = null;
            return;
        }
        this.mActiveInst = inst;
        inst.mDiv.className = 'ui-edit';
        inst.mTitleObj.append(this.mControlSpan);
        if (this.mBreakTitle) { inst.mDiv.append(this.mBreakTitle); }
        if (this.mIsPrepend) {
            inst.mDiv.prepend(this.mEditArea);
        } else {
            inst.mDiv.append(this.mEditArea);
        }
        if (inst.mLabelObj) { inst.mLabelObj.style.display = 'none'; }
        if (this.mIsRoot) {
            inst.mDiv.className = 'root-list';
        } else {
            this.mOldValue = this.saveValueForUndo(inst.mValue);
            this.setValue(inst.mValue, true);
        }
        if (this.mOnActivate) { this.mOnActivate(this.mActiveInst); }
    };
    mgr.isEqual = function(a, b) { return a == b; };
    if (mgr.mIsRoot) {
        mgr.updateLabel = function() {};
        return mgr;
    }
    mgr.getValue = function() { return null; };
    mgr.setValue = function(value) {};
    mgr.dupValue = function(value) { return value; };
    mgr.saveValueForUndo = mgr.dupValue;
    mgr.saveData = function(value) { return value; };
    mgr.getLabel = function(value) { return value.toString(); };
    mgr.updateLabel = function(inst) {
        if (inst.mLabelObj) {
            ClearChildren(inst.mLabelObj);
            inst.mLabelObj.append(LangSpan(this.getLabel(inst.mValue), null, true));
            if (this.onUpdateLabel) { this.onUpdateLabel(inst); }
        }
    };
    mgr.updateValue = function(inst, value, skip_self, from_child, src_mgr)
    {
        if (!inst) { debugger; }
        if (this.mActiveInst == inst && !skip_self && !from_child) { this.setValue(value); }
        inst.mValue = value;
        this.updateLabel(inst);
        if (this.onUpdateValue) { this.onUpdateValue(inst, src_mgr); }
        if (this.mOnUpdate) { this.mOnUpdate(inst, src_mgr); }
        if (this.updateVisible && this.mActiveInst == inst) { this.updateVisible(inst); }
        if (this.mActiveInst == inst && this.mParentMgr && this.mParentMgr.mActiveInst
            && !this.mParentMgr.mIsRoot) {
            this.mParentMgr.updateValue(
                this.mParentMgr.mActiveInst, this.mParentMgr.getValue(),
                skip_self, true, src_mgr);
        }
    };
    mgr.updateActive = function() {
        this.updateValue(this.mActiveInst, this.getValue(), true, false, this);
    };
    return mgr;
};
var UI_Select = CreateSingleton();
UI_Select.createMgr = function(args)
{
    //args.is_block = true;
    //args.no_apply_button = true;
    var mgr = UI_Replace.createMgr(args);
    if (args.update_options) { mgr.mUpdateOptions = args.update_options; }
    mgr.mSelectObj = CreateElement('span', 'selector');
    mgr.mEditObj.append(mgr.mSelectObj);
    mgr.mIsCollapsed = args.no_collapse ? null : true;
    mgr.mCloseButton = CreateScriptLink('&times;', function() {
        mgr.mIsCollapsed = true;
        mgr.activateOption(mgr.getValue());
    }, cLang.cmn_cancel);
    mgr.mNullButton = CreateScriptLink(cAltEmptyText, function() {
        mgr.unCollapse();
        mgr.activateOption(mgr.getValue());
    });
    mgr.clear = function() {
        ClearChildren(this.mSelectObj);
        this.mUserData = {};
        this.mLabelMap = {};
        this.mOptions = [];
        this.mActiveOption = null;
        if (!this.mIsCollapsed) {
            mgr.mSelectObj.append(mgr.mCloseButton, ' ');
        }
    };
    mgr.clear();
    mgr.unCollapse = function()
    {
        mgr.mIsCollapsed = false;
        ClearChildren(mgr.mSelectObj);
        mgr.mSelectObj.append(mgr.mCloseButton, ' ');
        mgr.mOptions.forEach(function(topt) {
            topt.className = 'unselected';
            mgr.mSelectObj.append(topt, ' ');
        });
    };
    mgr.addOption = function(opt_args)
    {
        var opt = CreateScriptLink(opt_args.label || opt_args.value, function() {
            if (mgr.mIsCollapsed) {
                mgr.unCollapse();
                opt.className = 'selected';
            } else {
                if (mgr.mIsCollapsed !== null) { mgr.mIsCollapsed = true; }
                mgr.activateOption(opt_args.value);
                mgr.updateActive();
            }
        });
        this.mUserData[opt_args.value] = opt_args.user_data;
        this.mLabelMap[opt_args.value] = {
            label : opt_args.label, elem : opt, author : opt_args.author,
        };
        if (mgr.mIsCollapsed) {
            if (this.mSelectorValue == opt_args.value) {
                this.mActiveOption = opt;
                this.mSelectObj.append(opt);
                FileMode.appendAuthorLink(this.mSelectObj, opt_args.author);
            }
        } else {
            opt.className = this.mSelectorValue == opt_args.value ? 'selected' : 'unselected';
            this.mSelectObj.append(opt, ' ');
        }
        this.mOptions.push(opt);
    };
    mgr.activateOption = function(value)
    {
        if (mgr.mIsCollapsed) { ClearChildren(this.mSelectObj); }
        if (mgr.mActiveOption) { mgr.mActiveOption.className = (
            mgr.mIsCollapsed ? null : 'unselected'); }
        var info = this.mLabelMap[value], opt = info && info.elem;
        mgr.mSelectorValue = value;
        mgr.mActiveOption = opt;
        if (mgr.mActiveOption) {
            if (mgr.mIsCollapsed) {
                this.mSelectObj.append(mgr.mActiveOption);
                mgr.mActiveOption.className = null;
                FileMode.appendAuthorLink(this.mSelectObj, info.author);
            } else { mgr.mActiveOption.className = 'selected'; }
        } else if (mgr.mIsCollapsed) {
            this.mSelectObj.append(mgr.mNullButton);
        }
    };
    mgr.getValue = function() { return this.mSelectorValue; };
    mgr.setValue = function(value) {
        if (this.mUpdateOptions) { this.mUpdateOptions(this, value); }
        var info = this.mLabelMap[value];
        mgr.activateOption(value);
    };
    mgr.getLabel = function(value)
    {
        var ret = cAltEmptyText;
        if (this.mUpdateOptions) { this.mUpdateOptions(this, value); }
        var info = this.mLabelMap[value];
        if (info) { ret = info.label; }
        return ret;
    };
    mgr.onUpdateValue = function(inst) { inst.mUserData = this.mUserData[inst.mValue] };
    if (args.options) {
        args.options.forEach(function(option) { mgr.addOption(option); });
    }
    return mgr;
};
var UI_Text = CreateSingleton();
UI_Text.createMgr = function(args)
{
    if (!args.no_clip) { args.clip_name = 'text'; }
    var mgr = UI_Replace.createMgr(args);
    //if (args.allow_empty) { mgr.mIsAllowEmpty = args.allow_empty; }
    var inp = mgr.mInputObj = CreateElement('input');
    inp.value = 0;
    inp.size = args.size || 16;
    inp.addEventListener('focus', function() { this.select(); });
    inp.addEventListener('keypress', function(ev) { mgr.onKeyPress(ev); });
    if (args.on_input) { mgr.mOnInput = args.on_input; }
    inp.addEventListener('input', function(ev) {
        if (mgr.mOnInput) { mgr.mOnInput(); }
        else { mgr.updateActive(); }
    });
    mgr.mValueType = args.type;
    mgr.mEditObj.append(inp);
    mgr.getValue = function() {
        var ret = this.mInputObj.value;
        //if (ret == '' && !this.mIsAllowEmpty) { return null; }
        if (mgr.mValueType == 'id') {
            ret = ret.replace(/^ *(.*?) *$/, '$1')
            var match = ret.match(/[a-z0-9_\-]*/i)
            var new_ret = match ? match[0] : '';
            if (ret != new_ret) {
                LangAlert(LangJoin([
                    cLang.desc_replaced_invalid_id, ': [' + ret + '] => [' + new_ret + '].\n',
                    cLang.desc_valid_letters, ': A~Z a~z 0~9 _ -']));
                ret = new_ret;
                this.mInputObj.value = ret;
            }
        } else if (mgr.mValueType == 'ids') {
            ret = ret.replace(/^ *(.*?) *$/, '$1')
            var match = ret.match(/[a-z0-9_\-,]*/i)
            var new_ret = match ? match[0] : '';
            if (ret != new_ret) {
                LangAlert(LangJoin([
                    cLang.desc_replaced_invalid_id, ': [' + ret + '] => [' + new_ret + '].\n',
                    cLang.desc_valid_letters, ': A~Z a~z 0~9 _ - ,\n',
                    cLang.desc_comma_separated]));
                ret = new_ret;
                this.mInputObj.value = ret;
            }
            ret = ret.split(',');
        }
        return ret;
    };
    mgr.setValue = function(value) {
        if (mgr.mValueType == 'ids') {
            this.mInputObj.value = value.join(',');
        } else {
            this.mInputObj.value = value;
        }
    };
    mgr.getLabel = function(value) {
        if (mgr.mValueType == 'ids') {
            return '[' + value.join(',') + ']';
        } else {
            return value == '' ? '""' : value;
        }
    };
    return mgr;
};
var UI_LangText = CreateSingleton();
UI_LangText.createMgr = function(args)
{
    args.clip_name = 'lang-text';
    var mgr = UI_Replace.createMgr(args);
    mgr.mInputObjs = [];
    for (var il = 0; il < cLanguages.length; ++il) {
        var span = CreateElement('span', 'il-' + cLanguages[il]);
        var inp = CreateElement('input');
        inp.value = 0;
        inp.size = args.size || 16;
        inp.addEventListener('focus', function() { this.select(); });
        inp.addEventListener('keypress', function(ev) { mgr.onKeyPress(ev); });
        if (args.on_input) { mgr.mOnInput = args.on_input; }
        inp.addEventListener('input', function(ev) {
            if (mgr.mOnInput) { mgr.mOnInput(); }
            else { mgr.updateActive(); }
        });
        mgr.mInputObjs.push(inp);
        span.append('[' + cLanguages[il] + '] ', inp);
        mgr.mEditObj.append(span);
    }
    mgr.isEqual = function(a, b) {
        for (var il = 0; il < cLanguages.length; ++il) {
            var ta = Array.isArray(a) ? a[il] : g_language == cLanguages[il] ? a : '';
            var tb = Array.isArray(b) ? b[il] : g_language == cLanguages[il] ? b : '';
            if (ta != tb) { return false; }
        }
        return true;
    };
    mgr.getValue = function() {
        return this.mInputObjs.map(inp => inp.value);
    };
    mgr.setValue = function(value)
    {
        for (var il = 0; il < cLanguages.length; ++il) {
            this.mInputObjs[il].value = Array.isArray(value) ? value[il]
                : g_language == cLanguages[il] ? value : '';
        }
    };
    mgr.getLabel = function(value) {
        if (!Array.isArray(value)) { return value == '' ? '""' : value; }
        var ret = [], def_label = '';
        for (var il = 0; il < cLanguages.length; ++il) {
            var label = value[il];
            if (def_label == '' && label != '') { def_label = label; }
            ret.push(label);
        }
        if (def_label == '') { def_label = '""'; }
        return ret.map(label => label == '' ? def_label : label);
    };
    return mgr;
};
var UI_Check = CreateSingleton();
UI_Check.createMgr = function(args)
{
    var mgr = UI_Replace.createMgr(args);
    var inp = mgr.mInputObj = CreateElement('input');
    inp.type = 'checkbox';
    inp.addEventListener('change', function(ev) { mgr.updateActive(); });
    mgr.mEditObj.append(inp, ' ');
    mgr.mIsDivLabel = true;
    mgr.mIsPrepend = true;
    mgr.getValue = function() {
        return this.mInputObj.checked;
    };
    mgr.setValue = function(value) { this.mInputObj.checked = value; };
    mgr.getLabel = function(value) { return value ? cLang.cmn_true : cLang.cmn_false; };
    return mgr;
};
var UI_Radio = CreateSingleton();
UI_Radio.createMgr = function(args)
{
    var mgr = UI_Replace.createMgr(args);
    mgr.mValueMap = {};
    mgr.mOptions = args.options;
    mgr.mOptions.forEach(function(option) {
        mgr.mValueMap[option.value] = option;
        var label = CreateElement('label');
        var inp = CreateElement('input');
        inp.name = args.dom_name;
        inp.type = 'radio';
        inp.value = option.value;
        inp.addEventListener('change', function(ev) { mgr.updateActive(); });
        option.input_obj = inp;
        label.append(inp, ' ');
        label.append(LangSpan(option.label || option.value));
        mgr.mEditObj.append(label, ' ');
    });
    mgr.getValue = function() {
        for (var i = 0; i < mgr.mOptions.length; ++i) {
            var option = mgr.mOptions[i];
            if (option.input_obj.checked) { return option.value; }
        }
        return '';
    };
    mgr.setValue = function(value) {
        for (var i = 0; i < mgr.mOptions.length; ++i) {
            var option = mgr.mOptions[i];
            if (option.value == value) { option.input_obj.checked = true; }
            else if (option.input_obj.checked) { option.input_obj.checked = false; }
        }
    };
    mgr.getLabel = function(value) {
        var option = mgr.mValueMap[value];
        return option ? option.label : cAltEmptyText;
    };
    return mgr;
};
var UI_Slider = CreateSingleton();
UI_Slider.createMgr = function(args)
{
    if (args.clip_name !== null) { args.clip_name = args.is_int ? 'int' : 'float'; }
    var mgr = UI_Replace.createMgr(args);
    mgr.mIsInt = args.is_int;
    mgr.mMinValue = args.min;
    mgr.mMaxValue = args.max;
    mgr.mRoundUnit = args.slide_round;
    mgr.mFixedDigits = args.fixed_digits;
    mgr.mOnSlide = args.on_slide;
    mgr.mValueRange = mgr.mMaxValue - mgr.mMinValue;
    mgr.round = function(v) {
        var ret = mgr.mIsInt ? Math.round(v): v;
        return this.mRoundUnit ? Math.round(ret / mgr.mRoundUnit) * mgr.mRoundUnit : ret;
    };
    mgr.clamp = function(v) { return clamp(v, mgr.mMinValue, mgr.mMaxValue); };
    var inp = mgr.mInputObj = CreateElement('input');
    inp.className = 'slider';
    inp.value = 0;
    inp.size = args.size || 8;
    inp.addEventListener('focus', function() { this.select(); });
    inp.addEventListener('keypress', function(ev) { mgr.onKeyPress(ev); });
    inp.addEventListener('input', function(ev) {
        if (mgr.mInputObj.value != '') {
            mgr.updateSlider(mgr.getValue());
            mgr.updateActive();
            if (mgr.mOnSlide) { mgr.mOnSlide(); }
        }
    });
    var slider_box = CreateElement('div');
    slider_box.className = 'ui-slider-box';
    var slider = mgr.mSliderObj = CreateElement('div');
    slider.className = 'ui-slider';
    if (args.width) { slider.style.width = args.width; }
    mgr.onSlide = function(ev) {
        var ofs_x = ev.clientX - slider.getBoundingClientRect().left;
        var cMargin = 5;
        mgr.setValue(mgr.clamp(mgr.round(
            ((ofs_x - cMargin) / (slider.clientWidth - cMargin * 2))
                * mgr.mValueRange + mgr.mMinValue)));
        mgr.updateActive();
        if (mgr.mOnSlide) { mgr.mOnSlide(); }
    };
    mgr.endSlide = function() {
        if (mgr.mSliding) { mgr.mSliding = false; }
    };
    mgr.mSliding = false;
    if (g_is_touch_device) {
        slider.addEventListener('touchstart', function(ev) {
            if (ev.touches.length > 0) {
                mgr.mSliding = true;
                //mgr.onMouseMove(ev.touches[0]);
                mgr.onSlide(ev.touches[0]);
            }
        });
        slider.addEventListener('touchmove', function(ev) {
            if (ev.touches.length > 0) {
                if (mgr.mSliding) { mgr.onSlide(ev.touches[0]); }
            }
        });
        slider.addEventListener('touchend', function(ev) {
            if (ev.touches.length == 0) { mgr.endSlide(); }
        });
    }
    slider.addEventListener('mousedown', function(ev) {
        mgr.mSliding = true;
        mgr.onSlide(ev);
    });
    slider.addEventListener('mousemove', function(ev) {
        if (mgr.mSliding) { mgr.onSlide(ev); }
    });
    slider.addEventListener('mouseleave', mgr.endSlide);
    slider.addEventListener('mouseup', mgr.endSlide);
    var handle = mgr.mHandleObj = CreateElement('div');
    if (args.handle_color) { handle.style.backgroundColor = args.handle_color; }
    slider.append(handle)
    slider_box.append(slider);
    mgr.mEditObj.append(inp, ' ');
    mgr.mEditObj.append(slider_box);
    mgr.getValue = function()
    {
        return this.clamp(this.mIsInt ? parseInt(this.mInputObj.value)
                         : parseFloat(this.mInputObj.value));
    };
    mgr.setValue = function(value)
    {
        this.mInputObj.value = value.toFixed(
            this.mFixedDigits ? this.mFixedDigits : 4).replace(/\.?0*$/, '');
        this.updateSlider(value);
        if (this.mRangeCtrl) {
            var abs_value = Math.abs(parseFloat(this.mInputObj.value));
            if (this.mRangeLinks) {
                this.mRangeLinks.forEach(linked_mgr => abs_value = Math.max(
                    abs_value, Math.abs(parseFloat(linked_mgr.mInputObj.value))));
            }
            while (this.mMaxValue < abs_value) { this.extendRange(); }
        }
    };
    mgr.getLabel = function(value)
    {
        return this.mIsInt || Number.isInteger(value) ? value.toString() : value.toFixed(3);
    };
    mgr.updateSlider = function(value)
    {
        if (this.mIsInt) {
            this.mHandleObj.style.width = '' + Math.max(
                2, Math.round(this.mSliderObj.clientWidth / (this.mValueRange + 1))) + 'px';
        }
        this.mHandleObj.style.left = '' + (
            (this.mSliderObj.clientWidth - this.mHandleObj.clientWidth)
                * (value - this.mMinValue) / this.mValueRange) + 'px';
    };
    mgr.updateRange = function(ext)
    {
        if (ext) {
            if (this.mIsInt && ext < 1 && max_abs(
                this.mMinValue, this.mMaxValue) <= 1) { return; }
            if (this.mMinValue * this.mMaxValue < 0) {
                this.mMinValue *= ext;
                this.mMaxValue *= ext;
            } else if (this.mMaxValue > 0) {
                this.mMaxValue *= ext;
            } else {
                this.mMinValue *= ext;
            }
            this.mValueRange = this.mMaxValue - this.mMinValue;
            this.mRangeExtendTurn = (this.mRangeExtendTurn + (ext > 1 ? 1 : 2)) % 3;
            this.updateSlider(this.getValue());
            if (this.mRangeLinks) {
                this.mRangeLinks.forEach(function(linked_mgr) {
                    linked_mgr.mMaxValue = this.mMaxValue;
                    linked_mgr.mMinValue = this.mMinValue;
                    linked_mgr.mValueRange = this.mValueRange;
                    linked_mgr.updateSlider(linked_mgr.getValue());
                }, this);
            }
        }
        this.mMinLabel.innerText = this.getLabel(this.mMinValue);
        this.mMaxLabel.innerText = this.getLabel(this.mMaxValue);
    };
    mgr.addRangeLink = function(linked_mgr)
    {
        if (!this.mRangeLinks) { this.mRangeLinks = []; }
        this.mRangeLinks.push(linked_mgr);
    };
    if (!args.no_label) {
        mgr.mMinLabel = CreateElement('p');
        mgr.mMinLabel.className = 'min';
        mgr.mMaxLabel = CreateElement('p');
        mgr.mMaxLabel.className = 'max';
        mgr.updateRange();
        var tmp_max = max_abs(mgr.mMinValue, mgr.mMaxValue);
        tmp_max /= Math.round(Math.pow(10, Math.floor(Math.log10(tmp_max) + 0.1)));
        mgr.mRangeExtendTurn = tmp_max == 2 ? 1 : tmp_max == 5 ? 2 : 0;
        slider_box.append(CreateBR(), mgr.mMinLabel, mgr.mMaxLabel);
        if (!args.fixed_range) {
            mgr.mRangeCtrl = CreateElement('p');
            mgr.mRangeCtrl.className = 'range';
            mgr.shortenRange = function() {
                mgr.updateRange(1 / (mgr.mRangeExtendTurn == 2 ? 2.5 : 2));
            };
            mgr.extendRange = function() {
                mgr.updateRange(mgr.mRangeExtendTurn == 1 ? 2.5 : 2);
            };
            mgr.mRangeCtrl.append(CreateScriptLink(
                '&darr;', mgr.shortenRange, cLang.ui_shorten_range));
            mgr.mRangeCtrl.append(CreateScriptLink(
                '&uarr;', mgr.extendRange, cLang.ui_extend_range));
            slider_box.append(mgr.mRangeCtrl);
        }
    }
    return mgr;
};
var UI_Vector = CreateSingleton();
UI_Vector.cValueTypes = [null, null, v2, v3, v4];
UI_Vector.cDimLabels = ['X', 'Y', 'Z', 'W'];
UI_Vector.createMgr = function(args)
{
    args.is_block = true;
    args.clip_name = 'v' + args.dim;
    var mgr = UI_Replace.createMgr(args);
    mgr.mDim = args.dim;
    mgr.mValueType = this.cValueTypes[mgr.mDim];
    mgr.mSliderMgrs = [];
    var slider_args = Object.assign({
        parent_mgr : mgr, fixed : true,
        on_slide : function() { mgr.updateActive(); },
    }, args);
    slider_args.clip_name = null;
    var labels = args.labels || this.cDimLabels;
    for (var i = 0; i < mgr.mDim; ++i) {
        slider_args.no_label = i < mgr.mDim - 1;
        var s_mgr = UI_Slider.createMgr(slider_args);
        mgr.mSliderMgrs[i] = s_mgr;
        var slider = s_mgr.createInstance({
            parent : mgr.mEditObj, title : labels[i], value : 0, });
        s_mgr.activate(slider);
        mgr.mEditObj.append(CreateBR());
    }
    for (var i = 0; i < mgr.mDim - 1; ++i) {
        mgr.mSliderMgrs[mgr.mDim - 1].addRangeLink(mgr.mSliderMgrs[i]);
    }
    mgr.isEqual = function(a, b) { return this.mValueType.IsEqual(a, b); };
    mgr.getValue = function()
    {
        var ret = this.mValueType.Makes(0);
        for (var i = 0; i < this.mDim; ++i) {
            ret[i] = this.mSliderMgrs[i].getValue();
        }
        return ret;
    };
    mgr.setValue = function(value)
    {
        for (var i = 0; i < this.mDim; ++i) {
            this.mSliderMgrs[i].setValue(value[i]);
        }
    };
    mgr.dupValue = function(value) { return this.mValueType.Dup(value); };
    mgr.saveData = function(value) { return this.mValueType.ToArray(value); };
    mgr.getLabel = function(value)
    {
        var ret = '(';
        for (var i = 0; i < this.mDim; ++i) {
            if (i) { ret += ', '; }
            ret += this.mSliderMgrs[i].getLabel(value[i]);
        }
        return ret + ')';
    };
    mgr.updateSlider = function(value)
    {
        for (var i = 0; i < this.mDim; ++i) {
            this.mSliderMgrs[i].updateSlider(value[i]);
        }
    };
    return mgr;
};
var UI_Color = CreateSingleton();
UI_Color.cElementNames = ['R', 'G', 'B', 'A'];
UI_Color.cElementColors = ['#ff0000', '#00ff00', '#0000ff', '#808080'];
UI_Color.floatToString = function(v) { return v.toFixed(3); };
UI_Color.stringToFloat = function(v) { return parseFloat(v); };
UI_Color.calcY = function(v) { return v[0] * 0.299 + v[1] * 0.587 + v[2] * 0.114; };
UI_Color.createMgr = function(args)
{
    args.is_block = true;
    args.clip_name = 'color';
    var mgr = UI_Replace.createMgr(args);
    mgr.mIsRGBA = args.is_rgba;
    mgr.mElementNum = mgr.mIsRGBA ? 4 : 3;
    mgr.mValueType = mgr.mIsRGBA ? v4 : v3;
    mgr.mSliderMgrs = [];
    var slider_args = {
        parent_mgr : mgr, fixed : true, min : 0, max : 1, size : 5, width : '6em',
        slide_round : 0.001, fixed_digits : 3,
        on_slide : function() { mgr.updateSample(); },
    };
    slider_args.clip_name = null;
    for (var i = 0; i < mgr.mElementNum; ++i) {
        slider_args.no_label = i < mgr.mElementNum - 1;
        slider_args.handle_color = this.cElementColors[i];
        var s_mgr = UI_Slider.createMgr(slider_args);
        mgr.mSliderMgrs[i] = s_mgr;
        var slider = s_mgr.createInstance({
            parent : mgr.mEditObj, title : this.cElementNames[i], value : 0, });
        s_mgr.activate(slider);
        mgr.mEditObj.append(CreateBR());
    }
    for (var i = 0; i < mgr.mElementNum - 1; ++i) {
        mgr.mSliderMgrs[mgr.mElementNum - 1].addRangeLink(mgr.mSliderMgrs[i]);
    }
    mgr.mSampleObj = CreateElement('div');
    mgr.mSampleObj.className = 'ui-color';
    mgr.mEditArea.insertBefore(mgr.mSampleObj, mgr.mEditObj.nextSibling);
    mgr.onCreateInstance = function(inst)
    {
        if (inst.mLabelObj) { inst.mLabelObj.className = 'ui-color'; }
    };
    mgr.onUpdateLabel = function(inst)
    {
        var bg = v3.ToColorCode(inst.mValue);
        var col = v3.ToColorCode(v3.Makes(step(UI_Color.calcY(inst.mValue), 0.5)));
        inst.mLabelObj.style.backgroundColor = bg;
        inst.mLabelObj.style.borderColor = col;
        inst.mLabelObj.style.color = col;
    };
    mgr.isEqual = function(a, b) { return this.mValueType.IsEqual(a, b); };
    mgr.getValue = function()
    {
        var ret = this.mValueType.Makes(0);
        for (var i = 0; i < this.mElementNum; ++i) {
            ret[i] = this.mSliderMgrs[i].getValue();
        }
        return ret;
    };
    mgr.setValue = function(value)
    {
        for (var i = 0; i < this.mElementNum && i < value.length; ++i) {
            this.mSliderMgrs[i].setValue(value[i]);
        }
        this.updateSample();
    };
    mgr.dupValue = function(value) { return this.mValueType.Dup(value); };
    mgr.saveData = function(value) { return this.mValueType.ToArray(value); };
    mgr.getLabel = function(value)
    {
        var ret = '';
        for (var i = 0; i < this.mElementNum; ++i) {
            ret += (i == 0 ? '(' : ', ') + this.mSliderMgrs[i].getLabel(value[i]);
        }
        return ret + ')';
    };
    mgr.updateSample = function() {
        var new_val = this.getValue();
        //mgr.updateValue(this.mActiveInst, new_val, true);
        this.mSampleObj.style.backgroundColor = v3.ToColorCode(new_val);
    };
    return mgr;
};
  </script>
  <!-- <script src="ui_struct.js"></script> -->
  <script>
'use strict';
var UI_Array = CreateSingleton();
UI_Array.createMgr = function(args)
{
    args.is_block = true;
    args.no_ctrl_br = true;
    args.is_break_title = true;
    if (args.element_mgr.mClipName) { args.clip_name = args.element_mgr.mClipName + '[]'; }
    var mgr = UI_Replace.createMgr(args);
    mgr.mIsArray = true;
    mgr.mDim = args.dim;
    mgr.mElementMgr = args.element_mgr;
    mgr.mElementMgr.mParentMgr = mgr;
    console.assert(mgr.mElementMgr.mIsDisableUndo || args.fixed);
    mgr.mLabelElements = args.label_elements;
    if (args.element_names) { mgr.mElementNames = args.element_names; }
    if (args.fixed_elements) { mgr.mFixedElements = args.fixed_elements; }
    mgr.mMinElementNum = args.min_element_num || 0;
    if (args.update_element_names) {
        mgr.mElementNames = [];
        mgr.mUpdateElementNames = args.update_element_names;
    }
    mgr.mInitElementValue = args.init_element_value;
    if (args.on_update_array) { mgr.mOnUpdateArray = args.on_update_array; }
    if (args.is_deletable) { mgr.mIsDeletable = args.is_deletable; }
    mgr.mElements = [];
    if (!mgr.mElementNames) {
        mgr.mControlSpan.append(' ', CreateScriptLinkButton(
            'A', function() { mgr.selectAll(!mgr.isSelectAll()); }, cLang.ui_select_all));
        mgr.mControlSpan.append(' ', CreateScriptLink(
            '+', function() { mgr.birthElement(); }, cLang.ui_add_element));
        mgr.mControlSpan.append(' ', CreateScriptLink(
            '&minus;', function() { mgr.deleteElements(); }, cLang.ui_del_elements));
        mgr.mControlSpan.append(' ', CreateScriptLink(
            '&darr;', function() { mgr.moveElements(1); }, cLang.ui_move_down));
        mgr.mControlSpan.append(' ', CreateScriptLink(
            '&uarr;', function() { mgr.moveElements(-1); }, cLang.ui_move_up));
    }
    mgr.mControlSpan.append(' [');
    mgr.mArrayObj = CreateElement('span');
    mgr.mEditObj.append(mgr.mArrayObj, ']');
    mgr.getFixedElementsNum = function() {
        return this.mFixedElements ? this.mFixedElements.length : 0;
    };
    mgr.saveStateForUndo = function()
    {
        if (!this.mIsRoot) { return null; }
        return Array.from(this.mElements);
    };
    mgr.pushUndo = function(old_state, action)
    {
        if (!old_state) { return; }
        var all_same = old_state.length == this.mElements.length;
        if (all_same) {
            for (var i = 0; i < this.mElements.length; ++i) {
                if (old_state[i] === this.mElements[i]) { continue; }
                all_same = false; break;
            }
        }
        if (all_same) return;
        var new_state = this.saveStateForUndo();
        function close_deleted_element(old_st, new_st) {
            for (var i = 0; i < old_st.length; ++i) {
                var tmp_elem = old_st[i], found = false;
                for (var j = 0; j < new_st.length; ++j) {
                    if (tmp_elem == new_st[j]) { found = true; break; }
                }
                if (!found && mgr.mElementMgr.mActiveInst == tmp_elem) {
                    mgr.mElementMgr.activate(null);
                    break;
                }
            }
        }
        PushUndo(function() {
            close_deleted_element(mgr.mElements, old_state);
            mgr.mElements = old_state;
            mgr.updateArray();
        }, function() {
            close_deleted_element(mgr.mElements, new_state);
            mgr.mElements = new_state;
            mgr.updateArray();
        }, action + ': ' + mgr.mValueName);
    };
    mgr.copyValue = function()
    {
        if (this.mClipName) {
            var clip = [];
            this.mElements.forEach(function(elem_inst) {
                if (elem_inst.mArrayCheck.checked) {
                    clip.push(this.mElementMgr.dupValue(elem_inst.mValue));
                }
            }, this);
            SetClipboard(this.mClipName, clip);
            this.selectAll(false);
        }
    };
    mgr.pasteValue = function()
    {
        if (this.mClipName) {
            var clip = GetClipboard(this.mClipName);
            if (!clip) {
                if (clip = GetClipboard(this.mElementMgr.mClipName)) { clip = [clip]; }
            }
            if (clip) {
                var old_state = this.saveStateForUndo();
                var first_sel = this.getFirstSelectedElement();
                this.selectAll(false);
                clip.forEach(function(cv) {
                    var elem_inst = this.createElementInst(
                        this.mElementMgr.dupValue(cv), first_sel);
                    //this.mElementMgr.updateValue(elem_inst, elem_inst.mValue);
                    elem_inst.mArrayCheck.checked = true;
                }, this);
                this.updateArray();
                this.pushUndo(old_state, 'paste elements');
            } else {
                Log(cLang.desc_cannot_paste);
            }
        }
    };
    mgr.getFirstSelectedElement = function()
    {
        for (var i = 0; i < this.mElements.length; ++i) {
            var elem_inst = this.mElements[i];
            if (elem_inst.mArrayCheck.checked) { return elem_inst; }
        }
        return null;
    };
    mgr.birthElement = function()
    {
        var old_state = this.saveStateForUndo();
        var new_val = this.mElementMgr.dupValue(this.mInitElementValue);
        var new_inst = this.createElementInst(new_val, this.getFirstSelectedElement());
        this.updateArray();
        this.pushUndo(old_state, 'birth element');
        this.mElementMgr.activate(new_inst);
    };
    mgr.deleteElements = function()
    {
        var old_state = this.saveStateForUndo(), i = 0;
        this.mElements = this.mElements.filter(function(elem_inst) {
            if (i++ < mgr.getFixedElementsNum() || !elem_inst.mArrayCheck.checked ||
                mgr.mIsDeletable && !mgr.mIsDeletable(elem_inst)) { return true; }
            if (mgr.mElementMgr.mActiveInst == elem_inst) { mgr.mElementMgr.activate(null); }
            return false;
        });
        while (this.mElements.length < mgr.mMinElementNum) { this.birthElement(); }
        this.updateArray();
        this.pushUndo(old_state, 'delete elements');
    };
    mgr.moveElements = function(ofs)
    {
        var checked = [], not_checked = [], first = -1;
        for (var i = 0; i < this.mElements.length; ++i) {
            var elem_inst = this.mElements[i];
            if (elem_inst.mArrayCheck.checked && i >= this.getFixedElementsNum()) {
                checked.push(elem_inst);
                if (first < 0) { first = not_checked.length; }
            } else {
                not_checked.push(elem_inst);
            }
        }
        if (first >= 0) {
            var old_state = this.saveStateForUndo();
            this.mElements = [];
            var new_first = -1, insert_pos = first + ofs;
            if (this.mFixedElements) {
                insert_pos = Math.max(this.mFixedElements.length, insert_pos);
            }
            for (var i = -1; i <= not_checked.length + 1; ++i) {
                if (insert_pos == i) {
                    new_first = this.mElements.length;
                    checked.forEach(e => this.mElements.push(e));
                }
                if (0 <= i && i < not_checked.length) { this.mElements.push(not_checked[i]); }
            }
            this.updateArray();
            for (var i = 0; i < checked.length; ++i) {
                this.mElements[new_first + i].mArrayCheck.checked = true;
            }
            this.pushUndo(old_state, 'move elements');
        }
    };
    mgr.isSelectAll = function()
    {
        for (var i = this.getFixedElementsNum(); i < this.mElements.length; ++i) {
            if (!this.mElements[i].mArrayCheck.checked) { return false; }
        }
        return true;
    };
    mgr.selectAll = function(sel)
    {
        for (var i = this.getFixedElementsNum(); i < this.mElements.length; ++i) {
            this.mElements[i].mArrayCheck.checked = sel;
        }
    };
    mgr.deleteAll = function()
    {
        this.selectAll(true);
        this.deleteElements();
    };
    mgr.createElementInst = function(elem_value, insert_before)
    {
        var cur_len = this.mElements.length;
        if (cur_len > 0) { this.mArrayObj.append(CreateBR()); }
        var title = CreateElement('label'), check = null;
        if (!this.mElementNames) {
            check = CreateElement('input');
            check.type = 'checkbox';
            if (cur_len >= this.getFixedElementsNum()) { title.append(check, ' '); }
        }
        title.append(this.mElementNames ? LangSpan(this.mElementNames[cur_len]) : (
            cur_len < this.getFixedElementsNum()
                ? LangSpan(this.mFixedElements[cur_len]) : cur_len.toString()));
        var elem_inst = this.mElementMgr.createInstance({
            parent : this.mArrayObj, title : title, value : elem_value, });
        elem_inst.mArrayCheck = check;
        do {
            if (insert_before) {
                var insert_at = this.mElements.indexOf(insert_before);
                if (insert_at >= 0) {
                    this.mElements.splice(insert_at, 0, elem_inst);
                    break;
                }
            }
            this.mElements.push(elem_inst);
        } while (false);
        this.mArrayObj.append(' ');
        return elem_inst;
    };
    mgr.makeDefaultValue = function()
    {
        if (!this.mElementNames) { return null; }
        var ret = [];
        for (var i = 0; i < this.mElementNames.length; ++i) {
            ret.push(this.mInitElementValue
                     ? this.mElementMgr.dupValue(this.mInitElementValue)
                     : this.mElementMgr.makeDefaultValue());
        }
        return ret;
    };
    mgr.isEqual = function(a, b)
    {
        if (a.length != b.length) { return false; }
        for (var i = 0; i < a.length; ++i) {
            if (!this.mElementMgr.isEqual(a[i], b[i])) { return false; }
        }
        return true;
    };
    if (mgr.mIsRoot) {
        mgr.updateArray = function()
        {
            ClearChildren(this.mArrayObj);
            this.mActiveInst.mValue = [];
            for (var i = 0; i < this.mElements.length; ++i) {
                var elem_inst = this.mElements[i];
                var label = elem_inst.mArrayCheck.parentNode;
                ClearChildren(label);
                label.append(elem_inst.mArrayCheck, ' ');
                var title_str = '' + i;
                if (this.mElementMgr.getUUID) {
                    var uuid_span = CreateElement('span');
                    uuid_span.append(title_str);
                    uuid_span.title = 'UUID: ' + this.mElementMgr.getUUID(elem_inst.mValue);
                    label.append(uuid_span);
                } else {
                    label.append(title_str);
                }
                if (i > 0) { this.mArrayObj.append(CreateBR()); }
                this.mArrayObj.append(elem_inst.mDiv);
                this.mActiveInst.mValue.push(elem_inst.mValue);
            }
            if (this.mOnUpdateArray) { this.mOnUpdateArray(); }
        };
        return mgr;
    }
    mgr.mArrayObj.className = 'ui-array';
    mgr.updateArray = function()
    {
        this.setValue(this.getValue());
        this.updateActive();
    }
    mgr.getValue = function()
    {
        var ret = [];
        this.mElementMgr.getValue();
        for (var i = 0; i < this.mElements.length; ++i) {
            ret[i] = this.mElements[i].mValue;
        }
        return ret;
    };
    mgr.setValue = function(value)
    {
        ClearChildren(this.mArrayObj);
        if (this.mUpdateElementNames) { this.mUpdateElementNames(this, value); }
        this.mElements = [];
        for (var i = 0; i < value.length; ++i) {
            this.createElementInst(value[i]);
        }
    };
    mgr.dupValue = function(value) {
        if (!value) { return null; }
        // @todo treat user_data
        var ret = [];
        for (var i = 0; i < value.length; ++i) {
            ret.push(this.mElementMgr.dupValue(value[i]));
        }
        return ret;
    };
    mgr.saveData = function(value) {
        var ret = [];
        for (var i = 0; i < value.length; ++i) {
            ret.push(this.mElementMgr.saveData(value[i]));
        }
        return ret;
    };
    mgr.getLabel = function(value)
    {
        if (value === undefined) { debugger; }
        var ret = '[';
        if (this.mLabelElements) {
            for (var i = 0; i < value.length; ++i) {
                if (i) { ret += ', '; }
                if (this.mElementNames) { ret += this.mElementNames[i] + ': '; }
                ret += this.mElementMgr.getLabel(value[i]);
            }
        } else {
            ret += value.length;
        }
        return ret + ']';
    };
    return mgr;
};
var UI_Struct = CreateSingleton();
UI_Struct.createMgr = function(args)
{
    args.is_block = true;
    args.no_ctrl_br = true;
    args.is_break_title = true;
    var mgr = UI_Replace.createMgr(args);
    mgr.mStruct = [];
    mgr.pushStruct = function(elem)
    {
        if (elem.condition) { elem.is_visible = true; }
        this.mStruct.push(elem);
    };
    mgr.mControlSpan.append(' {');
    mgr.initializeStruct = function()
    {
        for (var i = 0; i < this.mStruct.length; ++i) {
            var elem = this.mStruct[i];
            if (elem.mgr) {
                if (i > 0 && elem.mgr.mIsArray) { this.mEditObj.append(CreateBR()); }
                var elem_title = elem.title;
                if (elem.title_sub) { elem_title = LangAppend(elem_title, elem.title_sub); }
                elem.inst = elem.mgr.createInstance({
                    parent : this.mEditObj, title : elem_title, value : elem.def_value, });
                if (elem.mgr.mIsFixed) { elem.mgr.activate(elem.inst); }
            } else {
                var elem_cmd = elem.cmd;
                this.mEditObj.append(CreateScriptLink(elem.title, function() {
                    elem_cmd(mgr.mActiveInst.mValue);
                }, elem.link_title));
            }
            this.mEditObj.append(', ');
        }
        this.mEditObj.append('}');
    };
    mgr.makeDefaultValue = function()
    {
        var ret = {};
        for (var i = 0; i < this.mStruct.length; ++i) {
            var elem = this.mStruct[i];
            if (!elem.mgr) { continue; }
            ret[elem.key] = elem.get_def_value ? elem.get_def_value() : (
                elem.def_value !== null
                    ? elem.mgr.dupValue(elem.def_value) : elem.mgr.makeDefaultValue());
        }
        return ret;
    };
    mgr.isEqual = function(a, b)
    {
        for (var i = 0; i < this.mStruct.length; ++i) {
            var elem = this.mStruct[i];
            if (!elem.mgr) { continue; }
            if (!elem.mgr.isEqual(a[elem.key], b[elem.key])) { return false; }
        }
        return true;
    };
    mgr.getValue = function()
    {
        var ret = {};
        for (var i = 0; i < this.mStruct.length; ++i) {
            var elem = this.mStruct[i];
            if (!elem.mgr) { continue; }
            ret[elem.key] = elem.mgr.mEditArea.style.display == 'none'
                ? null : elem.mgr.getValue();
        }
        if (this.mUserData) { ret.user_data = this.mUserData; }
        return ret;
    };
    mgr.setValue = function(value)
    {
        for (var i = 0; i < this.mStruct.length; ++i) {
            var elem = this.mStruct[i];
            if (!elem.mgr) { continue; }
            var elem_val = value[elem.key];
            if (elem_val === null) {
                elem.mgr.mEditArea.style.display = 'none';
                elem.inst.mTitleObj.style.display = 'none';
            } else {
                elem.mgr.mEditArea.style.display = null;
                elem.inst.mTitleObj.style.display = null;
                elem.mgr.setValue(elem_val);
            }
        }
        this.mUserData = value.user_data;
        if (this.mActiveInst) { this.updateVisible(this.mActiveInst); }
    };
    mgr.dupValue = function(value) {
        if (!value) { return null; }
        var ret = {};
        for (var i = 0; i < this.mStruct.length; ++i) {
            var elem = this.mStruct[i];
            if (!elem.mgr) { continue; }
            ret[elem.key] = elem.mgr.dupValue(value[elem.key]);
        }
        return ret;
    };
    mgr.saveData = function(value) {
        var ret = {};
        for (var i = 0; i < this.mStruct.length; ++i) {
            var elem = this.mStruct[i];
            if (!elem.mgr) { continue; }
            ret[elem.key] = elem.mgr.saveData(value[elem.key]);
        }
        return ret;
    };
    mgr.saveValueForUndo = function(value)
    {
        var ret = this.dupValue(value);
        if (ret && value.user_data) { ret.user_data = value.user_data; }
        return ret;
    };
    mgr.setDefaultValues = function(value)
    {
        for (var i = 0; i < this.mStruct.length; ++i) {
            var elem = this.mStruct[i];
            if (!elem.mgr) { continue; }
            if (value[elem.key] !== undefined) { continue; }
            value[elem.key] = elem.get_def_value ? elem.get_def_value() : (
                elem.def_value !== null
                    ? elem.mgr.dupValue(elem.def_value) : elem.mgr.makeDefaultValue());
            //Log('set def value [' + elem.key + '] = ' + value[elem.key]);
        }
    };
    mgr.getLabel = function(value)
    {
        var ret = LangAppendTo(['', ''], '{'), n = 0;
        for (var i = 0; i < this.mStruct.length; ++i) {
            var elem = this.mStruct[i];
            if (!elem.mgr) { continue; }
            if (!elem.labeled) { continue; }
            var elem_val = value[elem.key];
            if (elem_val === null) { continue; }
            if (n) { LangAppendTo(ret, ', '); }
            if (elem.labeled != 'value') { ret = LangJoin([ret, elem.title, ': ']); }
            LangAppendTo(ret, elem.mgr.getLabel(elem_val));
            ++n;
        }
        return LangAppendTo(ret, '}');
    };
    mgr.updateVisible = function(inst)
    {
        for (var i = 0; i < this.mStruct.length; ++i) {
            var elem = this.mStruct[i];
            if (!elem.condition) { continue; }
            var vis = elem.condition(inst.mValue);
            if (vis == elem.is_visible) { continue; }
            elem.is_visible = vis;
            elem.inst.mDiv.style.display = vis ? null : 'none';
        }
    };
    return mgr;
};
  </script>
  <!-- <script src="m34.js"></script> -->
  <script>
'use strict';
// 3x4 matrix functions.
var m34 = {
    set : function(dst,
                   a11, a12, a13, a14,
                   a21, a22, a23, a24,
                   a31, a32, a33, a34)
    {
        dst[ 0] = a11; dst[ 1] = a12; dst[ 2] = a13; dst[ 3] = a14;
        dst[ 4] = a21; dst[ 5] = a22; dst[ 6] = a23; dst[ 7] = a24;
        dst[ 8] = a31; dst[ 9] = a32; dst[10] = a33; dst[11] = a34;
        return dst;
    },
    MakeUndef : function() {
        return new Float32Array(12);
    },
    Make : function(a11, a12, a13, a14,
                    a21, a22, a23, a24,
                    a31, a32, a33, a34)
    {
        var dst = new Float32Array(12);
        dst[ 0] = a11; dst[ 1] = a12; dst[ 2] = a13; dst[ 3] = a14;
        dst[ 4] = a21; dst[ 5] = a22; dst[ 6] = a23; dst[ 7] = a24;
        dst[ 8] = a31; dst[ 9] = a32; dst[10] = a33; dst[11] = a34;
        return dst;
    },
    copy : function(dst, src)
    {
        dst[ 0] = src[ 0]; dst[ 1] = src[ 1];
        dst[ 2] = src[ 2]; dst[ 3] = src[ 3];
        dst[ 4] = src[ 4]; dst[ 5] = src[ 5];
        dst[ 6] = src[ 6]; dst[ 7] = src[ 7];
        dst[ 8] = src[ 8]; dst[ 9] = src[ 9];
        dst[10] = src[10]; dst[11] = src[11];
        return dst;
    },
    Dup : function(src)
    {
        var dst = new Float32Array(12);
        dst[ 0] = src[ 0]; dst[ 1] = src[ 1];
        dst[ 2] = src[ 2]; dst[ 3] = src[ 3];
        dst[ 4] = src[ 4]; dst[ 5] = src[ 5];
        dst[ 6] = src[ 6]; dst[ 7] = src[ 7];
        dst[ 8] = src[ 8]; dst[ 9] = src[ 9];
        dst[10] = src[10]; dst[11] = src[11];
        return dst;
    },
    GetRow : function(src, i)
    {
        i *= 4;
        return v4.Make(src[0 + i], src[1 + i], src[2 + i], src[3 + i]);
    },
    GetCol : function(src, i)
    {
        return v3.Make(src[0 + i], src[4 + i], src[8 + i]);
    },
    setZero : function(dst)
    {
        dst.fill(0);
        return dst;
    },
    MakeZero : function()
    {
        var dst = new Float32Array(12);
        dst.fill(0);
        return dst;
    },
    setIdent : function(dst)
    {
        return m34.set(
            dst,
            1, 0, 0, 0,
            0, 1, 0, 0,
            0, 0, 1, 0);
    },
    MakeIdent : function()
    {
        var dst = new Float32Array(12);
        return m34.setIdent(dst);
    },
    RotV3 : function(lhs, rhs)
    {
        return v3.Make(
            lhs[ 0] * rhs[0] + lhs[ 1] * rhs[1] + lhs[ 2] * rhs[2],
            lhs[ 4] * rhs[0] + lhs[ 5] * rhs[1] + lhs[ 6] * rhs[2],
            lhs[ 8] * rhs[0] + lhs[ 9] * rhs[1] + lhs[10] * rhs[2]);
    },
    MulV3 : function(lhs, rhs)
    {
        return v3.Make(
            lhs[ 0] * rhs[0] + lhs[ 1] * rhs[1] + lhs[ 2] * rhs[2] + lhs[ 3],
            lhs[ 4] * rhs[0] + lhs[ 5] * rhs[1] + lhs[ 6] * rhs[2] + lhs[ 7],
            lhs[ 8] * rhs[0] + lhs[ 9] * rhs[1] + lhs[10] * rhs[2] + lhs[11]);
    },
    setMul : function(dst, lhs, rhs)
    {
        return m34.set(
            dst,
            lhs[ 0] * rhs[ 0] + lhs[ 1] * rhs[ 4] + lhs[ 2] * rhs[ 8],
            lhs[ 0] * rhs[ 1] + lhs[ 1] * rhs[ 5] + lhs[ 2] * rhs[ 9],
            lhs[ 0] * rhs[ 2] + lhs[ 1] * rhs[ 6] + lhs[ 2] * rhs[10],
            lhs[ 0] * rhs[ 3] + lhs[ 1] * rhs[ 7] + lhs[ 2] * rhs[11] + lhs[ 3],
            lhs[ 4] * rhs[ 0] + lhs[ 5] * rhs[ 4] + lhs[ 6] * rhs[ 8],
            lhs[ 4] * rhs[ 1] + lhs[ 5] * rhs[ 5] + lhs[ 6] * rhs[ 9],
            lhs[ 4] * rhs[ 2] + lhs[ 5] * rhs[ 6] + lhs[ 6] * rhs[10],
            lhs[ 4] * rhs[ 3] + lhs[ 5] * rhs[ 7] + lhs[ 6] * rhs[11] + lhs[ 7],
            lhs[ 8] * rhs[ 0] + lhs[ 9] * rhs[ 4] + lhs[10] * rhs[ 8],
            lhs[ 8] * rhs[ 1] + lhs[ 9] * rhs[ 5] + lhs[10] * rhs[ 9],
            lhs[ 8] * rhs[ 2] + lhs[ 9] * rhs[ 6] + lhs[10] * rhs[10],
            lhs[ 8] * rhs[ 3] + lhs[ 9] * rhs[ 7] + lhs[10] * rhs[11] + lhs[11]);
    },
    Mul : function(lhs, rhs)
    {
        var dst = new Float32Array(12);
        return m34.setMul(dst, lhs, rhs);
    },
    setST : function(dst, scale, trans)
    {
        return m34.set(
            dst,
            scale[0], 0, 0, trans[0],
            0, scale[1], 0, trans[1],
            0, 0, scale[2], trans[2]);
    },
    MakeST : function(scale, trans)
    {
        var dst = new Float32Array(12);
        return m34.setST(dst, scale, trans);
    },
    setRotX : function(dst, rx)
    {
        var sinx = Math.sin(rx), cosx = Math.cos(rx);
        return m34.set(
            dst,
            1,     0,    0, 0,
            0,  cosx, sinx, 0,
            0, -sinx, cosx, 0);
    },
    setRotY : function(dst, ry)
    {
        var siny = Math.sin(ry), cosy = Math.cos(ry);
        return m34.set(
            dst,
            cosy, 0, -siny, 0,
               0, 1,     0, 0,
            siny, 0,  cosy, 0);
    },
    setRotZ : function(dst, rz)
    {
        var sinz = Math.sin(rz), cosz = Math.cos(rz);
        return m34.set(
            dst,
             cosz, sinz, 0, 0,
            -sinz, cosz, 0, 0,
                0,    0, 1, 0);
    },
    setRotZXY : function(dst, r)
    {
        var sinx = Math.sin(r[0]), cosx = Math.cos(r[0]);
        var siny = Math.sin(r[1]), cosy = Math.cos(r[1]);
        var sinz = Math.sin(r[2]), cosz = Math.cos(r[2]);
        // RotX * RotZ
        //         cosz,         sinz,    0,
        // -cosx * sinz,  cosx * cosz, sinx,
        //  sinx * sinz, -sinx * cosz, cosx,
        return m34.set(
            dst,
            cosy * cosz - siny * sinx * sinz, cosy * sinz + siny * sinx * cosz, -siny * cosx, 0,
                                -cosx * sinz,                      cosx * cosz,         sinx, 0,
            siny * cosz + cosy * sinx * sinz, siny * sinz - cosy * sinx * cosz,  cosy * cosx, 0);
    },
    setRotZXYDeg : function(dst, r) { return m34.setRotZXY(dst, v3.Muls(r, cDeg2Rad)); },
    setSRT : function(dst, s, r, t)
    {
        var sinx = Math.sin(r[0]), cosx = Math.cos(r[0]);
        var siny = Math.sin(r[1]), cosy = Math.cos(r[1]);
        var sinz = Math.sin(r[2]), cosz = Math.cos(r[2]);
        return m34.set(
            dst,
            s[0] * (cosy * cosz - siny * sinx * sinz),
            s[1] * (cosy * sinz + siny * sinx * cosz),
            s[2] * -siny * cosx,
            t[0],
            s[0] * -cosx * sinz,
            s[1] * cosx * cosz,
            s[2] * sinx,
            t[1],
            s[0] * (siny * cosz + cosy * sinx * sinz),
            s[1] * (siny * sinz - cosy * sinx * cosz),
            s[2] * cosy * cosx,
            t[2]);
    },
    setSRTDeg : function(dst, s, r, t) { return m34.setSRT(dst, s, v3.Muls(r, cDeg2Rad), t); },
    MakeSRT : function(s, r, t)
    {
        var dst = new Float32Array(12);
        return m34.setSRT(dst, s, r, t);
    },
    MakeSRTDeg : function(s, r, t) { return m34.MakeSRT(s, v3.Muls(r, cDeg2Rad), t); },
    setOrtho : function(dst, dir, up, pos, scale)
    {
        scale = scale || v3.Makes(1);
        v3.normalize(dir)
        var left = v3.normalize(v3.Cross(up, dir));
        up = v3.normalize(v3.Cross(dir, left));
        return m34.set(
            dst,
            left[0] * scale[0],
            up  [0] * scale[1],
            dir [0] * scale[2],
            pos [0],
            left[1] * scale[0],
            up  [1] * scale[1],
            dir [1] * scale[2],
            pos [1],
            left[2] * scale[0],
            up  [2] * scale[1],
            dir [2] * scale[2],
            pos [2]);
    },
    MakeOrtho : function(dir, up, pos, scale)
    {
        var dst = new Float32Array(12);
        return m34.setOrtho(dst, dir, up, pos, scale);
    },
    setLookAt : function(dst, cam_pos, cam_at, up)
    {
        var vz = v3.normalize(v3.Sub(cam_pos, cam_at));
        var vx = v3.normalize(v3.Cross(up, vz));
        var vy = v3.normalize(v3.Cross(vz, vx));
        return m34.set(
            dst,
            vx[0], vx[1], vx[2], -v3.Dot(cam_pos, vx),
            vy[0], vy[1], vy[2], -v3.Dot(cam_pos, vy),
            vz[0], vz[1], vz[2], -v3.Dot(cam_pos, vz));
    },
    MakeLookAt : function(cam_pos, cam_at, up)
    {
        var dst = new Float32Array(12);
        return m34.setLookAt(dst, cam_pos, cam_at, up);
    },
    GetTrans : function(src) { return v3.Make(src[3], src[7], src[11]); },
    setTrans : function(dst, t) { dst[3]  = t[0]; dst[7]  = t[1]; dst[11]  = t[2]; },
    addTrans : function(dst, t) { dst[3] += t[0]; dst[7] += t[1]; dst[11] += t[2]; },
    subTrans : function(dst, t) { dst[3] -= t[0]; dst[7] -= t[1]; dst[11] -= t[2]; },
    Dump : function(src, d, label)
    {
        if (label) { Log(label + ':'); }
        Log('[0] ' + v4.ToFixed(m34.GetRow(src, 0), d));
        Log('[1] ' + v4.ToFixed(m34.GetRow(src, 1), d));
        Log('[2] ' + v4.ToFixed(m34.GetRow(src, 2), d));
    },
};
  </script>
  <!-- <script src="m44.js"></script> -->
  <script>
'use strict';
// 4x4 matrix functions.
var m44 = {
    set : function(dst,
                   a11, a12, a13, a14,
                   a21, a22, a23, a24,
                   a31, a32, a33, a34,
                   a41, a42, a43, a44)
    {
        dst[ 0] = a11; dst[ 1] = a12; dst[ 2] = a13; dst[ 3] = a14;
        dst[ 4] = a21; dst[ 5] = a22; dst[ 6] = a23; dst[ 7] = a24;
        dst[ 8] = a31; dst[ 9] = a32; dst[10] = a33; dst[11] = a34;
        dst[12] = a41; dst[13] = a42; dst[14] = a43; dst[15] = a44;
        return dst;
    },
    MakeUndef : function() {
        return new Float32Array(16);
    },
    Make : function(a11, a12, a13, a14,
                    a21, a22, a23, a24,
                    a31, a32, a33, a34,
                    a41, a42, a43, a44)
    {
        var dst = new Float32Array(16);
        dst[ 0] = a11; dst[ 1] = a12; dst[ 2] = a13; dst[ 3] = a14;
        dst[ 4] = a21; dst[ 5] = a22; dst[ 6] = a23; dst[ 7] = a24;
        dst[ 8] = a31; dst[ 9] = a32; dst[10] = a33; dst[11] = a34;
        dst[12] = a41; dst[13] = a42; dst[14] = a43; dst[15] = a44;
        return dst;
    },
    copy : function(dst, src)
    {
        dst[ 0] = src[ 0]; dst[ 1] = src[ 1];
        dst[ 2] = src[ 2]; dst[ 3] = src[ 3];
        dst[ 4] = src[ 4]; dst[ 5] = src[ 5];
        dst[ 6] = src[ 6]; dst[ 7] = src[ 7];
        dst[ 8] = src[ 8]; dst[ 9] = src[ 9];
        dst[10] = src[10]; dst[11] = src[11];
        dst[12] = src[12]; dst[13] = src[13];
        dst[14] = src[14]; dst[15] = src[15];
        return dst;
    },
    Dup : function(src)
    {
        var dst = new Float32Array(16);
        dst[ 0] = src[ 0]; dst[ 1] = src[ 1];
        dst[ 2] = src[ 2]; dst[ 3] = src[ 3];
        dst[ 4] = src[ 4]; dst[ 5] = src[ 5];
        dst[ 6] = src[ 6]; dst[ 7] = src[ 7];
        dst[ 8] = src[ 8]; dst[ 9] = src[ 9];
        dst[10] = src[10]; dst[11] = src[11];
        dst[12] = src[12]; dst[13] = src[13];
        dst[14] = src[14]; dst[15] = src[15];
        return dst;
    },
    GetRow : function(src, i)
    {
        i *= 4;
        return v4.Make(src[0 + i], src[1 + i], src[2 + i], src[3 + i]);
    },
    GetCol : function(src, i)
    {
        return v4.Make(src[0 + i], src[4 + i], src[8 + i], src[12 + i]);
    },
    setZero : function(dst)
    {
        dst.fill(0);
        return dst;
    },
    MakeZero : function(dst)
    {
        var dst = new Float32Array(16);
        return m44.setZero(dst);
    },
    setIdent : function(dst)
    {
        return m44.set(
            dst,
            1, 0, 0, 0,
            0, 1, 0, 0,
            0, 0, 1, 0,
            0, 0, 0, 1);
    },
    MakeIdent : function()
    {
        var dst = new Float32Array(16);
        return m44.setIdent(dst);
    },
    setMul34 : function(dst, lhs, rhs)
    {
        return m44.set(
            dst,
            lhs[ 0] * rhs[ 0] + lhs[ 1] * rhs[ 4] + lhs[ 2] * rhs[ 8],
            lhs[ 0] * rhs[ 1] + lhs[ 1] * rhs[ 5] + lhs[ 2] * rhs[ 9],
            lhs[ 0] * rhs[ 2] + lhs[ 1] * rhs[ 6] + lhs[ 2] * rhs[10],
            lhs[ 0] * rhs[ 3] + lhs[ 1] * rhs[ 7] + lhs[ 2] * rhs[11] + lhs[ 3],
            lhs[ 4] * rhs[ 0] + lhs[ 5] * rhs[ 4] + lhs[ 6] * rhs[ 8],
            lhs[ 4] * rhs[ 1] + lhs[ 5] * rhs[ 5] + lhs[ 6] * rhs[ 9],
            lhs[ 4] * rhs[ 2] + lhs[ 5] * rhs[ 6] + lhs[ 6] * rhs[10],
            lhs[ 4] * rhs[ 3] + lhs[ 5] * rhs[ 7] + lhs[ 6] * rhs[11] + lhs[ 7],
            lhs[ 8] * rhs[ 0] + lhs[ 9] * rhs[ 4] + lhs[10] * rhs[ 8],
            lhs[ 8] * rhs[ 1] + lhs[ 9] * rhs[ 5] + lhs[10] * rhs[ 9],
            lhs[ 8] * rhs[ 2] + lhs[ 9] * rhs[ 6] + lhs[10] * rhs[10],
            lhs[ 8] * rhs[ 3] + lhs[ 9] * rhs[ 7] + lhs[10] * rhs[11] + lhs[11],
            lhs[12] * rhs[ 0] + lhs[13] * rhs[ 4] + lhs[14] * rhs[ 8],
            lhs[12] * rhs[ 1] + lhs[13] * rhs[ 5] + lhs[14] * rhs[ 9],
            lhs[12] * rhs[ 2] + lhs[13] * rhs[ 6] + lhs[14] * rhs[10],
            lhs[12] * rhs[ 3] + lhs[13] * rhs[ 7] + lhs[14] * rhs[11] + lhs[15]);
    },
    Mul34 : function(lhs, rhs)
    {
        var dst = new Float32Array(16);
        return m44.setMul34(dst, lhs, rhs);
    },
    setPerspective : function(dst, fovy, aspect, near, far, offcent)
    {
        var f = Math.tan(cPI * 0.5 - 0.5 * fovy); // 1/tan
        var range_inv = 1.0 / (near - far);
        return m44.set(
            dst,
            f / aspect, 0, offcent ? offcent[0] : 0, 0,
            0         , f, offcent ? offcent[1] : 0, 0,
            0, 0, (near + far) * range_inv, 2 * near * far * range_inv,
            0, 0, -1, 0);
    },
    MakePerspective : function(fovy, aspect, near, far, offcent)
    {
        var dst = new Float32Array(16);
        return m44.setPerspective(dst, fovy, aspect, near, far, off_center);
    },
};
  </script>
  <!-- <script src="math.js"></script> -->
  <script>
'use strict';
var cPI = Math.PI;
var cPI2 = cPI * 2;
var cDeg2Rad = cPI / 180;
var cRad2Deg = 180 / cPI;
var cGoldenRatio = (1 + Math.sqrt(5)) / 2;
var cMinStepF32 = (new Float32Array([1.0000001]))[0];
var cMinValueF32 = cMinStepF32 - 1;
function square(x) { return x * x; }
function lerp(a, b, f) { return a * (1 - f) + b * f; }
function clamp(x, a_min, a_max) { return x < a_min ? a_min : (x < a_max ? x : a_max); }
function max_abs(a, b) { return Math.max(Math.abs(a), Math.abs(b)); }
function step(edge, x) { return edge <= x ? 1 : 0; }
function linearstep(edge0, edge1, x) {
    return clamp((x - edge0) / (edge1 - edge0), 0, 1);
}
function smoothstep(edge0, edge1, x) {
    var t = linearstep(edge0, edge1, x);;
    return t * t * (3 - 2 * t );
}
function pitchYawDeg(pitch, yaw) {
    var pitch_rad = pitch * cDeg2Rad, yaw_rad = yaw * cDeg2Rad;
    var cos_pitch = Math.cos(pitch_rad), sin_pitch = Math.sin(pitch_rad);
    var cos_yaw   = Math.cos(yaw_rad  ), sin_yaw   = Math.sin(yaw_rad  );
    return v3.Make(-cos_pitch * sin_yaw, sin_pitch, cos_pitch * cos_yaw);
}
function pitchYawDegV(v) { return pitchYawDeg(v[0], v[1]); }
function pitchYawRollDeg(pitch, yaw, roll) {
    var pitch_rad = pitch * cDeg2Rad, yaw_rad = yaw * cDeg2Rad, roll_rad = roll * cDeg2Rad;
    var cos_pitch = Math.cos(pitch_rad), sin_pitch = Math.sin(pitch_rad);
    var cos_yaw   = Math.cos(yaw_rad  ), sin_yaw   = Math.sin(yaw_rad  );
    var cos_roll  = Math.cos(roll_rad ), sin_roll  = Math.sin(roll_rad );
    //v3.Make(-cos_pitch * sin_yaw, sin_pitch,  cos_pitch * cos_yaw);
    //v3.Make(cos_yaw, 0, sin_yaw);
    return v3.Make(sin_roll * cos_yaw - cos_roll * cos_pitch * sin_yaw,
                   cos_roll * sin_pitch,
                   sin_roll * sin_yaw + cos_roll * cos_pitch * cos_yaw);
}
function pitchYawRollDegV(v) { return pitchYawRollDeg(v[0], v[1], v[2]); }
function calcV3Center(poss) {
    var center = v3.Makes(0);
    for (var i = 0; i < poss.length; ++i) {
        v3.add(center, poss[i]);
    }
    return v3.muls(center, 1 / poss.length);
}
function CalcMinStepF32()
{
    var ff = new Float32Array(4);
    var delta = 1, i = 0;
    while (true) {
        var next_delta = delta / 2;
        ff[0] = 1 + next_delta;
        if (ff[0] == 1) {
            ff[0] = 1 + delta;
            alert('delta = ' + delta + ', 1 + delta = ' + ff[0] + ', i = ' + i);
            break;
        }
        delta = next_delta;
        ++i;
    }
    var cMinStep = 1 + delta;
    ff[0] = cMinStep;
    ff[1] = 1.0000001;
    ff[2] = 1.0000002;
    alert('' + ff[0] + ' / ' + ff[1] + ' / ' + ff[2]);
}

var cIcosahedron = [];
for (var dim = 0; dim < 3; ++dim) {
    var dim_u = (dim + 1) % 3, dim_v = (dim + 2) % 3;
    for (var face = 0; face < 2; ++face) {
        var f_sign = face * 2 - 1;
        var pos = [];
        for (var u = 0; u < 2; ++u) {
            function push_tri(tri) {
                cIcosahedron.push(tri.map(p => v3.Normalize(p)));
            }
            var u_sign = u * 2 - 1;
            var p0 = v3.Makes(0), p1 = v3.Makes(0), p2 = v3.Makes(0);
            p0[dim] = p1[dim] = f_sign * cGoldenRatio;
            p0[dim_u] = -u_sign * f_sign; p1[dim_u] = u_sign * f_sign;
            p2[dim] = f_sign; p2[dim_v] = u_sign * cGoldenRatio;
            push_tri([p0, p1, p2]);
            if (dim == 0) {
                var p3 = v3.Makes(0), p4 = v3.Makes(0);
                p3[dim_u] = -u_sign * f_sign * cGoldenRatio;
                p4[dim_u] =  u_sign * f_sign * cGoldenRatio;
                p3[dim_v] = p4[dim_v] = u_sign;
                push_tri([p0, p2, p3]); push_tri([p2, p1, p4]);
            }
        }
    }
}
function calcNearestPointsOnLines(p0, d0, p1, d1)
{
    var nd0 = v3.Normalize(d0), nd1 = v3.Normalize(d1);
    var dd0 = v3.Dot(nd0, nd0), dd1 = v3.Dot(nd1, nd1), dd01 = v3.Dot(nd0, nd1);
    var w = dd0 * dd1 - dd01 * dd01;
    if (w == 0) { return null; }
    var t0 = v3.Dot(nd0, p0) - v3.Dot(nd0, p1);
    var t1 = v3.Dot(nd1, p0) - v3.Dot(nd1, p1);
    var a = (-dd1 * t0 + dd01 * t1) / w, pa = v3.add(v3.Muls(nd0, a), p0);
    var b = (-dd01 * t0 + dd0 * t1) / w, pb = v3.add(v3.Muls(nd1, b), p1);
    return {
        pos0 : p0, dir0 : nd0, dist0 : a, pivot0 : pa,
        pos1 : p1, dir1 : nd1, dist1 : b, pivot1 : pb,
        dist : v3.Length(v3.Sub(pa, pb)),
    };
}
  </script>
  <!-- <script src="view.js"></script> -->
  <script>
'use strict';
var cFPS = 60;
var cSmoothFrameNum = 5;
var FPSCalculator = CreateInstance();
FPSCalculator.create = function()
{
    var inst = CreateInstance();
    inst.mLastKeyTime = -1;
    inst.mLastFrameTime = -1;
    inst.mFPS = 0;
    inst.mFrameCount = 0;
    inst.mCalcDeltaTime = 0;
    inst.mDeltaHistory = [];
    inst.mCalcNum = 1;
    inst.initialize = function()
    {
        this.mSpanElement = DebugLog.mSpanFPS;
        for (var i = 0; i < cSmoothFrameNum; ++i) {
            this.mDeltaHistory.push(1000 / cFPS);
        }
    };
    inst.getCalcNum = function() { return this.mCalcNum; }
    inst.calc = function(t_ms)
    {
        if (this.mLastKeyTime < 0) {
            this.mLastKeyTime = t_ms;
        } else {
            ++this.mFrameCount;
            var dt = t_ms - this.mLastKeyTime;
            if (dt >= 1000) {
                this.mFPS = this.mFrameCount * 1000 / dt;
                var span = this.mSpanElement;
                span.innerText = this.mFPS.toFixed(1);
                this.mLastKeyTime = t_ms;
                this.mFrameCount = 0;
            }
        }
        if (this.mLastFrameTime < 0) {
            this.mLastFrameTime = t_ms;
            this.mCalcNum = 1;
        } else {
            var dt = t_ms - this.mLastFrameTime;
            this.mDeltaHistory.shift();
            this.mDeltaHistory.push(dt);
            var t_history = Array.from(this.mDeltaHistory);
            t_history.sort();
            dt = t_history[Math.floor(t_history.length / 2)];
            this.mCalcDeltaTime += dt;
            this.mLastFrameTime = t_ms;
            this.mCalcNum = Math.round(this.mCalcDeltaTime * cFPS / 1000);
            if (this.mCalcNum > g_max_calc_per_frame) {
                this.mCalcNum = g_max_calc_per_frame;
                this.mCalcDeltaTime = 0;
            } else {
                this.mCalcDeltaTime -= this.mCalcNum * 1000 / cFPS;
            }
            //Log('dt = ' + dt.toFixed(1) + ', CalcNum = ' + this.mCalcNum
            //    + ', Delta = ' + this.mCalcDeltaTime.toFixed(1));
        }
    };
    return inst;
};
var g_fps_calculator = FPSCalculator.create();
var Canvas = CreateObjMgr();
Canvas.create = function()
{
    var inst = Canvas.createObj();
    inst.getAspect = function()
    {
        return this.mDisplayWidth / this.mDisplayHeight;
    };
    inst.getContext = function() { return this.mContext; };
    inst.initialize = function(element)
    {
        element.style.display = 'block';
        var opt_aa = SplashObj.opt_aa.checked;
        var gl = element.getContext('webgl', { antialias : opt_aa, });
        if (!gl) { return false; }
        this.mElement = element;
        this.mContext = gl;
        this.mHandle = gl.canvas;
        this.mClearColor = v4.Make(0, 0, 0, 1);
        this.mDisplayWidth = this.mDisplayHeight = 1;
        this.mFrameBufferWidth = this.mFrameBufferHeight = 1;
        this.mIsVerticalMode = false;
        this.mTouchRectOffset = v2.Make(0, 0);
        this.mTouchRectSize = v2.Make(1, 1);
        return true;
    };
    inst.setClearColor = function(col) { this.mClearColor = col; };
    inst.update = function()
    {
        var gl = this.mContext;
        if (g_is_touch_device && false) {
            this.mDisplayWidth  = window.outerWidth;
            this.mDisplayHeight = window.outerHeight;
        } else {
            this.mDisplayWidth  = window.innerWidth;
            this.mDisplayHeight = window.innerHeight;
        }
        this.mElement.style.width  = this.mDisplayWidth  + 'px';
        this.mElement.style.height = this.mDisplayHeight + 'px';
        var reso_div = 1;
        if      (g_opt_resolution == 'half'   ) { reso_div = 2; }
        else if (g_opt_resolution == 'third'  ) { reso_div = 3; }
        else if (g_opt_resolution == 'quarter') { reso_div = 4; }
        this.mFrameBufferWidth  = Math.ceil(this.mDisplayWidth  / reso_div);
        this.mFrameBufferHeight = Math.ceil(this.mDisplayHeight / reso_div);
        if (this.mHandle.width  !== this.mFrameBufferWidth ||
            this.mHandle.height !== this.mFrameBufferHeight) {
            this.mHandle.width  = this.mFrameBufferWidth;
            this.mHandle.height = this.mFrameBufferHeight;
            this.mIsVerticalMode = this.mDisplayWidth < this.mDisplayHeight;
            SetBodyClassName(BodyClassNameSlot.VerticalMode,
                             this.mIsVerticalMode ? 'vertical' : 'horizontal');
        }
        var list_obj = MainMenu.GetListObj();
        v2.set(this.mTouchRectOffset, 0, 0);
        v2.set(this.mTouchRectSize, this.mDisplayWidth, this.mDisplayHeight);
        if (list_obj && list_obj.className.indexOf('hide') < 0) {
            var rect = list_obj.getBoundingClientRect();
            if (this.mIsVerticalMode) {
                this.mTouchRectOffset[1] = rect.bottom;
                this.mTouchRectSize  [1] = this.mDisplayHeight - rect.bottom;
            } else {
                this.mTouchRectOffset[0] = rect.right;
                this.mTouchRectSize  [0] = this.mDisplayWidth - rect.right;
            }
        }
        if (!this.mTouchRectOffsetPrev ||
            !v2.IsEqual(this.mTouchRectOffsetPrev, this.mTouchRectOffset) ||
            !v2.IsEqual(this.mTouchRectSizePrev  , this.mTouchRectSize  )) {
            WatchMode.mCameraGuide.style.width  = this.mTouchRectSize[0] + 'px';
            WatchMode.mCameraGuide.style.height = this.mTouchRectSize[1] + 'px';
            if (!this.mTouchRectOffsetPrev) {
                document.body.append(WatchMode.mCameraGuide);
                this.mTouchRectOffsetPrev = v2.MakeUndef();
                this.mTouchRectSizePrev   = v2.MakeUndef();
            }
            v2.copy(this.mTouchRectOffsetPrev, this.mTouchRectOffset);
            v2.copy(this.mTouchRectSizePrev  , this.mTouchRectSize  );
        }
        gl.viewport(0, 0, this.mHandle.width, this.mHandle.height);
        //gl.depthRange(0.0, 1.0);
        var col = this.mClearColor;
        gl.clearColor(col[0], col[1], col[2], col[3]);
        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
    };
    return inst;
};
var g_canvas = Canvas.create();
var Camera = CreateObjMgr();
Camera.create = function()
{
    var cam = Camera.createObj();
    cam.mPos  = v3.Make(0, 0, 1);
    cam.mAt   = v3.Make(0, 0, 0);
    cam.mUp   = v3.Make(0, 1, 0);
    cam.mAttLeft = v3.Make(1, 0, 0);
    cam.mAttUp   = v3.Make(0, 1, 0);
    cam.mAttDir  = v3.Make(0, 0, 1);
    cam.mFov = g_default_camera_fov * cDeg2Rad;
    cam.mFovx = cam.mFov;
    cam.mFovy = cam.mFov;
    cam.mNear = 1.0;
    cam.mFar  = 10000.0;
    cam.mOffCenter = v2.Makes(0);
    cam.mEffectOffCenter = v2.Makes(0);
    cam.initialize = function()
    {
        this.mViewMatrix = m34.MakeIdent();
        this.mProjectionMatrix = m44.MakeIdent();
    };
    cam.setPos = function(pos) { this.mPos = pos; };
    cam.setAt  = function(at ) { this.mAt  = at ; };
    cam.setUp  = function(up ) { this.mUp  = up ; };
    cam.setOffCenter = function(offcent) { this.mOffCenter = offcent; };
    cam.setFov = function(fov) { this.mFov = fov; };
    cam.getEffectOffCenter = function() { return this.mEffectOffCenter; };
    cam.calcDir = function() {
        return v3.normalize(v3.Sub(this.mAt, this.mPos));
    };
    cam.calcDist = function() {
        return v3.Length(v3.Sub(this.mAt, this.mPos));
    };
    cam.getViewMatrix = function() { return this.mViewMatrix; };
    cam.getProjectionMatrix = function() { return this.mProjectionMatrix; };
    cam.update = function()
    {
        this.mAttDir = this.calcDir();
        this.mAttLeft = v3.normalize(v3.Cross(this.mUp, this.mAttDir));
        this.mAttUp = v3.normalize(v3.Cross(this.mAttDir, this.mAttLeft));
        m34.setLookAt(this.mViewMatrix, this.mPos, this.mAt, this.mUp);
        if (g_canvas.mIsVerticalMode) {
            this.mFovx = this.mFov;
            this.mFovy = Math.atan(Math.tan(this.mFovx * 0.5) / g_canvas.getAspect()) * 2;
        } else {
            this.mFovy = this.mFov;
            this.mFovx = Math.atan(Math.tan(this.mFovy * 0.5) * g_canvas.getAspect()) * 2;
        }
        v2.copy(this.mEffectOffCenter, this.mOffCenter);
        var list_obj = MainMenu.GetListObj();
        if (list_obj && list_obj.className.indexOf('hide') < 0) {
            var rect = list_obj.getBoundingClientRect();
            if (g_canvas.mIsVerticalMode) {
                this.mEffectOffCenter[1] = lerp(
                    this.mEffectOffCenter[1], 1, rect.bottom / g_canvas.mDisplayHeight);
            } else {
                this.mEffectOffCenter[0] = lerp(
                    this.mEffectOffCenter[0], -1, rect.right / g_canvas.mDisplayWidth);
            }
        }
        var nf_factor = 1 / Math.tan(this.mFov * 0.5);
        m44.setPerspective(
            this.mProjectionMatrix,
            this.mFovy, g_canvas.getAspect(),
            this.mNear * nf_factor, this.mFar * nf_factor,
            this.mEffectOffCenter);
    };
    // screen_pos: [-1,-1]~[+1,+1]
    cam.calcRayDir = function(screen_pos)
    {
        var ty = Math.tan(this.mFovy * 0.5);
        var tx = ty * g_canvas.getAspect();
        var ofs_screen_pos = v2.Add(screen_pos, g_camera.getEffectOffCenter());
        var ray_dir = v3.add(v3.Muls(this.mAttLeft, -tx * ofs_screen_pos[0]),
                             v3.Muls(this.mAttUp, ty * ofs_screen_pos[1]));
        return v3.normalize(v3.add(ray_dir, this.mAttDir));
    };
    cam.calcPlaneIntersection = function(ray_dir, plane_pos, plane_nrm)
    {
        var plane_dist = v3.Dot(v3.Sub(this.mPos, plane_pos), plane_nrm);
        var dot = v3.Dot(ray_dir, plane_nrm);
        return v3.Sub(this.mPos, v3.Muls(ray_dir, plane_dist / dot));
    };
    cam.calcSphereIntersection = function(ray_dir, sphere)
    {
        var delta = v3.Sub(sphere, this.mPos), dist = v3.Length(delta), r = sphere[3];
        if (dist <= r) { return dist; }
        var dot = v3.Dot(delta, ray_dir);
        if (dot <= 0) { return -1; }
        var ret = Math.sqrt(dist * dist - dot * dot);
        return ret <= r ? ret : -1;
    };
    cam.calcCapsuleIntersection = function(ray_dir, pos0, pos1, r)
    {
        var delta = v3.Sub(pos1, pos0), len = v3.Length(delta);
        var res = calcNearestPointsOnLines(this.mPos, ray_dir, pos0, delta);
        if (res && res.dist0 >= 0 && res.dist1 >= 0 && res.dist1 <= len) {
            if (res.dist > r) { return null; }
            return { dist : res.dist, ofs : res.dist1, pos : res.pivot1, };
        }
        return null;
        var t = this.calcSphereIntersection(ray_dir, v4.FromV3(pos0, r));
        if (t >= 0) { return { dist : t, ofs : 0, pos : pos0, }; }
        t = this.calcSphereIntersection(ray_dir, v4.FromV3(pos1, r));
        if (t >= 0) { return { dist : t, ofs : len, pos : pos1, }; }
        return null;
    };
    return cam;
};
var CameraControl = CreateSingleton();
CameraControl.create = function(args)
{
    var inst = {
        mAt    : v3.Makes(0),
        mDist  : 50.0,
        mDistFactor : 1,
        //mDist  : 15,
        mYaw   : cPI / 2,
        mPitch : cPI * .4,//cPI / 4,
        mMaxPitch :  cPI * 0.49,
        mMinPitch : -cPI * 0.49,
        mFov : g_default_camera_fov * cDeg2Rad,
        mDownAt    : v3.Makes(0),
        mDownPos   : v3.Makes(0),
        mDownDist  : 0.0,
        mDownFov   : 0.0,
        mDownYaw   : 0.0,
        mDownPitch : 0.0,
        mDownOffCenter : v2.Makes(0),
        mOffCenter     : v2.Makes(0),
        mAttX : null,
        mAttZ : null,
        mIsEnableCalcPos : true,
    };
    inst.setYaw = function(yaw) {
        this.mYaw = yaw - Math.floor(yaw / cPI2) * cPI2;
    };
    inst.beginRotate = function()
    {
        this.mDownYaw   = this.mYaw  ;
        this.mDownPitch = this.mPitch;
    };
    inst.calcRotate = function(delta)
    {
        if (!this.mIsEnableCalcPos) { return; }
        this.setYaw(this.mDownYaw + delta[0] * 4.0);
        this.mPitch = this.mDownPitch + delta[1] * 4.0;
        this.mPitch = clamp(this.mPitch, this.mMinPitch, this.mMaxPitch);
    };
    inst.beginSlide = function()
    {
        if (this.mIsEnableCalcPos) { v3.copy(this.mDownAt, this.mAt); }
    };
    inst.calcSlide = function(delta)
    {
        var flat_dir = v3.normalize(v3.SetY(g_camera.calcDir(), 0));
        var flat_left = v3.Make(flat_dir[2], 0, -flat_dir[0]);
        var speed = this.mDist * 2.0;
        var p_curr;
        if (this.mIsEnableCalcPos) {
            p_curr = this.mAt;
            v3.copy(p_curr, this.mDownAt);
        } else {
            p_curr = g_camera.mPos;
            g_mouse.resetDelta();
        }
        v3.add(p_curr, v3.Muls(flat_left, delta[0] * speed));
        v3.add(p_curr, v3.Muls(flat_dir, delta[1] * speed * Math.sign(this.mPitch)));
        if (!this.mIsEnableCalcPos) { this.calcInverse(); }
    };
    inst.beginPan = function()
    {
        if (this.mIsEnableCalcPos) { v3.copy(this.mDownAt, this.mAt); }
    };
    inst.calcPan = function(delta)
    {
        var flat_dir = v3.normalize(v3.SetY(g_camera.calcDir(), 0));
        var cam_left = v3.normalize(v3.Cross(v3.ey, flat_dir));
        var speed = this.mDist * 2.0;
        var p_curr;
        if (this.mIsEnableCalcPos) {
            p_curr = this.mAt;
            v3.copy(p_curr, this.mDownAt);
        } else {
            p_curr = g_camera.mPos;
            g_mouse.resetDelta();
        }
        var pan_y = delta[1];
        if (g_is_touch_device) {
            pan_y += delta[0];
            //pan_y = pan_y > 0 ? Math.max(0, pan_y - 0.1) : Math.min(0, pan_y + 0.1);
            v3.add(p_curr, v3.Muls(v3.ey, pan_y * speed));
        } else {
            v3.add(p_curr, v3.Muls(cam_left, delta[0] * speed));
            v3.add(p_curr, v3.Muls(v3.ey, pan_y * speed));
        }
        if (!this.mIsEnableCalcPos) { this.calcInverse(); }
    };
    inst.beginOffCenter = function()
    {
        v3.copy(this.mDownOffCenter, this.mOffCenter);
    };
    inst.calcOffCenter = function(delta)
    {
        this.mOffCenter = v2.Clamps(v2.add(v2.muls(v2.Make(
            -delta[0], delta[1]), 2), this.mDownOffCenter), -1, 1);
    };
    inst.beginZoom = function()
    {
        this.mDownDist = this.mDist;
        if (!this.mIsEnableCalcPos) { this.calcInverse(); }
    },
    inst.calcZoom = function(delta)
    {
        this.mDist = this.mDownDist * Math.pow(8, -delta[1]);
        this.mDist = Math.max(this.mDist, 1);
        this.mDist = Math.min(this.mDist, 10000);
        if (!this.mIsEnableCalcPos) {
            g_camera.mPos = v3.add(v3.muls(g_camera.calcDir(), -this.mDist), g_camera.mAt);
            g_mouse.resetDelta();
            this.mDownDist = this.mDist;
            this.calcInverse();
        }
    };
    inst.beginDolly = function()
    {
        this.mDownFov = this.mFov;
    },
    inst.calcDolly = function(delta)
    {
        delta = delta < 0 ? Math.min(delta, -1) : delta > 0 ? Math.max(delta, 1) : 0;
        var fov_rad = clamp(Math.round(this.mDownFov * cRad2Deg + delta), 1, 179);
        this.mFov = fov_rad * cDeg2Rad;
        FileMode.setFov(fov_rad);
    };
    inst.calcInverse = function()
    {
        this.mDist = g_camera.calcDist();
    };
    inst.getAt = function() { return this.mAt; };
    inst.setAt = function(at) { this.mAt = at; };
    inst.setAtt = function(dx, dz) { this.mAttX = dx; this.mAttZ = dz; };
    inst.calcDist = function() { return this.mDist * (this.mDistFactor || 1); };
    inst.setDistFactor = function(df) { this.mDistFactor = df; };
    inst.resetDistFactor = function(df) {
        this.mDist *= this.mDistFactor;
    };
    inst.setFov = function(fov) { this.mFov = fov; };
    inst.setEnableCalcPos = function(f) { this.mIsEnableCalcPos = f; };
    inst.calcPos = function()
    {
        if (this.mAttX && !this.mPrevAttX) {
            var focus_yaw = Math.atan2(this.mAttX[2], this.mAttX[0]);
            this.setYaw(this.mYaw - focus_yaw);
        } else if (!this.mAttX && this.mPrevAttX) {
            var focus_yaw = Math.atan2(this.mPrevAttX[2], this.mPrevAttX[0]);
            this.setYaw(this.mYaw + focus_yaw);
        }
        if (this.mDistFactor && !this.mPrevDistFactor) {
            this.mDist /= this.mDistFactor;
        } else if(!this.mDistFactor && this.mPrevDistFactor) {
            this.mDist *= this.mPrevDistFactor;
        }
        var pos = v3.Make(
            Math.cos(this.mPitch) * Math.cos(this.mYaw),
            Math.sin(this.mPitch),
            Math.cos(this.mPitch) * Math.sin(this.mYaw));
        if (this.mAttX) {
            pos = v3.setY(v3.add(v3.Muls(this.mAttX, pos[0]),
                                 v3.Muls(this.mAttZ, pos[2])), pos[1]);
        }
        this.mPrevAttX = this.mAttX;
        this.mPrevDistFactor = this.mDistFactor;
        return v3.add(v3.muls(pos, this.mDist * (this.mDistFactor || 1)
                              / Math.tan(this.mFov * 0.5)), this.mAt);
    };
    inst.apply = function(camera)
    {
        camera.setAt(this.getAt());
        if (this.mIsEnableCalcPos) {
            camera.setPos(this.calcPos());
        }
        camera.setOffCenter(this.mOffCenter);
        camera.setFov(this.mFov);
    };
    inst.save = function()
    {
        return {
            at : v3.ToArray(this.mAt),
            pitch : this.mPitch,
            yaw : this.mYaw,
            dist : this.mDist,
            off_center : v2.ToArray(this.mOffCenter),
        };
    };
    inst.load = function(data)
    {
        this.mAt = v3.Dup(data.at);
        this.mPitch = data.pitch;
        this.mYaw = data.yaw;
        this.mDist = data.dist;
        this.mOffCenter = data.off_center;
    };
    return inst;
};
var WatchMode = CreateInstance();
WatchMode.mIsPauseMgr = UI_Check.createMgr({ fixed : true, })
WatchMode.mSimSpeedMgr = UI_Select.createMgr({
    fixed : true,
    options : [
        { value : 'x1/60', }, { value : 'x1/20', }, { value : 'x1/10', },
        { value : 'x1/5' , }, { value : 'x1/2' , }, { value : 'x1.0' , },
        { value : 'x2.0' , }, { value : 'x5.0' , }, { value : 'x10'  , },
        { value : 'x20'  , }, { value : 'x60'  , },
    ], });
WatchMode.mIsFixCameraMgr = UI_Check.createMgr({ fixed : true, })
WatchMode.mIsFocusRotMgr = UI_Check.createMgr({ fixed : true, })
WatchMode.mIsFocusZoomMgr = UI_Check.createMgr({ fixed : true, })
WatchMode.mIsMultiFocusMgr = UI_Check.createMgr({ fixed : true, })
WatchMode.mIsInspectMgr = UI_Check.createMgr({ fixed : true, })
WatchMode.initialize = function()
{
    WatchMode.mWatchPane = CreateEditPane('watch', cLang.head_watch, function(div_on) {
        this.mLayoutNameP = CreateElement('p');
        div_on.append(this.mLayoutNameP);
        this.mIsPause = this.mIsPauseMgr.createActiveInstance({
            parent : div_on, value : false, title : cLang.watch_pause, });
        div_on.append(CreateHBR());
        this.mSimSpeed = this.mSimSpeedMgr.createActiveInstance({
            parent : div_on, value : 'x1.0', title : cLang.watch_sim_speed, });
        div_on.append(CreateHBR());
        this.mIsFixCamera = this.mIsFixCameraMgr.createActiveInstance({
            parent : div_on, value : false, title : cLang.watch_fix_camera, });
        div_on.append(CreateHBR());
        this.mIsFocusRot = this.mIsFocusRotMgr.createActiveInstance({
            parent : div_on, value : true, title : cLang.watch_rot_focus, });
        div_on.append(CreateHBR());
        this.mIsFocusZoom = this.mIsFocusZoomMgr.createActiveInstance({
            parent : div_on, value : true, title : cLang.watch_zoom_focus, });
        div_on.append(CreateHBR());
        if (g_is_touch_device) {
            this.mIsMultiFocus = this.mIsMultiFocusMgr.createActiveInstance({
                parent : div_on, value : false, title : cLang.watch_multi_focus, });
        } else {
            div_on.append(CreateEditDiv(
                LangSpan(LangAppend(cLang.watch_multi_focus, ': shift'))));
        }
        div_on.append(CreateHBR());
        this.mIsInspect = this.mIsInspectMgr.createActiveInstance({
            parent : div_on, value : false, title : cLang.watch_inspect_mode, });
        div_on.append(CreateHBR());
        div_on.append(CreateScriptLinkEdit(cLang.watch_photo_mode, function() {
            SetPhotoMode(true);
        }));
    }, this);
    var cam_guide = CreateElement('table', 'camera-guide');
    var guide_text = [
        'offcent', 'forward', 'fov'    ,
        'slide'  , 'rotate' , 'slide'  ,
        'pan'    , 'forward', 'offcent',
    ];
    for (var irow = 0, icell = 0; irow < 3; ++irow) {
        var row = CreateElement('tr');
        if (irow != 1 && g_is_touch_device) { row.className = 'edge'; }
        for (var icol = 0; icol < 3; ++icol, ++icell) {
            var cell = CreateElement('td');
            if (icol != 1 && g_is_touch_device) { cell.className = 'edge'; }
            var text = cLang['cam_guide_' + guide_text[icell]];
            if (g_is_touch_device) {
                cell.append(LangSpan(text));
            } else {
                cell.append(LangSpan(text), ':', CreateBR());
                cell.append(LangSpan(cLang['cam_key_' + guide_text[icell]]));
            }
            if (icell == 4) {
                var close_link = CreateScriptLink(cLang.cam_guide_close, function() {
                    cam_guide.style.display = 'none';
                })
                cell.append(CreateBR(), close_link);
                g_mouse.pushCoverElements(close_link);
            }
            row.append(cell);
        }
        cam_guide.append(row);
    }
    this.mCameraGuide = cam_guide;
};
WatchMode.isCameraGuideVisible = function() {
    return this.mCameraGuide.style.display != 'none';
};
WatchMode.setCameraGuideVisible = function(f) {
    this.mCameraGuide.style.display = f ? null/*'table'*/ : 'none';
};
WatchMode.setTitle = function(title, author)
{
    if (!this.mLayoutNameP) { return; }
    ClearChildren(this.mLayoutNameP);
    this.mLayoutNameP.append(LangSpan(title, null, true), CreateHBR());
    FileMode.appendAuthorLink(this.mLayoutNameP, author);
};
WatchMode.getSimSpeed = function()
{
    var ret = this.mSimSpeed.mValue;
    return ret.startsWith('x1/') ? 1 / parseInt(ret.substr(3)) : parseInt(ret.substr(1));
};
WatchMode.isFixCamera = function() { return this.mIsFixCamera.mValue; };
WatchMode.isFocusRot = function() { return this.mIsFocusRot.mValue; };
WatchMode.isFocusZoom = function() { return this.mIsFocusZoom.mValue; };
WatchMode.isMultiFocus = function() { return this.mIsMultiFocus.mValue; };
function IsPause() { return WatchMode.mIsPause.mValue || g_calc_num < 1; }
function SetPause(p) { WatchMode.mIsPauseMgr.updateValue(WatchMode.mIsPause, p); }
function IsInspectMode()
{
    return !IsMenuWatch() || IsEnableDebugDraw() || WatchMode.mIsInspect.mValue;
}
var g_is_photo_mode = false;
function IsPhotoMode() { return g_is_photo_mode; }
function SetPhotoMode(f)
{
    g_is_photo_mode = f;
    SetBodyClassName(BodyClassNameSlot.PhotoMode, 'photo-' + (f ? 'on' : 'off'));
}
  </script>
  <!-- <script src="webgl.js"></script> -->
  <script>
'use strict';
const cSignNum = 2;
const cVtxPerTri = 3;
const cVtxPerQuad = 4;
const cTriPerQuad = 2;
const cFacePerCube = 6;
var webgl = CreateInstance();
webgl.initialize = function(gl)
{
    //Log('webgl.initialize');
    this.mContext = gl;
    this.checkConstant(gl, 'MAX_VERTEX_ATTRIBS');
    this.checkConstant(gl, 'MAX_VERTEX_UNIFORM_VECTORS');
    this.checkConstant(gl, 'MAX_FRAGMENT_UNIFORM_VECTORS');
    this.mExtInstancedArrays = gl.getExtension('ANGLE_instanced_arrays');
};
webgl.checkConstant = function(gl, name)
{
    this[name] = gl.getParameter(gl[name]);
    Log(name + ' = ' + this[name]);
};
webgl.createShader = function(gl, id, src, type)
{
    var shader = gl.createShader(type);
    gl.shaderSource(shader, src);
    gl.compileShader(shader);
    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
        var lastError = gl.getShaderInfoLog(shader);
        var line_no = 0;
        console.log(src.split('\n').map(line => '' + (++line_no) + ' ' + line).join('\n'));
        console.log('*** Error compiling shader ' + id + '.'
                    + (type == gl.VERTEX_SHADER ? 'vsh' : 'fsh') + ':');
        console.log(lastError);
        gl.deleteShader(shader);
        return null;
    }
    return shader;
};
webgl.createShaderProgram = function(gl, id, vsh_src, fsh_src)
{
    var shaders = [
        this.createShader(gl, id, vsh_src, gl.VERTEX_SHADER  ),
        this.createShader(gl, id, fsh_src, gl.FRAGMENT_SHADER),
    ];
    var program = gl.createProgram();
    for (var i = 0; i < shaders.length; ++i) {
        if (!shaders[i]) {
            gl.deleteProgram(program);
            return null;
        }
        gl.attachShader(program, shaders[i]);
    }
    gl.linkProgram(program);
    var linked = gl.getProgramParameter(program, gl.LINK_STATUS);
    if (!linked) {
        var lastError = gl.getProgramInfoLog(program);
        console.log('Error in program linking:');
        console.log(lastError);
        gl.deleteProgram(program);
        return null;
    }
    return program;
};
webgl.getUniformLocationV = function(gl, shader, name, size)
{
    var locations = [];
    for (var i = 0; i < size; ++i) {
        locations.push(gl.getUniformLocation(shader, name + '[' + i + ']'));
    }
    return locations;
};
webgl.uniform4fx3 = function(gl, locations, m)
{
    gl.uniform4f(locations[0], m[ 0], m[ 1], m[ 2], m[ 3]);
    gl.uniform4f(locations[1], m[ 4], m[ 5], m[ 6], m[ 7]);
    gl.uniform4f(locations[2], m[ 8], m[ 9], m[10], m[11]);
};
webgl.uniform4fx4 = function(gl, locations, m)
{
    gl.uniform4f(locations[0], m[ 0], m[ 1], m[ 2], m[ 3]);
    gl.uniform4f(locations[1], m[ 4], m[ 5], m[ 6], m[ 7]);
    gl.uniform4f(locations[2], m[ 8], m[ 9], m[10], m[11]);
    gl.uniform4f(locations[3], m[12], m[13], m[14], m[15]);
};
webgl.uniform4fv = function(gl, locations, a)
{
    var n = Math.min(locations.length, a.length);
    for (var i = 0; i < n; ++i) {
        gl.uniform4fv(locations[i], a[i]);
    }
};
  </script>
  <!-- <script src="shader.js"></script> -->
  <script>
'use strict';
var Shader = CreateInstance();
Shader.create = function(id, attribs, varyings,
                         vsh_uniforms, fsh_uniforms, vsh_src, fsh_src)
{
    var gl = g_canvas.getContext();
    function expand_args(args, decl) {
        var src = '';
        for (var i = 0; i < args.length; ++i) {
            var v = args[i];
            if (v) {
                var type = v[0], name = v[1];
                src += decl + ' ' + type + ' ' + name + ';\n';
            }
        }
        return src;
    }
    var attrib_src = expand_args(attribs, 'attribute');
    var varying_src = expand_args(varyings, 'varying');
    function expand_uniforms(args) {
        var src = '';
        for (var i = 0; i < args.length; ++i) {
            var v = args[i];
            if (v) {
                var type = v[0], name = v[1], alen = v[2];
                src += 'uniform ' + type + ' ' + name;
                if (alen > 1) { src += '[' + alen + ']'; }
                src += ';\n';
            }
        }
        return src;
    }
    var vsh_uniform_src = expand_uniforms(vsh_uniforms);
    var fsh_uniform_src = expand_uniforms(fsh_uniforms);
    vsh_src = Shader.cVertexPreHeader
        + Shader.cCommonHeader
        + Shader.cVertexHeader
        + attrib_src
        + varying_src
        + vsh_uniform_src
        + vsh_src;
    fsh_src = Shader.cFragmentPreHeader
        + Shader.cCommonHeader
        + Shader.cFragmentHeader
        + varying_src
        + fsh_uniform_src
        + fsh_src;
    var shader = webgl.createShaderProgram(gl, id, vsh_src, fsh_src);
    var locations = {}, attrib_infos = {}, stride = 0, inst_stride = 0;
    for (var i = 0; i < attribs.length; ++i) {
        var v = attribs[i];
        if (v) {
            var type = v[0], name = v[1];
            var loc = gl.getAttribLocation(shader, name);
            locations[name] = loc;
            var size = 1;
            for (var i_size = 2; i_size <= 4; ++i_size) {
                if (type.endsWith(i_size.toString())) { size = i_size; break; }
            }
            var info = { size : size, };
            if (name.startsWith('inst')) {
                info.byte_offset = 4 * inst_stride;
                inst_stride += size;
            } else {
                info.byte_offset = 4 * stride;
                stride += size;
            }
            attrib_infos[name] = info;
        }
    }
    //Log(id + ': stride = ' + stride + (inst_stride ? ', inst_stride = ' + inst_stride : ''));
    function search_uniforms(args) {
        for (var i = 0; i < args.length; ++i) {
            var v = args[i];
            if (v) {
                var name = v[1], alen = v[2];
                var loc;
                if (alen == 1) {
                    loc = gl.getUniformLocation(shader, name);
                } else {
                    loc = webgl.getUniformLocationV(gl, shader, name, alen);
                }
                locations[name] = loc;
            }
        }
    }
    search_uniforms(vsh_uniforms);
    search_uniforms(fsh_uniforms);
    return {
        mShader : shader,
        mLocations : locations,
        mAttribInfos : attrib_infos,
        mStride : stride,
        mInstStride : inst_stride,
        activateAttrib : function(gl, name)
        {
            var info = this.mAttribInfos[name];
            gl.enableVertexAttribArray(this.mLocations[name]);
            gl.vertexAttribPointer(
                this.mLocations[name],
                info.size,
                gl.FLOAT, // type
                false, // normalize
                4 * this.mStride,
                info.byte_offset
            );
        },
        activateInstAttrib : function(gl, name)
        {
            var info = this.mAttribInfos[name];
            gl.enableVertexAttribArray(this.mLocations[name]);
            gl.vertexAttribPointer(
                this.mLocations[name],
                info.size,
                gl.FLOAT, // type
                false, // normalize
                4 * this.mInstStride,
                info.byte_offset
            );
            webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mLocations[name], 1);
        },
    };
};
Shader.cCommonHeader = [
    'vec3 mulMtx34Vec3(vec4 m[3], vec3 v) {',
    '    vec3 r;',
    '    r.x = dot(m[0], vec4(v, 1));',
    '    r.y = dot(m[1], vec4(v, 1));',
    '    r.z = dot(m[2], vec4(v, 1));',
    '    return r;',
    '}',
    'vec3 rotMtx34Vec3(vec4 m[3], vec3 v) {',
    '    vec3 r;',
    '    r.x = dot(m[0].xyz, v);',
    '    r.y = dot(m[1].xyz, v);',
    '    r.z = dot(m[2].xyz, v);',
    '    return r;',
    '}',
    'vec4 mulMtx44Vec4(vec4 m[4], vec4 v) {',
    '    vec4 r;',
    '    r.x = dot(m[0], v);',
    '    r.y = dot(m[1], v);',
    '    r.z = dot(m[2], v);',
    '    r.w = dot(m[3], v);',
    '    return r;',
    '}',
    'float saturate(float x) { return clamp(x, 0.0, 1.0); }',
    'float step2(float e0, float e1, float x) { return step(e0, x) * step(x, e1); }',
    'float linearstep(float e0, float e1, float x) { return saturate((x - e0) / (e1 - e0)); }',
    'float linearstep_w(float e, float w, float x) { return saturate((x - e) / w); }',
    'float linearstep_rcp_w(float e, float rcp_w, float x)',
    '{ return saturate((x - e) * rcp_w); }',
    '',
].join('\n');
Shader.cVertexPreHeader = [
    '',
].join('\n');
Shader.cVertexHeader = [
    '',
].join('\n');
Shader.cFragmentPreHeader = [
    'precision mediump float;',
    '',
].join('\n');
Shader.cFragmentHeader = [
    'vec3 cLightDir = normalize(vec3(-1, -4, -2));',
    'float calcDiffuse(vec3 nrm) {',
    'float diffuse = saturate(dot(-cLightDir, nrm) * 0.5 + 0.5);',
    'float ambient = 0.1; return diffuse + ambient;',
    '}',
    'float IGN(vec2 p) {',
    'return fract(52.9829189 * fract(0.06711056*p.x + 0.00583715*p.y));',
    '}',
    '',
].join('\n');
  </script>
  <!-- <script src="line_drawer.js"></script> -->
  <script>
'use strict';
var LineDrawerShader = CreateInstance();
LineDrawerShader.create = function()
{ return Shader.create(
    'line_drawer',
    [
        ['vec3', 'aPos'],
        ['vec4', 'aCol'],
    ],
    [
        ['vec4', 'vColor'],
    ],
    [
        ['vec4', 'cViewProjMtx', 4],
    ],
    [],
    [
        'void main() {',
        'vec3 world_pos = aPos;',
        'gl_Position = mulMtx44Vec4(cViewProjMtx, vec4(world_pos, 1));',
        'vColor = aCol;',
        '}'
    ].join('\n'),
    [
        'void main() {',
        'gl_FragColor = vColor;',
        '}',
    ].join('\n'));
};
var LineDrawer = CreateInstance();
LineDrawer.create = function()
{
    var inst = CreateInstance();
    inst.initialize = function(gl)
    {
        this.mShaderInfo = LineDrawerShader.create();
        this.mShLoc = this.mShaderInfo.mLocations;
        this.mStride = this.mShaderInfo.mStride;
        this.mBufferCapacity = 0;
        this.mArrayCapacity = 128;
        this.mSize = 0;
        this.mVertexArray = new Float32Array(this.mArrayCapacity * this.mStride);
    };
    inst.setIgnoreDepth = function(f) { this.mIgnoreDepth = f; }
    inst.beginWrite = function()
    {
        this.mSize = 0;
    };
    inst.addSize = function(delta)
    {
        var new_size = this.mSize + delta;
        if (this.mArrayCapacity >= new_size) { return new_size; }
        while (this.mArrayCapacity < new_size) { this.mArrayCapacity *= 2; }
        var new_array = new Float32Array(this.mArrayCapacity * this.mStride);
        new_array.set(this.mVertexArray);
        this.mVertexArray = new_array;
        CapacityLog('line array capacity => ' + this.mArrayCapacity);
        return new_size;
    };
    inst.pushVertex = function(p, c)
    {
        var new_size = this.addSize(1);
        var ofs = this.mSize * this.mStride;
        this.mVertexArray.set(p, ofs    );
        this.mVertexArray.set(c, ofs + 3);
        this.mSize = new_size;
    };
    inst.pushLine = function(p0, p1, c)
    {
        var new_size = this.addSize(2);
        var ofs = this.mSize * this.mStride;
        this.mVertexArray.set(p0, ofs     );
        this.mVertexArray.set(c , ofs +  3);
        this.mVertexArray.set(p1, ofs +  7);
        this.mVertexArray.set(c , ofs + 10);
        this.mSize = new_size;
    };
    inst.pushQuad = function(mtx, c)
    {
        var poss = [
            m34.MulV3(mtx, v3.Make( 0.5, 0,  0.5)),
            m34.MulV3(mtx, v3.Make(-0.5, 0,  0.5)),
            m34.MulV3(mtx, v3.Make(-0.5, 0, -0.5)),
            m34.MulV3(mtx, v3.Make( 0.5, 0, -0.5)),
        ];
        for (var i = 0; i < 4; ++i) {
            this.pushLine(poss[i], poss[(i + 1) & 3], c);
        }
    };
    inst.pushQuadTriangle = function(mtx, c)
    {
        var poss = [
            m34.MulV3(mtx, v3.Make(-0.5, 0,  0.5)),
            m34.MulV3(mtx, v3.Make(-0.5, 0, -0.5)),
            m34.MulV3(mtx, v3.Make( 0.5, 0, -0.5)),
        ];
        for (var i = 0; i < 3; ++i) {
            this.pushLine(poss[i], poss[(i + 1) % 3], c);
        }
    };
    inst.pushAxis = function(mtx)
    {
        var c = m34.GetCol(mtx, 3);
        this.pushLine(c, m34.MulV3(mtx, v3.ex), v4.Make(1, 0, 0, 1));
        this.pushLine(c, m34.MulV3(mtx, v3.ey), v4.Make(0, 1, 0, 1));
        this.pushLine(c, m34.MulV3(mtx, v3.ez), v4.Make(0, 0, 1, 1));
    }
    inst.pushDualAxis = function(mtx)
    {
        this.pushLine(m34.MulV3(mtx, v3.Make(-1, 0, 0)),
                      m34.MulV3(mtx, v3.ex), v4.Make(1, 0, 0, 1));
        this.pushLine(m34.MulV3(mtx, v3.Make(0, -1, 0)),
                      m34.MulV3(mtx, v3.ey), v4.Make(0, 1, 0, 1));
        this.pushLine(m34.MulV3(mtx, v3.Make(0, 0, -1)),
                      m34.MulV3(mtx, v3.ez), v4.Make(0, 0, 1, 1));
    }
    inst.pushAABB = function(aabb, c, mtx)
    {
        if (!aabb3.IsValid(aabb)) { return; }
        for (var i_dim = 0; i_dim < 3; ++i_dim) {
            var u_dim = (i_dim + 1) % 3, v_dim = (i_dim + 2) % 3;
            for (var u = 0; u < 2; ++u) {
                for (var v = 0; v < 2; ++v) {
                    var p0 = v3.MakeUndef(), p1 = v3.MakeUndef();
                    p0[i_dim] = aabb[0][i_dim]; p1[i_dim] = aabb[1][i_dim];
                    p0[u_dim] = p1[u_dim] = aabb[u][u_dim];
                    p0[v_dim] = p1[v_dim] = aabb[v][v_dim];
                    if (mtx) {
                        p0 = m34.MulV3(mtx, p0);
                        p1 = m34.MulV3(mtx, p1);
                    }
                    this.pushLine(p0, p1, c);
                }
            }
        }
    };
    inst.pushSphere = function(sphere, c)
    {
        var r = sphere[3];
        cIcosahedron.forEach(function(p) {
            var q = [], m = v3.Makes(0);
            for (var i = 0; i < 3; ++i) {
                q.push(v3.normalize(v3.Mid(p[i], p[(i + 1) % 3])));
                v3.add(m, p[i]);
            }
            v3.normalize(m);
            for (var i = 0; i < 3; ++i) {
                var t = v3.add(v3.Muls(q[i], r), sphere);
                inst.pushLine(t, v3.add(v3.Muls(p[i], r), sphere), c);
                inst.pushLine(t, v3.add(v3.Muls(m, r), sphere), c);
            }
        });
    };
    inst.endWrite = function(gl)
    {
        if (this.mBufferCapacity < this.mArrayCapacity) {
            this.mBufferCapacity = this.mArrayCapacity;
            CapacityLog('line buffer capacity => ' + this.mBufferCapacity);
            this.mVertexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, this.mVertexArray, gl.DYNAMIC_DRAW);
        } else {
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        }
        gl.bufferSubData(
            gl.ARRAY_BUFFER, 0,
            new Float32Array(this.mVertexArray.buffer,
                             0, this.mSize * this.mStride));
    };
    inst.getCapacityText = function() { return '' + this.mSize + '/' + this.mArrayCapacity; };
    inst.draw = function(gl, view_ctx)
    {
        if (this.mSize <= 0) { return; }
        gl.enable(gl.CULL_FACE);
        if (this.mIgnoreDepth) { gl.disable(gl.DEPTH_TEST); }
        else { gl.enable(gl.DEPTH_TEST); }
        gl.useProgram(this.mShaderInfo.mShader);
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.mShaderInfo.activateAttrib(gl, 'aPos');
        this.mShaderInfo.activateAttrib(gl, 'aCol');
        webgl.uniform4fx4(gl, this.mShLoc.cViewProjMtx, view_ctx.view_proj_mtx);
        gl.drawArrays(
            gl.LINES,
            0, // offset
            this.mSize // count
        );
        if (this.mIgnoreDepth) { gl.enable(gl.DEPTH_TEST); }
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
    };
    return inst;
};
  </script>
  <!-- <script src="box_drawer.js"></script> -->
  <script>
'use strict';
var BoxDrawerShader = CreateInstance();
BoxDrawerShader.create = function()
{ return Shader.create(
    'box_drawer',
    [
        ['vec3', 'aPos'     ],
        ['vec3', 'aNrm'     ],
        ['vec4', 'instMtx0' ],
        ['vec4', 'instMtx1' ],
        ['vec4', 'instMtx2' ],
        ['vec4', 'instColor'],
    ],
    [
        ['vec3', 'vWorldNrm'],
        ['vec4', 'vColor'   ],
    ],
    [
        ['vec4', 'cViewProjMtx', 4],
    ],
    [],
    [
        'void main() {',
        'vec4 inst_mtx[3];',
        'inst_mtx[0] = instMtx0;',
        'inst_mtx[1] = instMtx1;',
        'inst_mtx[2] = instMtx2;',
        'vec3 world_pos = mulMtx34Vec3(inst_mtx, aPos);',
        'gl_Position = mulMtx44Vec4(cViewProjMtx, vec4(world_pos, 1));',
        'vWorldNrm = normalize(rotMtx34Vec3(inst_mtx, aNrm));',
        'vColor = instColor;',
        '}',
    ].join('\n'),
    [
        'void main() {',
        'vec3 f_world_normal = normalize(vWorldNrm);',
        'float diffuse_s = calcDiffuse(f_world_normal);',
        'gl_FragColor = vColor;',
        'gl_FragColor.rgb *= diffuse_s;',
        '}',
    ].join('\n'));
};
var BoxDrawer = CreateInstance();
BoxDrawer.create = function()
{
    var inst = CreateInstance();
    inst.initialize = function(gl)
    {
        this.mShaderInfo = BoxDrawerShader.create();
        this.mShLoc = this.mShaderInfo.mLocations;
        this.mInstStride = this.mShaderInfo.mInstStride;
        this.mVertexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.setGeometry(gl);
        this.mBufferCapacity = 0;
        this.mArrayCapacity = 128;
        this.mSize = 0;
        this.mInstVertexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
        this.mInstVertexArray = new Float32Array(this.mArrayCapacity * this.mInstStride);
        gl.bufferData(gl.ARRAY_BUFFER, this.mInstVertexArray, gl.DYNAMIC_DRAW);
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
    };
    inst.beginWrite = function()
    {
        this.mSize = 0;
    };
    inst.pushBox = function(/*m34*/m, c)
    {
        var new_size = this.mSize + 1;
        if (this.mArrayCapacity < new_size) {
            while (this.mArrayCapacity < new_size) { this.mArrayCapacity *= 2; }
            var new_array = new Float32Array(this.mArrayCapacity * this.mInstStride);
            new_array.set(this.mInstVertexArray);
            this.mInstVertexArray = new_array;
            CapacityLog('box array capacity => ' + this.mArrayCapacity);
        }
        var ofs = this.mSize * this.mInstStride;
        this.mInstVertexArray.set(m, ofs     );
        this.mInstVertexArray.set(c, ofs + 12);
        this.mSize = new_size;
    };
    inst.endWrite = function(gl)
    {
        if (this.mBufferCapacity < this.mArrayCapacity) {
            this.mBufferCapacity = this.mArrayCapacity;
            CapacityLog('box buffer capacity => ' + this.mBufferCapacity);
            this.mInstVertexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, this.mInstVertexArray, gl.DYNAMIC_DRAW);
        } else {
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
        }
        gl.bufferSubData(
            gl.ARRAY_BUFFER, 0,
            new Float32Array(this.mInstVertexArray.buffer,
                             0, this.mSize * this.mInstStride));
    };
    inst.getCapacityText = function() { return '' + this.mSize + '/' + this.mArrayCapacity; };
    inst.draw = function(gl, view_ctx)
    {
        if (this.mSize <= 0) { return; }
        gl.enable(gl.CULL_FACE);
        gl.enable(gl.DEPTH_TEST);
        gl.useProgram(this.mShaderInfo.mShader);
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.mShaderInfo.activateAttrib(gl, 'aPos');
        this.mShaderInfo.activateAttrib(gl, 'aNrm');
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
        this.mShaderInfo.activateInstAttrib(gl, 'instMtx0');
        this.mShaderInfo.activateInstAttrib(gl, 'instMtx1');
        this.mShaderInfo.activateInstAttrib(gl, 'instMtx2');
        this.mShaderInfo.activateInstAttrib(gl, 'instColor');
        webgl.uniform4fx4(gl, this.mShLoc.cViewProjMtx, view_ctx.view_proj_mtx);
        webgl.mExtInstancedArrays.drawArraysInstancedANGLE(
            gl.TRIANGLES,
            0, // offset
            36, // count
            this.mSize // instances
        );
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
        webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mShLoc.instMtx0 , 0);
        webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mShLoc.instMtx1 , 0);
        webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mShLoc.instMtx2 , 0);
        webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mShLoc.instColor, 0);
    };
    inst.setGeometry = function(gl)
    {
        var buf = [];
        function push_buf(p, n) {
            buf.push(p[0], p[1], p[2], n[0], n[1], n[2]);
        };
        for (var dim = 0; dim < 3; ++dim) {
            var dim1 = (dim + 1) % 3, dim2 = (dim + 2) % 3;
            for (var face = 0; face < 2; ++face) {
                var nrm = [0, 0, 0];
                var f_sign = face * 2 - 1;
                nrm[dim] = f_sign;
                var pos = [];
                for (var u = 0; u < 2; ++u) {
                    for (var v = 0; v < 2; ++v) {
                        var p = [0, 0, 0];
                        p[dim] = face - 0.5;
                        p[dim1] = u - 0.5;
                        p[dim2] = (v - 0.5) * f_sign;
                        pos.push(p);
                    }
                }
                push_buf(pos[0], nrm); push_buf(pos[2], nrm); push_buf(pos[1], nrm);
                push_buf(pos[1], nrm); push_buf(pos[2], nrm); push_buf(pos[3], nrm);
            }
        }
        gl.bufferData(
            gl.ARRAY_BUFFER,
            new Float32Array(buf),
            gl.STATIC_DRAW
        );
    };
    return inst;
};
  </script>
  <!-- <script src="sphere_drawer.js"></script> -->
  <script>
'use strict';
var SphereDrawerShader = CreateInstance();
SphereDrawerShader.create = function()
{ return Shader.create(
    'sphere_drawer',
    [
        ['vec3', 'aPos'     ],
        ['vec3', 'aNrm'     ],
        ['vec4', 'instPosR' ],
        ['vec4', 'instColor'],
    ],
    [
        ['vec3', 'vWorldNrm'],
        ['vec4', 'vColor'   ],
    ],
    [
        ['vec4', 'cViewProjMtx', 4],
    ],
    [],
    [
        'void main() {',
        'vec3 world_pos = aPos * instPosR.w + instPosR.xyz;',
        'gl_Position = mulMtx44Vec4(cViewProjMtx, vec4(world_pos, 1));',
        'vWorldNrm = aNrm;',
        'vColor = instColor;',
        '}',
    ].join('\n'),
    [
        'void main() {',
        'vec3 f_world_normal = normalize(vWorldNrm);',
        'float diffuse_s = calcDiffuse(f_world_normal);',
        'gl_FragColor = vColor;',
        'gl_FragColor.rgb *= diffuse_s;',
        '}',
    ].join('\n'));
};
var SphereDrawer = CreateInstance();
SphereDrawer.create = function()
{
    var inst = CreateInstance();
    inst.initialize = function(gl)
    {
        this.mShaderInfo = SphereDrawerShader.create();
        this.mShLoc = this.mShaderInfo.mLocations;
        this.mInstStride = this.mShaderInfo.mInstStride;
        this.mVertexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.setGeometry(gl);
        this.mBufferCapacity = 0;
        this.mArrayCapacity = 128;
        this.mSize = 0;
        this.mInstVertexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
        this.mInstVertexArray = new Float32Array(this.mArrayCapacity * this.mInstStride);
        gl.bufferData(gl.ARRAY_BUFFER, this.mInstVertexArray, gl.DYNAMIC_DRAW);
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
    };
    inst.beginWrite = function()
    {
        this.mSize = 0;
    };
    inst.pushSphere = function(pos, radius, c)
    {
        this.pushSphereV4(v4.FromV3(pos, radius), c);
    };
    inst.pushSphereV4 = function(sphere, c)
    {
        var new_size = this.mSize + 1;
        if (this.mArrayCapacity < new_size) {
            while (this.mArrayCapacity < new_size) { this.mArrayCapacity *= 2; }
            var new_array = new Float32Array(this.mArrayCapacity * this.mInstStride);
            new_array.set(this.mInstVertexArray);
            this.mInstVertexArray = new_array;
            CapacityLog('sphere array capacity => ' + this.mArrayCapacity);
        }
        var ofs = this.mSize * this.mInstStride;
        this.mInstVertexArray.set(sphere, ofs    );
        this.mInstVertexArray.set(c     , ofs + 4);
        this.mSize = new_size;
    };
    inst.endWrite = function(gl)
    {
        if (this.mBufferCapacity < this.mArrayCapacity) {
            this.mBufferCapacity = this.mArrayCapacity;
            CapacityLog('sphere buffer capacity => ' + this.mBufferCapacity);
            this.mInstVertexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, this.mInstVertexArray, gl.DYNAMIC_DRAW);
        } else {
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
        }
        gl.bufferSubData(
            gl.ARRAY_BUFFER, 0,
            new Float32Array(this.mInstVertexArray.buffer,
                             0, this.mSize * this.mInstStride));
    };
    inst.getCapacityText = function() { return '' + this.mSize + '/' + this.mArrayCapacity; };
    inst.draw = function(gl, view_ctx)
    {
        if (this.mSize <= 0) { return; }
        gl.enable(gl.CULL_FACE);
        gl.enable(gl.DEPTH_TEST);
        gl.useProgram(this.mShaderInfo.mShader);
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.mShaderInfo.activateAttrib(gl, 'aPos');
        this.mShaderInfo.activateAttrib(gl, 'aNrm');
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
        this.mShaderInfo.activateInstAttrib(gl, 'instPosR');
        this.mShaderInfo.activateInstAttrib(gl, 'instColor');
        webgl.uniform4fx4(gl, this.mShLoc.cViewProjMtx, view_ctx.view_proj_mtx);
        webgl.mExtInstancedArrays.drawArraysInstancedANGLE(
            gl.TRIANGLES,
            0, // offset
            60, // count
            this.mSize // instances
        );
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
        webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mShLoc.instPosR , 0);
        webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mShLoc.instColor, 0);
    };
    inst.setGeometry = function(gl)
    {
        var buf = [];
        function push_buf(p, n) {
            buf.push(p[0], p[1], p[2], n[0], n[1], n[2]);
        };
        cIcosahedron.forEach(function(p) {
            for (var i = 0; i < 3; ++i) {
                push_buf(v3.Muls(p[i], 0.5), p[i]);
            }
        });
        gl.bufferData(
            gl.ARRAY_BUFFER,
            new Float32Array(buf),
            gl.STATIC_DRAW
        );
    };
    return inst;
};
  </script>
  <!-- <script src="smoke_drawer.js"></script> -->
  <script>
'use strict';
var SmokeDrawerShader = CreateInstance();
SmokeDrawerShader.create = function()
{ return Shader.create(
    'smoke_drawer',
    [
        ['vec3', 'aPos'     ],
        ['vec3', 'aNrm'     ],
        ['vec4', 'instPosR' ],
        ['vec4', 'instColor'],
    ],
    [
        ['vec3', 'vWorldNrm'],
        ['vec4', 'vColor'   ],
        ['vec2', 'vNoiseOfs'],
    ],
    [
        ['vec4', 'cViewProjMtx', 4],
    ],
    [],
    [
        'void main() {',
        'vec3 world_pos = aPos * instPosR.w + instPosR.xyz;',
        'gl_Position = mulMtx44Vec4(cViewProjMtx, vec4(world_pos, 1));',
        'vWorldNrm = aNrm;',
        'vColor = instColor;',
        //'vNoiseOfs = floor(fract(instPosR.xz) * 100.0);',
        '}',
    ].join('\n'),
    [
        'void main() {',
        'float ix = fract(gl_FragCoord.x * 0.0078125) * 128.0;',
        'float iy = fract(gl_FragCoord.y * 0.0078125) * 128.0;',
        'if (IGN(vec2(ix, iy)) > vColor.a) { discard; }',
        'vec3 f_world_normal = normalize(vWorldNrm);',
        'float diffuse_s = calcDiffuse(f_world_normal);',
        'gl_FragColor = vec4(vColor.rgb, 1);',
        'gl_FragColor.rgb *= diffuse_s;',
        '}',
    ].join('\n'));
};
var SmokeDrawer = CreateInstance();
SmokeDrawer.create = function()
{
    var inst = CreateInstance();
    inst.initialize = function(gl)
    {
        this.mShaderInfo = SmokeDrawerShader.create();
        this.mShLoc = this.mShaderInfo.mLocations;
        this.mInstStride = this.mShaderInfo.mInstStride;
        this.mVertexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.setGeometry(gl);
        this.mBufferCapacity = 0;
        this.mArrayCapacity = 128;
        this.mSize = 0;
        this.mInstVertexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
        this.mInstVertexArray = new Float32Array(this.mArrayCapacity * this.mInstStride);
        gl.bufferData(gl.ARRAY_BUFFER, this.mInstVertexArray, gl.DYNAMIC_DRAW);
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
        this.mPtclArray = [];
    };
    inst.beginWrite = function()
    {
        this.mSize = 0;
        var new_ptcl_array = [];
        this.mPtclArray.forEach(function(ptcl) {
            var smoke = ptcl.smoke;
            if (!this.mIsPause) {
                v3.add(ptcl.pos, v3.add(v3.MakeRandomRange(
                    -smoke.turbulence, smoke.turbulence), ptcl.vel));
                v3.muls(ptcl.vel, smoke.damp);
                ptcl.alpha = ptcl.life / ptcl.init_life;
                ptcl.scale = lerp(smoke.scale_fin, smoke.scale, ptcl.alpha);
                --ptcl.life;
            }
            this.pushSmokeV4(v4.FromV3(ptcl.pos, ptcl.scale),
                             v4.Lerp(smoke.color_fin, smoke.color, ptcl.alpha));
            if (ptcl.life > 0) { new_ptcl_array.push(ptcl); }
        }, this);
        this.mPtclArray = new_ptcl_array;
    };
    inst.pushSmoke = function(pos, dir, smoke)
    {
        if (this.mIsPause || this.mIsFade) { return; }
        var init_life = Math.round(smoke.life * 60);
        this.mPtclArray.push({
            pos : v3.Dup(pos),
            vel : dir,
            scale : smoke.scale,
            init_life : init_life,
            life : init_life,
            alpha : 1,
            smoke : smoke,
        });
        this.pushSmokeV4(v4.FromV3(pos, smoke.scale), smoke.color);
    };
    inst.pushSmokeV4 = function(smoke, c)
    {
        var new_size = this.mSize + 1;
        if (this.mArrayCapacity < new_size) {
            while (this.mArrayCapacity < new_size) { this.mArrayCapacity *= 2; }
            var new_array = new Float32Array(this.mArrayCapacity * this.mInstStride);
            new_array.set(this.mInstVertexArray);
            this.mInstVertexArray = new_array;
            CapacityLog('smoke array capacity => ' + this.mArrayCapacity);
        }
        var ofs = this.mSize * this.mInstStride;
        this.mInstVertexArray.set(smoke, ofs    );
        this.mInstVertexArray.set(c    , ofs + 4);
        this.mSize = new_size;
    };
    inst.endWrite = function(gl)
    {
        if (this.mBufferCapacity < this.mArrayCapacity) {
            this.mBufferCapacity = this.mArrayCapacity;
            CapacityLog('smoke buffer capacity => ' + this.mBufferCapacity);
            this.mInstVertexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, this.mInstVertexArray, gl.DYNAMIC_DRAW);
        } else {
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
        }
        gl.bufferSubData(
            gl.ARRAY_BUFFER, 0,
            new Float32Array(this.mInstVertexArray.buffer,
                             0, this.mSize * this.mInstStride));
    };
    inst.getCapacityText = function() { return '' + this.mSize + '/' + this.mArrayCapacity; };
    inst.draw = function(gl, view_ctx)
    {
        if (this.mSize <= 0) { return; }
        gl.enable(gl.CULL_FACE);
        gl.enable(gl.DEPTH_TEST);
        gl.useProgram(this.mShaderInfo.mShader);
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.mShaderInfo.activateAttrib(gl, 'aPos');
        this.mShaderInfo.activateAttrib(gl, 'aNrm');
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
        this.mShaderInfo.activateInstAttrib(gl, 'instPosR');
        this.mShaderInfo.activateInstAttrib(gl, 'instColor');
        webgl.uniform4fx4(gl, this.mShLoc.cViewProjMtx, view_ctx.view_proj_mtx);
        webgl.mExtInstancedArrays.drawArraysInstancedANGLE(
            gl.TRIANGLES,
            0, // offset
            60, // count
            this.mSize // instances
        );
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
        webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mShLoc.instPosR , 0);
        webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mShLoc.instColor, 0);
    };
    inst.setGeometry = function(gl)
    {
        var buf = [];
        function push_buf(p, n) {
            buf.push(p[0], p[1], p[2], n[0], n[1], n[2]);
        };
        cIcosahedron.forEach(function(p) {
            for (var i = 0; i < 3; ++i) {
                push_buf(v3.Muls(p[i], 0.5), p[i]);
            }
        });
        gl.bufferData(
            gl.ARRAY_BUFFER,
            new Float32Array(buf),
            gl.STATIC_DRAW
        );
    };
    return inst;
};
var ModelSmoke = CreateInstance();
ModelSmoke.createSmokesMgr = function(parent, parent_mgr, is_mount)
{
    parent.mSmokeMgr = UI_Struct.createMgr({ clip_name : 'smoke', disable_undo : true, });
    if (is_mount) {
        parent.mSmokeMgr.pushStruct({
            key : 'mount_id', def_value : '', labeled : true,
            title : LangJoin([cLang.train_fixed_to, ' ', cLang.cmn_id]),
            mgr : UI_Text.createMgr({
                parent_mgr : parent.mSmokeMgr, fixed : true, size : 8, type : 'id', }), });
    }
    parent.mSmokeMgr.pushStruct({
        key : 'life', title : cLang.smoke_life, title_sub : ' [s]', def_value : 1,
        mgr : UI_Slider.createMgr({
            parent_mgr : parent.mSmokeMgr, fixed : true,
            min : 0, max : 10, slide_round : 0.1, }), });
    parent.mSmokeMgr.pushStruct({
        key : 'scale', title : cLang.cmn_scale, def_value : 1,
        mgr : UI_Slider.createMgr({
            parent_mgr : parent.mSmokeMgr, fixed : true,
            min : 0, max : 10, slide_round : 0.1, }), });
    parent.mSmokeMgr.pushStruct({
        key : 'scale_fin', title : cLang.smoke_scale_fin, def_value : 2,
        mgr : UI_Slider.createMgr({
            parent_mgr : parent.mSmokeMgr, fixed : true,
            min : 0, max : 10, slide_round : 0.1, }), });
    parent.mSmokeMgr.pushStruct({
        key : 'damp', title : cLang.smoke_speed_damp, def_value : 0.9,
        mgr : UI_Slider.createMgr({
            parent_mgr : parent.mSmokeMgr, fixed : true, fixed_range : true,
            min : 0, max : 1, slide_round : 0.01, }), });
    parent.mSmokeMgr.pushStruct({
        key : 'emit_ratio', title : cLang.smoke_emit_ratio, def_value : 0.5,
        mgr : UI_Slider.createMgr({
            parent_mgr : parent.mSmokeMgr, fixed : true, fixed_range : true,
            min : 0, max : 1, slide_round : 0.01, }), });
    parent.mSmokeMgr.pushStruct({
        key : 'turbulence', title : cLang.smoke_turbulence, def_value : 0.1,
        mgr : UI_Slider.createMgr({
            parent_mgr : parent.mSmokeMgr, fixed : true, fixed_range : true,
            min : 0, max : 1, slide_round : 0.01, }), });
    parent.mSmokeMgr.pushStruct({
        key : 'direction', title : cLang.cmn_direction, def_value : v3.Make(0, 1, 0),
        mgr : UI_Vector.createMgr({
            parent_mgr : parent.mSmokeMgr, fixed : true,
            dim : 3, min : -1, max : 1, size : 4, slide_round : 0.01, }), });
    parent.mSmokeMgr.pushStruct({
        key : 'trans', title : cLang.cmn_trans, def_value : v3.Makes(0),
        mgr : UI_Vector.createMgr({
            parent_mgr : parent.mSmokeMgr, fixed : true, dim : 3, min : -50, max : 50, }), });
    parent.mSmokeMgr.pushStruct({
        key : 'color', title : cLang.cmn_color, def_value : v4.Makes(1), labeled : 'value',
        mgr : UI_Color.createMgr({
            parent_mgr : parent.mSmokeMgr, fixed : true, is_rgba : true, }), });
    parent.mSmokeMgr.pushStruct({
        key : 'color_fin', title : cLang.cmn_color, def_value : v4.Make(1, 1, 1, 0),
        mgr : UI_Color.createMgr({
            parent_mgr : parent.mSmokeMgr, fixed : true, is_rgba : true, }), });
    parent.mSmokeMgr.pushStruct({
        key : 'condition', title : cLang.cmn_condition, def_value : null,
        mgr : ModelSwitch.createConditionMgr(parent.mSmokeMgr), });
    parent.mSmokeMgr.initializeStruct();
    parent.mSmokesMgr = UI_Array.createMgr({
        parent_mgr : parent_mgr, fixed : true,
        element_mgr : parent.mSmokeMgr, init_element_value : null, });
    return parent.mSmokesMgr;
};
ModelSmoke.applySmokeSwitches = function(mdl, values, is_preview)
{
    var ret = [];
    mdl.smokes.forEach(function(smoke) {
        ret.push(EditModel.applySwitchCondition(mdl, values, is_preview, smoke.condition));
    });
    return ret;
};
  </script>
  <!-- <script src="field_drawer.js"></script> -->
  <script>
'use strict';
var FieldTypeInfo = {
    grass  : { color : v4.Make(0.2, 0.4, 0.0, 1), },
    desert : { color : v4.Make(0.9, 0.8, 0.3, 1), },
    rock   : { color : v4.Make(0.6, 0.6, 0.6, 1), },
    snow   : { color : v4.Make(0.9, 1.0, 1.0, 1), },
    water  : { color : v4.Make(0.1, 0.2, 0.8, 1), },
};
// Workaround for failing line drawing in some renderer when crossing near clipping plane.
var GridDrawerShader = CreateInstance();
GridDrawerShader.cRepeatInterval = 160;
GridDrawerShader.create = function()
{ return Shader.create(
    'line_drawer',
    [
        ['vec3', 'aPos0'],
        ['vec3', 'aPos1'],
        ['vec4', 'aCol'],
    ],
    [
        ['vec4', 'vColor'],
    ],
    [
        ['vec4', 'cViewProjMtx', 4],
        ['vec4', 'cCenter', 1],
    ],
    [],
    [
        'void main() {',
        'float cNear = 1.0;',
        'vec3 world_pos0 = aPos0 * cCenter.w + cCenter.xyz;',
        'vec3 world_pos1 = aPos1 * cCenter.w + cCenter.xyz;',
        'vec4 screen_pos0 = mulMtx44Vec4(cViewProjMtx, vec4(world_pos0, 1));',
        'vec4 screen_pos1 = mulMtx44Vec4(cViewProjMtx, vec4(world_pos1, 1));',
        'if (screen_pos0.w < cNear && screen_pos1.w > cNear) {',
        '    float r = (cNear - screen_pos0.w) / (screen_pos1.w - screen_pos0.w);',
        '    gl_Position = mix(screen_pos0, screen_pos1, r);',
        '} else {',
        '    gl_Position = screen_pos0;',
        '}',
        'vColor = aCol;',
        '}'
    ].join('\n'),
    [
        'void main() {',
        'gl_FragColor = vColor;',
        '}',
    ].join('\n'));
};
var GridDrawer = CreateInstance();
GridDrawer.create = function(snap_unit)
{
    var inst = CreateInstance();
    inst.mSnapUnit = snap_unit;
    inst.mDrawScale = 1;
    inst.mCenterPosY = 0;
    inst.initialize = function(gl)
    {
        this.mShaderInfo = GridDrawerShader.create();
        this.mShLoc = this.mShaderInfo.mLocations;
        this.mStride = this.mShaderInfo.mStride;
        this.mBufferCapacity = 0;
        this.mArrayCapacity = 128;
        this.mSize = 0;
        this.mVertexArray = new Float32Array(this.mArrayCapacity * this.mStride);
    };
    inst.beginWrite = function()
    {
        this.mSize = 0;
    };
    inst.pushLine = function(p0, p1, c)
    {
        var new_size = this.mSize + 2;
        if (this.mArrayCapacity < new_size) {
            while (this.mArrayCapacity < new_size) { this.mArrayCapacity *= 2; }
            var new_array = new Float32Array(this.mArrayCapacity * this.mStride);
            new_array.set(this.mVertexArray);
            this.mVertexArray = new_array;
            CapacityLog('grid array capacity => ' + this.mArrayCapacity);
        }
        var ofs = this.mSize * this.mStride;
        this.mVertexArray.set(p0, ofs     );
        this.mVertexArray.set(p1, ofs +  3);
        this.mVertexArray.set(c , ofs +  6);
        this.mVertexArray.set(p1, ofs + 10);
        this.mVertexArray.set(p0, ofs + 13);
        this.mVertexArray.set(c , ofs + 16);
        this.mSize = new_size;
    };
    inst.endWrite = function(gl)
    {
        if (this.mBufferCapacity < this.mArrayCapacity) {
            this.mBufferCapacity = this.mArrayCapacity;
            CapacityLog('grid buffer capacity => ' + this.mBufferCapacity);
            this.mVertexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, this.mVertexArray, gl.DYNAMIC_DRAW);
        } else {
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        }
        gl.bufferSubData(
            gl.ARRAY_BUFFER, 0,
            new Float32Array(this.mVertexArray.buffer,
                             0, this.mSize * this.mStride));
    };
    inst.getCapacityText = function() { return '' + this.mSize + '/' + this.mArrayCapacity; };
    inst.draw = function(gl, view_ctx)
    {
        if (this.mSize <= 0) { return; }
        gl.enable(gl.CULL_FACE);
        gl.enable(gl.DEPTH_TEST);
        gl.enable(gl.BLEND);
        gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);
        gl.useProgram(this.mShaderInfo.mShader);
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.mShaderInfo.activateAttrib(gl, 'aPos0');
        this.mShaderInfo.activateAttrib(gl, 'aPos1');
        this.mShaderInfo.activateAttrib(gl, 'aCol');
        webgl.uniform4fx4(gl, this.mShLoc.cViewProjMtx, view_ctx.view_proj_mtx);
        gl.uniform4f(
            this.mShLoc.cCenter,
            Math.round(view_ctx.camera_at[0] / this.mSnapUnit) * this.mSnapUnit,
            this.mCenterPosY,
            Math.round(view_ctx.camera_at[2] / this.mSnapUnit) * this.mSnapUnit,
            this.mDrawScale);
        gl.drawArrays(
            gl.LINES,
            0, // offset
            this.mSize // count
        );
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
        gl.disable(gl.BLEND);
    };
    return inst;
};
var FieldDrawerShader = CreateInstance();
FieldDrawerShader.create = function(field_unit)
{ return Shader.create(
    'field_drawer',
    [
        ['vec3', 'aPos'     ],
        ['vec3', 'aNrm'     ],
        ['vec4', 'instPos'  ],
        ['vec4', 'instParam'],
        ['vec4', 'instColor'],
    ],
    [
        ['vec3', 'vWorldNrm'   ],
        ['vec2', 'vNoiseVal'   ],
        ['vec3', 'vColor'      ],
        ['vec4', 'vSelectColor'],
    ],
    [
        ['vec4', 'cViewProjMtx', 4],
        ['vec4', 'cDrawParam0' , 1],
        ['vec2', 'cNoiseCenter', 1],
    ],
    [],
    [
        'void main() {',
        'float cFieldUnit = '+field_unit.toFixed(1)+';',
        'vec2 rx = instParam.xy, rz = vec2(-rx.y, rx.x);',
        'vec3 world_pos = vec3(dot(rx, aPos.xz), 0, dot(rz, aPos.xz));',
        'vec2 slope = instParam.zw;',
        'float sy = dot(world_pos.xz, slope);',
        'world_pos = world_pos * cFieldUnit + instPos.xyz;',
        'vNoiseVal = world_pos.xz - cNoiseCenter;',
        'world_pos.y += sy;',
        'world_pos.y = mix(world_pos.y, instColor.w, aPos.y);',
        'gl_Position = mulMtx44Vec4(cViewProjMtx, vec4(world_pos, 1));',
        'vWorldNrm = mix(vec3(dot(rx, aNrm.xz), 0, dot(rz, aNrm.xz)),',
        '  vec3(-slope.x, cFieldUnit, -slope.y), aNrm.y);',
        'float highlight = instPos.w == cDrawParam0.x ? 1.0 : 0.0;',
        'float selected  = instPos.w == cDrawParam0.y ? 1.0 : 0.0;',
        'vSelectColor = vec4(highlight, selected, 0, min(1.0, highlight + selected));',
        'vColor = instColor.rgb;',
        '}',
    ].join('\n'),
    [
        'void main() {',
        'vec3 f_world_normal = normalize(vWorldNrm);',
        'float diffuse_s = calcDiffuse(f_world_normal);',
        'float noise = IGN(floor(vNoiseVal));',
        'diffuse_s *= mix(0.9, 1.0, noise);',
        'gl_FragColor = vec4(vColor, 1);',
        'gl_FragColor.rgb *= diffuse_s;',
        'gl_FragColor.rgb = mix(gl_FragColor.rgb, vSelectColor.rgb, vSelectColor.a);',
        '}',
    ].join('\n'));
};
var FieldDrawer = CreateInstance();
FieldDrawer.cRotVec = [[1, 0], [0, 1], [-1, 0], [0, -1], [1, 0]],
FieldDrawer.calcOffset = function(r, s)
{
    var asx = Math.abs(s[0]), asy = Math.abs(s[1]);
    if (r == 0 && s[0] <= 0 && s[1] <= 0 ||
        r == 1 && s[0] <= 0 && s[1] >= 0 ||
        r == 2 && s[0] >= 0 && s[1] >= 0 ||
        r == 3 && s[0] >= 0 && s[1] <= 0) {
        return (Math.max(asx, asy) - Math.min(asx, asy)) * 0.5;
    }
    return (asx + asy) * 0.5;
};
FieldDrawer.create = function(field_unit)
{
    var inst = CreateInstance();
    inst.mFieldUnit = field_unit;
    inst.initialize = function(gl)
    {
        this.mShaderInfo = FieldDrawerShader.create(this.mFieldUnit);
        this.mShLoc = this.mShaderInfo.mLocations;
        this.mInstStride = this.mShaderInfo.mInstStride;
        this.mVertexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.setGeometry(gl);
        this.mBufferCapacity = 0;
        this.mArrayCapacity = 128;
        this.mSize = 0;
        this.mInstVertexArray = new Float32Array(this.mArrayCapacity * this.mInstStride);
        this.mFieldCounterF32 = v1.Make(cMinValueF32);
        this.mHighlightCounterF32 = v4.Makes(0);
    };
    inst.beginWrite = function()
    {
        this.mSize = 0;
        this.mFieldCounterF32[0] = cMinValueF32;
    };
    inst.pushField = function(field, alt_rot, min_y)
    {
        var finfo = FieldTypeInfo[field.type];
        var p = v3.Make((field.x + 0.5) * this.mFieldUnit, field.y,
                        (field.z + 0.5) * this.mFieldUnit);
        var r = FieldDrawer.cRotVec[alt_rot ? alt_rot : field.r];
        var s = field.s, c = finfo.color;
        p[1] += FieldDrawer.calcOffset(field.r, s);
        var new_size = this.mSize + 1;
        if (this.mArrayCapacity < new_size) {
            while (this.mArrayCapacity < new_size) { this.mArrayCapacity *= 2; }
            var new_array = new Float32Array(this.mArrayCapacity * this.mInstStride);
            new_array.set(this.mInstVertexArray);
            this.mInstVertexArray = new_array;
            CapacityLog('field array capacity => ' + this.mArrayCapacity);
        }
        var ofs = this.mSize * this.mInstStride;
        var fc = this.mFieldCounterF32;
        var y = v1.Make(min_y);
        this.mInstVertexArray.set(p , ofs     );
        this.mInstVertexArray.set(fc, ofs +  3);
        this.mInstVertexArray.set(r , ofs +  4);
        this.mInstVertexArray.set(s , ofs +  6);
        this.mInstVertexArray.set(c , ofs +  8);
        this.mInstVertexArray.set(y , ofs + 11);
        this.mSize = new_size;
        field.mFieldCounter = fc[0];
        if (!alt_rot) { this.mFieldCounterF32[0] *= cMinStepF32; }
    };
    inst.setHighlight = function(hl) { this.mHighlightCounterF32[0] = hl; };
    inst.setSelected  = function(hl) { this.mHighlightCounterF32[1] = hl; };
    inst.endWrite = function(gl)
    {
        if (this.mBufferCapacity < this.mArrayCapacity) {
            this.mBufferCapacity = this.mArrayCapacity;
            CapacityLog('field buffer capacity => ' + this.mBufferCapacity);
            this.mInstVertexBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, this.mInstVertexArray, gl.DYNAMIC_DRAW);
        } else {
            gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
        }
        gl.bufferSubData(
            gl.ARRAY_BUFFER, 0,
            new Float32Array(this.mInstVertexArray.buffer,
                             0, this.mSize * this.mInstStride));
    };
    inst.getCapacityText = function() { return '' + this.mSize + '/' + this.mArrayCapacity; };
    inst.draw = function(gl, view_ctx)
    {
        if (this.mSize <= 0) { return; }
        gl.enable(gl.CULL_FACE);
        gl.enable(gl.DEPTH_TEST);
        gl.useProgram(this.mShaderInfo.mShader);
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.mShaderInfo.activateAttrib(gl, 'aPos');
        this.mShaderInfo.activateAttrib(gl, 'aNrm');
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mInstVertexBuffer);
        this.mShaderInfo.activateInstAttrib(gl, 'instPos');
        this.mShaderInfo.activateInstAttrib(gl, 'instParam');
        this.mShaderInfo.activateInstAttrib(gl, 'instColor');
        webgl.uniform4fx4(gl, this.mShLoc.cViewProjMtx, view_ctx.view_proj_mtx);
        gl.uniform4fv(this.mShLoc.cDrawParam0, this.mHighlightCounterF32);
        gl.uniform2f(this.mShLoc.cNoiseCenter,
                     Math.floor(view_ctx.camera_at[0] / GridDrawerShader.cRepeatInterval)
                     * GridDrawerShader.cRepeatInterval,
                     Math.floor(view_ctx.camera_at[2] / GridDrawerShader.cRepeatInterval)
                     * GridDrawerShader.cRepeatInterval);
        webgl.mExtInstancedArrays.drawArraysInstancedANGLE(
            gl.TRIANGLES,
            0, // offset
            21, // count
            this.mSize // instances
        );
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
        webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mShLoc.instPos  , 0);
        webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mShLoc.instParam, 0);
        webgl.mExtInstancedArrays.vertexAttribDivisorANGLE(this.mShLoc.instColor, 0);
        v4.set(this.mHighlightCounterF32, 0, 0, 0, 0);
    };
    inst.setGeometry = function(gl)
    {
        var buf = [];
        function push_buf(p, n) {
            buf.push(p[0], p[1], p[2], n[0], n[1], n[2]);
        };
        var pos = [v3.Make(-0.5, 0, 0.5), v3.Make(0.5, 0, -0.5), v3.Make(-0.5, 0, -0.5),
                   v3.Make(-0.5, 1, 0.5), v3.Make(0.5, 1, -0.5), v3.Make(-0.5, 1, -0.5)];
        var nrm = [v3.Make(0, 1, 0), v3.Make(1, 0, 1), v3.Make(0, 0, -1), v3.Make(-1, 0, 0)];
        push_buf(pos[0], nrm[0]); push_buf(pos[1], nrm[0]); push_buf(pos[2], nrm[0]);
        push_buf(pos[1], nrm[1]); push_buf(pos[0], nrm[1]); push_buf(pos[3], nrm[1]);
        push_buf(pos[1], nrm[1]); push_buf(pos[3], nrm[1]); push_buf(pos[4], nrm[1]);
        push_buf(pos[2], nrm[2]); push_buf(pos[1], nrm[2]); push_buf(pos[4], nrm[2]);
        push_buf(pos[2], nrm[2]); push_buf(pos[4], nrm[2]); push_buf(pos[5], nrm[2]);
        push_buf(pos[0], nrm[3]); push_buf(pos[2], nrm[3]); push_buf(pos[5], nrm[3]);
        push_buf(pos[0], nrm[3]); push_buf(pos[5], nrm[3]); push_buf(pos[3], nrm[3]);
        gl.bufferData(
            gl.ARRAY_BUFFER,
            new Float32Array(buf),
            gl.STATIC_DRAW
        );
    };
    return inst;
};
  </script>
  <!-- <script src="model_drawer.js"></script> -->
  <script>
'use strict';
var ModelDrawerShader = CreateInstance();
ModelDrawerShader.cBoundStepLt = function(a, v, w) {
    if (w == 0) {
        return 'step(' + a + ', float(' + v + '))';
    } else {
        return 'linearstep_rcp_w(' + a + ', float(' + ( 1 / w ) + '), float(' + v + '))';
    }
};
ModelDrawerShader.cBoundStepGt = function(a, v, w) {
    if (w == 0) {
        return 'step(float(' + v + '), ' + a + ')';
    } else {
        return 'linearstep_rcp_w(' + a + ', float(' + ( -1 / w ) + '), float(' + v + '))';
    }
};
ModelDrawerShader.cBoundStepFns = {
    lt : ModelDrawerShader.cBoundStepLt,
    gt : ModelDrawerShader.cBoundStepGt,
};
ModelDrawerShader.getInsertColor = function(mdl, cdata) {
    if (cdata.override_color_id) {
        var info = mdl.user_data.insert_colors[cdata.override_color_id];
        if (info) {
            return 'cInsertColors[' + info.index + ']';
        }
    }
    return 'vec4' + v4.ToString(cdata.default_value);
};
ModelDrawerShader.create = function(mdl)
{ return Shader.create(
    'model_drawer',
    [
        ['vec3', 'aPos'],
        ['vec3', 'aNrm'],
        ['vec3', 'aCol'],
    ],
    [
        ['vec3', 'vLocalPos'],
        ['vec3', 'vWorldNrm'],
        ['vec4', 'vColor'   ],
    ],
    [
        ['vec4', 'cViewProjMtx', 4],
        ['vec4', 'cInstMtx', 3],
    ],
    [
        mdl.user_data.insert_color_num > 0 &&
            ['vec4', 'cInsertColors', Math.max(mdl.user_data.insert_color_num, 2)],
    ],
    [
        'void main() {',
        'vLocalPos = aPos;',
        'vec3 world_pos = mulMtx34Vec3(cInstMtx, aPos);',
        'gl_Position = mulMtx44Vec4(cViewProjMtx, vec4(world_pos, 1));',
        'vWorldNrm = normalize(rotMtx34Vec3(cInstMtx, aNrm));',
        'vColor = vec4(aCol, 1);',
        '}',
    ].join('\n'),
    [
        'void main() {',
        'vec3 f_world_normal = normalize(vWorldNrm), bdif;',
        'float diffuse_s = calcDiffuse(f_world_normal);',
        'float bdot, mask, t;',
        'vec4 pcolor;',
        'gl_FragColor = vColor;',
        mdl.painters.map(function(painter) {
            var ret = ['mask = 1.0;',
                       'pcolor = '+ModelDrawerShader.getInsertColor(
                           mdl, painter.color)+';',];
            painter.bounds.forEach(function(bound) {
                var d = pitchYawRollDegV(bound.angle), t_bound = bound.bound;
                ret.push('bdif = vLocalPos - vec3'+v3.ToString(bound.pos)+';');
                ret.push('bdot = dot(bdif, vec3'+v3.ToString(d)+');');
                if (bound.shape != 'plane') {
                    if (bound.shape == 'circle') {
                        ret.push('bdot = length(bdif - bdot * vec3'+v3.ToString(d)+');');
                    } else if (bound.shape == 'sphere') {
                        ret.push('bdot = length(bdif);');
                    }
                    if (t_bound < 0) { ret.push('bdot = -bdot;'); }
                }
                ret.push('t = '+ModelDrawerShader.cBoundStepFns[bound.type.slice(-2)](
                    'bdot', t_bound, bound.width)+';');
                if (bound.type.startsWith('alt')) {
                    ret.push('pcolor = mix(pcolor, '+ModelDrawerShader.getInsertColor(
                        mdl, bound.alt_color)+', t);');
                } else {
                    ret.push('mask = mix(mask, '+(
                        bound.type.startsWith('mask') ? '0.0' : '1.0')+', t);');
                }
            });
            ret.push('gl_FragColor.rgb = mix(gl_FragColor.rgb, pcolor.rgb, pcolor.a * mask);');
            return ret;
        }).flat().join('\n'),
        'gl_FragColor.rgb *= diffuse_s;',
        '}',
    ].join('\n'));
};
var ModelDrawer = CreateInstance();
ModelDrawer.create = function()
{
    var inst = CreateInstance();
    inst.initialize = function(gl, mdl)
    {
        this.mShaderInfo = ModelDrawerShader.create(mdl);
        this.mShLoc = this.mShaderInfo.mLocations;
        this.mStride = this.mShaderInfo.mStride;
        this.mVertexBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.mVertexNum = 0;
        this.mAABB = aabb3.MakeUndef();
        this.setGeometry(gl, mdl);
        this.mInstInfo = [];
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
        this.mIsTunnel = mdl.draw_pass == 'tunnel';
    };
    inst.beginWrite = function()
    {
        this.mInstInfo = [];
    };
    inst.pushModel = function(/*m34*/m, colors)
    {
        if (0) {
            var bsp = aabb3.CalcBoundingSphere(this.mAABB, m);
            g_line_drawer.pushAABB(this.mAABB, v4.Makes(1), m);
            g_line_drawer.pushSphere(bsp, v4.Makes(1));
        }
        this.mInstInfo.push({
            cInstMtx : m34.Dup(m),
            cInsertColors : colors,
        });
    };
    inst.endWrite = function(gl)
    {
    };
    inst.draw = function(gl, view_ctx)
    {
        if (this.mInstInfo.length <= 0) { return; }
        gl.enable(gl.CULL_FACE);
        gl.enable(gl.DEPTH_TEST);
        if (this.mIsTunnel) { gl.depthFunc(gl.GREATER); }
        gl.useProgram(this.mShaderInfo.mShader);
        gl.bindBuffer(gl.ARRAY_BUFFER, this.mVertexBuffer);
        this.mShaderInfo.activateAttrib(gl, 'aPos');
        this.mShaderInfo.activateAttrib(gl, 'aNrm');
        this.mShaderInfo.activateAttrib(gl, 'aCol');
        webgl.uniform4fx4(gl, this.mShLoc.cViewProjMtx, view_ctx.view_proj_mtx);
        for (var i = 0; i < this.mInstInfo.length; ++i)
        {
            var info = this.mInstInfo[i];
            webgl.uniform4fx3(gl, this.mShLoc.cInstMtx, info.cInstMtx);
            if (this.mShLoc.cInsertColors) {
                webgl.uniform4fv(gl, this.mShLoc.cInsertColors, info.cInsertColors);
            }
            gl.drawArrays(
                gl.TRIANGLES,
                0, // offset
                this.mVertexNum // count
            );
        }
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
        if (this.mIsTunnel) { gl.depthFunc(gl.LESS); }
    };
    inst.setGeometry = function(gl, mdl)
    {
        var buf = [], base_color;
        for (var i_prim = 0; i_prim < mdl.primitives.length; ++i_prim)
        {
            var prim = mdl.primitives[i_prim];
            function push_tri(p0, p1, p2) {
                if (v3.IsEqual(p0, p1) || v3.IsEqual(p1, p2) || v3.IsEqual(p2, p0)) {
                    //Log('skip tri: ' + v3.ToFixed(p0, 3)
                    //    + ', ' + v3.ToFixed(p1, 3) + ', ' + v3.ToFixed(p2, 3));
                    return;
                }
                function push_buf(p, n) {
                    buf.push(p[0], p[1], p[2], n[0], n[1], n[2],
                             base_color[0], base_color[1], base_color[2]);
                };
                var n = v3.normalize(v3.Cross(v3.Sub(p0, p1), v3.Sub(p0, p2)));
                var tri = [p0, p1, p2];
                function push_impl(di) {
                    if (0) { // triangulation check
                        var center = calcV3Center(tri);
                        for (var i = 0; i < cVtxPerTri; ++i) {
                            push_buf(v3.Lerp(tri[(i * di) % cVtxPerTri], center, 0.05), n);
                        }
                    } else {
                        for (var i = 0; i < cVtxPerTri; ++i) {
                            push_buf(tri[(i * di) % cVtxPerTri], n);
                        }
                    }
                    inst.mVertexNum += 3;
                }
                if (prim.face == 'front' || prim.face == 'both') { push_impl(1); }
                if (prim.face == 'back'  || prim.face == 'both') { v3.neg(n); push_impl(2); }
            };
            var split = prim.split;
            base_color = prim.base_color;
            var slicers = [];
            for (var i = 0; i < prim.slicers.length; ++i) {
                var slicer = prim.slicers[i];
                var d = { dir : pitchYawRollDegV(slicer.angle),
                          ofs : slicer.offset, res : slicer,
                          is_erase : slicer.type.startsWith('erase'), }
                if (slicer.type.endsWith(d.is_erase ? 'lt' : 'gt')) {
                    v3.neg(d.dir); d.ofs = -d.ofs;
                }
                slicers.push(d);
            }
            var polys = [];
            var mtx = m34.setSRTDeg(m34.MakeZero(), prim.scale, prim.rotate, prim.trans);
            function mm(p) {
                if (prim.taper < 0) {
                    var s = lerp(1, 0.5 + p[2], -prim.taper);
                    p = v3.Make(s * p[0], s * p[1], p[2]);
                } else if (prim.taper > 0) {
                    var s = lerp(1, 0.5 - p[2], prim.taper);
                    p = v3.Make(s * p[0], s * p[1], p[2]);
                }
                return m34.MulV3(mtx, p);
            }
            if (prim.type == 'plane')
            {
                var pos = [];
                for (var u = 0; u < 2; ++u) {
                    for (var v = 0; v < 2; ++v) {
                        var p = v3.Makes(0);
                        p[0] = u - 0.5;
                        p[2] = -(v - 0.5);
                        p = mm(p);
                        pos.push(p);
                    }
                }
                polys.push([pos[0], pos[2], pos[3], pos[1]]);
            }
            else if (prim.type == 'prism')
            {
                var q = [v3.Make(0, 0.5, 0), v3.Make(-0.5, -0.5, 0), v3.Make(0.5, -0.5, 0)];
                for (var face = 0; face < 2; ++face) {
                    var pos = [];
                    for (var i = 0; i < 3; ++i ) {
                        var p = q[face ? i : 2 - i];
                        pos.push(mm(v3.AddZ(p, face - 0.5)));
                    }
                    polys.push([pos[0], pos[1], pos[2]]);
                }
                for (var i = 0; i < 3; ++i ) {
                    var pos = [];
                    for (var u = 0; u < 2; ++u) {
                        for (var v = 0; v < 2; ++v) {
                            pos.push(mm(v3.AddZ(q[(i + u) % 3], v - 0.5)));
                        }
                    }
                    polys.push([pos[0], pos[2], pos[3], pos[1]]);
                }
            }
            else if (prim.type == 'cube')
            {
                for (var dim = 0; dim < 3; ++dim) {
                    var dim_u = (dim + 1) % 3, dim_v = (dim + 2) % 3;
                    for (var face = 0; face < 2; ++face) {
                        var f_sign = face * 2 - 1;
                        var pos = [];
                        for (var u = 0; u < 2; ++u) {
                            for (var v = 0; v < 2; ++v) {
                                var p = v3.Makes(0);
                                p[dim] = face - 0.5;
                                p[dim_u] = u - 0.5;
                                p[dim_v] = (v - 0.5) * f_sign;
                                p = mm(p);
                                pos.push(p);
                            }
                        }
                        polys.push([pos[0], pos[2], pos[3], pos[1]]);
                    }
                }
            }
            else if (prim.type == 'cylinder')
            {
                var q = [];
                for (i = 0; i < split; ++i) {
                    var rad = i * cPI2 / split;
                    q.push(v3.muls(v3.Make(-Math.sin(rad), Math.cos(rad), 0), 0.5));
                }
                for (var face = 0; face < 2; ++face) {
                    var pos = [];
                    for (var i = 0; i < split; ++i ) {
                        var p = q[face ? i : split - 1 - i];
                        pos.push(mm(v3.AddZ(p, face - 0.5)));
                    }
                    polys.push(pos);
                }
                for (var i = 0; i < split; ++i ) {
                    var pos = [];
                    for (var u = 0; u < 2; ++u) {
                        for (var v = 0; v < 2; ++v) {
                            pos.push(mm(v3.AddZ(q[(i + u) % split], v - 0.5)));
                        }
                    }
                    polys.push([pos[0], pos[2], pos[3], pos[1]]);
                }
            }
            else if (prim.type == 'sphere')
            {
                cIcosahedron.forEach(function split_tri(p) {
                    function add_tri(pos) {
                        var tri = [];
                        for (var i = 0; i < 3; ++i) {
                            tri.push(mm(v3.muls(v3.Normalize(pos[i]), 0.5)));
                        }
                        polys.push(tri);
                    }
                    for (var u = 0; u < split; ++u) {
                        var a0 = u == 0 ? p[0] : v3.Lerp(p[0], p[1], u / split);
                        var a1 = u == split - 1 ? p[1] : v3.Lerp(p[0], p[1], (u + 1) / split);
                        var b0 = u == 0 ? p[0] : v3.Lerp(p[0], p[2], u / split);
                        var b1 = u == split - 1 ? p[2] : v3.Lerp(p[0], p[2], (u + 1) / split);
                        var a2 = a0, a3 = a1;
                        for (var v = 0; v < u; ++v) {
                            var a4 = v3.Lerp(a0, b0, (v + 1) / u);
                            var a5 = v3.Lerp(a1, b1, (v + 1) / (u + 1));
                            add_tri([a2, a3, a5]); add_tri([a2, a5, a4]);
                            a2 = a4; a3 = a5;
                        }
                        add_tri([a2, a3, b1]);
                    }
                });
            }
            var polys_set = [polys], erased_polys_set = [];
            for (var i_slicer = 0; i_slicer < slicers.length; ++i_slicer) {
                var d = slicers[i_slicer];
                var src_polys_set = d.is_erase ? polys_set : erased_polys_set;
                var new_polys_set = [], new_erased_polys_set = [];
                if (d.is_erase) {
                    erased_polys_set.forEach(s => new_erased_polys_set.push(s));
                } else {
                    polys_set.forEach(s => new_polys_set.push(s));
                }
                src_polys_set.forEach(function(src_polys) {
                    var new_polys = [], dump_polys = [], prof_vertices = [], is_cut = false;
                    function push_prof(pp) {
                        if (!d.res.solid) { return; }
                        for (var j = 0; j < prof_vertices.length; ++j) {
                            if (v3.IsEqual(pp, prof_vertices[j])) { return; }
                        }
                        prof_vertices.push(pp);
                    }
                    src_polys.forEach(function(poly) {
                        var vertices = [], dump_vertices = [], prof = [], p0, dot0, abs_dot0;
                        for (var i = 0; i <= poly.length; ++i) {
                            var p1 = poly[i % poly.length];
                            var dot1 = v3.Dot(v3.Sub(p1, d.res.pos), d.dir) - d.ofs;
                            var abs_dot1 = Math.abs(dot1);
                            if (i) {
                                if (dot0 <= 0) { vertices.push(p0); }
                                if (dot0 >= 0) { dump_vertices.push(p0); }
                                if (dot0 * dot1 < 0) {
                                    var p2 = v3.Lerp(p0, p1, abs_dot0 / (abs_dot0 + abs_dot1));
                                    vertices.push(p2);
                                    dump_vertices.push(p2);
                                    push_prof(p2);
                                    is_cut = true;
                                }
                                if (dot1 == 0) { prof.push(p1); }
                            }
                            p0 = p1; dot0 = dot1; abs_dot0 = abs_dot1;
                        }
                        if (vertices.length >= cVtxPerTri) {
                            new_polys.push(vertices);
                        }
                        if (prof.length < poly.length) {
                            if (dump_vertices.length >= cVtxPerTri) {
                                dump_polys.push(dump_vertices);
                            }
                            if (vertices.length > 0 && dump_vertices.length > 0
                                && vertices.length < poly.length
                                && dump_vertices.length < poly.length) {
                                is_cut = true;
                            }
                            prof.forEach(pp => push_prof(pp));
                        }
                    });
                    if (prof_vertices.length >= cVtxPerTri && is_cut) {
                        var center = calcV3Center(prof_vertices);
                        var d0 = v3.normalize(v3.Sub(prof_vertices[0], center));
                        var d1, max_cross = 0;
                        for (var j = 1; j < prof_vertices.length; ++j) {
                            var dj = v3.normalize(v3.Sub(prof_vertices[j], center));
                            var dotj = v3.Length(v3.Cross(d0, dj));
                            if (dotj >= max_cross) { d1 = dj; max_cross = dotj; }
                        }
                        var dn = v3.Cross(d0, d1);
                        if (v3.Dot(dn, d.dir) > 0) { v3.neg(dn); }
                        d1 = v3.Cross(dn, d0);
                        var order = [], angle = [];
                        for (var i = 0; i < prof_vertices.length; ++i) {
                            order.push(i);
                            var delta = v3.Sub(prof_vertices[i], center);
                            angle.push(Math.atan2(v3.Dot(d0, delta), v3.Dot(d1, delta)));
                        }
                        order.sort(function(a, b) { return angle[a] - angle[b]; });
                        new_polys.push(order.map(i => prof_vertices[i]));
                        dump_polys.push(order.map(i => prof_vertices[i]).reverse());
                    }
                    if (new_polys.length > 0) { new_polys_set.push(new_polys); }
                    if (dump_polys.length > 0 && d.res.reshapable) {
                        new_erased_polys_set.push(dump_polys);
                    }
                });
                polys_set = new_polys_set; erased_polys_set = new_erased_polys_set;
            }
            polys_set.forEach(function(t_polys) {
                t_polys.forEach(function(poly) {
                    for (var i = 2; i < poly.length; ++i) {
                        push_tri(poly[0], poly[i - 1], poly[i]);
                    }
                    if (poly.length >= cVtxPerTri) {
                        for (var i = 0; i < poly.length; ++i) {
                            aabb3.extendWith(inst.mAABB, poly[i]);
                        }
                    }
                });
            });
        }
        gl.bufferData(
            gl.ARRAY_BUFFER,
            new Float32Array(buf),
            gl.STATIC_DRAW
        );
    };
    return inst;
};
  </script>
  <!-- <script src="rail_drawer.js"></script> -->
  <script>
'use strict';
var RailDrawerType = {
    cDefault      :  0,
    cSwitch       :  1,
    cSafege       :  2,
    cSafegeSwitch :  3,
    cAlweg        :  4,
    cAlwegSwitch  :  5,
    cBallast      :  6,
    cSlab         :  7,
    cGirder       :  8,
    cTunnel       :  9,
    cPlatform     : 10,
    cWall         : 11,
    cFloor        : 12,
    cPltTnl       : 13,
};
var RailDrawerInfo = [
    { id : 'rail_drawer'         , use_uv : false, use_col : false, },
    { id : 'rail_switch_drawer'  , use_uv : false, use_col : false, },
    { id : 'safege_drawer'       , use_uv : false, use_col : false, },
    { id : 'safege_switch_drawer', use_uv : false, use_col : false, },
    { id : 'alweg_drawer'        , use_uv : false, use_col : false, },
    { id : 'alweg_switch_drawer' , use_uv : false, use_col : false, },
    { id : 'rail_ballast_drawer' , use_uv : true , use_col : false, },
    { id : 'rail_slab_drawer'    , use_uv : true , use_col : false, },
    { id : 'rail_girder_drawer'  , use_uv : false, use_col : false, },
    { id : 'rail_tunnel_drawer'  , use_uv : false, use_col : false, },
    { id : 'rail_platform_drawer', use_uv : false, use_col : true , },
    { id : 'rail_wall_drawer'    , use_uv : false, use_col : false, },
    { id : 'rail_floor_drawer'   , use_uv : false, use_col : false, },
    { id : 'rail_plt_tnl_drawer' , use_uv : false, use_col : false, },
];
function IsRailDrawerCurve(type) { return type == RailDrawerType.cAlwegSwitch; }
function IsRailDrawerSwitch(type) { return RailDrawerInfo[type].id.endsWith('_switch_drawer'); }
function IsRailDrawerUseUV(type) { return RailDrawerInfo[type].use_uv; }
function IsRailDrawerUseColor(type) { return RailDrawerInfo[type].use_col; }
var cGirderTopProfileNum = 3;
var cSafegeBottomProfileNum = 14;
var cAlwegTopProfileNum = 8;
var cAlwegNonBottomProfileNum = 13;
var cPlatformTopProfileNum = 7;
var cWallTopProfileNum = 4;
var cFloorTopProfileNum = 2;
var RailGaugeType = { cNarrow : 0, cStandard : 1, };
var RailDrawerShader = CreateInstance();
RailDrawerShader.create = function(type)
{ return Shader.create(
    RailDrawerInfo[type].id,
    [
        ['vec4', 'aPos'],
        ['vec3', 'aNrm'],
        IsRailDrawerSwitch(type) && ['vec2', 'aTongue'] ||
            IsRailDrawerUseUV(type) && ['vec2', 'aTexCoord'] ||
            IsRailDrawerUseColor(type) && ['vec3', 'aColor'],
    ],
    [
        ['vec3', 'vWorldNrm'],
        ['vec4', 'vSelectColor'],
        IsRailDrawerUseUV(type) && ['vec4', 'vTexCoord'] ||
            IsRailDrawerUseColor(type) && ['vec3', 'vColor'],
    ],
    [
        ['vec4', 'cViewProjMtx', 4],
        ['vec4', 'cDrawParam0', 1],
        ['vec2', 'cNoiseCenter', 1],
        IsRailDrawerCurve(type) && ['vec3', 'cCurveInfo0', 3] ||
            IsRailDrawerSwitch(type) && ['vec4', 'cTongueOffset0', 1],
        IsRailDrawerCurve(type) && ['vec3', 'cCurveInfo1', 3] ||
            IsRailDrawerSwitch(type) && ['vec4', 'cTongueOffset1', 1],
    ],
    [
        IsRailDrawerSwitch(type) && ['vec4', 'cTestColor', 1],
    ],
    [
        'void main() {',
        'vec3 world_pos = aPos.xyz;',
        ( IsRailDrawerCurve(type)
          ? ['float t = aPos.z;',
             'float t2 = t * t, t3 = t2 * t;',
             'float h00 =  2.0 * t3 - 3.0 * t2     + 1.0;',
             'float h10 =        t3 - 2.0 * t2 + t      ;',
             'float h01 = -2.0 * t3 + 3.0 * t2          ;',
             'float h11 =        t3 -       t2          ;',
             'vec3 pos0 = cCurveInfo0[0], pos1 = cCurveInfo1[0];',
             'vec3 m0   = cCurveInfo0[1], m1   = cCurveInfo1[1];',
             'vec3 up0  = cCurveInfo0[2], up1  = cCurveInfo1[2];',
             'vec3 out_pos = pos0 * h00 + m0 * h10 + pos1 * h01 + m1 * h11;',
             'float h20 =  6.0 * t2 - 6.0 * t      ;',
             'float h30 =  3.0 * t2 - 4.0 * t + 1.0;',
             'float h21 = -6.0 * t2 + 6.0 * t      ;',
             'float h31 =  3.0 * t2 - 2.0 * t      ;',
             'vec3 out_dir = pos0 * h20 + m0 * h30 + pos1 * h21 + m1 * h31;',
             'out_dir = normalize(out_dir);',
             'vec3 out_left = normalize(cross(mix(up0, up1, t), out_dir));',
             'vec3 out_up = normalize(cross(out_dir, out_left));',
             'world_pos = out_pos + out_left * aPos.x + out_up * aPos.y;']
          : IsRailDrawerSwitch(type)
          ? ( 'world_pos += '+
              'cTongueOffset0.xyz * (aTongue.x < 0.0 ? cTongueOffset0.w : 1.0) * aTongue.x +'+
              'cTongueOffset1.xyz * (aTongue.y < 0.0 ? cTongueOffset1.w : 1.0) * aTongue.y;')
          : ''),
        'gl_Position = mulMtx44Vec4(cViewProjMtx, vec4(world_pos, 1));',
        ( IsRailDrawerCurve(type)
          ? 'vWorldNrm = out_left * aNrm.x + out_up * aNrm.y;'
          : 'vWorldNrm = aNrm;'),
        'float highlight = aPos.w == cDrawParam0.x ? 1.0 : 0.0;',
        'float selected  = aPos.w == cDrawParam0.y ? 1.0 : 0.0;',
        'float hl_value = '+(IsRailDrawerUseUV(type) ? '0.8' : '1.0')+';',
        'vSelectColor = vec4(highlight * hl_value, selected * hl_value, 0,'+
            ' min(1.0, highlight + selected));',
        ( IsRailDrawerUseUV(type)
          ? 'vTexCoord.xy = aTexCoord; vTexCoord.zw = world_pos.xz - cNoiseCenter;' : ''),
        ( IsRailDrawerUseColor(type)
          ? 'vColor = aColor;' : ''),
        '}',
    ].flat(3).join('\n'),
    [
        'void main() {',
        'vec3 f_world_normal = normalize(vWorldNrm);',
        'float diffuse_s = calcDiffuse(f_world_normal);',
        ( IsRailDrawerUseUV(type)
          ? [ 'vec2 tie_uv = vTexCoord.xy;',
              ( type == RailDrawerType.cSlab
                ? [ 'float is_tie_sep = 1.0;',
                    'if (tie_uv.x > 5.0) { is_tie_sep = 0.0; tie_uv.x -= 10.0; }'] : []),
              'tie_uv = vec2(saturate(tie_uv.x), fract(tie_uv.y));',
              'gl_FragColor = vec4('+(type == RailDrawerType.cBallast
                                      ? '0.6, 0.4, 0.3' : '0.8, 0.8, 0.8')+', 1);',
              ( type == RailDrawerType.cBallast
                ? 'gl_FragColor.rgb *= mix(0.7, 1.0,'+
                ' IGN(floor(fract(vTexCoord.zw) * 20.0)));' : ''),
              'gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3('+(
                  type == RailDrawerType.cBallast
                      ? '0.4, 0.2, 0.0' : '0.5, 0.5, 0.5')+'),'+
              'step2(0.1, 0.9, tie_uv.x) * step2(0.3, 0.7, tie_uv.y)'+(
                  type == RailDrawerType.cBallast ? ''
                      : ' * (1.0 - is_tie_sep * step2(0.33, 0.67, tie_uv.x))')+');',]
          : IsRailDrawerUseColor(type)           ? 'gl_FragColor = vec4(vColor, 1);'
          : type <= RailDrawerType.cSwitch       ? 'gl_FragColor = vec4(1);'
          : type <= RailDrawerType.cSafegeSwitch ? 'gl_FragColor = vec4(0.9, 0.9, 0.9, 1);'
          : type == RailDrawerType.cAlweg        ? 'gl_FragColor = vec4(0.9, 0.9, 0.9, 1);'
          : type == RailDrawerType.cAlwegSwitch  ? 'gl_FragColor = vec4(0.8, 0.8, 0.8, 1);'
          : type == RailDrawerType.cGirder       ? 'gl_FragColor = vec4(0.7, 0.7, 0.7, 1);'
          : type == RailDrawerType.cTunnel       ? 'gl_FragColor = vec4(0.7, 0.7, 0.7, 1);'
          : type == RailDrawerType.cWall         ? 'gl_FragColor = vec4(0.7, 0.7, 0.7, 1);'
          : type == RailDrawerType.cFloor        ? 'gl_FragColor = vec4(0.7, 0.7, 0.7, 1);'
          : type == RailDrawerType.cPltTnl       ? 'gl_FragColor = vec4(0.7, 0.7, 0.7, 1);'
          : 'gl_FragColor = vec4(0);'),
        ( type == RailDrawerType.cSwitch ? 'gl_FragColor = cTestColor;'
          : type == RailDrawerType.cPlatform ? 'gl_FragColor.rgb = mix('+
          'gl_FragColor.rgb, vec3(0.5), step(f_world_normal.y, 0.5));' : ''),
        'gl_FragColor.rgb *= diffuse_s;',
        'gl_FragColor.rgb = mix(gl_FragColor.rgb, vSelectColor.rgb, vSelectColor.a);',
        '}',
    ].flat(3).join('\n'));
};
var RailDrawer = CreateInstance();
RailDrawer.create = function(type, x_sign)
{
    x_sign = x_sign || 1;
    var inst = CreateInstance();
    inst.mType = type;
    inst.mIsMono = RailDrawerType.cSafege <= type && type <= RailDrawerType.cAlwegSwitch;
    inst.mIsTunnel = type == RailDrawerType.cTunnel || type == RailDrawerType.cPltTnl;
    inst.initialize = function(gl)
    {
        this.mShaderInfo = RailDrawerShader.create(this.mType);
        this.mShLoc = this.mShaderInfo.mLocations;
        this.mStride = this.mShaderInfo.mStride;
        this.mBufferCapacity = 0;
        this.mArrayCapacity = 128;
        this.mSize = 0;
        this.mRailCounterF32 = v1.Make(cMinValueF32);
        this.mHighlightCounterF32 = v4.Makes(0);
        var y_ofs = this.mType <= RailDrawerType.cSwitch ? RailMetric.cBallastHeight : 0;
        function make_vtx(px, py, nx, ny, is_flat) {
            return {
                pos : v2.Make(px, py + y_ofs),
                nrm : v2.normalize(v2.Make(nx, ny)),
                is_flat : is_flat,
            };
        }
        function make_edge(px0, py0, nx0, ny0, f0, px1, py1, nx1, ny1, f1, col) {
            var v0 = make_vtx(px0 * x_sign, py0, nx0 * x_sign, ny0, f0);
            var v1 = make_vtx(px1 * x_sign, py1, nx1 * x_sign, ny1, f1);
            return {
                mVertices : (x_sign > 0 ? [v0, v1] : [v1, v0]),
                mColor : col,
            };
        }
        this.mProfiles = this.mType <= RailDrawerType.cSwitch ? [
            make_edge(
                RailMetric.cHalfOuterWidth, 0, 1, .5, false,
                RailMetric.cHalfOuterWidth, RailMetric.cHeight, 1, 0, false),
            make_edge(
                RailMetric.cHalfOuterWidth, RailMetric.cHeight, 1, 1, false,
                RailMetric.cHalfGauge, RailMetric.cHeight, -1, 1, false),
            make_edge(
                RailMetric.cHalfGauge, RailMetric.cHeight, -1, 0, false,
                RailMetric.cHalfGauge, 0, -1, .5, false),
            make_edge(
                -RailMetric.cHalfGauge, 0, 1, .5, false,
                -RailMetric.cHalfGauge, RailMetric.cHeight, 1, 0, false),
            make_edge(
                -RailMetric.cHalfGauge, RailMetric.cHeight, 1, 1, false,
                -RailMetric.cHalfOuterWidth, RailMetric.cHeight, -1, 1, false),
            make_edge(
                -RailMetric.cHalfOuterWidth, RailMetric.cHeight, -1, 0, false,
                -RailMetric.cHalfOuterWidth, 0, -1, .5, false),
        ] : this.mType == RailDrawerType.cBallast ? [
            make_edge(
                RailMetric.cHalfBallastBottomWidth, 0, 1, .5, true,
                RailMetric.cHalfBallastTopWidth, RailMetric.cBallastHeight, 0.5, 1, false),
            make_edge(
                RailMetric.cHalfBallastTopWidth, RailMetric.cBallastHeight, 0.1, 1, false,
                -RailMetric.cHalfBallastTopWidth, RailMetric.cBallastHeight, -0.1, 1, false),
            make_edge(
                -RailMetric.cHalfBallastTopWidth, RailMetric.cBallastHeight, -0.5, 1, false,
                -RailMetric.cHalfBallastBottomWidth, 0, -1, .5, true),
        ] : this.mType == RailDrawerType.cSlab ? [
            make_edge(
                RailMetric.cHalfSlabWidth, 0, 1, 0, true,
                RailMetric.cHalfSlabWidth, RailMetric.cBallastHeight, 1, 0, false),
            make_edge(
                RailMetric.cHalfSlabWidth, RailMetric.cBallastHeight, 0, 1, false,
                -RailMetric.cHalfSlabWidth, RailMetric.cBallastHeight, 0, 1, false),
            make_edge(
                -RailMetric.cHalfSlabWidth, RailMetric.cBallastHeight, -1, 0, false,
                -RailMetric.cHalfSlabWidth, 0, -1, 0, true),
        ] : this.mType <= RailDrawerType.cSafegeSwitch ? [
            make_edge(
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeMiddleHeight, -1, 0, false,
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeFloorHeight, -1, 0, false),
            make_edge(
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeFloorHeight, 0, 1, false,
                RailMetric.cHalfSafegeOpenTopWidth, RailMetric.cSafegeFloorHeight, 0, 1, false),
            make_edge(
                RailMetric.cHalfSafegeOpenTopWidth,
                RailMetric.cSafegeFloorHeight, -1, -0.5, false,
                RailMetric.cHalfSafegeOpenBottomWidth,
                RailMetric.cSafegeBottomHeight, -1, -0.5, false),
            make_edge(
                RailMetric.cHalfSafegeOpenBottomWidth,
                RailMetric.cSafegeBottomHeight, 0, -1, false,
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeBottomHeight, 0, -1, false),
            make_edge(
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeBottomHeight, 1, -1, false,
                RailMetric.cHalfSafegeWidth, RailMetric.cSafegeFloorHeight, 1, -1, false),
            make_edge(
                RailMetric.cHalfSafegeWidth, RailMetric.cSafegeFloorHeight, 1, 0, false,
                RailMetric.cHalfSafegeWidth, RailMetric.cSafegeMiddleHeight, 1, 0, false),
            make_edge(
                RailMetric.cHalfSafegeWidth, RailMetric.cSafegeMiddleHeight, 0, 1, false,
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeMiddleHeight, 0, 1, false),
            make_edge(
                -RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeMiddleHeight, 0, 1, false,
                -RailMetric.cHalfSafegeWidth, RailMetric.cSafegeMiddleHeight, 0, 1, false),
            make_edge(
                -RailMetric.cHalfSafegeWidth, RailMetric.cSafegeMiddleHeight, -1, 0, false,
                -RailMetric.cHalfSafegeWidth, RailMetric.cSafegeFloorHeight, -1, 0, false),
            make_edge(
                -RailMetric.cHalfSafegeWidth, RailMetric.cSafegeFloorHeight, -1, -1, false,
                -RailMetric.cHalfSafegeInnerWidth,
                RailMetric.cSafegeBottomHeight, -1, -1, false),
            make_edge(
                -RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeBottomHeight, 0, -1, false,
                -RailMetric.cHalfSafegeOpenBottomWidth,
                RailMetric.cSafegeBottomHeight, 0, -1, false),
            make_edge(
                -RailMetric.cHalfSafegeOpenBottomWidth,
                RailMetric.cSafegeBottomHeight, 1, -0.5, false,
                -RailMetric.cHalfSafegeOpenTopWidth,
                RailMetric.cSafegeFloorHeight, 1, -0.5, false),
            make_edge(
                -RailMetric.cHalfSafegeOpenTopWidth, RailMetric.cSafegeFloorHeight, 0, 1, false,
                -RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeFloorHeight, 0, 1, false),
            make_edge(
                -RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeFloorHeight, 1, 0, false,
                -RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeMiddleHeight, 1, 0, false),
            // upper wall
            make_edge(
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeCeilHeight, -1, 0, false,
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeMiddleHeight, -1, 0, false),
            make_edge(
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeMiddleHeight, 0, -1, false,
                RailMetric.cHalfSafegeBorderWidth, RailMetric.cSafegeMiddleHeight, 0, -1, false),
            make_edge(
                RailMetric.cHalfSafegeBorderWidth, RailMetric.cSafegeMiddleHeight, 1, 0, false,
                RailMetric.cHalfSafegeBorderWidth, RailMetric.cSafegeBorderHeight, 1, 0, false),
            make_edge(
                RailMetric.cHalfSafegeBorderWidth, RailMetric.cSafegeBorderHeight, 0, -1, false,
                RailMetric.cHalfSafegeWidth, RailMetric.cSafegeBorderHeight, 0, -1, false),
            make_edge(
                RailMetric.cHalfSafegeWidth, RailMetric.cSafegeBorderHeight, 1, 0, false,
                RailMetric.cHalfSafegeWidth, RailMetric.cSafegeCeilHeight, 1, 0, false),
            make_edge(
                -RailMetric.cHalfSafegeWidth, RailMetric.cSafegeCeilHeight, -1, 0, false,
                -RailMetric.cHalfSafegeWidth, RailMetric.cSafegeBorderHeight, -1, 0, false),
            make_edge(
                -RailMetric.cHalfSafegeWidth, RailMetric.cSafegeBorderHeight, 0, -1, false,
                -RailMetric.cHalfSafegeBorderWidth,
                RailMetric.cSafegeBorderHeight, 0, -1, false),
            make_edge(
                -RailMetric.cHalfSafegeBorderWidth, RailMetric.cSafegeBorderHeight, -1, 0, false,
                -RailMetric.cHalfSafegeBorderWidth,
                RailMetric.cSafegeMiddleHeight, -1, 0, false),
            make_edge(
                -RailMetric.cHalfSafegeBorderWidth, RailMetric.cSafegeMiddleHeight, 0, -1, false,
                -RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeMiddleHeight, 0, -1, false),
            make_edge(
                -RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeMiddleHeight, 1, 0, false,
                -RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeCeilHeight, 1, 0, false),
            // roof
            make_edge(
                RailMetric.cHalfSafegeWidth, RailMetric.cSafegeCeilHeight, 1, 1, false,
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeTopHeight, 1, 1, false),
            make_edge(
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeTopHeight, 0, 1, false,
                -RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeTopHeight, 0, 1, false),
            make_edge(
                -RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeTopHeight, -1, 1, false,
                -RailMetric.cHalfSafegeWidth, RailMetric.cSafegeCeilHeight, -1, 1, false),
            make_edge(
                -RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeCeilHeight, 0, -1, false,
                RailMetric.cHalfSafegeInnerWidth, RailMetric.cSafegeCeilHeight, 0, -1, false),
        ] : this.mType <= RailDrawerType.cAlwegSwitch ? [
            make_edge(
                RailMetric.cHalfAlwegMiddleWidth, RailMetric.cAlwegLowMiddleHeight, 1, 0, false,
                RailMetric.cHalfAlwegMiddleWidth,
                RailMetric.cAlwegHighMiddleHeight, 1, 0, false),
            make_edge(
                RailMetric.cHalfAlwegMiddleWidth,
                RailMetric.cAlwegHighMiddleHeight, 1, -1, false,
                RailMetric.cHalfAlwegWidth, RailMetric.cAlwegMiddleTopHeight, 1, -1, false),
            make_edge(
                RailMetric.cHalfAlwegWidth, RailMetric.cAlwegMiddleTopHeight, 1, 0, false,
                RailMetric.cHalfAlwegWidth, RailMetric.cAlwegTopHeight, 1, 0, false),
            make_edge(
                RailMetric.cHalfAlwegWidth, RailMetric.cAlwegTopHeight, 0, 1, false,
                RailMetric.cHalfAlwegMiddleWidth, RailMetric.cAlwegTopHeight, 0, 1, false),
            make_edge(
                -RailMetric.cHalfAlwegMiddleWidth, RailMetric.cAlwegTopHeight, 0, 1, false,
                -RailMetric.cHalfAlwegWidth, RailMetric.cAlwegTopHeight, 0, 1, false),
            make_edge(
                -RailMetric.cHalfAlwegWidth, RailMetric.cAlwegTopHeight, -1, 0, false,
                -RailMetric.cHalfAlwegWidth, RailMetric.cAlwegMiddleTopHeight, -1, 0, false),
            make_edge(
                -RailMetric.cHalfAlwegWidth, RailMetric.cAlwegMiddleTopHeight, -1, -1, false,
                -RailMetric.cHalfAlwegMiddleWidth,
                RailMetric.cAlwegHighMiddleHeight, -1, -1, false),
            make_edge(
                -RailMetric.cHalfAlwegMiddleWidth,
                RailMetric.cAlwegHighMiddleHeight, -1, 0, false,
                -RailMetric.cHalfAlwegMiddleWidth,
                RailMetric.cAlwegLowMiddleHeight, -1, 0, false),
            // bottom
            make_edge(
                -RailMetric.cHalfAlwegMiddleWidth,
                RailMetric.cAlwegLowMiddleHeight, -1, 1, false,
                -RailMetric.cHalfAlwegWidth, RailMetric.cAlwegMiddleBottomHeight, -1, 1, false),
            make_edge(
                -RailMetric.cHalfAlwegWidth, RailMetric.cAlwegMiddleBottomHeight, -1, 0, false,
                -RailMetric.cHalfAlwegWidth, RailMetric.cAlwegBottomHeight, -1, 0, false),
            make_edge(
                RailMetric.cHalfAlwegWidth, RailMetric.cAlwegBottomHeight, 1, 0, false,
                RailMetric.cHalfAlwegWidth, RailMetric.cAlwegMiddleBottomHeight, 1, 0, false),
            make_edge(
                RailMetric.cHalfAlwegWidth, RailMetric.cAlwegMiddleBottomHeight, 1, 1, false,
                RailMetric.cHalfAlwegMiddleWidth, RailMetric.cAlwegLowMiddleHeight, 1, 1, false),
            make_edge(
                RailMetric.cHalfAlwegMiddleWidth, RailMetric.cAlwegTopHeight, 0, 1, false,
                -RailMetric.cHalfAlwegMiddleWidth, RailMetric.cAlwegTopHeight, 0, 1, false),
            make_edge(
                -RailMetric.cHalfAlwegWidth, RailMetric.cAlwegBottomHeight, 0, -1, false,
                RailMetric.cHalfAlwegWidth, RailMetric.cAlwegBottomHeight, 0, -1, false),
        ] : this.mType == RailDrawerType.cGirder ? [
            make_edge(
                RailMetric.cHalfGirderWidth, -RailMetric.cGirderHeight, 1, 0, true,
                RailMetric.cHalfGirderWidth, 0, 1, 0, true),
            make_edge(
                RailMetric.cHalfGirderWidth, 0, 0, 1, true,
                -RailMetric.cHalfGirderWidth, 0, 0, 1, true),
            make_edge(
                -RailMetric.cHalfGirderWidth, 0, -1, 0, true,
                -RailMetric.cHalfGirderWidth, -RailMetric.cGirderHeight, -1, 0, true),
            make_edge(
                -RailMetric.cHalfGirderWidth, -RailMetric.cGirderHeight, 0, -1, true,
                RailMetric.cHalfGirderWidth, -RailMetric.cGirderHeight, 0, -1, true),
        ] : this.mType == RailDrawerType.cTunnel ? [
            make_edge(
                RailMetric.cHalfTunnelWidth, RailMetric.cTunnelHeight, -1, 0, true,
                RailMetric.cHalfTunnelWidth, RailMetric.cTunnelBottom, -1, 0, true),
            make_edge(
                RailMetric.cHalfTunnelWidth, RailMetric.cTunnelBottom, 0, 1, true,
                -RailMetric.cHalfTunnelWidth, RailMetric.cTunnelBottom, 0, 1, true),
            make_edge(
                -RailMetric.cHalfTunnelWidth, RailMetric.cTunnelBottom, 1, 0, true,
                -RailMetric.cHalfTunnelWidth, RailMetric.cTunnelHeight, 1, 0, true),
            make_edge(
                -RailMetric.cHalfTunnelWidth, RailMetric.cTunnelHeight, 0, -1, true,
                RailMetric.cHalfTunnelWidth, RailMetric.cTunnelHeight, 0, -1, true),
        ] : this.mType == RailDrawerType.cPlatform ? [
            make_edge(1.0  , -0.1,  1,  0, true,
                      1.0  ,  1  ,  1,  0, true, v3.Make(0.5, 0.5, 0.5)),
            make_edge(1.0  ,  1  ,  0,  1, true,
                      0.9  ,  1  ,  0,  1, true, v3.Make(0.5, 0.5, 0.5)),
            make_edge(0.9  ,  1  ,  0,  1, true,
                      0.6  ,  1  ,  0,  1, true, v3.Make(0.9, 0.8, 0.0)),
            make_edge(0.6  ,  1  ,  0,  1, true,
                      0.1  ,  1  ,  0,  1, true, v3.Make(0.7, 0.7, 0.7)),
            make_edge(0.1  ,  1  ,  0,  1, true,
                      0.001,  1  ,  0,  1, true, v3.Make(1.0, 1.0, 1.0)),
            make_edge(0.001,  1  , -1,  0, true,
                      0.001,  0.1, -1,  0, true, v3.Make(0.5, 0.5, 0.5)),
            make_edge(0.001,  0.1,  0,  1, true,
                      0.0  ,  0.1,  0,  1, true, v3.Make(0.7, 0.7, 0.7)),
            make_edge(0.0  , -0.1,  0, -1, true,
                      1.0  , -0.1,  0, -1, true, v3.Make(0.7, 0.7, 0.7)),
        ] : this.mType == RailDrawerType.cWall ? [
            make_edge(0.2  , -0.1,  1,  0, true,
                      0.2  ,  1.0,  1,  0, true),
            make_edge(0.2  ,  1.0,  0,  1, true,
                      0.001,  1.0,  0,  1, true),
            make_edge(0.001,  1.0, -1,  0, true,
                      0.001,  0.1, -1,  0, true),
            make_edge(0.001,  0.1,  0,  1, true,
                      0    ,  0.1,  0,  1, true),
            make_edge(0    , -0.1,  0, -1, true,
                      0.2  , -0.1,  0, -1, true),
        ] : this.mType == RailDrawerType.cFloor ? [
            make_edge(0.2  , -0.1,  1,  0, true,
                      0.2  ,  0.1,  1,  0, true),
            make_edge(0.2  ,  0.1,  0,  1, true,
                      0    ,  0.1,  0,  1, true),
            make_edge(0    , -0.1,  0, -1, true,
                      0.2  , -0.1,  0, -1, true),
        ] : this.mType == RailDrawerType.cPltTnl ? [
            make_edge(
                1.0, RailMetric.cTunnelHeight, -1, 0, true,
                1.0, 0, -1, 0, true),
            make_edge(
                1.0, 0, 0, 1, true,
                0.0, 0, 0, 1, true),
            make_edge(
                0.0, 0, 1, 0, true,
                0.0, RailMetric.cTunnelHeight, 1, 0, true),
            make_edge(
                0.0, RailMetric.cTunnelHeight, 0, -1, true,
                1.0, RailMetric.cTunnelHeight, 0, -1, true),
        ] : null;
        for (var i = 0; i < this.mProfiles.length; ++i) {
            var profile = this.mProfiles[i];
            profile.mVertexArray = new Float32Array(this.mArrayCapacity * this.mStride * 2);
            profile.mLastPos = v3.Makes(0);
            profile.mLastTongueParam = v2.Makes(0);
            this.mProfiles[i] = profile;
        }
    };
    inst.beginWrite = function()
    {
        this.mSize = 0;
        this.mDrawBlocks = [];
        for (var i = 0; i < this.mProfiles.length; ++i) {
            var profile = this.mProfiles[i];
            v3.sets(profile.mLastPos, 0);
            v2.sets(profile.mLastTongueParam, 0);
        }
        this.mRailCounterF32[0] = cMinValueF32;
    };
    inst.incrementRailCounter = function() { this.mRailCounterF32[0] *= cMinStepF32; };
    inst.getRailCounter = function() { return this.mRailCounterF32[0]; };
    inst.setHighlight = function(hl) { this.mHighlightCounterF32[0] = hl; };
    inst.setSelected  = function(hl) { this.mHighlightCounterF32[1] = hl; };
    inst.pushDrawBlock = function()
    {
        var block = CreateInstance();
        block.mOffset = this.mSize;
        block.mColor = v4.Makes(1);
        block.mSwitchState = [0, 0];
        block.mSwitchAnim = [1, 1];
        this.mDrawBlocks.push(block);
        return block;
    };
    inst.pushSegment = function(seg, args, is_first, is_last, is_end)
    {
        if (is_first && !is_end) {
            this.pushSegment(seg, args, true, false, 5);
            this.pushSegment(seg, args, false, false, 1);
            is_first = false;
        } else if (is_last && !is_end) {
            this.pushSegment(seg, args, false, false, 0);
            this.pushSegment(seg, args, false, false, 2);
            is_end = 6;
        }
        var end_y = 0;
        var gauge_ofs = args.gauge ? (RailMetric.cHalfGaugeStd - RailMetric.cHalfGauge)
            * (this.mType <= RailDrawerType.cSwitch ? 1 : RailMetric.cHalfBallastTopWidth
               / (RailMetric.cHalfWidth + RailMetric.cGauge * 0.4)) : 0;
        if (this.mType <= RailDrawerType.cSwitch) { end_y = RailMetric.cBallastHeight; }
        else if (this.mType <= RailDrawerType.cSafegeSwitch) {
            end_y = RailMetric.cSafegeFloorHeight; }
        else if (this.mType <= RailDrawerType.cAlwegSwitch) {
            end_y = RailMetric.cAlwegTopHeight; }
        else if (this.mType <= RailDrawerType.cSlab) { end_y = 0; }
        else if (this.mType == RailDrawerType.cGirder) { end_y = args.girder_ofs_y || 0; }
        else if (this.mType >= RailDrawerType.cPlatform) { end_y = args.part_ofs_y || 0; }
        var is_safege = this.mType == RailDrawerType.cSafege
            || this.mType == RailDrawerType.cSafegeSwitch;
        var is_alweg = this.mType == RailDrawerType.cAlweg
            || this.mType == RailDrawerType.cAlwegSwitch;
        var is_curve = IsRailDrawerCurve(type);
        var skip_seg = args && args.skip_seg;
        var n = is_first || skip_seg ? 2 : 1;
        var cShiftOffset = IsRailDrawerUseUV(this.mType) ? 0
            : RailMetric.cWidth * (args && (args.tongue_ofs0 || args.tongue_ofs1) ? 1 : 2);
        var cShiftOffsetThin = cShiftOffset - RailMetric.cWidth;
        var rc = this.mRailCounterF32;
        var new_size = this.mSize + n;
        if (this.mArrayCapacity < new_size) {
            while (this.mArrayCapacity < new_size) { this.mArrayCapacity *= 2; }
            for (var i = 0; i < this.mProfiles.length; ++i) {
                var profile = this.mProfiles[i];
                var new_array = new Float32Array(this.mArrayCapacity * this.mStride * 2);
                new_array.set(profile.mVertexArray);
                profile.mVertexArray = new_array;
            }
            CapacityLog(RailDrawerInfo[this.mType].id
                        + ' array capacity => ' + this.mArrayCapacity);
        }
        var seg_stride = this.mStride * 2;
        var ofs0 = this.mSize * seg_stride;
        var ofs1 = ofs0 + this.mStride;
        var ofs2 = ofs0 + (n > 1 ? seg_stride : 0);
        var ofs3 = ofs2 + this.mStride;
        for (var i = 0; i < this.mProfiles.length; ++i) {
            if (is_safege && i == cSafegeBottomProfileNum) {
                end_y = RailMetric.cSafegeCeilHeight;
            } else if (is_alweg && i == cAlwegTopProfileNum) {
                end_y = RailMetric.cAlwegBottomHeight;
            }
            var tseg = seg;
            if (args) {
                if (i < 3) {
                    if (args.seg_l) { tseg = args.seg_l; }
                } else {
                    if (args.seg_r) { tseg = args.seg_r; }
                }
            }
            var shift_x = !this.mIsMono && args && cShiftOffset * (
                i < 3 ? -Math.max(0, -args.shift_x) : Math.max(0, args.shift_x)) || 0;
            var bend_x = !this.mIsMono && args && cShiftOffset * (
                i < 3 ? -Math.max(0, -args.bend_x) : Math.max(0, args.bend_x)) || 0;
            function calc_thin(vtx, wpos) {
                var ppos = vtx.pos;
                function thin_curve(x) {
                    if (args.is_mid_gap) { return x; }
                    var sign = Math.sign(x);
                    x *= sign / RailMetric.cWidth;
                    x = Math.min(1, x * 1.2);
                    x = x * x;
                    return x * sign * RailMetric.cWidth;
                }
                if (ppos[0] < -RailMetric.cHalfMidWidth
                    && shift_x > 0) {
                    v3.add(wpos, v3.Muls(tseg.left, thin_curve(Math.max(
                        0, shift_x - cShiftOffsetThin))));
                }
                if (ppos[0] > RailMetric.cHalfMidWidth
                    && shift_x < 0) {
                    v3.add(wpos, v3.Muls(tseg.left, thin_curve(Math.min(
                        0, shift_x + cShiftOffsetThin))));
                }
            }
            var profile = this.mProfiles[i];
            var vtx0 = profile.mVertices[0], x0 = vtx0.pos[0], y0 = vtx0.pos[1], bo0 = 0;
            var vtx1 = profile.mVertices[1], x1 = vtx1.pos[0], y1 = vtx1.pos[1], bo1 = 0;
            var mx = (x0 + x1) * 0.5;
            var is_safege_tongue = is_safege && i < this.mProfiles.length - 4
                && (mx < 0 ? args.no_wall0 > 0 || args.no_wall1 > 0
                    : args.no_wall0 < 0 || args.no_wall1 < 0);
            var is_cross_tongue = is_safege_tongue && args.tongue_ex_ofs0 !== undefined;
            if (RailDrawerType.cGirder <= this.mType && this.mType <= RailDrawerType.cTunnel) {
                if (args.girder_ofs_y) {
                    function calc_ofs_y(y) {
                        return args.girder_ofs_y + (y > 0.01 && args.girder_ofs_y2 || 0);
                    }
                    y0 += calc_ofs_y(y0); y1 += calc_ofs_y(y1);
                }
            } else if (this.mType >= RailDrawerType.cPlatform) {
                function calc_ofs_x(x) {
                    var abs_x = Math.abs(x);
                    return (abs_x > 0 ? args.part_ofs : 0) + (
                        abs_x >= 1 ? args.part_width - Math.sign(x) * 1 : 0);
                }
                x0 += calc_ofs_x(x0);
                x1 += calc_ofs_x(x1);
                y0 += y0 >= 1 ? args.part_height - 1 : 0;
                y1 += y1 >= 1 ? args.part_height - 1 : 0;
                if (args.part_ofs_y) { y0 += args.part_ofs_y; y1 += args.part_ofs_y; }
            }
            if (gauge_ofs) {
                function calc_ofs_x(x) { return (x < 0 ? -1 : 1) * gauge_ofs; }
                x0 += calc_ofs_x(x0);
                x1 += calc_ofs_x(x1);
            } else if (this.mType == RailDrawerType.cSafegeSwitch) {
                function calc_ofs_x(x) {
                    if (!is_safege_tongue || is_cross_tongue) { return 0; }
                    var ret = RailMetric.cSafegeSwitchWidth;
                    if (Math.abs(x) > RailMetric.cHalfSafegeOpenBottomWidth + 0.01) {
                        ret += RailMetric.cSafegeSingleSideWidth;
                    }
                    ret *= mx > 0
                        ? (args.no_wall0 < 0 && args.tongue_ofs0 || 0)
                        + (args.no_wall1 < 0 && args.tongue_ofs1 || 0)
                        : (args.no_wall0 > 0 && args.tongue_ofs0 || 0)
                        + (args.no_wall1 > 0 && args.tongue_ofs1 || 0);
                    return ret * (x < 0 ? 1 : -1) * 0.5;
                }
                x0 += calc_ofs_x(x0);
                x1 += calc_ofs_x(x1);
            }
            if (this.mType >= RailDrawerType.cBallast &&
                this.mType < RailDrawerType.cPlatform && args && args.ballast_ofs) {
                function calc_ofs_x(x) { return args.ballast_ofs[x < 0 ? 0 : 1]; }
                var cTieAdjust = this.mType == RailDrawerType.cBallast ? 0.17 : 0.24;
                x0 += bo0 = calc_ofs_x(x0); bo0 = max_abs(bo0, calc_ofs_x(-x0)) * cTieAdjust;
                x1 += bo1 = calc_ofs_x(x1); bo1 = max_abs(bo1, calc_ofs_x(-x1)) * cTieAdjust;
            }
            function adjust_y(y) {
                if (is_end & 4) { y = end_y; }
                if (is_safege && args) { return is_safege_tongue ? Math.min(
                    y, RailMetric.cSafegeFloorHeight) : y; }
                return y;
            }
            var end_nrm = is_end ? v3.muls(v3.normalize(v3.Cross(
                tseg.left, tseg.up)), is_end & 2 ? 1 : -1) : null;
            var left0 = is_curve ? v3.ex : vtx0.is_flat ? tseg.fleft : tseg.left;
            var up0   = is_curve ? v3.ey : vtx0.is_flat ? tseg.fup   : tseg.up  ;
            var p0 = v3.Muls(left0, x0 + shift_x - bend_x);
            v3.add(p0, v3.Muls(up0, adjust_y(y0)));
            v3.add(p0, is_curve ? v3.Make(0, 0, tseg.ratio) : tseg.pos);
            calc_thin(vtx0, p0);
            var n0 = end_nrm || v3.add(v3.Muls(left0, vtx0.nrm[0]),
                                       v3.Muls(up0  , vtx0.nrm[1]));
            var left1 = is_curve ? v3.ex : vtx1.is_flat ? tseg.fleft : tseg.left;
            var up1   = is_curve ? v3.ey : vtx1.is_flat ? tseg.fup   : tseg.up  ;
            var p1 = v3.Muls(left1, x1 + shift_x - bend_x);
            v3.add(p1, v3.Muls(up1, adjust_y(y1)));
            v3.add(p1, is_curve ? v3.Make(0, 0, tseg.ratio) : tseg.pos);
            calc_thin(vtx1, p1);
            var n1 = end_nrm || v3.add(v3.Muls(left1, vtx1.nrm[0]),
                                       v3.Muls(up1  , vtx1.nrm[1]));
            var tongue_param;
            if (this.mType == RailDrawerType.cSwitch) {
                var tongue_x0 = args &&
                    Math.max(0, i < 3 ? -args.tongue_ofs0 : args.tongue_ofs0) || 0;
                var tongue_x1 = args &&
                    Math.max(0, i < 3 ? -args.tongue_ofs1 : args.tongue_ofs1) || 0;
                tongue_param = v2.Make(tongue_x0, tongue_x1);
            } else if (this.mType == RailDrawerType.cSafegeSwitch) {
                if (is_safege_tongue) {
                    var tongue_f0 = mx > 0 ? args.no_wall0 < 0 : args.no_wall0 > 0;
                    var tongue_x0 = tongue_f0 && args.tongue_ofs0 || 0;
                    var tongue_f1 = mx > 0 ? args.no_wall1 < 0 : args.no_wall1 > 0;
                    var tongue_x1 = tongue_f1 && args.tongue_ofs1 || 0;
                    if (tongue_f0 && is_cross_tongue) {
                        v3.add(p0, args.tongue_ex_ofs0);
                        v3.add(p1, args.tongue_ex_ofs0);
                        tongue_x0 = -(1 - tongue_x0) * RailMetric.cSafegeTongueCrossFactor2
                            / RailMetric.cSafegeTongueCrossFactor;
                    }
                    if (tongue_f1 && is_cross_tongue) {
                        v3.add(p0, args.tongue_ex_ofs1);
                        v3.add(p1, args.tongue_ex_ofs1);
                        tongue_x1 = -(1 - tongue_x1) * RailMetric.cSafegeTongueCrossFactor2
                            / RailMetric.cSafegeTongueCrossFactor;
                    }
                    tongue_param = v2.Make(tongue_x0, tongue_x1);
                } else {
                    tongue_param = v2.Makes(0);
                }
            } else if (this.mType == RailDrawerType.cAlwegSwitch) {
                tongue_param = v2.Makes(0);
            }
            function calc_tex_u(a_vtx, bo) {
                return (a_vtx.pos[0]) / (RailMetric.cBallastTopWidth + bo) + 0.5
                    + (args.is_tie_switch ? 10 : 0);
            }
            if (is_first || skip_seg) {
                profile.mVertexArray.set(profile.mLastPos, ofs0);
                profile.mVertexArray.set(rc, ofs0 + 3);
                profile.mVertexArray.set(n0, ofs0 + 4);
                profile.mVertexArray.set(p0, ofs1    );
                profile.mVertexArray.set(rc, ofs1 + 3);
                profile.mVertexArray.set(n0, ofs1 + 4);
                if (IsRailDrawerSwitch(this.mType)) {
                    profile.mVertexArray.set(
                        profile.mLastTongueParam, ofs0 + 7);
                    profile.mVertexArray.set(tongue_param, ofs1 + 7);
                } else if (IsRailDrawerUseUV(this.mType)) {
                    profile.mVertexArray.set(v2.Make(
                        calc_tex_u(vtx0, bo0), seg.ballast_v), ofs0 + 7);
                    profile.mVertexArray.set(v2.Make(
                        calc_tex_u(vtx1, bo1), seg.ballast_v), ofs1 + 7);
                } else if (IsRailDrawerUseColor(this.mType)) {
                    profile.mVertexArray.set(profile.mColor, ofs0 + 7);
                    profile.mVertexArray.set(profile.mColor, ofs1 + 7);
                }
            }
            profile.mVertexArray.set(p0, ofs2    );
            profile.mVertexArray.set(rc, ofs2 + 3);
            profile.mVertexArray.set(n0, ofs2 + 4);
            profile.mVertexArray.set(p1, ofs3    );
            profile.mVertexArray.set(rc, ofs3 + 3);
            profile.mVertexArray.set(n1, ofs3 + 4);
            v3.copy(profile.mLastPos, p1);
            if (IsRailDrawerSwitch(this.mType)) {
                profile.mVertexArray.set(tongue_param, ofs2 + 7);
                profile.mVertexArray.set(tongue_param, ofs3 + 7);
                v2.copy(profile.mLastTongueParam, tongue_param);
            } else if (IsRailDrawerUseUV(this.mType)) {
                profile.mVertexArray.set(v2.Make(
                    calc_tex_u(vtx0, bo0), seg.ballast_v), ofs2 + 7);
                profile.mVertexArray.set(v2.Make(
                    calc_tex_u(vtx1, bo1), seg.ballast_v), ofs3 + 7);
            } else if (IsRailDrawerUseColor(this.mType)) {
                profile.mVertexArray.set(profile.mColor, ofs2 + 7);
                profile.mVertexArray.set(profile.mColor, ofs3 + 7);
            }
        }
        this.mSize = new_size;
    };
    inst.endWrite = function(gl)
    {
        var seg_stride = this.mStride * 2;
        if (this.mBufferCapacity < this.mArrayCapacity) {
            this.mBufferCapacity = this.mArrayCapacity;
            CapacityLog(RailDrawerInfo[this.mType].id
                        + ' buffer capacity => ' + this.mBufferCapacity);
            for (var i = 0; i < this.mProfiles.length; ++i) {
                var profile = this.mProfiles[i];
                profile.mVertexBuffer = gl.createBuffer();
                gl.bindBuffer(gl.ARRAY_BUFFER, profile.mVertexBuffer);
                gl.bufferData(gl.ARRAY_BUFFER, profile.mVertexArray, gl.DYNAMIC_DRAW);
            }
        }
        for (var i = 0; i < this.mProfiles.length; ++i) {
            var profile = this.mProfiles[i];
            gl.bindBuffer(gl.ARRAY_BUFFER, profile.mVertexBuffer);
            gl.bufferSubData(
                gl.ARRAY_BUFFER, 0,
                new Float32Array(profile.mVertexArray.buffer,
                                 0, this.mSize * seg_stride));
        }
    };
    inst.getCapacityText = function() { return '' + this.mSize + '/' + this.mArrayCapacity; };
    inst.setDrawProfileNum = function(n) { this.mDrawProfileNum = n; };
    inst.draw = function(gl, view_ctx)
    {
        if (this.mSize <= 0) { return; }
        gl.enable(gl.CULL_FACE);
        gl.enable(gl.DEPTH_TEST);
        if (this.mIsTunnel) { gl.depthFunc(gl.GREATER); }
        gl.useProgram(this.mShaderInfo.mShader);
        webgl.uniform4fx4(gl, this.mShLoc.cViewProjMtx, view_ctx.view_proj_mtx);
        gl.uniform4fv(this.mShLoc.cDrawParam0, this.mHighlightCounterF32);
        gl.uniform2f(this.mShLoc.cNoiseCenter,
                     Math.floor(view_ctx.camera_at[0] * 0.1) * 10,
                     Math.floor(view_ctx.camera_at[2] * 0.1) * 10);
        for (var i = 0; i < this.mProfiles.length; ++i) {
            if (this.mDrawProfileNum && i >= this.mDrawProfileNum) { break; }
            var profile = this.mProfiles[i];
            gl.bindBuffer(gl.ARRAY_BUFFER, profile.mVertexBuffer);
            this.mShaderInfo.activateAttrib(gl, 'aPos');
            this.mShaderInfo.activateAttrib(gl, 'aNrm');
            if (IsRailDrawerSwitch(this.mType) && this.mShLoc.aTongue >= 0) {
                this.mShaderInfo.activateAttrib(gl, 'aTongue');
            } else if (IsRailDrawerUseUV(this.mType) && this.mShLoc.aTexCoord >= 0) {
                this.mShaderInfo.activateAttrib(gl, 'aTexCoord');
            } else if (IsRailDrawerUseColor(this.mType) && this.mShLoc.aColor >= 0) {
                this.mShaderInfo.activateAttrib(gl, 'aColor');
            }
            if (this.mDrawBlocks.length == 0) {
                gl.drawArrays(
                    gl.TRIANGLE_STRIP,
                    0, // offset
                    this.mSize * 2 // count
                );
            } else {
                var is_color = IsMenuSchedule();
                for (var j = 0; j < this.mDrawBlocks.length; ++j) {
                    var block = this.mDrawBlocks[j];
                    var next_block = this.mDrawBlocks[j + 1];
                    var size = next_block ? next_block.mOffset : this.mSize;
                    size -= block.mOffset;
                    var color = is_color ? block.mColor : v4.ones;
                    if (IsRailDrawerCurve(this.mType)) {
                        function set_curve_info(cvloc, cvb, cvs, ratio) {
                            gl.uniform3fv(cvloc[0], v3.Lerp(cvb.pos, cvs.pos, ratio));
                            gl.uniform3fv(cvloc[1], v3.Lerp(cvb.dir, cvs.dir, ratio));
                            gl.uniform3fv(cvloc[2], v3.Lerp(cvb.up , cvs.up , ratio));
                        }
                        set_curve_info(this.mShLoc.cCurveInfo0, block.mBasePoint0,
                                       block.mSwitchPoint0, 0.5 - block.mSwitchAnim[1] * 0.5);
                        set_curve_info(this.mShLoc.cCurveInfo1, block.mBasePoint1,
                                       block.mSwitchPoint1, 0.5 - block.mSwitchAnim[0] * 0.5);
                    } else if (IsRailDrawerSwitch(this.mType)) {
                        var scale = 1, cross_factor = 0;
                        if (this.mType == RailDrawerType.cSafegeSwitch) {
                            var t_sw0 = block.mSwitchAnim[0], t_sw1 = block.mSwitchAnim[1];
                            if (block.mIsSameSide) { t_sw0 = -t_sw0; }
                            if (t_sw0 < 0 && t_sw1 < 0) {
                                cross_factor = -Math.max(t_sw0, t_sw1);
                                scale = 1 + cross_factor * (
                                    RailMetric.cSafegeTongueCrossFactor - 1);
                            }
                        }
                        gl.uniform4fv(
                            this.mShLoc.cTongueOffset0,
                            v4.FromV3(v3.Muls(
                                block.mTongueOffset0, block.mSwitchAnim[0] * scale),
                                      cross_factor));
                        gl.uniform4fv(
                            this.mShLoc.cTongueOffset1,
                            v4.FromV3(v3.Muls(
                                block.mTongueOffset1, block.mSwitchAnim[1] * scale),
                                      cross_factor));
                        gl.uniform4fv(this.mShLoc.cTestColor, color);
                    }
                    gl.drawArrays(
                        gl.TRIANGLE_STRIP,
                        block.mOffset * 2, // offset
                        size * 2 // count
                    );
                }
            }
        }
        gl.bindBuffer(gl.ARRAY_BUFFER, null);
        v4.set(this.mHighlightCounterF32, 0, 0, 0, 0);
        if (this.mIsTunnel) { gl.depthFunc(gl.LESS); }
    };
    return inst;
};
RailDrawer.createPair = function(type)
{
    return [this.create(type, 1), this.create(type, -1)];
};
  </script>
  <!-- <script src="input.js"></script> -->
  <script>
'use strict';
var g_is_touch_device = window.ontouchstart === null;
var g_touch_hit_scale = g_is_touch_device ? 3 : 1;
var g_mouse = {
    mPos : v2.Makes(0),
    mDomPos : v2.Makes(0),
    mIsDown : false,
    mIsPrevDown : false,
    mIsTrig : false,
    mIsRelease : false,
    mIsFree : false,
    mIsTouchMoved : false,
    mWasShortTouch : false,
    mIsCancel : false,
    mDownPos : v2.Makes(0),
    mDelta : v2.Makes(0),
    mMaxDeltaLen : 0,
    mTouchKeepDist : 0.01,
    mCoverElements : [],
    initialize : function() {
        if (g_is_touch_device)
        {
            g_mouse.mTouchKeepDist = 0.05;
            document.body.addEventListener('touchmove', function(ev) {
                if (ev.touches.length > 0) {
                    g_mouse.onMouseMove(ev.touches[0]);
                }
            });
            document.body.addEventListener('touchstart', function(ev) {
                if (ev.touches.length > 0) {
                    g_mouse.onMouseMove(ev.touches[0]);
                    g_mouse.onMouseDown(ev.touches[0]);
                }
            });
            document.body.addEventListener('touchend', function(ev) {
                if (ev.touches.length == 0) {
                    g_mouse.onMouseUp(ev);
                }
            });
        }
        else
        {
            document.body.addEventListener('mousemove', function(ev) {
                g_mouse.onMouseMove(ev);
            });
            document.body.addEventListener('mousedown', function(ev) {
                g_mouse.onMouseDown(ev);
            });
            document.body.addEventListener('mouseup', function(ev) {
                g_mouse.onMouseUp(ev);
            });
            document.body.addEventListener('mouseleave', function(ev) {
                g_mouse.onMouseUp(ev);
                g_mouse.setCancel();
            });
            document.body.addEventListener('wheel', function(ev) {
                g_mouse.onWheel(ev);
            });
        }
    },
    pushCoverElements : function(el) {
        this.mCoverElements.push(el);
    },
    isTrig : function() { return this.mIsTrig; },
    isHold : function() { return !this.mIsRelease && !this.mIsFree; },
    isRelease : function() { return this.mIsRelease; },
    isFree : function() { return this.mIsFree; },
    isCancel : function() { return this.mIsCancel; },
    isTouchMoved : function() { return this.mIsTouchMoved; },
    wasShortTouch : function() { return this.mWasShortTouch; },
    getPos : function() { return this.mPos; },
    getDownPos : function() {  return this.mDownPos; },
    getDelta : function() { return this.mDelta; },
    getDeltaWithAspect : function() {
        return g_canvas.mIsVerticalMode
            ? v2.mul(v2.Make(1, 1 / g_canvas.getAspect()), this.mDelta)
            : v2.mul(v2.Make(g_canvas.getAspect(), 1), this.mDelta);
    },
    calcDeltaDist : function() { return v2.Length(this.mDelta); },
    setCancel : function() { this.mIsCancel = this.mIsTouchMoved = true; },
    resetDelta : function() {
        v2.copy(this.mDownPos, this.mPos);
        v2.sets(this.mDelta, 0);
    },
    update : function()
    {
        this.mIsTrig = this.mIsDown && !this.mIsPrevDown;
        this.mIsRelease = !this.mIsDown && this.mIsPrevDown;
        this.mIsFree = !this.mIsDown && !this.mIsPrevDown;
        this.mWasShortTouch = this.mIsRelease && !this.mIsTouchMoved;
        this.mIsPrevDown = this.mIsDown;
    },
    onMouseMove : function(ev) {
        if (!g_canvas || !g_canvas.mElement) { return; }
        //var rect = g_canvas.mElement.getBoundingClientRect();
        //v2.set(this.mPos, (ev.pageX - rect.left) / rect.width,
        //       (ev.pageY - rect.top ) / rect.height);
        v2.set(this.mPos, ev.pageX / g_canvas.mDisplayWidth,
               ev.pageY / g_canvas.mDisplayHeight);
        v2.set(this.mDomPos, ev.pageX, ev.pageY);
        if (this.mIsDown) {
            v2.sub(v2.copy(this.mDelta, this.mPos), this.mDownPos);
            this.mMaxDeltaLen = Math.max(this.mMaxDeltaLen, v2.Length(this.mDelta));
            if (this.mMaxDeltaLen > this.mTouchKeepDist) { this.mIsTouchMoved = true; }
            ClearSelection();
        }
    },
    onMouseDown : function(ev) {
        if (!g_is_touch_device && ev.button != 0) { return; }
        if (this.mIsDown) { return; }
        if (this.checkCoverElements()) { return; }
        v2.copy(this.mDownPos, this.mPos);
        v2.sets(this.mDelta, 0);
        this.mIsDown = true;
        this.mIsCancel = false;
        this.mWasShortTouch = false;
        this.mMaxDeltaLen = 0;
        this.mIsTouchMoved = false;
    },
    onMouseUp : function(ev) {
        if (!this.mIsDown) { return; }
        this.mIsDown = false;
        ClearSelection();
    },
    onWheel : function(ev) {
        if (this.mIsDown) { return; }
        if (this.checkCoverElements(true)) { return; }
        if (g_keyboard.isCtrlDown()) {
            g_cam_ctrl.beginDolly();
            g_cam_ctrl.calcDolly(-ev.deltaY * 0.01);
        } else {
            g_cam_ctrl.beginZoom();
            g_cam_ctrl.calcZoom(v2.Make(0, -ev.deltaY * 0.001));
        }
    },
    checkCoverElements : function(detect_log) {
        for (var i = 0; i < this.mCoverElements.length; ++i) {
            var el = this.mCoverElements[i];
            if (el.className == 'log' && !detect_log) { continue; }
            if (el.style.display == 'none') { continue; }
            var rect = el.getBoundingClientRect();
            if (rect.left <= this.mDomPos[0] && this.mDomPos[0] <= rect.right &&
                rect.top <= this.mDomPos[1] && this.mDomPos[1] <= rect.bottom ) {
                return true;
            }
        }
        return false;
    },
};
var g_keyboard = {
    mKeyInfo : {
        Shift  : { code : 16, },
        Ctrl   : { code : 17, },
        Alt    : { code : 18, },
        Cmd    : { code : 91, },
        Delete : { code :  8, },
        BackSp : { code : 46, },
        Escape : { code : 27, },
    },
    mKeyData :  {},
    initialize : function()
    {
        for (var key_name in this.mKeyInfo) {
            var info = this.mKeyInfo[key_name];
            info.is_down = false;
            this.mKeyData[info.code] = info;
        }
        document.body.addEventListener('keydown', function(ev) {
            g_keyboard.onKeyDown(ev.keyCode);
        });
        document.body.addEventListener('keyup', function(ev) {
            g_keyboard.onKeyUp(ev.keyCode);
        });
    },
    isSupportKeyDown : function(info) {
        return info.is_down;
    },
    getSupportKeyTrig : function(info) {
        if (info.is_down) {
            info.is_down = false;
            return true;
        }
        return false;
    },
    onKeyDown : function(code) {
        var info = this.mKeyData[code];
        if (info) { info.is_down = true; }
    },
    onKeyUp : function(code) {
        var info = this.mKeyData[code];
        if (info) { info.is_down = false; }
    },
    isShiftDown : function() {
        return this.isSupportKeyDown(this.mKeyInfo.Shift);
    },
    isCtrlDown : function() {
        return this.isSupportKeyDown(this.mKeyInfo.Ctrl)
            || this.isSupportKeyDown(this.mKeyInfo.Cmd);
    },
    isAltDown : function() {
        return this.isSupportKeyDown(this.mKeyInfo.Alt);
    },
    getCommonDeleteTrig : function() {
        var ret0 = this.getSupportKeyTrig(this.mKeyInfo.Delete);
        var ret1 = this.getSupportKeyTrig(this.mKeyInfo.BackSp);
        return ret0 || ret1;
    },
    getEscapeTrig : function() {
        return this.getSupportKeyTrig(this.mKeyInfo.Escape);
    },
};
function GetFocusElement()
{
    var ret = document.activeElement;
    return ret == document.body ? null : ret;
}
  </script>
  <!-- <script src="file.js"></script> -->
  <script>
'use strict';
var cFileVersion = 1;
var cFileType_Layout = 'RailSimWeb-layout-data';
var cFileType_Model = 'RailSimWeb-model-data';
var cJsEmbedBegin = '//embedded-data-begin';
var cJsEmbedEnd   = '//embedded-data-end';
var cJsAssignHead = 'var g_layout_data = ';
var g_undo_stack = [];
var g_redo_stack = [];
var g_undo_redo_callback = CreateCallbackSet();
var g_clipboard = null;
function SetClipboard(type, value) {
    g_clipboard = { type : type, value : value, };
}
function GetClipboard(type) {
    return g_clipboard && g_clipboard.type == type ? g_clipboard.value : null;
}
function UpdateUndoRedoMenu()
{
    ToggleLinkColor('menu-link-undo', g_undo_stack.length > 0);
    ToggleLinkColor('menu-link-redo', g_redo_stack.length > 0);
}
function PushUndo(undo_func, redo_func, act_label, is_invoke_redo, target_inst)
{
    if (is_invoke_redo) { redo_func(); }
    if (g_opt_undo_stack_size == 0) { return; }
    var last_undo = g_undo_stack.length > 0 ? g_undo_stack[g_undo_stack.length - 1] : null;
    if (last_undo && target_inst && last_undo.label == act_label
        && last_undo.inst == target_inst) {
        last_undo.redo = redo_func;
    } else {
        g_undo_stack.push({ undo : undo_func, redo : redo_func, label : act_label,
                            inst : target_inst, });
    }
    g_redo_stack = [];
    if (g_opt_undo_stack_size >= 0) {
        while (g_undo_stack.length > g_opt_undo_stack_size) { g_undo_stack.shift(); }
    }
    UpdateUndoRedoMenu();
}
function Undo()
{
    CancelMouse();
    g_undo_redo_callback.invoke();
    if (g_undo_stack.length > 0) {
        var f = g_undo_stack.pop();
        f.undo();
        g_redo_stack.push(f);
        Log(LangJoin([cLang.file_undo, ' "', f.label,
                      '" (' + g_redo_stack.length + '/'
                      + (g_undo_stack.length + g_redo_stack.length) + ')']));
    }
    UpdateUndoRedoMenu();
}
function Redo()
{
    CancelMouse();
    g_undo_redo_callback.invoke();
    if (g_redo_stack.length > 0) {
        var f = g_redo_stack.pop();
        f.redo();
        g_undo_stack.push(f);
        Log(LangJoin([cLang.file_redo, ' "', f.label,
                      '" (' + g_redo_stack.length + '/'
                      + (g_undo_stack.length + g_redo_stack.length) + ')']));
    }
    UpdateUndoRedoMenu();
}
var FileMode = CreateInstance();
FileMode.createAuthorInfoMgr = function(parent_mgr)
{
    var mgr = UI_Struct.createMgr({
        clip_name : 'author-info', fixed : true, parent_mgr : parent_mgr, });
    mgr.pushStruct({
        key : 'name', title : cLang.cmn_name, def_value : '',
        mgr : UI_Text.createMgr({ parent_mgr : mgr, fixed : true, no_clip : true, }), });
    mgr.pushStruct({
        key : 'url', title : 'URL', def_value : '',
        mgr : UI_Text.createMgr({ parent_mgr : mgr, fixed : true, no_clip : true, }), });
    mgr.initializeStruct();
    return mgr;
};
FileMode.appendAuthorLink = function(parent, author)
{
    if (!author || !(author.name || author.url)) { return; }
    parent.append(' (', author.url ? CreateLink(
        author.name || 'link', author.url, cLang.cmn_author) : author.name, ')');
};
FileMode.updateLayoutName = function()
{
    WatchMode.setTitle(this.mLayoutNameMgr.getValue(), this.mLayoutAuthorMgr.getValue());
};
FileMode.mLayoutNameMgr = UI_LangText.createMgr({
    fixed : true, on_update : function(inst) { FileMode.updateLayoutName(); },
})
FileMode.mLayoutAuthorMgr = FileMode.createAuthorInfoMgr();
FileMode.mLayoutAuthorMgr.mOnUpdate = function(inst) { FileMode.updateLayoutName(); };
FileMode.mExportPartModelMgr = UI_Check.createMgr({ fixed : true, })
FileMode.mExportTrainModelMgr = UI_Check.createMgr({ fixed : true, })
FileMode.mExportStructModelMgr = UI_Check.createMgr({ fixed : true, })
FileMode.mExportTrainFormMgr = UI_Check.createMgr({ fixed : true, })
FileMode.mCameraFovMgr = UI_Slider.createMgr({
    fixed : true, size : 4, min : 1, max : 179, slide_round : 1, fixed_range : true, });
FileMode.initialize = function()
{
    FileMode.mFilePane = CreateEditPane('file', cLang.head_file, function(div_on) {
        if (!g_is_touch_device)
        {
            var drop_class = 'file-drop', div_drop = CreateElement('div', drop_class);
            div_drop.append(LangSpan(cLang.desc_drop_file));
            div_drop.addEventListener('dragover', function(event) {
                event.preventDefault();
                event.dataTransfer.dropEffect = 'copy';
                div_drop.className = drop_class + ' dropping';
            });
            div_drop.addEventListener('dragleave', function(event) {
                div_drop.className = drop_class;
            });
            div_drop.addEventListener('drop', function(event) {
                event.preventDefault();
                div_drop.className = drop_class;
                if (event.dataTransfer.items) {
                    for (var item of event.dataTransfer.items) {
                        var { kind, type } = item;
                        if (kind === 'file') {
                            FileMode.loadFile(item.getAsFile());
                        } else {
                            Log(cLang.desc_invalid_data);
                        }
                        return;
                    }
                }
            });
            div_on.append(div_drop);
        }
        var file_elem = CreateElement('input', 'file-hidden');
        file_elem.type = 'file';
        file_elem.addEventListener('change', async function(event) {
            if (file_elem.files.length > 0) {
                var file = file_elem.files[0];
                FileMode.loadFile(file);
                file_elem.value = '';
            }
        });
        div_on.append(file_elem);
        div_on.append(CreateScriptLinkEdit(
            cLang.file_load_scene, function() {
                file_elem.accept = 'application/json';
                file_elem.click();
            }));
        div_on.append(CreateHBRVSL(), CreateScriptLinkEdit(
            cLang.file_new_scene,
            function() { ClearData(false); }));
        div_on.append(CreateHBRVSL(), CreateScriptLinkEdit(
            LangJoin([cLang.file_new_scene, ' (', cLang.file_keep_model_data, ')']),
            function() { ClearData(true); }));
        div_on.append(CreateHBRVSL(), CreateScriptLinkEdit(
            LangAppend(cLang.file_save_scene, ' (.json)'),
            function() { SaveData(null); }));
        div_on.append(CreateHBRVSL(), CreateScriptLinkEdit(
            cLang.file_save_for_embedding, function() {
                file_elem.accept = 'text/html;text/javascript';
                file_elem.click();
            }));
        var info_p = CreateElement('p', 'group');
        this.mLayoutName = this.mLayoutNameMgr.createActiveInstance({
            parent : info_p, title : cLang.file_layout_name,
            value : ['New Layout', '新規レイアウト'], });
        info_p.append(CreateHBRVSL());
        this.mLayoutAuthor = this.mLayoutAuthorMgr.createActiveInstance({
            parent : info_p, title : cLang.cmn_author, value : null, });
        div_on.append(info_p);
        var export_p = CreateElement('p', 'group');
        export_p.append(CreateScriptLinkEdit(
            cLang.file_export_data, function() { ExportData(); }));
        export_p.append(CreateHBRVSL());
        this.mExportPartModel = this.mExportPartModelMgr.createActiveInstance({
            parent : export_p, value : true, title : cLang.file_export_part_model, });
        export_p.append(CreateHBRVSL());
        this.mExportTrainModel = this.mExportTrainModelMgr.createActiveInstance({
            parent : export_p, value : true, title : cLang.file_export_train_model, });
        export_p.append(CreateHBRVSL());
        this.mExportStructModel = this.mExportStructModelMgr.createActiveInstance({
            parent : export_p, value : true, title : cLang.file_export_struct_model, });
        export_p.append(CreateHBRVSL());
        this.mExportTrainForm = this.mExportTrainFormMgr.createActiveInstance({
            parent : export_p, value : true, title : cLang.file_export_train_form, });
        div_on.append(export_p);
        var config_p = CreateElement('p', 'group');
        this.mCameraFov = this.mCameraFovMgr.createActiveInstance({
            parent : config_p, value : g_default_camera_fov, title : cLang.file_fov, });
        config_p.append(CreateHBRVSL());
        config_p.append(CreateScriptLinkEdit(
            cLang.file_reset_camera, function() { FileMode.resetCamera(); }));
        config_p.append(CreateHBRVSL());
        config_p.append(CreateScriptLinkEdit(
            cLang.cam_guide_open, function() {
                WatchMode.setCameraGuideVisible(!WatchMode.isCameraGuideVisible());
            }));
        div_on.append(config_p);
        var version_p = CreateElement('p', 'group');
        div_on.append(version_p);
        OnNextCalc(function() {
            version_p.innerText = GetVersionText();
            if (!this.mCameraFovMgr.isVisible()) { return true; }
            this.mCameraFovMgr.updateSlider(this.mCameraFov.mValue);
        }, this);
    }, this);
};
FileMode.resetCamera = function()
{
    function new_ctrl() { return CameraControl.create({}); }
    var is_def_cam = g_cam_ctrl == g_cam_ctrl_default;
    g_cam_ctrl_default = new_ctrl();
    g_cam_ctrl_model = new_ctrl();
    g_cam_ctrl = is_def_cam ? g_cam_ctrl_default : g_cam_ctrl_model;
    this.setFov(g_default_camera_fov);
};
FileMode.requestUpdateCameraSlider = function()
{
    if (!this.mIsRequestUpdateCameraSlider) {
        this.mIsRequestUpdateCameraSlider = true;
        OnNextCalc(function() {
            if (!this.mCameraFovMgr.isVisible()) { return true; }
            this.mCameraFovMgr.updateSlider(this.mCameraFov.mValue);
            this.mIsRequestUpdateCameraSlider = false;
        }, this);
    }
};
FileMode.setFov = function(fov)
{
    this.mCameraFovMgr.updateValue(FileMode.mCameraFov, fov);
    this.requestUpdateCameraSlider();
};
FileMode.loadFile = function(file)
{
    var reader = new FileReader();
    reader.readAsText(file);
    reader.addEventListener('load', function(event) {
        Log(LangAppend(cLang.desc_load_data, ': ' + file.name));
        var text = reader.result;
        if (text.indexOf(cJsEmbedBegin) >= 0 && text.indexOf(cJsEmbedEnd) >= 0)
        {
            var embed_info = { pre : '', post : '', name : file.name, };
            var step = 0;
            text.split('\n').forEach(function(line) {
                if (step == 0) {
                    embed_info.pre += line + '\n';
                    if (!line.startsWith(cJsEmbedBegin)) { return; }
                    step = 1;
                } else if (step == 1) {
                    if (!line.startsWith(cJsEmbedEnd)) { return; }
                    embed_info.post += line + '\n';
                    step = 2;
                } else if (step == 2) {
                    if (line != '') { embed_info.post += line + '\n'; }
                }
            });
            if (step == 2) {
                SaveData(embed_info);
            } else {
                Log(cLang.desc_embed_failed);
            }
            return;
        }
        if (file.name.endsWith('.js') && text.startsWith(cJsAssignHead)) {
            text = text.slice(cJsAssignHead.length);
        }
        try {
            var loaded_data = JSON.parse(text);
            if (loaded_data) {
                var gl = g_canvas.getContext();
                if (loaded_data.type == cFileType_Layout) {
                    if (!ClearData(false)) { return; }
                } else if (loaded_data.type == cFileType_Model) {
                } else {
                    Log(LangAppend(cLang.error_tag, cLang.error_file_type));
                    return;
                }
                LoadData(gl, loaded_data);
            }
        } catch (error) {
            Log(cLang.desc_invalid_data);
        }
    });
    reader.addEventListener('error', function(event) {
        Log('ERROR: ' + reader.error);
    });
};
FileMode.initialize();
function ClearData(is_keep_model_data)
{
    if (!LangConfirm(cLang.file_confirm_clear_scene)) { return false; }
    Log(cLang.file_new_scene);
    Rail.clear();
    Train.clear();
    Struct.clear();
    TrainEditor.clear();
    StructEditor.clear();
    Rail.writeAll();
    FieldEditor.createTestField(g_canvas.getContext());
    if (!is_keep_model_data) {
        TrainModel.clear();
        StructModel.clear();
        EditModel.clear();
        FileMode.resetCamera();
        //WatchMode.setCameraGuideVisible(true);
    }
    g_undo_stack = [];
    g_redo_stack = [];
    UpdateUndoRedoMenu();
    return true;
}
function ExportData()
{
    Log(LangAppend(cLang.file_export_data, '...'));
    var is_available = false;
    function apply_check(cls, is_export) {
        cls.mInstsMgr.mElements.forEach(function(elem_inst) {
            var mdl = elem_inst.mValue;
            mdl.user_data.is_checked = is_export && elem_inst.mArrayCheck.checked;
            if (!mdl.user_data.is_checked) { return; }
            is_available = true;
            Log(LangJoin([cLang.cmn_checked, ': ', mdl.name]));
            if (!mdl.parts) { return; }
            mdl.parts.forEach(function(part) {
                var dep_mdl = EditModel.mIdToData[part.model];
                if (dep_mdl && !dep_mdl.user_data.is_checked) {
                    dep_mdl.user_data.is_checked = true;
                    Log(LangJoin([cLang.cmn_depended, ': ', dep_mdl.name]));
                }
            });
        });
    }
    apply_check(EditModel  , FileMode.mExportPartModel  .mValue);
    apply_check(TrainModel , FileMode.mExportTrainModel .mValue);
    apply_check(StructModel, FileMode.mExportStructModel.mValue);
    apply_check(TrainEditor, FileMode.mExportTrainForm  .mValue);
    if (!is_available) {
        Log(LangAppend(cLang.error_tag, cLang.error_file_no_export_data));
        return;
    }
    SaveData(null, true);
}
function SaveData(embed_info, is_export)
{
    var data = {
        version : cFileVersion,
    };
    if (is_export) {
        data.type = cFileType_Model;
        EditModel.saveAll(data);
        TrainModel.saveAll(data);
        TrainEditor.saveAll(data);
        StructModel.saveAll(data);
        delete data.trains.cur_id;
    } else {
        data.name = FileMode.mLayoutNameMgr.getValue();
        data.author = FileMode.mLayoutAuthorMgr.getValue();
        data.type = cFileType_Layout;
        data.is_pause = WatchMode.mIsPause.mValue;
        data.cam_guide = WatchMode.isCameraGuideVisible();
        data.cam_ctrl = g_cam_ctrl_default.save();
        data.cam_fov = FileMode.mCameraFov.mValue;
        FieldEditor.save(data);
        Rail.saveAll(data);
        EditModel.saveAll(data);
        TrainModel.saveAll(data);
        TrainEditor.saveAll(data);
        StructModel.saveAll(data);
        StructEditor.saveAll(data);
        Log(LangJoin([cLang.desc_save_data, ': ', data.name]));
    }
    var time_str = FormatDateTimeForFile(new Date)
    var json = JSON.stringify(data) + '\n';
    var name = time_str + '.rsw.layout.json';
    if (embed_info) {
        json = embed_info.pre + cJsAssignHead + json + embed_info.post;
        name = embed_info.name;
    } else if (is_export) {
        name = time_str + '.rsw.model.json';
    }
    Log(LangAppend(cLang.file_download, ': ' + name));
    var blob = new Blob([json], { type : 'application/json', });
    var dummy_a_el = document.createElement('a');
    document.body.appendChild(dummy_a_el);
    var obj_url = dummy_a_el.href = window.URL.createObjectURL(blob);
    dummy_a_el.download = name;
    dummy_a_el.click();
    document.body.removeChild(dummy_a_el);
    URL.revokeObjectURL(obj_url);
}
function LoadData(gl, data)
{
    if (!data) { return; }
    if (typeof(data) !== 'object' || (
        data.type != cFileType_Layout && data.type != cFileType_Model)) {
        Log(LangAppend(cLang.error_tag, cLang.error_file_type));
        return;
    }
    if (data.version > cFileVersion) {
        Log(LangJoin([cLang.error_tag, cLang.error_file_version, data.version]));
        return;
    }
    if (data.type == cFileType_Layout) {
        FileMode.mLayoutNameMgr.setValue(data.name);
        FileMode.mLayoutAuthorMgr.setValue(data.author);
        FileMode.updateLayoutName();
    }
    FieldEditor.load(gl, data);
    Rail.loadAll(data);
    EditModel.loadAll(gl, data);
    TrainModel.loadAll(gl, data);
    TrainEditor.loadAll(data);
    StructModel.loadAll(gl, data);
    StructEditor.loadAll(data);
    SetPause(data.is_pause);
    if (data.type == cFileType_Model) {
        Log(cLang.desc_import_data);
    } else {
        WatchMode.setCameraGuideVisible(data.cam_guide);
        g_cam_ctrl_default.load(data.cam_ctrl);
        FileMode.mCameraFovMgr.updateValue(FileMode.mCameraFov, data.cam_fov);
        Log(LangJoin([cLang.desc_load_data, ': ', data.name]));
    }
}
  </script>
  <!-- <script src="rail.js"></script> -->
  <script>
'use strict';
var RailMetric = CreateInstance();
RailMetric.cWidth          = 0.065;
RailMetric.cHalfWidth      = RailMetric.cWidth * 0.5;
RailMetric.cHeight         = 0.15;
RailMetric.cGauge          = 1.067;
RailMetric.cGaugeStd       = 1.435;
RailMetric.cHalfGauge      = RailMetric.cGauge    * 0.5;
RailMetric.cHalfGaugeStd   = RailMetric.cGaugeStd * 0.5;
RailMetric.cHalfMidWidth   = RailMetric.cHalfWidth + RailMetric.cHalfGauge;
RailMetric.cHalfOuterWidth = RailMetric.cWidth + RailMetric.cHalfGauge;
RailMetric.cInterval       = (RailMetric.cWidth + RailMetric.cGauge) * 0.5;
RailMetric.cEndSign        = [-1, 1];
RailMetric.cBallastTopWidth        = 2.0;
RailMetric.cBallastBottomWidth     = 3.0;
RailMetric.cHalfBallastTopWidth    = RailMetric.cBallastTopWidth    * 0.5;
RailMetric.cHalfBallastBottomWidth = RailMetric.cBallastBottomWidth * 0.5;
RailMetric.cBallastSwitchOffset    = RailMetric.cHalfBallastTopWidth + RailMetric.cHalfGauge;
RailMetric.cBallastSwitchOffsetSub =
    RailMetric.cHalfBallastTopWidth - RailMetric.cHalfOuterWidth;
RailMetric.cBallastHeight          = 0.35;
RailMetric.cSlabWidth = (RailMetric.cBallastTopWidth + RailMetric.cBallastBottomWidth) * 0.5;
RailMetric.cHalfSlabWidth          = RailMetric.cSlabWidth * 0.5;
RailMetric.cTieInterval            = 0.5;
RailMetric.calcTieNum = function(len) {
    return Math.max(1, Math.round(len / RailMetric.cTieInterval))
};
RailMetric.cSafegeWidth               = 2.2;
RailMetric.cHalfSafegeWidth           = RailMetric.cSafegeWidth * 0.5
RailMetric.cSafegeInnerWidth          = 1.8;
RailMetric.cHalfSafegeInnerWidth      = RailMetric.cSafegeInnerWidth * 0.5
RailMetric.cSafegeOpenTopWidth        = 0.6;
RailMetric.cHalfSafegeOpenTopWidth    = RailMetric.cSafegeOpenTopWidth * 0.5;
RailMetric.cSafegeOpenBottomWidth     = 1.0;
RailMetric.cHalfSafegeOpenBottomWidth = RailMetric.cSafegeOpenBottomWidth * 0.5;
RailMetric.cSafegeSingleSideWidth     =
    (RailMetric.cSafegeWidth - RailMetric.cSafegeOpenTopWidth) / 2;
RailMetric.cSafegeSwitchWidth         =
    RailMetric.cSafegeWidth - RailMetric.cSafegeSingleSideWidth;
RailMetric.cHalfSafegeBorderWidth     =
    (RailMetric.cSafegeWidth + RailMetric.cSafegeInnerWidth) / 4;
RailMetric.cSafegeBottomHeight        = 0.3;
RailMetric.cSafegeMiddleHeight        = 1.0;
RailMetric.cSafegeBorderHeight        = 1.8;
RailMetric.cSafegeTopHeight           = 2.5;
RailMetric.cSafegeFloorHeight         = 0.5;
RailMetric.cSafegeCeilHeight          = 2.3;
RailMetric.cSafegeTongueCrossFactor   = 5;
RailMetric.cSafegeTongueCrossFactor2  = 3.5;
RailMetric.cSafegePartsOffsetY        = -4.0;
RailMetric.cAlwegWidth              = 0.85;
RailMetric.cHalfAlwegWidth          = RailMetric.cAlwegWidth * 0.5;
RailMetric.cAlwegMiddleWidth        = 0.55;
RailMetric.cHalfAlwegMiddleWidth    = RailMetric.cAlwegMiddleWidth * 0.5;
RailMetric.cAlwegBottomHeight       = -1.0;
RailMetric.cAlwegMiddleBottomHeight = -0.5;
RailMetric.cAlwegLowMiddleHeight    = -0.35;
RailMetric.cAlwegHighMiddleHeight   = 0.05;
RailMetric.cAlwegMiddleTopHeight    = 0.2;
RailMetric.cAlwegTopHeight          = 0.5;
RailMetric.cAlwegSwitchWidth        = 3;
RailMetric.cAlwegGirderOffsetY      = -1.5;
RailMetric.cGirderWidth      = 4.0;
RailMetric.cHalfGirderWidth  = RailMetric.cGirderWidth * 0.5;
RailMetric.cGirderHeight     = 1.5;
RailMetric.cHalfGirderHeight = RailMetric.cGirderHeight * 0.5;
RailMetric.cTunnelWidth      = 6.0;
RailMetric.cHalfTunnelWidth  = RailMetric.cTunnelWidth * 0.5;
RailMetric.cTunnelHeight     = 6.0;
RailMetric.cTunnelBottom     = 0.01;
RailMetric.cPierWidth      = 2.0;
RailMetric.cHalfPierWidth  = RailMetric.cPierWidth * 0.5;
RailMetric.cPierBeamHeight = 1.0;
RailMetric.cHalfPierBeamHeight = RailMetric.cPierBeamHeight * 0.5;
RailMetric.cPierSideOffset = 4.0;
RailMetric.cHalfPierBeamWidth = RailMetric.cPierSideOffset + RailMetric.cHalfPierWidth;
RailMetric.cPierIntervalDefault = 10.0;
RailMetric.cTotalHeight = RailMetric.cHeight + RailMetric.cBallastHeight;
function AddRailTotalHeight(pos, up) {
    return v3.add(v3.Muls(up ? up : v3.ey, RailMetric.cTotalHeight), pos);
}
var ControlPoint = CreateIDMgr();
ControlPoint.sID = 0;
ControlPoint.create = function(pos)
{
    var point = CreateInstance();
    point.mID = ControlPoint.addID();
    point.mPos = v3.Dup(pos);
    point.mRails = [null, null];
    point.mSwitchFrom = -1;
    return point;
};
ControlPoint.setDir = function(point, dir, up)
{
    point.mDir = v3.Dup(dir);
    point.mUp = v3.Dup(up ? up : v3.ey);
    point.mLeft = v3.normalize(v3.Cross(point.mUp, point.mDir));
    v3.normalize(v3.setCross(point.mUp, point.mDir, point.mLeft));
};
ControlPoint.setRail = function(point, point_side, rail)
{
    point.mRails[point_side] = rail;
};
ControlPoint.onDeleteRail = function(point, rail)
{
    for (var i = 0; i < point.mRails.length; ++i) {
        if (point.mRails[i] == rail) {
            point.mRails[i] = null;
        }
    }
};
ControlPoint.checkSide = function(point, rail)
{
    if (point.mRails[0] == rail) { return 0; }
    if (point.mRails[1] == rail) { return 1; }
    return -1;
};
ControlPoint.forEach = function(f, a_this)
{
    Rail.forEach(function(rail) {
        var impl = function(points) {
            for (var i = 0; i < points.length; ++i) {
                var point = points[i];
                if (!point) { continue; }
                var side = ControlPoint.checkSide(point, rail);
                if (side >= 0) {
                    if (side == 0 || !point.mRails[side ? 0 : 1]) {
                        f.apply(a_this, [point]);
                    }
                }
            }
        };
        impl(rail.mPoints);
        impl(rail.mSwitchPoints);
    }, a_this);
};
var Rail = CreateObjMgr();
Rail.onClear = function()
{
    Rail.sSwitchRails = [];
    Rail.sHiddenRails = [];
    Rail.sSignalBlocks = {};
};
Rail.onClear();
Rail.cRailOptions = [
    // Rail
    { m : 'CurveFactor' , s : 'curve_factor'  , },
    { m : 'RailFlag'    , s : 'rail_flag'     , },
    { m : 'RailType'    , s : 'rail_type'     , },
    { m : 'TieFlag'     , s : 'tie_flag'      , },
    { m : 'TieType'     , s : 'tie_type'      , },
    { m : 'GirderFlag'  , s : 'girder_flag'   , },
    { m : 'GirderType'  , s : 'girder_type'   , },
    { m : 'PierFlag'    , s : 'pier_flag'     , },
    { m : 'PierType'    , s : 'pier_type'     , },
    { m : 'PierInterval', s : 'pier_interval' , },
    { m : 'PierOffset'  , s : 'pier_offset'   , },
    { m : 'LeftPart'    , s : 'left_part'     , },
    { m : 'RightPart'   , s : 'right_part'    , },
    // Schedule
    { m : 'SignalName'  , s : 'signal'        , },
];
Rail.createData = function(rail)
{
    rail.mSegments = [[[], []], [[], []]];
    rail.mCurveLength = [[0, 0], [0, 0]];
    rail.mTrainInfo = [];
    rail.mStopTime = 0;
};
Rail.create = function(point0, point_side0, point1, point_side1)
{
    //Log('Rail.create(' + point0.mID + '[' + point_side0
    //    + '], ' + point1.mID + '[' + point_side1 + '])');
    var rail = Rail.createObj()
    this.createData(rail);
    rail.mPoints = [point0, point1];
    rail.mSwitchPoints = [null, null];
    rail.mSwitchInfos = [null, null];
    rail.mStationInfo = [];
    rail.mAlternateSwitchState = [0, 0];
    rail.mSignalName = '';
    this.cRailOptions.forEach(name =>
        rail['m' +  name.m] = RailBuilder['get' + name.m]());
    rail.mRailCounter          = -1;
    rail.mRailTieCounter       = -1;
    rail.mRailGirderCounter    = -1;
    rail.mRailLeftPartCounter  = -1;
    rail.mRailRightPartCounter = -1;
    rail.mRailLeftTnlCounter   = -1;
    rail.mRailRightTnlCounter  = -1;
    Rail.connect(rail, point0, point_side0, point1, point_side1);
    return rail;
};
Rail.pushTrain = function(rail, train)
{
    for (var i = 0; i < rail.mTrainInfo.length; ++i) {
        var info = rail.mTrainInfo[i];
        if (info.train != train) { return null; }
    }
    var sig_block = null;
    if (rail.mSignalName) {
        sig_block = this.sSignalBlocks[rail.mSignalName];
        if (sig_block) {
            for (var i = 0; i < sig_block.length; ++i) {
                var info = sig_block[i];
                if (info.train != train) { return null; }
            }
        } else {
            sig_block = this.sSignalBlocks[rail.mSignalName] = [];
        }
    }
    var info = { rail : rail, train : train, sig_block : sig_block, };
    rail.mTrainInfo.push(info);
    if (sig_block) { sig_block.push(info); }
    return info;
};
Rail.eraseTrainInfo = function(train_info)
{
    var rail = train_info.rail;
    if (train_info.sig_block) {
        for (var i = 0; i < train_info.sig_block.length; ++i) {
            var info = train_info.sig_block[i];
            if (info == train_info) {
                train_info.sig_block.splice(i, 1);
                break;
            }
        }
    }
    for (var i = 0; i < rail.mTrainInfo.length; ++i) {
        var info = rail.mTrainInfo[i];
        if (info == train_info) {
            rail.mTrainInfo.splice(i, 1);
            if (rail.mTrainInfo.length == 0) {
                rail.mStopTime = 0;
            }
            return;
        }
    }
};
Rail.onDeleteRail = function(rail, del_rail)
{
    for (var i = 0; i < rail.mPoints.length; ++i) {
        ControlPoint.onDeleteRail(rail.mPoints[i], del_rail);
        var spoint = rail.mSwitchPoints[i];
        if (spoint) { ControlPoint.onDeleteRail(spoint, del_rail); }
    }
};
Rail.checkEnd = function(rail, point)
{
    if (rail.mPoints[0] == point) { return 0; }
    if (rail.mPoints[1] == point) { return 1; }
    var sp0 = rail.mSwitchPoints[0], sp1 = rail.mSwitchPoints[1];
    if (sp0 && sp0 == point) { return 0; }
    if (sp1 && sp1 == point) { return 1; }
    return -1;
};
Rail.getConnection = function(rail, side, sw)
{
    var point = Rail.getPoint(rail, side, sw);
    var next_point_side = 1 - ControlPoint.checkSide(point, rail);
    return {
        point : point,
        point_side : next_point_side,
        rail : point.mRails[next_point_side],
    };
};
Rail.getPoint = function(rail, side, sw)
{
    return sw ? rail.mSwitchPoints[side] : rail.mPoints[side];
};
Rail.getPointAtt = function(rail, side)
{
    var point = rail.mPoints[side];
    var point_side = ControlPoint.checkSide(point, rail);
    var ret = {
        pos  : point.mPos ,
        up   : point.mUp  ,
        dir  : point.mDir ,
        left : point.mLeft,
    };
    if ((side ^ point_side) == 0) {
        ret.dir  = v3.Neg(ret.dir );
        ret.left = v3.Neg(ret.left);
    }
    return ret;
};
Rail.CalcCurve = function(seg0, seg1, func, args)
{
    if (!args || args.curve_factor === undefined) { debugger; }
    var pos0 = v3.Dup(seg0.pos), dir0 = v3.Dup(seg0.dir), up0 = v3.Dup(seg0.up);
    var pos1 = v3.Dup(seg1.pos), dir1 = v3.Dup(seg1.dir), up1 = v3.Dup(seg1.up);
    var flat_left0 = v3.normalize(v3.Cross(v3.ey, dir0)), flat_up0 = v3.Cross(dir0, flat_left0);
    var flat_left1 = v3.normalize(v3.Cross(v3.ey, dir1)), flat_up1 = v3.Cross(dir1, flat_left1);
    var cant_ratio0 = v3.Dot(flat_left0, up0) / v3.Dot(flat_up0, up0);
    var cant_ratio1 = v3.Dot(flat_left1, up1) / v3.Dot(flat_up1, up1);
    var diff_pp = v3.normalize(v3.Sub(pos1, pos0));
    var mid_factor = (1 + args.curve_factor) - v3.Dot(dir0, dir1) * args.curve_factor;
    var mid_factor0 = mid_factor + Math.max(0, -v3.Dot(dir0, diff_pp)) * 5;
    var mid_factor1 = mid_factor + Math.max(0, -v3.Dot(dir1, diff_pp)) * 5;
    var len = v3.CalcDist(pos0, pos1);
    var m0 = v3.Muls(dir0, len * (mid_factor0 * 0.25 + mid_factor1 * 0.75));
    var m1 = v3.Muls(dir1, len * (mid_factor0 * 0.75 + mid_factor1 * 0.25));
    if (args && args.out_m) { args.out_m[0] = m0; args.out_m[1] = m1; }
    function calc_curve(t) {
        var t2 = t * t, t3 = t2 * t;
        var h00 =  2 * t3 - 3 * t2     + 1;
        var h10 =      t3 - 2 * t2 + t    ;
        var h01 = -2 * t3 + 3 * t2        ;
        var h11 =      t3 -     t2        ;
        var out_pos = v3.Muls(pos0, h00);
        v3.add(out_pos, v3.Muls(m0  , h10));
        v3.add(out_pos, v3.Muls(pos1, h01));
        v3.add(out_pos, v3.Muls(m1  , h11));
        var h20 =  6 * t2 - 6 * t    ;
        var h30 =  3 * t2 - 4 * t + 1;
        var h21 = -6 * t2 + 6 * t    ;
        var h31 =  3 * t2 - 2 * t    ;
        var out_dir = v3.Muls(pos0, h20);
        v3.add(out_dir, v3.Muls(m0  , h30));
        v3.add(out_dir, v3.Muls(pos1, h21));
        v3.add(out_dir, v3.Muls(m1  , h31));
        v3.normalize(out_dir);
        var flat_left = v3.normalize(v3.Cross(v3.ey, out_dir));
        var out_fup = v3.Cross(out_dir, flat_left);
        var tmp_up = v3.add(v3.Muls(flat_left, cant_ratio0 * (1 - t) + cant_ratio1 * t), out_fup);
        var out_up = v3.normalize(v3.Cross(out_dir, v3.Cross(tmp_up, out_dir)));
        return { pos : out_pos, dir : out_dir, up : out_up, fup : out_fup, ratio : t, };
    }
    var cMinDiv = 0.1, cPosAccuracy = 0.025, cDirAccuracy = 0.2, cUpAccuracy = 0.1;
    var max_div = args && args.max_div;
    var rseg0 = { pos : pos0, dir : dir0, up : up0, fup : flat_up0, ratio : 0, };
    var rseg1 = { pos : pos1, dir : dir1, up : up1, fup : flat_up1, ratio : 1, };
    var splitters = args && args.splitters, i_splitter = 0;
    var splitter = splitters && splitters[i_splitter];
    var min_seg = rseg0; min_seg.acc_len = 0;
    function solve(max_seg) {
        var mid_pos = v3.Mid(min_seg.pos, max_seg.pos);
        var mid_dir = v3.Sub(max_seg.pos, min_seg.pos);
        var mid_seg = calc_curve((min_seg.ratio + max_seg.ratio) * 0.5);
        len = v3.Length(mid_dir); v3.divs(mid_dir, len);
        if (len < cMinDiv || (!max_div || len <= max_div) &&
            (v3.CalcDist(mid_pos, mid_seg.pos) < cPosAccuracy &&
             v3.CalcDist(mid_dir, mid_seg.dir) * len < cDirAccuracy
             && v3.CalcDist(min_seg.up, max_seg.up) < cUpAccuracy)) {
            max_seg.acc_len = min_seg.acc_len + len;
            var spl_seg0 = min_seg;
            while (splitter && splitter < max_seg.acc_len) {
                if (min_seg.acc_len < splitter) {
                    var spl_seg1 = calc_curve(
                        (min_seg.ratio * (max_seg.acc_len - splitter) +
                         max_seg.ratio * (splitter - min_seg.acc_len)) / len);
                    spl_seg1.acc_len = splitter;
                    if (func(spl_seg0, spl_seg1)) { return true; }
                    spl_seg0 = spl_seg1;
                }
                splitter = splitters && splitters[++i_splitter];
            }
            if (func(spl_seg0, max_seg)) { return true; }
            min_seg = max_seg;
        } else {
            if (solve(mid_seg)) { return true; }
            if (solve(max_seg)) { return true; }
        }
        return false;
    }
    return solve(rseg1);
};
Rail.CalcCurveWithPoints = function(rail, point0, point1, func, args)
{
    var seg0 = { pos : point0.mPos, dir : v3.Dup(point0.mDir), up : v3.Dup(point0.mUp), };
    var seg1 = { pos : point1.mPos, dir : v3.Dup(point1.mDir), up : v3.Dup(point1.mUp), };
    if (ControlPoint.checkSide(point0, rail) == 0) { v3.neg(seg0.dir); }
    if (ControlPoint.checkSide(point1, rail) == 1) { v3.neg(seg1.dir); }
    Rail.CalcCurve(seg0, seg1, func, args);
};
Rail.CalcCurveWithPoints2 = function(
    rail, point0, tpoint0, side0, point1, tpoint1, side1, func, args)
{
    var seg0 = { pos : tpoint0.mPos, dir : v3.Dup(tpoint0.mDir), up : v3.Dup(tpoint0.mUp), };
    var seg1 = { pos : tpoint1.mPos, dir : v3.Dup(tpoint1.mDir), up : v3.Dup(tpoint1.mUp), };
    if (ControlPoint.checkSide(point0, rail) == side0) { v3.neg(seg0.dir); }
    if (ControlPoint.checkSide(point1, rail) == side1) { v3.neg(seg1.dir); }
    Rail.CalcCurve(seg0, seg1, func, args);
};
Rail.calcCurve = function(rail, sw0, sw1, func, args)
{
    if (!args) { args = { curve_factor : rail.mCurveFactor, }; }
    var point0 = sw0 ? rail.mSwitchPoints[0] : rail.mPoints[0];
    var point1 = sw1 ? rail.mSwitchPoints[1] : rail.mPoints[1];
    Rail.CalcCurveWithPoints(rail, point0, point1, func, args);
};
Rail.bakeCurve = function(rail, sw0, tpoint0, sw1, tpoint1, args)
{
    var segments = [];
    rail.mSegments[sw0][sw1] = segments;
    var seg_id = 0, acc_len_ofs = 0, bake_acc_len = 0;
    function bake_segment(seg0, seg1) {
        function push_segment(s, is_first) {
            var seg = {
                pos : s.pos,
                dir : s.dir,
                up : s.up,
                acc_len : s.acc_len + acc_len_ofs,
            };
            segments.push(seg);
            bake_acc_len = s.acc_len;
        }
        if (seg_id++ == 0) {
            push_segment(seg0, true);
        }
        push_segment(seg1, false);
    }
    var splitters = args.splitters; args.splitters = undefined;
    var point0 = sw0 ? rail.mSwitchPoints[0] : rail.mPoints[0];
    var point1 = sw1 ? rail.mSwitchPoints[1] : rail.mPoints[1];
    if (!v3.IsEqual(point0.mPos, tpoint0.mPos)) {
        Rail.CalcCurveWithPoints2(
            rail, point0, point0, 0, point0, tpoint0, 0, bake_segment, args);
        acc_len_ofs = bake_acc_len;
    }
    Rail.CalcCurveWithPoints2(rail, point0, tpoint0, 0, point1, tpoint1, 1, bake_segment, args);
    acc_len_ofs += bake_acc_len;
    if (!v3.IsEqual(point1.mPos, tpoint1.mPos)) {
        Rail.CalcCurveWithPoints2(
            rail, point1, tpoint1, 1, point1, point1, 1, bake_segment, args);
        acc_len_ofs += bake_acc_len;
    }
    rail.mCurveLength[sw0][sw1] = acc_len_ofs;
    segments.forEach(seg => seg.len_ratio = seg.acc_len / acc_len_ofs);
    args.splitters = splitters;
};
Rail.traverseCurve = function(rail, func, is_reverse, ignore_switch)
{
    var sw0 = 0, sw1 = 0;
    if (rail.mDrawBlock && !ignore_switch) {
        sw0 = rail.mDrawBlock.mSwitchState[1];
        sw1 = rail.mDrawBlock.mSwitchState[0];
    }
    var segments = rail.mSegments[sw0][sw1], curve_len = rail.mCurveLength[sw0][sw1];
    var seg_num = segments.length;
    if (is_reverse) {
        for (var i = seg_num - 1; i > 0; --i) {
            if (func(segments[i - 1], segments[i], curve_len)) {
                return true;
            }
        }
    } else {
        for (var i = 1; i < seg_num; ++i) {
            if (func(segments[i - 1], segments[i], curve_len)) {
                return true;
            }
        }
    }
    return false;
};
Rail.setHighlightImpl = function(rail, fname)
{
    var drawer_set = rail ? this.getDrawerSet(rail) : null;
    function set_drawer_counter(drawer, ref_drawer, cnt) {
        drawer[fname](drawer_set && drawer_set[ref_drawer] == drawer ? rail[cnt] : 0);
    }
    set_drawer_counter(g_rail_drawer         , 'rail'  , 'mRailCounter'      );
    set_drawer_counter(g_rail_switch_drawer  , 'rail'  , 'mRailCounter'      );
    set_drawer_counter(g_safege_drawer       , 'rail'  , 'mRailCounter'      );
    set_drawer_counter(g_safege_switch_drawer, 'rail'  , 'mRailCounter'      );
    set_drawer_counter(g_alweg_drawer        , 'rail'  , 'mRailCounter'      );
    set_drawer_counter(g_alweg_switch_drawer , 'rail'  , 'mRailCounter'      );
    set_drawer_counter(g_rail_ballast_drawer , 'tie'   , 'mRailTieCounter'   );
    set_drawer_counter(g_rail_slab_drawer    , 'tie'   , 'mRailTieCounter'   );
    set_drawer_counter(g_rail_girder_drawer  , 'girder', 'mRailGirderCounter');
    set_drawer_counter(g_rail_tunnel_drawer  , 'girder', 'mRailGirderCounter');
    function set_part_counter(i, pname, cname, tcname) {
        var part = rail ? rail[pname] : null;
        function is_part_type(t) { return part && part.flag && part.type == t; }
        g_rail_platform_drawer[i][fname](is_part_type('plt'  ) ? rail[cname] : 0);
        g_rail_wall_drawer    [i][fname](is_part_type('wall' ) ? rail[cname] : 0);
        g_rail_floor_drawer   [i][fname](is_part_type('floor') ? rail[cname] : 0);
        g_rail_plt_tnl_drawer [i][fname](rail ? rail[tcname] : 0);
    }
    set_part_counter(0, 'mLeftPart' , 'mRailLeftPartCounter' , 'mRailLeftTnlCounter' );
    set_part_counter(1, 'mRightPart', 'mRailRightPartCounter', 'mRailRightTnlCounter');
}
Rail.setHighlight = function(rail)
{
    this.setHighlightImpl(rail, 'setHighlight');
};
Rail.setSelected = function(rail)
{
    this.setHighlightImpl(rail, 'setSelected');
};
Rail.calcSwitch = function(rail)
{
    var cSwitchSpeed = 0.05, block = rail.mDrawBlock;
    for (var i = 0; i < 2; ++i) {
        if (rail.mSwitchPoints[1 - i]||1) {
            var sw = block.mSwitchState[i];
            var anim = block.mSwitchAnim[i];
            if (sw) { anim = Math.max(-1, anim - cSwitchSpeed); }
            else    { anim = Math.min( 1, anim + cSwitchSpeed); }
            block.mSwitchAnim[i] = anim;
        }
    }
};
Rail.getDrawerSet = function(rail)
{
    var ret = {};
    if (rail.mRailFlag) {
        if (rail.mSwitchPoints[0] || rail.mSwitchPoints[1]) {
            ret.rail = rail.mRailType == 'safege' ? g_safege_switch_drawer
                : rail.mRailType == 'alweg' ? g_alweg_switch_drawer : g_rail_switch_drawer;
        } else {
            ret.rail = rail.mRailType == 'safege' ? g_safege_drawer
                : rail.mRailType == 'alweg' ? g_alweg_drawer : g_rail_drawer;
        }
    }
    if (rail.mTieFlag && (rail.mRailType == 'narrow' || rail.mRailType == 'standard')) {
        ret.tie = rail.mTieType == 'slab' ? g_rail_slab_drawer : g_rail_ballast_drawer;
    }
    if (rail.mGirderFlag) {
        ret.girder = rail.mGirderType == 'tunnel' ? g_rail_tunnel_drawer : g_rail_girder_drawer;
    }
    return ret;
};
Rail.write = function(rail)
{
    var drawer_set = Rail.getDrawerSet(rail);
    var parts_data = [{ i : 0, part : rail.mLeftPart, }, { i : 1, part : rail.mRightPart, }];
    parts_data.forEach(function(data) {
        var drawer_pair = !data.part.flag ? null
            : data.part.type == 'plt'   ? g_rail_platform_drawer
            : data.part.type == 'wall'  ? g_rail_wall_drawer
            : data.part.type == 'floor' ? g_rail_floor_drawer : null;
        if (drawer_pair) {
            data.drawer = drawer_pair[data.i];
            data.sign = 1 - data.i * 2;
            if (drawer_set.girder == g_rail_tunnel_drawer) {
                data.tnl_drawer = g_rail_plt_tnl_drawer[data.i];
                parts_data.push({ i : data.i, part : data.part, sign : data.sign,
                                  drawer : data.tnl_drawer, });
            }
        }
    });
    var pier_drawer = rail.mPierFlag ? g_rail_pier_drawer : null;
    var pier_interval = Math.max(RailMetric.cPierWidth * 0.5, rail.mPierInterval);
    var eps = 0.001, tongue_ratio = 0.4;
    var seg_id = 0, acc_len = 0, pier_acc_len = -1;
    function calc_length(seg0, seg1) {
        acc_len += v3.CalcDist(seg0.pos, seg1.pos);
    }
    var is_shift0 = 0, is_shift1 = 0, is_main = false;
    var frog_thres0 = 0, frog_thres1 = 0;
    var gap_pos0 = null, gap_pos1 = null, curve_end_pos = null;
    var cross_len0 = null, cross_len1 = null, cross_type = 0;
    var d_pivot_len0 = null, d_pivot_len1 = null, d_pivot_range = null;
    var d_pivot_pos = null, d_pivot_dir = null;
    var curve_len, curve_tie_num, ballast_tex_v_factor, is_switch;
    var is_curve_left = true, is_curve_right = true;
    var is_switch_from0 = null, is_switch_from1 = null;
    var base_points = [], switch_points = [], is_switch_rail, is_double_slip, is_same_side;
    var is_mono = rail.mRailType == 'safege' || rail.mRailType == 'alweg';
    var is_safege = rail.mRailType == 'safege';
    var is_alweg = rail.mRailType == 'alweg';
    var gauge_type = rail.mRailType == 'standard'
        ? RailGaugeType.cStandard : RailGaugeType.cNarrow;
    var gauge_ofs = gauge_type ? RailMetric.cHalfGaugeStd - RailMetric.cHalfGauge : 0;
    var ballast_switch_ofs = RailMetric.cBallastSwitchOffset + gauge_ofs * 2;
    function set_curve_len(acc_len) {
        curve_len = acc_len;
        curve_tie_num = RailMetric.calcTieNum(acc_len);
        ballast_tex_v_factor = curve_tie_num / acc_len;
    }
    function draw_segment(seg0, seg1) {
        var tongue_thres = acc_len * tongue_ratio;
        var mid_len = acc_len * 0.5, cBallastOffsetLen = 5;
        function push_segment(s, is_first) {
            function calc_dseg(pivot_len) {
                var spos = s.pos, sdir = s.dir;
                if (pivot_len) {
                    var r = smoothstep(0, 1, 1 - Math.abs(
                        s.acc_len - pivot_len) / d_pivot_range);
                    spos = v3.Lerp(spos, d_pivot_pos, r);
                    sdir = v3.Lerp(sdir, d_pivot_dir, r);
                }
                var left = v3.normalize(v3.Cross(s.up, sdir));
                var fleft = v3.normalize(v3.Cross(s.fup, sdir));
                return { pos : spos, left : left, up : s.up, fleft : fleft, fup : s.fup,
                         ballast_v : s.acc_len * ballast_tex_v_factor, };
            }
            var is_last = v3.IsEqual(s.pos, curve_end_pos);
            var args = { gauge : gauge_type, };
            var dseg = calc_dseg(null);
            //var dseg = calc_dseg(d_pivot_len1);
            if (!is_switch) {
                if (s.ballast_offset) {
                    args.ballast_ofs = [0, 0];
                    args.ballast_ofs[s.ballast_offset < 0 ? 0 : 1] = s.ballast_offset;
                } else if (switch_points[0] || switch_points[1]) {
                    var bofs1 = s.acc_len / acc_len, bofs0 = 1 - bofs1;
                    bofs0 *= bofs0; bofs1 *= bofs1;
                    args.ballast_ofs = [0, 0];
                    if (switch_points[0]) {
                        args.ballast_ofs[switch_points[0].mIsLeft < 0 ? 0 : 1] +=
                            bofs0 * switch_points[0].mIsLeft * (
                                ballast_switch_ofs * switch_points[0].mBallastOffsetScale
                                    - RailMetric.cBallastSwitchOffsetSub);
                    }
                    if (switch_points[1]) {
                        args.ballast_ofs[switch_points[1].mIsLeft > 0 ? 0 : 1] -=
                            bofs1 * switch_points[1].mIsLeft * (
                                ballast_switch_ofs * switch_points[1].mBallastOffsetScale
                                    - RailMetric.cBallastSwitchOffsetSub);
                    }
                }
                var old_pos = null;
                if (is_switch_from0 || is_switch_from1) {
                    old_pos = dseg.pos;
                    dseg.pos = v3.Sub(dseg.pos, v3.Muls(
                        dseg.up, Math.max(
                            is_switch_from0 ? 1 - Math.min(
                                1, s.acc_len / cBallastOffsetLen) : 0,
                            is_switch_from1 ? 1 - Math.min(
                                1, (acc_len - s.acc_len) / cBallastOffsetLen) : 0) * 0.01));
                }
                if (rail.mTieType == 'slab') { args.is_tie_switch = is_switch_rail; }
                if (drawer_set.tie) {
                    drawer_set.tie.pushSegment(dseg, args, is_first, is_last);
                }
                if (is_safege) { args.girder_ofs_y = RailMetric.cSafegePartsOffsetY; }
                else if (is_alweg) {
                    args.girder_ofs_y = RailMetric.cAlwegGirderOffsetY;
                    args.girder_ofs_y2 = -RailMetric.cAlwegGirderOffsetY;
                }
                if (drawer_set.girder) {
                    drawer_set.girder.pushSegment(dseg, args, is_first, is_last);
                }
                if (old_pos) { dseg.pos = old_pos; }
            }
            if (is_safege) { args.part_ofs_y = RailMetric.cSafegePartsOffsetY; }
            else if (is_alweg) { args.part_ofs_y = RailMetric.cAlwegBottomHeight; }
            parts_data.forEach(function(data) {
                if (!data.drawer) { return; }
                if (!(data.i ? is_curve_right : is_curve_left)) { return; }
                var metrics = data.part.metrics;
                var m_idx_f = (metrics.length - 1) * s.ratio;
                var m_idx = Math.floor(m_idx_f), m_idx_r = m_idx_f - m_idx;
                function lerp_metric(pname) {
                    var param0 = metrics[m_idx][pname];
                    return m_idx >= metrics.length - 1
                        ? param0 : lerp(param0, metrics[m_idx + 1][pname], m_idx_r);
                }
                args.part_ofs = data.sign * lerp_metric('offset');
                args.part_width = data.sign * lerp_metric('width');
                args.part_height = lerp_metric('height');
                data.drawer.pushSegment(dseg, args, is_first, is_last);
            });
            if (d_pivot_len0) { args.seg_l = calc_dseg(d_pivot_len0); }
            if (d_pivot_len1) { args.seg_r = calc_dseg(d_pivot_len1); }
            var dist0 = tongue_thres - s.acc_len;
            var dist1 = s.acc_len - (acc_len - tongue_thres);
            var dist0f = frog_thres0 - s.acc_len;
            var dist1f = s.acc_len - (acc_len - frog_thres1);
            if (is_shift0 && dist0 > 0 && is_main) {
                args.shift_x = is_shift0 * (dist0 / tongue_thres);
            }
            if (is_shift1 && dist1 > 0 && is_main) {
                args.shift_x = is_shift1 * (dist1 / tongue_thres);
            }
            if (is_safege) {
                var t_sf0 = is_switch_from0;
                var t_sf1 = is_same_side ? !is_switch_from1 : is_switch_from1;
                if (t_sf0 && t_sf1) {
                    args.no_wall0 = t_sf0 ? is_shift0 : 0;
                    args.no_wall1 = t_sf1 ? is_shift1 : 0;
                } else {
                    args.no_wall0 = t_sf0 ? 0 : is_shift0;
                    args.no_wall1 = t_sf1 ? 0 : is_shift1;
                }
                if (switch_points[1]) { args.tongue_ofs0 = 1 - s.acc_len / acc_len; }
                if (switch_points[0]) { args.tongue_ofs1 =     s.acc_len / acc_len; }
                if (t_sf0 && t_sf1) {
                    args.tongue_ex_ofs0 = v3.Muls(
                        rail.mDrawBlock.mTongueOffset0, args.tongue_ofs1
                            * RailMetric.cSafegeTongueCrossFactor2
                            * (is_same_side ? 1 : -1));
                    args.tongue_ex_ofs1 = v3.Muls(
                        rail.mDrawBlock.mTongueOffset1, -args.tongue_ofs0
                            * RailMetric.cSafegeTongueCrossFactor2);
                }
            } else if (is_alweg) {
                if (is_switch_rail) {
                    dseg.ratio = s.ratio;
                }
            } else {
                if (is_shift0 && (is_shift0 * is_shift1 <= 0 && dist1f > 0)
                    && (!is_main || !is_double_slip)) {
                    args.bend_x = is_shift0 * dist1f / frog_thres1;
                }
                if (is_shift1 && (is_shift0 * is_shift1 <= 0 && dist0f > 0)
                    && (!is_main || !is_double_slip)) {
                    args.bend_x = is_shift1 * dist0f / frog_thres0;
                }
                if (args.shift_x) {
                    if (s.acc_len < mid_len) { args.tongue_ofs0 = args.shift_x; }
                    else { args.tongue_ofs1 = args.shift_x; }
                }
            }
            if (cross_len0 && cross_len0 < s.acc_len && s.acc_len < cross_len1) {
                var cross_ratio = s.acc_len <= (gap_pos0 + gap_pos1) * 0.5
                    ? linearstep(cross_len0, gap_pos0, s.acc_len)
                    : linearstep(cross_len1, gap_pos1, s.acc_len);
                if ((s.acc_len <= gap_pos0) ^ !cross_type) {
                    args.shift_x =  cross_ratio;
                    args.bend_x  =  cross_ratio;
                } else {
                    args.shift_x = -cross_ratio;
                    args.bend_x  = -cross_ratio;
                }
                args.is_mid_gap = true;
            }
            if (gap_pos0 && gap_pos0 + eps <= s.acc_len && s.acc_len <= gap_pos1 + eps) {
                args.skip_seg = true;
            }
            if (drawer_set.rail) { drawer_set.rail.pushSegment(dseg, args, is_first, is_last); }
            if (IsEnableDebugDraw()) {
                function calc_side_pos(ds, x) {
                    return AddRailTotalHeight(v3.add(v3.Muls(
                        ds.left, RailMetric.cGauge * x), ds.pos), ds.up);
                }
                g_rail_debug_line_drawer.pushLine(
                    calc_side_pos(args.seg_l ? args.seg_l : dseg,  0.5),
                    calc_side_pos(args.seg_r ? args.seg_r : dseg, -0.5),
                    v4.Make(0, 1, 1, 1));
            }
        }
        if (seg_id++ == 0) {
            push_segment(seg0, true);
        }
        push_segment(seg1, false);
        if (pier_drawer && pier_acc_len >= 0) {
            while (pier_acc_len <= seg1.acc_len) {
                var pratio = (pier_acc_len - seg0.acc_len) / (seg1.acc_len - seg0.acc_len);
                var ppos = v3.Lerp(seg0.pos, seg1.pos, pratio), pier_top = ppos[1];
                var cMinPierTop = 0.1;
                var pier_bottom = FieldEditor.getFieldHeight(ppos);
                if (pier_bottom !== null && pier_top > pier_bottom + cMinPierTop) {
                    var p_ofs_y = 0;
                    if (is_safege) {
                        p_ofs_y = RailMetric.cSafegeTopHeight + RailMetric.cPierBeamHeight;
                    } else if (is_alweg) {
                        p_ofs_y = RailMetric.cAlwegBottomHeight;
                    } else {
                        p_ofs_y = -RailMetric.cHalfGirderHeight;
                    }
                    pier_top += p_ofs_y;
                    var ldir = v3.normalize(v3.Lerp(seg0.dir, seg1.dir, pratio));
                    var pdir = v3.normalize(v3.SetY(ldir, 0));
                    var pleft = v3.Cross(v3.ey, pdir);
                    function draw_pier(x_ofs) {
                        var pos2 = v3.add(v3.Muls(pleft, x_ofs), ppos), field_arg = {};
                        pos2[1] = FieldEditor.getFieldHeight(pos2, field_arg);
                        if (pos2[1] === null || pier_top <= pos2[1] + cMinPierTop) { return; }
                        pos2[1] -= RailMetric.cPierWidth / Math.sqrt(2) *
                            Math.sqrt(1 - square(field_arg.nrm[1]));
                        var pheight = pier_top - pos2[1];
                        pos2[1] += pheight * 0.5;
                        pier_drawer.pushBox(m34.MakeOrtho(
                            pdir, v3.ey, pos2, v3.Make(
                                RailMetric.cPierWidth, pheight, RailMetric.cPierWidth)),
                                            v4.Make(.7, .7, .7, 1));
                    }
                    function draw_beam(x0, x1) {
                        var bup = v3.normalize(v3.Cross(ldir, v3.Cross(v3.ey, ldir)));
                        pier_drawer.pushBox(m34.MakeOrtho(
                            ldir, bup,
                            v3.add(v3.SetY(ppos, pier_top + p_ofs_y * (1 / bup[1] - 1)),
                                   v3.Muls(pleft, (x0 + x1) * 0.5)),
                            v3.Make(Math.abs(x0 - x1),
                                    RailMetric.cPierBeamHeight, RailMetric.cPierWidth)),
                                            v4.Make(.7, .7, .7, 1));
                    }
                    if (rail.mPierType == 'center' &&
                        (Math.abs(ldir[1]) < 0.01 || drawer_set.girder)) {
                        draw_pier(0);
                    } else {
                        pier_top -= RailMetric.cHalfPierBeamHeight;
                        if (rail.mPierType == 'left') {
                            draw_pier(RailMetric.cPierSideOffset);
                            draw_beam(RailMetric.cHalfPierBeamWidth, -RailMetric.cHalfPierWidth);
                        } else if (rail.mPierType == 'right') {
                            draw_pier(-RailMetric.cPierSideOffset);
                            draw_beam(RailMetric.cHalfPierWidth, -RailMetric.cHalfPierBeamWidth);
                        } else if (rail.mPierType == 'both') {
                            draw_pier(RailMetric.cPierSideOffset);
                            draw_pier(-RailMetric.cPierSideOffset);
                            draw_beam(RailMetric.cHalfPierBeamWidth,
                                      -RailMetric.cHalfPierBeamWidth);
                        } else {
                            draw_pier(0);
                            draw_beam(RailMetric.cHalfPierWidth, -RailMetric.cHalfPierWidth);
                        }
                    }
                }
                pier_acc_len += pier_interval;
            }
        }
    }
    var point_att0 = Rail.getPointAtt(rail, 0);
    var point_att1 = Rail.getPointAtt(rail, 1);
    is_switch_rail = rail.mSwitchPoints[0] || rail.mSwitchPoints[1];
    is_double_slip = rail.mSwitchPoints[0] && rail.mSwitchPoints[1];
    var switch_lr = [0, 0];
    function copy_point(src, other, a_sign) {
        if (!src) { return null; }
        var a_side = a_sign > 0 ? 0 : 1;
        var ret = {
            mPos : src.mPos,
            mDir : src.mDir,
            mUp : src.mUp,
            mRails : src.mRails,
            mSwitchFrom : src.mSwitchFrom,
        };
        if (!other) { return ret; }
        var sign = ControlPoint.checkSide(src, rail) ? 1 : -1;
        var perp = v3.Muls(v3.Cross(v3.ey, src.mDir), sign);
        var left_dot = v3.Dot(perp, v3.normalize(
            v3.Sub(other.mPos, src.mPos)));
        var is_left = left_dot < 0 ? 1 : -1;
        var dir_dot = v3.Dot(src.mDir, other.mDir);
        if (src.mSwitchFrom >= 0) { switch_lr[a_side] = is_left; }
        ret.mIsLeft = is_left;
        ret.mBallastOffsetScale = 1 / Math.abs(dir_dot);
        if (is_double_slip && !is_mono) {
            function make_seg(l) {
                return {
                    pos : v3.Add(src.mPos, v3.Muls(ret.mDir, l)),
                    dir : ret.mDir, up : v3.Dup(src.mUp),
                    fup : v3.normalize(v3.Cross(ret.mDir, v3.Cross(v3.ey, ret.mDir))),
                    acc_len : 0,
                };
            }
            const appr_ofs = 0.75, appr_ofs1 = (appr_ofs + 2) / 3;
            var dir_sin = Math.sqrt(1 - dir_dot * dir_dot);
            acc_len = RailMetric.cWidth * 6 / dir_sin;
            var l1 = acc_len / 3, l2 = l1 * 2, l3 = acc_len;
            var seg0 = make_seg(0);
            var seg1 = make_seg(sign * l1);
            var seg2 = make_seg(sign * l3);
            seg_id = 0;
            if (src.mSwitchFrom < 0) {
                seg0.ballast_offset = -is_left * sign
                    * (ballast_switch_ofs * ret.mBallastOffsetScale
                       - RailMetric.cBallastSwitchOffsetSub);
                seg1.ballast_offset = -is_left * sign
                    * (ballast_switch_ofs * ret.mBallastOffsetScale * appr_ofs1
                       - RailMetric.cBallastSwitchOffsetSub);
                seg2.ballast_offset = -is_left * sign
                    * (ballast_switch_ofs * ret.mBallastOffsetScale * appr_ofs
                       - RailMetric.cBallastSwitchOffsetSub);
            }
            function draw_approach(s0, s1, s2) {
                set_curve_len(l3);
                is_switch = src.mSwitchFrom >= 0;
                curve_end_pos = s2.pos;
                draw_segment(s0, s1);
                draw_segment(s1, s2);
            }
            seg0.ratio = seg1.ratio = seg2.ratio = a_side;
            is_curve_left = !(is_curve_right = (is_left < 0) ^ a_side);
            if (sign > 0) {
                is_shift0 = 0; is_shift1 = is_left;
                frog_thres0 = l1;
                seg1.acc_len = l1;
                seg2.acc_len = l3;
                draw_approach(seg0, seg1, seg2);
            } else {
                is_shift1 = 0; is_shift0 = -is_left;
                frog_thres1 = l1;
                seg1.acc_len = l2;
                seg0.acc_len = l3;
                seg0.ratio = seg1.ratio = seg2.ratio = 1;
                draw_approach(seg2, seg1, seg0);
            }
            ret.mPos = v3.Add(ret.mPos, v3.Muls(ret.mDir, sign * l3));
            ret.mBallastOffsetScale *= appr_ofs;
        }
        return ret;
    }
    var switch_state = null, switch_anim = null;
    if (rail.mDrawBlock) {
        switch_state = rail.mDrawBlock.mSwitchState;
        switch_anim = rail.mDrawBlock.mSwitchAnim;
    }
    rail.mDrawBlock = null;
    if (is_switch_rail) {
        if (drawer_set.rail) {
            rail.mDrawBlock = drawer_set.rail.pushDrawBlock();
        } else {
            rail.mDrawBlock = { mSwitchState : [0, 0], };
        }
        if (switch_state) { rail.mDrawBlock.mSwitchState = switch_state; }
        if (switch_anim) { rail.mDrawBlock.mSwitchAnim = switch_anim; }
        Rail.sSwitchRails.push(rail);
    } else {
    }
    if (!rail.mRailFlag && !drawer_set.tie) {
        Rail.sHiddenRails.push(rail);
    }
    rail.mRailCounter = drawer_set.rail ? drawer_set.rail.getRailCounter() : -1;
    rail.mRailTieCounter = drawer_set.tie ? drawer_set.tie.getRailCounter() : -1;
    rail.mRailGirderCounter = drawer_set.girder ? drawer_set.girder.getRailCounter() : -1;
    function get_part_counter(i, cname, tcname) {
        var drawer = parts_data[i].drawer;
        rail[cname ] = drawer ? drawer.getRailCounter() : -1;
        var tdrawer = parts_data[i].tnl_drawer;
        rail[tcname] = tdrawer ? tdrawer.getRailCounter() : -1;
    }
    get_part_counter(0, 'mRailLeftPartCounter' , 'mRailLeftTnlCounter' );
    get_part_counter(1, 'mRailRightPartCounter', 'mRailRightTnlCounter');
    base_points = [
        copy_point(rail.mPoints[0], rail.mSwitchPoints[0],  1),
        copy_point(rail.mPoints[1], rail.mSwitchPoints[1], -1),
    ];
    switch_points = [
        copy_point(rail.mSwitchPoints[0], rail.mPoints[0],  1),
        copy_point(rail.mSwitchPoints[1], rail.mPoints[1], -1),
    ];
    is_main = true;
    if (is_switch_rail) {
        var cTongueOffset = RailMetric.cWidth;
        // @todo: calc for single slip
        function calc_ofs(tg_sp, tg_bp, tg_rp, ofs) {
            if (!tg_sp) { return v3.Makes(0); }
            var ret = v3.Sub(tg_sp.mPos, tg_bp.mPos);
            v3.sub(ret, v3.Muls(tg_rp.mUp , v3.Dot(tg_rp.mUp , ret)));
            v3.sub(ret, v3.Muls(tg_rp.mDir, v3.Dot(tg_rp.mDir, ret)));
            return v3.muls(v3.normalize(ret), ofs);
        }
        if (is_safege) {
            rail.mDrawBlock.mTongueOffset0 = calc_ofs(
                switch_points[1], base_points[1], base_points[0],
                RailMetric.cSafegeSwitchWidth * 0.5);
            rail.mDrawBlock.mTongueOffset1 = calc_ofs(
                switch_points[0], base_points[0], base_points[1],
                RailMetric.cSafegeSwitchWidth * 0.5);
        } else if (is_alweg) {
            function calc_curve_info(cp) {
                return { pos : cp.mPos, dir : cp.mDir, up : cp.mUp, };
            }
            rail.mDrawBlock.mBasePoint0 = calc_curve_info(base_points[0]);
            rail.mDrawBlock.mBasePoint1 = calc_curve_info(base_points[1]);
            rail.mDrawBlock.mSwitchPoint0 = calc_curve_info(
                switch_points[0] || base_points[0]);
            rail.mDrawBlock.mSwitchPoint1 = calc_curve_info(
                switch_points[1] || base_points[1]);
        } else {
            rail.mDrawBlock.mTongueOffset0 = calc_ofs(
                switch_points[1], base_points[1], base_points[0], cTongueOffset);
            rail.mDrawBlock.mTongueOffset1 = calc_ofs(
                switch_points[0], base_points[0], base_points[1], cTongueOffset);
        }
    }
    var args = { curve_factor : rail.mCurveFactor, };
    if (switch_points[0] || switch_points[1]) {
        if (is_alweg) { args.max_div = 4.0; }
        else {
            args.max_div = Math.max(
                v3.CalcDist(base_points[0].mPos, base_points[1].mPos) / 10,
                RailMetric.cGauge);
            if (is_double_slip) { args.max_div *= 0.5; }
        }
    }
    function calc_frog_len(dir0, dir1) {
        var dot = Math.abs(v3.Dot(dir0, dir1));
        var r = Math.sqrt(1 - dot * dot);
        return RailMetric.cWidth * 2 * dot / r;
    }
    var sp0 = switch_points[0], sp1 = switch_points[1];
    if (sp0) {
        is_shift1 = v3.Dot(v3.Sub(sp0.mPos, point_att0.pos), point_att0.left) < 0 ? 1 : -1;
        if (drawer_set.rail && !is_mono) {
            var frog_len = calc_frog_len(point_att0.dir, sp0.mDir);
            var sseg = { pos : point_att0.pos , left : point_att0.left, up : point_att0.up, };
            drawer_set.rail.pushSegment(sseg, { gauge : gauge_type, }, true, false);
            sseg.pos = v3.add(v3.Muls(point_att0.dir, frog_len * 0.5), point_att0.pos);
            drawer_set.rail.pushSegment(sseg, {
                shift_x : is_shift1, bend_x : is_shift1, gauge : gauge_type, }, false, false);
        }
    }
    if (sp1) {
        is_shift0 = v3.Dot(v3.Sub(sp1.mPos, point_att1.pos), point_att1.left) < 0 ? 1 : -1;
        if (drawer_set.rail && !is_mono) {
            var frog_len = calc_frog_len(point_att1.dir, sp1.mDir);
            var tmp_left = v3.Neg(point_att1.left);
            var sseg = { pos : point_att1.pos, left : tmp_left, up : point_att1.up, };
            drawer_set.rail.pushSegment(sseg, { gauge : gauge_type, }, true, false);
            sseg.pos = v3.add(v3.Muls(point_att1.dir, -frog_len * 0.5), point_att1.pos);
            drawer_set.rail.pushSegment(sseg, {
                shift_x : -is_shift0, bend_x : -is_shift0, gauge : gauge_type, }, false, false);
        }
    }
    is_same_side = is_shift0 * is_shift1 > 0;
    var s0 = is_shift0 < 0, s1 = is_shift1 < 0;
    var curve_infos = [];
    function calc_curves(func) {
        for (var i = 0; i <= 3; ++i) {
            var f0 = i & 1, f1 = (i >> 1) & 1;
            var tp0 = f0 ? switch_points[0] : base_points[0];
            var tp1 = f1 ? switch_points[1] : base_points[1];
            if (tp0 && tp1) {
                args.splitters = [];
                d_pivot_len0 = d_pivot_len1 = null;
                func(i, f0, tp0, f1, tp1);
            }
            if (i & 1) { is_shift0 = -is_shift0; }
            is_shift1 = -is_shift1;
        }
    }
    var lr0 = switch_lr[0], lr1 = switch_lr[1];
    calc_curves(function(i, f0, tp0, f1, tp1) {
        acc_len = 0;
        Rail.CalcCurveWithPoints(rail, tp0, tp1, calc_length, args);
        var curve_info = { acc_len : acc_len, };
        curve_infos[i] = curve_info;
        if (!is_double_slip) { return; }
        var mid_len  = acc_len * 0.5;
        var mid_pos  = v3.Makes(0);
        var mid_dir  = v3.Makes(0);
        var mid_left = v3.Makes(0);
        var acc_len2 = 0;
        function calc_mid_dir(seg0, seg1) {
            var delta = v3.CalcDist(seg0.pos, seg1.pos);
            if (mid_len <= acc_len2 + delta) {
                var r = (mid_len - acc_len2) / delta;
                v3.setLerp(mid_pos, seg0.pos, seg1.pos, r);
                v3.setLerp(mid_dir, seg0.dir, seg1.dir, r);
                v3.normalize(v3.setCross(mid_left, v3.ey, mid_dir));
                return true;
            }
            acc_len2 += delta;
        }
        Rail.CalcCurveWithPoints(rail, tp0, tp1, calc_mid_dir, args);
        //Log('mid_pos ['+i+'] = '+v3.ToFixed(mid_pos , 2));
        //Log('mid_dir ['+i+'] = '+v3.ToFixed(mid_dir , 2));
        //Log('mid_left['+i+'] = '+v3.ToFixed(mid_left, 2));
        curve_info.mid_pos  = mid_pos ;
        curve_info.mid_dir  = mid_dir ;
        curve_info.mid_left = mid_left;
    });
    var pivot_pos = null, pivot_dir = null, pivot_left = null;
    var primary_dir = null, secondary_dir = null, pivot_dot = 1;
    var mid_gap = 1.0;
    if (is_double_slip) {
        rail.mDrawBlock.mIsSameSide = is_same_side;
        pivot_pos  = v3.Makes(0);
        pivot_dir  = v3.Makes(0);
        pivot_left = v3.Makes(0);
        for (var i = 0; i <= 3; ++i) {
            var f0 = i & 1, f1 = (i >> 1) & 1;
            if (f0 ^ f1 ^ s0 ^ s1) {
                var curve_info = curve_infos[i];
                v3.add(pivot_pos, curve_info.mid_pos)
                v3.add(pivot_dir, curve_info.mid_dir)
                if (!primary_dir) {
                    primary_dir = curve_info.mid_dir;
                } else {
                    secondary_dir = curve_info.mid_dir;
                }
            }
        }
        v3.muls(pivot_pos, 0.5);
        v3.normalize(pivot_dir, 0.5);
        v3.setCross(pivot_left, v3.ey, pivot_dir);
        pivot_dot = v3.Dot(primary_dir, secondary_dir);
        //Log('pivot_pos ['+i+'] = '+v3.ToFixed(pivot_pos , 2));
        //Log('pivot_dir ['+i+'] = '+v3.ToFixed(pivot_dir , 2));
        //Log('pivot_left['+i+'] = '+v3.ToFixed(pivot_left, 2));
        var sin_theta = Math.sqrt(1 - pivot_dot * pivot_dot);
        mid_gap = RailMetric.cWidth / sin_theta * 1.5;
        rail.mDoubleSlipPivot = pivot_pos;
    } else {
        rail.mDoubleSlipPivot = null;
    }
    if (is_alweg && is_switch_rail) { args.out_m = []; }
    calc_curves(function(i, f0, tp0, f1, tp1) {
        is_curve_left  = (!lr0 || ((lr0 < 0) ^ f0)) && (!lr1 || !((lr1 < 0) ^ f1));
        is_curve_right = (!lr0 || ((lr0 > 0) ^ f0)) && (!lr1 || !((lr1 > 0) ^ f1));
        var curve_info = curve_infos[i];
        acc_len = curve_info.acc_len;
        pier_acc_len = i == 0 ? pier_interval * rail.mPierOffset : -1;
        set_curve_len(acc_len);
        is_switch = f0 || f1;
        seg_id = 0;
        frog_thres0 = frog_thres1 = 0;
        if (sp0 && !is_mono) {
            frog_thres0 = calc_frog_len(base_points[0].mDir, sp0.mDir);
            args.splitters.push(frog_thres0);
        }
        if (sp1 && !is_mono) {
            args.splitters.push(acc_len * tongue_ratio);
        }
        is_switch_from0 = tp0.mSwitchFrom >= 0;
        is_switch_from1 = tp1.mSwitchFrom >= 0;
        if (is_double_slip && (f0 ^ f1 ^ s0 ^ s1) && !is_mono) {
            gap_pos0 = acc_len * 0.5 - mid_gap * 0.5;
            gap_pos1 = acc_len * 0.5 + mid_gap * 0.5;
            cross_len0 = gap_pos0 - mid_gap * 1.2;
            cross_len1 = gap_pos1 + mid_gap * 1.2;
            args.splitters.push(cross_len0);
            //for(var i=1;i<10;++i){
            //    args.splitters.push((cross_len0*(10-i)+gap_pos0*i)/10);
            //}
            args.splitters.push(gap_pos0);
            args.splitters.push(gap_pos1);
            //for(var i=1;i<10;++i){
            //    args.splitters.push((gap_pos1*(10-i)+cross_len1*i)/10);
            //}
            args.splitters.push(cross_len1);
            if (f0 ^ s1) {
                d_pivot_len0 = gap_pos1;
                d_pivot_len1 = gap_pos0;
                cross_type = 0;
            } else {
                d_pivot_len0 = gap_pos0;
                d_pivot_len1 = gap_pos1;
                cross_type = 1;
            }
            //d_pivot_range = acc_len * 0.25;
            d_pivot_range = mid_gap;
            d_pivot_pos = pivot_pos;
            d_pivot_dir = pivot_dir;
        } else {
            gap_pos0 = gap_pos1 = null;
            cross_len0 = cross_len1 = null;
        }
        if (sp0 && !is_mono) {
            args.splitters.push(acc_len * (1 - tongue_ratio));
        }
        if (sp1 && !is_mono) {
            frog_thres1 = calc_frog_len(base_points[1].mDir, sp1.mDir);
            args.splitters.push(acc_len - frog_thres1);
        }
        if (args.splitters) { args.splitters.sort(function(a, b) { return a - b; }); }
        Rail.bakeCurve(rail, f0, tp0, f1, tp1, args);
        curve_end_pos = tp1.mPos;
        Rail.CalcCurveWithPoints(rail, tp0, tp1, draw_segment, args);
        if (args.out_m) {
            if (f0) {
                rail.mDrawBlock.mSwitchPoint0.dir = args.out_m[0];
            } else {
                rail.mDrawBlock.mBasePoint0.dir = args.out_m[0];
                rail.mDrawBlock.mSwitchPoint0.dir ||= args.out_m[0];
            }
            if (f1) {
                rail.mDrawBlock.mSwitchPoint1.dir = args.out_m[1];
            } else {
                rail.mDrawBlock.mBasePoint1.dir = args.out_m[1];
                rail.mDrawBlock.mSwitchPoint1.dir ||= args.out_m[1];
            }
        }
    });
    if (drawer_set.rail  ) { drawer_set.rail  .incrementRailCounter(); }
    if (drawer_set.tie   ) { drawer_set.tie   .incrementRailCounter(); }
    if (drawer_set.girder) { drawer_set.girder.incrementRailCounter(); }
    parts_data.forEach(function(data) {
        if (data.drawer) { data.drawer.incrementRailCounter(); }
    });
};
Rail.writeDynamic = function(rail)
{
    for (var i = 0; i <= 3; ++i) {
        var f0 = i & 1, f1 = (i >> 1) & 1;
        var tp0 = f0 ? rail.mSwitchPoints[0] : rail.mPoints[0];
        var tp1 = f1 ? rail.mSwitchPoints[1] : rail.mPoints[1];
        if (tp0 && tp1) {
            Rail.CalcCurveWithPoints(rail, tp0, tp1, function(seg0, seg1) {
                g_line_drawer.pushLine(
                    v3.add(v3.Muls(v3.ey, RailMetric.cTotalHeight), seg0.pos),
                    v3.add(v3.Muls(v3.ey, RailMetric.cTotalHeight), seg1.pos),
                    v4.Make(RailBuilder.mNearestRail == rail ? 1 : 0,
                            RailBuilder.mSelectedRail == rail ? 1 : 0,
                            0, 1));
            });
        }
    }
};
Rail.proceed = function(anc, dist, args)
{
    if (!args) { args = {}; }
    anc = RailAnchor.copy(anc);
    var ret = {}, rail0 = anc.mRail;
    function reserve_rail(t_rail) {
        var already = false;
        if (t_rail) {
            if (t_rail.mTrainInfo.length > 0) { already = true; }
            var reserve = Rail.pushTrain(t_rail, args.train);
            if (!reserve) {
                ret.mIsBlocked = true;
                if (args.is_sensor) {
                    ret.mRail = con.rail;
                    ret.mPos = v3.Dup(con.point.mPos);
                }
                return null;
            }
            args.rail_reserves.push(reserve);
        }
        return { is_already_reserved : already, };
    }
    var reserve_ret = reserve_rail(rail0)
    if (!reserve_ret) { return ret; }
    while (true)
    {
        if (args.is_sensor && !reserve_ret.is_already_reserved) {
            var settings = con.rail.mStationInfo;
            if (settings && settings.length >= 1) {
                var setting = null, set_dir = anc.mDirSide;
                for (var i = 0; i < settings.length; ++i) {
                    var tset = settings[i];
                    if ((!tset.train_id || args.train.mID == tset.train_id) && (
                        tset.direction == 'all' || tset.direction == (set_dir ? '0' : '1'))) {
                        setting = tset;
                    }
                }
                if (setting && setting.stop) {
                    //Log('train ' + args.train.mID + ' start stop');
                    anc.mRail.mStopTime = setting.duration
                        + Math.random() * setting.duration_rnd;
                    anc.mRail.mStopOffset = setting.offset;
                    anc.mRail.mIsTurnaround = setting.turnaround;
                }
            }
        }
        var is_reverse = anc.mDirSide ? dist < 0 : dist > 0;
        var s_ratio = 1 - anc.mRail.mStopOffset, prev_ratio = 0;
        Rail.traverseCurve(anc.mRail, function(seg0, seg1, curve_len) {
            if (args.is_override_switch && anc.mRail.mStopTime > 0) {
                var t_ratio = is_reverse ? 1 - seg0.len_ratio : seg1.len_ratio;
                if (s_ratio <= t_ratio) {
                    var i_ratio = (s_ratio - prev_ratio) / (t_ratio - prev_ratio);
                    if (is_reverse) { i_ratio = 1 - i_ratio; }
                    var ipos = v3.Lerp(seg0.pos, seg1.pos, i_ratio);
                    if (v3.CalcDist(ipos, anc.mPos) <= Math.abs(dist) + 0.01) {
                        //Log('train ' + args.train.mID + ' stopping ' + args.is_sensor);
                        ret.mIsBlocked = true;
                        ret.mRail = args.train.mSpeed == 0 ? null : anc.mRail;
                        ret.mPos = ipos;
                        ret.mDir = v3.Lerp(seg0.dir, seg1.dir, i_ratio);
                        if (is_reverse) { v3.neg(ret.mDir); }
                        ret.mUp = v3.Dup(anc.mUp);
                        if (args.train.mSpeed == 0) {
                            //Log('train ' + args.train.mID + ' waiting');
                            anc.mRail.mStopTime -= 1 / cFPS;
                            if (anc.mRail.mStopTime <= 0) {
                                if (anc.mRail.mIsTurnaround) { Train.reverse(args.train); }
                            }
                        }
                        return true;
                    }
                }
                prev_ratio = t_ratio;
            }
            var p0 = seg0.pos, d0 = seg0.dir, u0 = seg0.up;
            var p1 = seg1.pos, d1 = seg1.dir, u1 = seg1.up;
            var diff10 = v3.Sub(p1, p0), dist10 = v3.Length(diff10);
            var base_dot = v3.Dot(diff10, anc.mDir);
            if (anc.mDirSide ? base_dot < 0 : base_dot > 0) { return; }
            var diff0 = v3.Sub(p0, anc.mPos), dist0 = v3.Length(diff0);
            var diff1 = v3.Sub(p1, anc.mPos), dist1 = v3.Length(diff1);
            if (v3.Dot(anc.mDir, diff0) < 0) { dist0 = -dist0; }
            if (v3.Dot(anc.mDir, diff1) < 0) { dist1 = -dist1; }
            if (!(dist0 <= dist && dist <= dist1 ||
                  dist1 <= dist && dist <= dist0)) {
                return;
            }
            var m0 = v3.Muls(d0, dist10), m1 = v3.Muls(d1, dist10);
            var s = (dist - dist0) / (dist1 - dist0);
            function calc_curve(t, out_dir, out_up) {
                var t2 = t * t, t3 = t2 * t;
                var h00 =  2 * t3 - 3 * t2     + 1;
                var h10 =      t3 - 2 * t2 + t    ;
                var h01 = -2 * t3 + 3 * t2        ;
                var h11 =      t3 -     t2        ;
                var ret = v3.Muls(p0, h00);
                v3.add(ret, v3.Muls(m0, h10));
                v3.add(ret, v3.Muls(p1, h01));
                v3.add(ret, v3.Muls(m1, h11));
                var h20 =  6 * t2 - 6 * t    ;
                var h30 =  3 * t2 - 4 * t + 1;
                var h21 = -6 * t2 + 6 * t    ;
                var h31 =  3 * t2 - 2 * t    ;
                v3.muls(v3.copy(out_dir, p0), h20);
                v3.add(out_dir, v3.Muls(m0, h30));
                v3.add(out_dir, v3.Muls(p1, h21));
                v3.add(out_dir, v3.Muls(m1, h31));
                v3.normalize(out_dir);
                v3.add(v3.muls(v3.copy(out_up, u0), h00), v3.Muls(u1, h01));
                v3.normalize(v3.Cross(out_dir, v3.Cross(out_up, out_dir)));
                return ret;
            }
            ret.mRail = anc.mRail;
            ret.mDir = v3.Makes(0);
            ret.mUp  = v3.Makes(0);
            ret.mPos = calc_curve(s, ret.mDir, ret.mUp);
            if (!anc.mDirSide) { v3.neg(ret.mDir); }
            return true;
        }, is_reverse);
        if (ret.mRail || ret.mIsBlocked) { break; }
        var rail_end = anc.mDirSide;
        if (dist < 0) { rail_end = 1 - rail_end; }
        var sw = 0;
        if (anc.mRail.mSwitchPoints[rail_end]) {
            var sw_side = 1 - rail_end;
            sw = anc.mRail.mDrawBlock.mSwitchState[sw_side];
        }
        var con = Rail.getConnection(anc.mRail, rail_end, sw);
        if (!con.rail) {
            if (args.is_sensor) {
                //ret.mRail = anc.mRail;
                ret.mPos = v3.Dup(con.point.mPos);
            }
            break;
        }
        if (con.rail == rail0) { break; }
        reserve_ret = reserve_rail(con.rail);
        if (!reserve_ret) { break; }
        if (args.is_override_switch) {
            var end2 = Rail.checkEnd(con.rail, con.point), sw_end2 = 1 - end2;
            if (con.rail.mSwitchPoints[sw_end2]) {
                var state = con.rail.mDrawBlock.mSwitchState, sw2 = state[end2];
                var settings = con.rail.mSwitchInfos[sw_end2], set_sw = 0;
                if (settings && settings.length >= 1) {
                    var setting = settings[0];
                    for (var i = 1; i < settings.length; ++i) {
                        if (args.train.mID == settings[i].train_id) { setting = settings[i]; }
                    }
                    if (setting.schedule == 'alt' || setting.schedule == 'rnd') {
                        if (!reserve_ret.is_already_reserved) {
                            if (setting.schedule == 'alt') {
                                con.rail.mAlternateSwitchState[sw_end2] =
                                    1 - con.rail.mAlternateSwitchState[sw_end2];
                            } else if (setting.schedule == 'rnd') {
                                con.rail.mAlternateSwitchState[sw_end2] =
                                    Math.random() < 0.5 ? 0 : 1;
                            }
                        }
                        set_sw = con.rail.mAlternateSwitchState[sw_end2];
                    } else {
                        set_sw = setting.schedule == 'sub' ? 1 : 0;
                    }
                }
                if (sw2 != set_sw) {
                    state[end2] = set_sw;
                    //Log('Turn switch: rail[' + con.rail.mID
                    //    + '].end[' + end2 + '] => ' + state[end2]);
                }
            }
            if (con.rail.mSwitchPoints[end2]) {
                var state = con.rail.mDrawBlock.mSwitchState;
                var sw2 = state[sw_end2];
                var con2 = Rail.getConnection(con.rail, end2, sw2);
                if (con2.rail != anc.mRail) {
                    state[sw_end2] = 1 - sw2;
                    //Log('Override switch: rail[' + con.rail.mID
                    //    + '].end[' + sw_end2 + '] => ' + state[sw_end2]);
                }
            }
        }
        anc.mRail = con.rail;
        var next_rail_end = Rail.checkEnd(anc.mRail, con.point);
        if (next_rail_end < 0) { break; }
        if (next_rail_end == rail_end) { anc.mDirSide = 1 - anc.mDirSide; }
    }
    ret.mDirSide = anc.mDirSide;
    return ret;
};
Rail.connect = function(rail, point0, point_side0, point1, point_side1)
{
    ControlPoint.setRail(point0, point_side0, rail);
    ControlPoint.setRail(point1, point_side1, rail);
};
Rail.deleteRail = function(rail)
{
    if (Rail.eraseObj(rail)) {
        for (var i = 0; i < 2; ++i) {
            if (rail.mSwitchPoints[i]) {
                rail.mSwitchPoints[i].mSwitchFrom = -1;
            }
        }
        Rail.forEach(function(rail2) {
            Rail.onDeleteRail(rail2, rail);
        });
    }
};
Rail.setSwitchPoint = function(rail, side, point)
{
    rail.mSwitchPoints[side] = point;
    if (point) {
        point.mSwitchFrom = 1 - side;
        point.mRails[point.mSwitchFrom] = rail;
    }
};
Rail.calcSwitchAll = function()
{
    if (IsPause()) { return; }
    Rail.sSwitchRails.forEach(Rail.calcSwitch, this);
};
Rail.writeDynamicAll = function()
{
    if (!IsEnableDebugDraw()) { return; }
    if (!IsEditorMode()) { // check switch point dir
        Rail.forEach(function(rail) {
            for (var i = 0; i < 2; ++i) {
                var sp = rail.mSwitchPoints[i];
                if (sp) {
                    var tp = AddRailTotalHeight(sp.mPos);
                    DrawArrow(tp, v3.Add(tp, sp.mDir), 0.2, v4.Make(1 - i, i, 0, 1));
                }
            }
        });
    }
    Rail.sHiddenRails.forEach(Rail.writeDynamic, this);
};
Rail.writeAll = function()
{
    var gl = g_canvas.getContext();
    ForEachRailDrawer(drawer => drawer.beginWrite());
    Rail.sSwitchRails = [];
    Rail.sHiddenRails = [];
    Rail.forEach(Rail.write);
    ForEachRailDrawer(drawer => drawer.endWrite(gl));
};
Rail.searchNearestEnd = function(wpos, hit_scale)
{
    hit_scale = (hit_scale ? hit_scale : 1) * g_touch_hit_scale;
    var ret = { rail : null, side : -1, sw : 0, dist : -1, };
    Rail.forEach(function(rail) {
        for (var side = 0; side < 2; ++side) {
            for (var sw = 0; sw < 2; ++sw) {
                var point = Rail.getPoint(rail, side, sw);
                if (!point) { continue; }
                var point_side = ControlPoint.checkSide(point, rail);
                var ofs = RailMetric.cWidth * RailMetric.cEndSign[point_side];
                var epos = v3.add(v3.Muls(point.mDir, ofs), point.mPos);
                //var dist = v3.CalcDist(wpos, epos);
                var dist = g_camera.calcSphereIntersection(
                    g_cursor_ray, v4.FromV3(epos, RailMetric.cGauge * hit_scale));
                if (dist >= 0 && (!ret.rail || dist < ret.dist)) {
                    ret.rail = rail;
                    ret.side = side;
                    ret.sw   = sw  ;
                    ret.dist = dist;
                }
            }
        }
    });
    return ret;
};
Rail.searchNearestRail = function(wpos)
{
    var ret = { rail : null, dist : -1, pos : null, dir : null, up : null, };
    Rail.forEach(function(rail) {
        Rail.traverseCurve(rail, function(seg0, seg1) {
            var pos0 = seg0.pos, pos1 = seg1.pos;
            var res = g_camera.calcCapsuleIntersection(
                g_cursor_ray, pos0, pos1, RailMetric.cGauge * g_touch_hit_scale);
            if (res && (!ret.rail || res.dist < ret.dist)) {
                var dist10 = v3.Length(v3.Sub(pos1, pos0));
                ret.rail = rail;
                ret.dist = res.dist;
                ret.pos = res.pos;
                var ofs_ratio = res.ofs / dist10;
                ret.dir = v3.normalize(v3.Lerp(seg0.dir, seg1.dir, ofs_ratio));
                ret.up = v3.normalize(v3.Lerp(seg0.up, seg1.up, ofs_ratio));
            }
        });
    });
    return ret;
};
Rail.getInterpolatedPos = function(rail, ratio)
{
    var ret = null, prev_ratio = 0;
    Rail.traverseCurve(rail, function(seg0, seg1, curve_len) {
        var t_ratio = seg1.acc_len / curve_len;
        if (ratio > t_ratio) {
            prev_ratio = t_ratio;
            return false;
        }
        var i_ratio = (ratio - prev_ratio) / (t_ratio - prev_ratio);
        ret = {};
        ret.pos = v3.Lerp(seg0.pos, seg1.pos, i_ratio);
        ret.dir = v3.Lerp(seg0.dir, seg1.dir, i_ratio);
        ret.up  = v3.Lerp(seg0.up , seg1.up , i_ratio);
        return true;
    }, false, true);
    return ret;
};
Rail.resetDrawBlockColors = function(color)
{
    Rail.forEach(function(rail) {
        if (rail.mDrawBlock) {
            rail.mDrawBlock.mColor = color;
        }
    });
};
Rail.saveAll = function(data)
{
    data.point = ControlPoint.saveInsts(function(point) {
        return {
            id : point.mID,
            pos : v3.ToArray(point.mPos),
            dir : v3.ToArray(point.mDir),
            up : v3.ToArray(point.mUp),
            rails : point.mRails.map(rail => rail ? rail.mID : null),
            switch_from : point.mSwitchFrom,
            left_sign : point.mLeftSign,
        };
    });
    data.rail = this.saveInsts(function(rail) {
        function make_point_data(point) { return point ? point.mID : null; }
        var inst = {
            id : rail.mID,
            points : rail.mPoints.map(make_point_data),
            sinfos : rail.mSwitchInfos,
            alt_sw : rail.mAlternateSwitchState,
            st_info : rail.mStationInfo,
        };
        if (HasValidValue(rail.mSwitchPoints)) {
            inst.spoints = rail.mSwitchPoints.map(make_point_data);
        }
        if (rail.mLeftPart ) { inst.left_part  = rail.mLeftPart ; }
        if (rail.mRightPart) { inst.right_part = rail.mRightPart; }
        this.cRailOptions.forEach(name => inst[name.s] = rail['m' + name.m]);
        if (rail.mSwitchPoints[0] || rail.mSwitchPoints[1]) {
            inst.switch_state = rail.mDrawBlock.mSwitchState;
        }
        if (rail.mDoubleSlipPivot) { inst.ds_pivot = v3.ToArray(rail.mDoubleSlipPivot); }
        return inst;
    });
};
Rail.loadAll = function(data)
{
    var tmp_points = [], tmp_switches = [];
    ControlPoint.loadInsts(data.point, function(inst) {
        var point = {
            mID : inst.id,
            mPos : v3.FromArray(inst.pos),
            mRails : inst.rails,
            mSwitchFrom : inst.switch_from,
            mLeftSign : inst.left_sign,
        };
        this.setDir(point, inst.dir, inst.up);
        tmp_points.push(point);
    });
    this.loadInsts(data.rail, function(inst) {
        function search_point(point_id) {
            return tmp_points.find(point => point.mID == point_id);
        }
        var rail = {
            mID : inst.id,
            mPoints : inst.points.map(search_point),
            mSwitchPoints : inst.spoints && inst.spoints.map(search_point) || [null, null],
            mSwitchInfos : inst.sinfos,
            mAlternateSwitchState : inst.alt_sw,
            mStationInfo : inst.st_info,
        };
        inst.curve_factor ||= 0.5,
        this.createData(rail);
        this.cRailOptions.forEach(name => rail['m' + name.m] = inst[name.s]);
        rail.mPierType = rail.mPierType || 'center';
        if (rail.mStationInfo) {
            rail.mStationInfo.forEach(function(setting) {
                setting.duration_rnd = setting.duration_rnd || 0;
            });
        }
        if (inst.switch_state) { tmp_switches.push({
            rail : rail, switch_state : inst.switch_state, }); }
        if (inst.ds_pivot) { rail.mDoubleSlipPivot = v3.FromArray(inst.ds_pivot); }
        this.sObjs.push(rail);
    });
    tmp_points.forEach(function(point) {
        point.mRails = point.mRails.map(rail_id =>
            Rail.sObjs.find(rail => rail.mID == rail_id));
    });
    this.writeAll();
    tmp_switches.forEach(function(info) {
        info.rail.mDrawBlock.mSwitchState = info.switch_state;
    });
};
g_toggle_debug_draw_callback.push(function() {
    Rail.writeAll();
});
  </script>
  <!-- <script src="edit_model.js"></script> -->
  <script>
'use strict';
// common switch
var ModelSwitch = CreateInstance();
ModelSwitch.createSwitchesMgr = function(parent, parent_mgr)
{
    parent.mSwitchMgr = UI_Struct.createMgr({
        clip_name : 'mdl-switch', disable_undo : true, });
    parent.mSwitchMgr.pushStruct({
        key : 'id', title : LangAppend(cLang.cmn_switch, ' ID'),
        def_value : 'switch_id', labeled : 'value',
        mgr : UI_Text.createMgr({
            parent_mgr : parent.mSwitchMgr, fixed : true, type : 'id', }), });
    parent.mSwitchMgr.pushStruct({
        key : 'label', title : LangAppendSp(cLang.cmn_switch, cLang.cmn_label),
        def_value : 'Switch Label', labeled : 'value',
        mgr : UI_LangText.createMgr({ parent_mgr : parent.mSwitchMgr, fixed : true, }), });
    parent.mSwitchMgr.pushStruct({
        key : 'default_value_id', title : LangAppend(cLang.model_default_value, ' ID'),
        def_value : 'value_id',
        mgr : UI_Text.createMgr({
            parent_mgr : parent.mSwitchMgr, fixed : true, type : 'id', }), });
    parent.mSwitchMgr.pushStruct({
        key : 'preview_value_id', title : LangAppend(cLang.model_preview_value, ' ID'),
        def_value : 'value_id',
        mgr : UI_Text.createMgr({
            parent_mgr : parent.mSwitchMgr, fixed : true, type : 'id', }), });
    parent.mValueMgr = UI_Struct.createMgr({
        clip_name : 'mdl-switch', disable_undo : true, });
    parent.mValueMgr.pushStruct({
        key : 'id', def_value : 'value_id', labeled : 'value',
        title : LangAppend(cLang.cmn_value, ' ID'),
        mgr : UI_Text.createMgr({
            parent_mgr : parent.mValueMgr, fixed : true, type : 'id', }), });
    parent.mValueMgr.pushStruct({
        key : 'label', title : LangAppendSp(cLang.cmn_value, cLang.cmn_label),
        def_value : 'Value Label', labeled : 'value',
        mgr : UI_LangText.createMgr({ parent_mgr : parent.mValueMgr, fixed : true, }), });
    parent.mSwitchColorMgr = UI_Struct.createMgr({
        clip_name : 'mdl-switch', disable_undo : true, });
    parent.mSwitchColorMgr.pushStruct({
        key : 'id', def_value : 'color_id', labeled : 'value',
        title : LangAppend(cLang.cmn_color, ' ID'),
        mgr : UI_Text.createMgr({
            parent_mgr : parent.mSwitchColorMgr, fixed : true, type : 'id', }), });
    parent.mSwitchColorMgr.pushStruct({
        key : 'color', title : cLang.cmn_color, def_value : v4.Makes(1), labeled : 'value',
        mgr : UI_Color.createMgr({
            parent_mgr : parent.mSwitchColorMgr, fixed : true, is_rgba : true, }), });
    parent.mSwitchColorMgr.initializeStruct();
    parent.mSwitchColorsMgr = UI_Array.createMgr({ parent_mgr : parent.mValueMgr, fixed : true,
        element_mgr : parent.mSwitchColorMgr, init_element_value : null, });
    parent.mValueMgr.pushStruct({
        key : 'colors', title : cLang.cmn_colors, def_value : [], labeled : true,
        mgr : parent.mSwitchColorsMgr, });
    parent.mValueMgr.initializeStruct();
    parent.mValuesMgr = UI_Array.createMgr({ parent_mgr : parent.mSwitchMgr, fixed : true,
        element_mgr : parent.mValueMgr, init_element_value : null, });
    parent.mSwitchMgr.pushStruct({
        key : 'values', title : cLang.cmn_values, def_value : [], labeled : true,
        mgr : parent.mValuesMgr, });
    parent.mSwitchMgr.initializeStruct();
    parent.mSwitchesMgr = UI_Array.createMgr({ parent_mgr : parent_mgr, fixed : true,
        element_mgr : parent.mSwitchMgr, init_element_value : null, });
    return parent.mSwitchesMgr;
};
ModelSwitch.createConditionMgr = function(parent, parent_mgr)
{
    var condition_mgr = UI_Struct.createMgr({
        clip_name : 'mdl-condition', fixed : true, parent_mgr : parent_mgr, });
    condition_mgr.pushStruct({
        key : 'switch_id', def_value : '', labeled : true,
        title : LangAppend(cLang.cmn_switch, ' ID'),
        mgr : UI_Text.createMgr({
            parent_mgr : condition_mgr, fixed : true, type : 'id', }), });
    condition_mgr.pushStruct({
        key : 'op', title : cLang.model_compare, def_value : 'is', labeled : true,
        mgr : UI_Select.createMgr({
            parent_mgr : condition_mgr, clip_name : 'switch-op',
            fixed : true,
            options : [
                { label : '=', value : 'is'    , },
                { label : '≠', value : 'is_not', },
            ], }), });
    condition_mgr.pushStruct({
        key : 'value_id', def_value : [], labeled : true,
        title : LangJoin([cLang.cmn_value, ' ', cLang.cmn_ids]),
        mgr : UI_Text.createMgr({
            parent_mgr : condition_mgr, fixed : true, type : 'ids', }), });
    condition_mgr.getLabel = function(value)
    {
        var ret = '{';
        var op_labels = { is : 'is', is_not : 'is not', };
        ret += '[' + value.switch_id + '] ' + op_labels[value.compare]
            + ' [' + value.value_id + ']';
        return ret + '}';
    };
    condition_mgr.initializeStruct();
    return condition_mgr;
};
ModelSwitch.evaluateCondition = function(condition, vid)
{
    for (var i = 0; i < condition.value_id.length; ++i) {
        if (condition.value_id[i] == vid) { return condition.op == 'is'; }
    }
    return condition.op != 'is';
};
ModelSwitch.createInsertColorMgr = function(parent_mgr)
{
    var mgr = UI_Struct.createMgr({
        clip_name : 'mdl-insert-color', fixed : true, parent_mgr : parent_mgr, });
    mgr.pushStruct({
        key : 'default_value', title : cLang.model_default_color,
        def_value : v4.Make(1, 0, 0, 1),
        mgr : UI_Color.createMgr({ parent_mgr : mgr, fixed : true, is_rgba : true, }), });
    mgr.pushStruct({
        key : 'override_color_id', title : LangAppend(cLang.model_override_color, ' ID'),
        def_value : '', labeled : true,
        mgr : UI_Text.createMgr({ parent_mgr : mgr, fixed : true, type : 'id', }), });
    mgr.initializeStruct();
    return mgr;
};
ModelSwitch.createSwitchSelectsMgr = function(parent, parent_mgr, update_switches, update_sel)
{
    parent.mSwitchSelectMgr = UI_Select.createMgr({
        clip_name : 'switch-sel', no_ctrl_br : true, no_collapse : true, disable_undo : true,
        update_options : update_sel, });
    parent.mSwitchSelectsMgr = UI_Array.createMgr({
        parent_mgr : parent_mgr, fixed : true, element_mgr : parent.mSwitchSelectMgr,
        init_element_value : '-', update_element_names : update_switches, })
    return parent.mSwitchSelectsMgr;
};
// common model
var EditModel = CreateIDMgr(null, true);
EditModel.mModelsObj = null;
EditModel.mRadioMgr = UI_Radios.createMgr({
    name : 'edit-model-default', title : 'preview model',
    for_each : function(f) {
        EditModel.forEach(function(mdl) { f(mdl.user_data.def_radio); });
    }, });
EditModel.mIdToData = {};
EditModel.mSelectMgrs = [];
EditModel.createSelectMgr = function(args) {
    var mgr = UI_Select.createMgr(Object.assign({ clip_name : 'e-model', }, args));
    this.mSelectMgrs.push(mgr);
    return mgr;
};
EditModel.mInstMgr = UI_Struct.createMgr({
    name : 'model data', clip_name : 'e-model',
    on_create_instance : function(elem_inst) {
        var val = elem_inst.mValue;
        val.user_data = EditModel.issueID(val.user_data);
        val.user_data.def_radio = EditModel.mRadioMgr.createInstance({
            parent : elem_inst.mTitleObj, prepend : true, id : val.user_data.uuid, });
        UI_Radios.setCheck(val.user_data.def_radio);
    },
    on_update : function(inst) {
        EditModel.updateList();
        EditModel.createDrawer(g_canvas.getContext(), inst.mValue);
    },
    on_activate : function(inst) { UI_Radios.setCheck(inst.mValue.user_data.def_radio); }, });
EditModel.mInstMgr.getUUID = function(value) { return value.user_data.uuid; };
EditModel.mInstMgr.pushStruct({
    key : 'name', title : cLang.cmn_name, def_value : 'e-model', labeled : 'value',
    mgr : UI_LangText.createMgr({ parent_mgr : EditModel.mInstMgr, fixed : true, }), });
EditModel.mInstMgr.pushStruct({
    key : 'author', title : cLang.cmn_author, def_value : null,
    mgr : FileMode.createAuthorInfoMgr(EditModel.mInstMgr), });
EditModel.mInstMgr.pushStruct({
    key : 'draw_pass', title : cLang.model_draw_pass, def_value : 'default',
    mgr : UI_Select.createMgr({
        parent_mgr : EditModel.mInstMgr, fixed : true, clip_name : 'draw-pass',
        options : [
            { label : cLang.model_pass_field  , value : 'field'  , },
            { label : cLang.model_pass_tunnel , value : 'tunnel' , },
            { label : cLang.model_pass_default, value : 'default', },
        ], }), });
EditModel.mPrimitiveMgr = UI_Struct.createMgr({ clip_name : 'primitive', disable_undo : true, });
EditModel.mPrimitiveMgr.pushStruct({
    key : 'comment', title : cLang.cmn_comment, def_value : '', labeled : 'value',
    mgr : UI_Text.createMgr({ parent_mgr : EditModel.mPrimitiveMgr, fixed : true, }), });
EditModel.mPrimitiveMgr.pushStruct({
    key : 'type', title : cLang.cmn_type, def_value : 'cube', labeled : true,
    mgr : UI_Select.createMgr({
        parent_mgr : EditModel.mPrimitiveMgr, fixed : true, clip_name : 'model-primitive',
        options : [
            { label : cLang.primitive_plane   , value : 'plane'   , },
            { label : cLang.primitive_prism   , value : 'prism'   , },
            { label : cLang.primitive_cube    , value : 'cube'    , },
            { label : cLang.primitive_cylinder, value : 'cylinder', },
            { label : cLang.primitive_sphere  , value : 'sphere'  , },
        ], }), });
EditModel.mPrimitiveMgr.pushStruct({
    key : 'face', title : cLang.model_face, def_value : 'front',
    mgr : UI_Select.createMgr({
        parent_mgr : EditModel.mPrimitiveMgr, fixed : true, clip_name : 'model-face',
        options : [
            { label : cLang.face_front, value : 'front', },
            { label : cLang.face_back , value : 'back' , },
            { label : cLang.face_both , value : 'both' , },
        ], }), });
EditModel.mPrimitiveMgr.pushStruct({
    key : 'split', title : cLang.model_split, def_value : 6,
    mgr : UI_Slider.createMgr({
        parent_mgr : EditModel.mPrimitiveMgr, fixed : true,
        min : 1, max : 16, is_int : true, width : '4em', }), });
EditModel.mPrimitiveMgr.pushStruct({
    key : 'taper', title : cLang.model_taper, def_value : 0,
    mgr : UI_Slider.createMgr({
        parent_mgr : EditModel.mPrimitiveMgr, fixed : true, fixed_range : true,
        min : -1, max : 1, slide_round : 0.001, width : '4em', }), });
EditModel.mPrimitiveMgr.pushStruct({
    key : 'scale', title : cLang.cmn_scale, def_value : v3.Makes(1), labeled : true,
    mgr : UI_Vector.createMgr({
        parent_mgr : EditModel.mPrimitiveMgr, fixed : true, dim : 3, min : 0, max : 50, }), });
EditModel.mPrimitiveMgr.pushStruct({
    key : 'rotate', title : cLang.cmn_rotate, def_value : v3.Makes(0),
    mgr : UI_Vector.createMgr({
        parent_mgr : EditModel.mPrimitiveMgr, fixed : true,
        dim : 3, min : -180, max : 180, size : 4, slide_round : 0.1, }), });
EditModel.mPrimitiveMgr.pushStruct({
    key : 'trans', title : cLang.cmn_trans, def_value : v3.Makes(0),
    mgr : UI_Vector.createMgr({
        parent_mgr : EditModel.mPrimitiveMgr, fixed : true, dim : 3, min : -50, max : 50, }), });
EditModel.mPrimitiveMgr.pushStruct({
    key : 'base_color', title : cLang.model_base_color, def_value : v4.Makes(1),
    mgr : UI_Color.createMgr({ parent_mgr : EditModel.mPrimitiveMgr, fixed : true, }), });
EditModel.mSlicerMgr = UI_Struct.createMgr({ clip_name : 'slicer', disable_undo : true, });
EditModel.mSlicerMgr.pushStruct({
    key : 'type', title : cLang.cmn_type, def_value : 'erase_gt', labeled : true,
    mgr : UI_Select.createMgr({
        parent_mgr : EditModel.mSlicerMgr, fixed : true,
        options : [
            { label : cLang.slicer_erase_lt  , value : 'erase_lt', },
            { label : cLang.slicer_erase_gt  , value : 'erase_gt', },
            { label : cLang.slicer_reshape_lt, value : 'reshape_lt', },
            { label : cLang.slicer_reshape_gt, value : 'reshape_gt', },
        ], }), });
EditModel.mSlicerMgr.pushStruct({
    key : 'solid', title : cLang.model_solid, def_value : true,
    mgr : UI_Check.createMgr({ parent_mgr : EditModel.mSlicerMgr, fixed : true, }), });
EditModel.mSlicerMgr.pushStruct({
    key : 'reshapable', title : cLang.model_reshapable, def_value : true,
    mgr : UI_Check.createMgr({ parent_mgr : EditModel.mSlicerMgr, fixed : true, }), });
EditModel.mSlicerMgr.pushStruct({
    key : 'offset', title : cLang.cmn_offset, def_value : 0,
    mgr : UI_Slider.createMgr({
        parent_mgr : EditModel.mSlicerMgr, fixed : true,
        min : -20, max : 20, slide_round : 0.001, }), });
EditModel.mSlicerMgr.pushStruct({
    key : 'angle', title : cLang.cmn_angle, def_value : v3.Makes(0), labeled : true,
    mgr : UI_Vector.createMgr({
        parent_mgr : EditModel.mSlicerMgr, fixed : true,
        dim : 3, min : -180, max : 180, size : 4, slide_round : 0.1, }), });
EditModel.mSlicerMgr.pushStruct({
    key : 'pos', title : cLang.cmn_position, def_value : v3.Makes(0), labeled : true,
    mgr : UI_Vector.createMgr({
        parent_mgr : EditModel.mSlicerMgr, fixed : true, dim : 3, min : -50, max : 50, }), });
EditModel.mSlicerMgr.initializeStruct();
EditModel.mPrimitiveMgr.pushStruct({
    key : 'slicers', title : cLang.model_slicers, def_value : [], labeled : true,
    mgr : UI_Array.createMgr({
        parent_mgr : EditModel.mPrimitiveMgr, fixed : true,
        element_mgr : EditModel.mSlicerMgr, init_element_value : null, }), });
EditModel.mPrimitiveMgr.initializeStruct();
EditModel.mPrimitivesMgr = UI_Array.createMgr({
    parent_mgr : EditModel.mInstMgr, fixed : true,
    element_mgr : EditModel.mPrimitiveMgr, init_element_value : null, });
EditModel.mInstMgr.pushStruct({
    key : 'primitives', title : cLang.model_primitives, labeled : true,
    def_value : [EditModel.mPrimitiveMgr.makeDefaultValue()],
    mgr : EditModel.mPrimitivesMgr, });
EditModel.mPainterMgr = UI_Struct.createMgr({ clip_name : 'painter', disable_undo : true, });
EditModel.mPainterMgr.pushStruct({
    key : 'comment', title : cLang.cmn_comment, def_value : '', labeled : 'value',
    mgr : UI_Text.createMgr({ parent_mgr : EditModel.mPainterMgr, fixed : true, }), });
EditModel.mPainterMgr.pushStruct({
    key : 'color', title : cLang.cmn_color, def_value : null, labeled : true,
    mgr : ModelSwitch.createInsertColorMgr(EditModel.mPainterMgr), });
EditModel.mPainterBoundMgr = UI_Struct.createMgr({
    clip_name : 'painter-bound', disable_undo : true, });
EditModel.mPainterBoundMgr.pushStruct({
    key : 'type', title : cLang.cmn_type, def_value : 'mask_gt', labeled : true,
    mgr : UI_Select.createMgr({
        parent_mgr : EditModel.mPainterBoundMgr, fixed : true,
        options : [
            { label : cLang.painter_mask_lt , value : 'mask_lt' , },
            { label : cLang.painter_mask_gt , value : 'mask_gt' , },
            { label : cLang.painter_paint_lt, value : 'paint_lt', },
            { label : cLang.painter_paint_gt, value : 'paint_gt', },
            { label : cLang.painter_alt_lt  , value : 'alt_lt'  , },
            { label : cLang.painter_alt_gt  , value : 'alt_gt'  , },
        ], }), });
EditModel.mPainterBoundMgr.pushStruct({
    key : 'shape', title : cLang.cmn_shape, def_value : 'plane', labeled : true,
    mgr : UI_Select.createMgr({
        parent_mgr : EditModel.mPainterBoundMgr, fixed : true,
        options : [
            { label : cLang.painter_shape_plane , value : 'plane' , },
            { label : cLang.painter_shape_circle, value : 'circle', },
            { label : cLang.painter_shape_sphere, value : 'sphere', },
        ], }), });
EditModel.mPainterBoundMgr.pushStruct({
    key : 'bound', title : cLang.model_bound, def_value : 0,
    mgr : UI_Slider.createMgr({
        parent_mgr : EditModel.mPainterBoundMgr, fixed : true,
        min : -20, max : 20, slide_round : 0.01, }), });
EditModel.mPainterBoundMgr.pushStruct({
    key : 'width', title : cLang.cmn_width, def_value : 0,
    mgr : UI_Slider.createMgr({
        parent_mgr : EditModel.mPainterBoundMgr, fixed : true,
        min : 0, max : 20, slide_round : 0.01, }), });
EditModel.mPainterBoundMgr.pushStruct({
    key : 'angle', title : cLang.cmn_angle, def_value : v3.Make(90, 0, 0), labeled : true,
    mgr : UI_Vector.createMgr({
        parent_mgr : EditModel.mPainterBoundMgr, fixed : true,
        dim : 3, min : -180, max : 180, size : 4, slide_round : 0.1, }), });
EditModel.mPainterBoundMgr.pushStruct({
    key : 'pos', title : cLang.cmn_position, def_value : v3.Makes(0), labeled : true,
    mgr : UI_Vector.createMgr({
        parent_mgr : EditModel.mPainterBoundMgr, fixed : true, dim : 3,
        min : -50, max : 50, }), });
EditModel.mPainterBoundMgr.pushStruct({
    key : 'alt_color', title : cLang.model_alt_color, def_value : null,
    condition : function(value) { return value.type.startsWith('alt'); },
    mgr : ModelSwitch.createInsertColorMgr(EditModel.mPainterBoundMgr), });
EditModel.mPainterBoundMgr.initializeStruct();
EditModel.mPainterMgr.pushStruct({
    key : 'bounds', title : cLang.model_bounds, def_value : [], labeled : true,
    mgr : UI_Array.createMgr({
        parent_mgr : EditModel.mPainterMgr, fixed : true,
        element_mgr : EditModel.mPainterBoundMgr, init_element_value : null, }), });
EditModel.mPainterMgr.initializeStruct();
EditModel.mPaintersMgr = UI_Array.createMgr({
    parent_mgr : EditModel.mInstMgr, fixed : true,
    element_mgr : EditModel.mPainterMgr, init_element_value : null, });
EditModel.mInstMgr.pushStruct({
    key : 'painters', title : cLang.model_painters, def_value : [], labeled : true,
    mgr : EditModel.mPaintersMgr, });
EditModel.mInstMgr.initializeStruct();
EditModel.mInstsMgr = UI_Array.createMgr({
    fixed : true, root : true, element_mgr : EditModel.mInstMgr, init_element_value : null,
    on_update_array : function() {
        EditModel.updateList();
    },
    is_deletable : function(inst) {
        var ret = true;
        function impl(class_name) {
            class_name.forEach(function(mdl) {
                var ret_mdl = true;
                mdl.parts.forEach(function(part) {
                    if (part.model != inst.mValue.uuid || !ret_mdl) { return; }
                    Log(LangJoin([cLang.error_not_deletable, ': ', inst.mValue.name, ' (',
                                  cLang.error_used_by, ': ', mdl.name, ')']));
                    if (!ret) { return; }
                    DebugLog.show();
                    ret = ret_mdl = false;
                });
            });
        }
        impl(TrainModel);
        impl(StructModel);
        return ret;
    }, });
EditModel.cDrawPassTypes = ['field', 'tunnel', 'default'];
EditModel.mDrawPassMap = {};
EditModel.initialize = function()
{
    this.mListObj = CreateEditPane('edit-model', cLang.head_edit_model, function(div_on) {
        this.mInsts = this.mInstsMgr.createInstance({
            parent : div_on, value : [], });
        this.mInstsMgr.activate(this.mInsts);
    }, this);
};
EditModel.forEach = function(f, a_this)
{
    this.mInstsMgr.mElements.forEach(function(elem_inst) {
        f.apply(a_this, [elem_inst.mValue]);
    });
};
EditModel.clear = function() { this.mInstsMgr.deleteAll(); };
EditModel.updateList = function()
{
    this.mRadioMgr.updateCheck();
    this.mIdToData = {};
    this.mSelectMgrs.forEach(function(mgr) {
        mgr.clear();
        mgr.addOption({ label : cLang.cmn_none, value : '', });
    });
    this.forEach(function(mdl) {
        this.mIdToData[mdl.user_data.uuid] = mdl;
        this.mSelectMgrs.forEach(
            mgr => mgr.addOption({
                label : mdl.name, value : mdl.user_data.uuid, user_data : mdl,
                author : mdl.author, }));
    }, this);
    if (TrainModel.mPartsMgr.mActiveInst) {
        TrainModel.mPartsMgr.mElements.forEach(function(elem) {
            TrainModel.mPartMgr.updateLabel(elem);
        });
    }
};
EditModel.createDrawer = function(gl, mdl) {
    mdl.user_data = CreateInstance(mdl.user_data);
    mdl.user_data.insert_color_num = 0;
    mdl.user_data.insert_colors = {};
    mdl.user_data.insert_colors_default = [];
    function push_insert_color(cdata) {
        var id = cdata.override_color_id
        if (!id || mdl.user_data.insert_colors[id]) { return; }
        if (mdl.user_data.insert_color_num >= webgl.MAX_FRAGMENT_UNIFORM_VECTORS) { return; }
        var info = mdl.user_data.insert_colors[id] = {
            index : mdl.user_data.insert_color_num++,
        };
        mdl.user_data.insert_colors_default.push(cdata.default_value);
    }
    mdl.painters.forEach(function(painter) {
        push_insert_color(painter.color);
        painter.bounds.forEach(function(bound) {
            push_insert_color(bound.alt_color);
        });
    });
    mdl.user_data.drawer = ModelDrawer.create();
    mdl.user_data.drawer.initialize(gl, mdl);
    Train.requestResetAll();
};
EditModel.beginWrite = function()
{
    this.cDrawPassTypes.forEach(pass => EditModel.mDrawPassMap[pass] = []);
    this.forEach(function(mdl) {
        mdl.user_data.drawer.beginWrite();
    });
};
EditModel.write = function(mdl, mtx, insert_colors)
{
    if (!mdl) { return; }
    mdl.user_data.drawer.pushModel(
        mtx, insert_colors ? insert_colors : mdl.user_data.insert_colors_default);
};
EditModel.endWrite = function()
{
    this.forEach(function(mdl) {
        mdl.user_data.drawer.endWrite();
        this.mDrawPassMap[mdl.draw_pass].push(mdl);
    }, this);
};
EditModel.writeEditor = function()
{
    var mdl = EditModel.getDefault();
    function draw_slicer_plane(pos, angle, ofs, col) {
        var left = pitchYawRollDegV(v3.AddZ(angle, 90));
        var dir = pitchYawRollDegV(angle), up = v3.normalize(v3.Cross(dir, left));
        var len = 128, tx = v3.Muls(left, len), ty = v3.Muls(up, len);
        var base = v3.add(v3.Muls(dir, ofs), pos), itv = 5;
        g_line_drawer.pushLine(base, v3.add(v3.Muls(dir, len), base), v4.ones);
        for (var u = 0; u <= len; u = u ? u * 2 : 0.25) {
            for (var s = 0; s < (u ? 2 : 1); ++s) {
                var v = s ? u : -u, c = u ? col : v4.ones;
                var bx = v3.add(v3.Muls(up  , v), base);
                var by = v3.add(v3.Muls(left, v), base);
                g_line_drawer.pushLine(v3.Sub(bx, tx), v3.Add(bx, tx), c);
                g_line_drawer.pushLine(v3.Sub(by, ty), v3.Add(by, ty), c);
            }
        }
    }
    if (mdl) {
        this.write(mdl, m34.MakeIdent(), mdl.user_data.insert_colors_default);
        if (document.body.contains(EditModel.mSlicerMgr.mEditArea)) {
            var slicer = EditModel.mSlicerMgr.getValue();
            draw_slicer_plane(slicer.pos, slicer.angle, slicer.offset, v4.Make(1, 0.5, 0.5, 1));
        }
        if (document.body.contains(EditModel.mPainterBoundMgr.mEditArea)) {
            var bound = EditModel.mPainterBoundMgr.getValue();
            draw_slicer_plane(
                bound.pos, bound.angle, bound.shape == 'plane' ? bound.bound : 0,
                v4.Make(0.5, 1, 0.5, 1));
        }
    }
};
EditModel.applySwitchCondition = function(mdl, values, is_preview, condition)
{
    var state = { enabled : true, };
    if (condition.switch_id) {
        var prefix = condition.switch_id + ':', value = null;
        for (var iv = 0; iv < values.length; ++iv) {
            if (values[iv].startsWith(prefix)) {
                value = values[iv].slice(prefix.length);
                break;
            }
        }
        if (value === null) {
            for (var i = 0; i < mdl.switches.length; ++i) {
                var a_switch = mdl.switches[i];
                if (a_switch.id == condition.switch_id) {
                    value = is_preview ? a_switch.preview_value_id
                        : a_switch.default_value_id;
                    //Log('use default value ' + value);
                    break;
                }
            }
        }
        state.enabled = ModelSwitch.evaluateCondition(condition, value);
    }
    return state;
};
EditModel.applySwitches = function(mdl, values, is_preview, part, e_mdl)
{
    if (!e_mdl) { return null; }
    var state = this.applySwitchCondition(mdl, values, is_preview, part.condition);
    state.insert_colors = Array.from(e_mdl.user_data.insert_colors_default);
    if (state.enabled) {
        for (var i = 0; i < mdl.switches.length; ++i) {
            var a_switch = mdl.switches[i];
            var prefix = a_switch.id + ':', value = is_preview
                ? a_switch.preview_value_id : a_switch.default_value_id;
            for (var iv = 0; iv < values.length; ++iv) {
                if (values[iv].startsWith(prefix)) {
                    value = values[iv].slice(prefix.length);
                    break;
                }
            }
            for (var iv = 0; iv < a_switch.values.length; ++iv) {
                var a_value = a_switch.values[iv];
                if (a_value.id == value) {
                    a_value.colors.forEach(function(sw_color) {
                        var info = e_mdl.user_data.insert_colors[sw_color.id];
                        if (info) { state.insert_colors[info.index] = sw_color.color; }
                    });
                    break;
                }
            }
        }
    }
    return state;
};
EditModel.draw = function(gl, view_ctx, draw_pass)
{
    this.mDrawPassMap[draw_pass].forEach(function(mdl) {
        mdl.user_data.drawer.draw(gl, view_ctx);
    });
};
EditModel.getDefaultValue = function() { return this.mRadioMgr.getValue(); };
EditModel.getDefault = function()
{
    var def = this.getDefaultValue(), ret = null;
    this.forEach(function(mdl) {
        if (mdl.user_data.uuid == def) { ret = mdl; }
    });
    return ret;
};
EditModel.getName = function(uuid) {
    return this.mIdToData[uuid].name;
};
EditModel.saveAll = function(data)
{
    this.mInstsMgr.updateArray();
    data.edit_models = EditModel.saveInsts(function(mdl) {
        if (data.type == cFileType_Model && !mdl.user_data.is_checked) { return null; }
        var ret = this.mInstMgr.saveData(mdl);
        ret.uuid = mdl.user_data.uuid;
        return ret;
    });
};
EditModel.loadAll = function(gl, data)
{
    this.loadInsts(data.edit_models, function(inst) {
        if (data.type == cFileType_Model && this.mIdToData[inst.uuid]) {
            Log(LangJoin([cLang.warn_tag, cLang.warn_already_exist,
                          ': ', cLang.menu_edit_model, ' [', inst.uuid, '] ',
                          this.mIdToData[inst.uuid].name]));
            return;
        }
        this.mInstMgr.setDefaultValues(inst);
        inst.user_data = CreateInstance(inst.user_data);
        inst.user_data.uuid = inst.uuid;
        inst.primitives.forEach(function(primitive) {
            this.mPrimitiveMgr.setDefaultValues(primitive);
            primitive.slicers.forEach(function(slicer) {
                this.mSlicerMgr.setDefaultValues(slicer);
            }, this);
        }, this);
        inst.painters.forEach(function(painter) {
            this.mPainterMgr.setDefaultValues(painter);
            painter.bounds.forEach(function(bound) {
                this.mPainterBoundMgr.setDefaultValues(bound);
            }, this);
        }, this);
        var elem_inst = this.mInstsMgr.createElementInst(inst);
        this.createDrawer(gl, elem_inst.mValue);
    });
    this.mInstsMgr.updateArray();
    this.updateList();
};
EditModel.initialize();
function AddEditModel() { EditModel.mInstsMgr.birthElement(); }
  </script>
  <!-- <script src="train.js"></script> -->
  <script>
'use strict';
var RailAnchor = CreateInstance();
RailAnchor.create = function(rail, dir_side, pos, dir, up)
{
    var anc = CreateInstance();
    anc.mRail    = rail    ;
    anc.mDirSide = dir_side;
    anc.mPos     = pos     ;
    anc.mDir     = dir     ;
    anc.mUp      = up      ;
    return anc;
};
RailAnchor.createDefault = function()
{
    return RailAnchor.create(
        null, 0, v3.Makes(0), v3.Make(0, 0, 1), v3.Make(0, 1, 0));
};
RailAnchor.copy = function(anc)
{
    return RailAnchor.create(
        anc.mRail   ,
        anc.mDirSide,
        anc.mPos    ,
        anc.mDir    ,
        anc.mUp     );
};
RailAnchor.turn = function(anc)
{
    var anc2 = RailAnchor.copy(anc);
    anc2.mDirSide = 1 - anc2.mDirSide;
    anc2.mDir     = v3.neg(anc2.mDir);
    return anc2;
};
var TrainCar = CreateInstance();
TrainCar.create = function(edit_obj)
{
    var car = CreateInstance();
    car.mEditObj = edit_obj;
    car.mHeadPos = v3.Makes(0);
    car.mTailPos = v3.Makes(0);
    car.mWheelsAtt = [];
    car.mPartsAtt = [];
    car.mPartsSwitchState = [];
    car.mSmokesSwitchState = [];
    car.mModel = this.getModelData(car);
    this.applySwitches(car);
    return car;
};
TrainCar.getModelData = function(car)
{
    return TrainModel.mIdToData[car.mEditObj.model];
};
TrainCar.write = function(car, mtx)
{
    var mdl = car.mModel;
    car.mPartsAtt = [];
    if (!mdl) { return; }
    TrainModel.write(mdl, car.mWheelsAtt, car.mPartsSwitchState, car.mSmokesSwitchState);
    mdl.user_data.parts_info.forEach(info => car.mPartsAtt.push(
        info.visible ? info.world_mtx : null));
};
TrainCar.applySwitches = function(car)
{
    if (!car.mModel) { return; }
    car.mPartsSwitchState = TrainModel.applySwitches(car.mModel, car.mEditObj.switches);
    car.mSmokesSwitchState = ModelSmoke.applySmokeSwitches(car.mModel, car.mEditObj.switches);
};
var Train = CreateObjMgr();
Train.create = function(edit_obj)
{
    var train = Train.createObj();
    train = CreateInstance(train);
    train.mEditObj = edit_obj;
    train.mHeadAnchor = RailAnchor.createDefault();
    train.mTailAnchor = RailAnchor.createDefault();
    train.mSensorAnchor = RailAnchor.createDefault();
    train.mSpeed = 0;
    train.mReverse = false;
    train.mCars = [];
    //train.mCollisionObjs = [];
    train.mRailReserves = [];
    train.mRailSensors = [];
    return train;
};
Train.clearCar = function(train) { train.mCars = []; };
Train.pushCar = function(train, car) { train.mCars.push(car); };
Train.insertCar = function(train, index, car) { train.mCars.splice(index, 0, car); };
Train.removeCar = function(train, car)
{
    var index = train.mCars.indexOf(car);
    if (index < 0) { return; }
    train.mCars.splice(index, 1);
    if (train.mCars.length <= 0) { Train.remove(train); }
};
Train.put = function(train, rail, rail_dir, pos, dir, up)
{
    train.mHeadAnchor.mRail = rail;
    train.mHeadAnchor.mDirSide = rail_dir;
    train.mTailAnchor.mRail = null;
    train.mSpeed = 0;
    train.mReverse = train.mEditObj.back;
    v3.copy(train.mHeadAnchor.mPos, pos);
    v3.copy(train.mHeadAnchor.mDir, dir);
    v3.copy(train.mHeadAnchor.mUp , up );
};
Train.isPut = function(train) { return train.mHeadAnchor.mRail != null; };
Train.remove = function(train)
{
    if (!Train.isPut(train)) { return; }
    Log(LangJoin([cLang.desc_train_removed, ': [' + train.mID + '] ', train.mEditObj.name]));
    train.mHeadAnchor.mRail = train.mTailAnchor.mRail = train.mSensorAnchor.mRail = null;
    Train.eraseCollisionObjs(train);
    Train.eraseRailReserves(train);
    Train.eraseRailSensors(train);
};
Train.eraseCollisionObjs = function(train) {
    if (!train.mCollisionObjs) { return; }
    train.mCollisionObjs.forEach(obj => RailCollision.erase(obj));
    train.mCollisionObjs = [];
};
Train.eraseRailReserves = function(train, new_data) {
    train.mRailReserves.forEach(reserve => Rail.eraseTrainInfo(reserve));
    train.mRailReserves = new_data || [];
};
Train.eraseRailSensors = function(train, new_data) {
    train.mRailSensors.forEach(sensor => Rail.eraseTrainInfo(sensor));
    train.mRailSensors = new_data || [];
};
Train.calc = function(train)
{
    if (!train.mHeadAnchor.mRail) { return; }
    var speed_mpf = 0, abs_speed = 0, speed_sign = 0;
    Train.eraseCollisionObjs(train);
    var proceed_args = { train : train, rail_reserves : [], };
    var sensor_args = {
        train : train, is_sensor : true, is_override_switch : true,
        rail_reserves : [],
    };
    var is_pause = IsPause();
    if ((train.mEditObj.go || train.mSpeed > 0) && train.mTailAnchor.mRail)
    {
        var accel = 1;//train.mEditObj.accel / cFPS;
        var decel = 1;//train.mEditObj.decel / cFPS;
        if (!train.mEditObj.go) {
            train.mSpeed = Math.max(train.mSpeed - decel, 0);
        } else if (train.mHeadAnchor.mRail && train.mTailAnchor.mRail) {
            if (train.mEditObj.back != train.mReverse) {
                if (train.mSpeed > 0) {
                    train.mSpeed = Math.max(train.mSpeed - decel, 0);
                } else {
                    train.mReverse = train.mEditObj.back;
                    train.mHeadAnchor = RailAnchor.turn(train.mTailAnchor);
                }
            } else if (train.mSpeed < train.mEditObj.speed) {
                train.mSpeed = Math.min(train.mSpeed + accel, train.mEditObj.speed);
            } else if (train.mSpeed > train.mEditObj.speed) {
                train.mSpeed = Math.max(train.mSpeed - decel, train.mEditObj.speed);
            }
        }
        speed_mpf = train.mSpeed / 216; // meter per frame
        var sensor_mpf = speed_mpf * Math.ceil(Math.abs(train.mSpeed) / decel) * 0.5;
        var sensor_margin = 0.1, switch_margin = 5, sensor_blocked = false;
        sensor_mpf += sensor_margin + switch_margin;
        var sensor_unit = 10, sensor_n = Math.ceil(sensor_mpf / sensor_unit);
        sensor_unit = sensor_n ? sensor_mpf / sensor_n : 0;
        var sensor_reach = 0;
        train.mSensorAnchor = train.mHeadAnchor;
        for (var i = 0; i < sensor_n; ++i) {
            var sr = Rail.proceed(train.mSensorAnchor, sensor_unit, sensor_args);
            if (sr.mRail && !sr.mIsBlocked) {
                sensor_reach += sensor_unit;
                train.mSensorAnchor = sr;
            } else {
                sensor_reach += v3.Length(v3.Sub(sr.mPos, train.mSensorAnchor.mPos));
                train.mSensorAnchor = sr;
                train.mSpeed *= Math.min(Math.sqrt(
                    Math.max(0, sensor_reach - sensor_margin)
                        / (Math.abs(sensor_mpf) - sensor_margin - switch_margin)), 1);
                sensor_blocked = !sr.mRail;
                break;
            }
        }
        proceed_args.is_override_switch = true;
        var ret = is_pause ? train.mHeadAnchor
            : Rail.proceed(train.mHeadAnchor, speed_mpf, proceed_args);
        proceed_args.is_override_switch = false;
        abs_speed = Math.abs(speed_mpf);
        speed_sign = Math.sign(speed_mpf);
        if (ret.mRail) {
            train.mHeadAnchor = ret;
            if (sensor_blocked && train.mSpeed == 0) {
                Train.reverse(train);
            }
        } else if (train.mTailAnchor.mRail) {
            if (ret.mIsBlocked) {
                speed_mpf = abs_speed = 0;
            } else {
                Train.reverse(train);
            }
        } else {
            Train.remove(train);
        }
    }
    Train.eraseRailReserves(train, proceed_args.rail_reserves);
    Train.eraseRailSensors(train, sensor_args.rail_reserves);
    var is_valid = false, prev_anc = RailAnchor.create(
        train.mHeadAnchor, 0, null, null, null);
    for (var i = 0; i < train.mCars.length; ++i) {
        var car = train.mCars[train.mReverse ? train.mCars.length - 1 - i : i];
        var mdl = car.mModel;
        if (!mdl) { continue; }
        is_valid = true;
        var length = mdl.length;
        if (i == 0) {
            prev_anc = RailAnchor.copy(train.mHeadAnchor);
            v3.copy(car.mHeadPos, train.mHeadAnchor.mPos);
        }
        if (!prev_anc.mRail) { break; }
        v3.copy(car.mHeadPos, prev_anc.mPos);
        var wheels_info = mdl.user_data.wheels_info, cur_z = 0;
        if (car.mWheelsAtt.length != wheels_info.length) {
            car.mWheelsAtt = [];
            wheels_info.forEach(wheel_info => car.mWheelsAtt.push({
                rot : 0,
            }));
        }
        function calc_wheel(iw, is_rev, sign) {
            var wheel_info = wheels_info[iw], radius = wheel_info.radius;
            var next_z = wheel_info.z, att = car.mWheelsAtt[iw];
            if (is_rev) { next_z = length - next_z; }
            prev_anc = Rail.proceed(prev_anc, cur_z - next_z, proceed_args);
            if (!prev_anc.mRail) { return false; }
            cur_z = next_z;
            if (radius && !is_pause) { att.rot -= sign * speed_sign * (1 - Math.exp(
                -abs_speed / (radius * cPI))) * cPI; }
            att.pos = v3.Dup(prev_anc.mPos);
            att.dir = v3.Muls(prev_anc.mDir, sign);
            att.up = v3.Dup(prev_anc.mUp);
            return true;
        }
        if (car.mEditObj.flip ^ train.mReverse) {
            for (var iw = wheels_info.length - 1; iw >= 0; --iw) {
                if (!calc_wheel(iw, true, -1)) { break; }
            }
        } else {
            for (var iw = 0; iw < wheels_info.length; ++iw) {
                if (!calc_wheel(iw, false, 1)) { break; }
            }
        }
        if (!prev_anc.mRail) { break; }
        prev_anc = Rail.proceed(prev_anc, cur_z - length, proceed_args);
        if (!prev_anc.mRail) { break; }
        v3.copy(car.mTailPos, prev_anc.mPos);
    }
    if (prev_anc.mRail && is_valid) {
        train.mTailAnchor = prev_anc;
    } else {
        Train.remove(train);
    }
};
Train.reverse = function(train)
{
    //Log('Train[' + train.mID + '] reverse.');
    train.mEditObj.back = train.mReverse = !train.mReverse;
    var editor_active = TrainEditor.mInstMgr.mActiveInst;
    if (editor_active && editor_active.mValue.user_data.sim_obj == train) {
        TrainEditor.mBackMgr.setValue(train.mReverse);
    }
    train.mHeadAnchor = RailAnchor.turn(train.mTailAnchor);
};
Train.requestResetAll = function() { this.sRequestResetAll = true; };
Train.calcAll = function()
{
    if (!IsEditorMode()) {
        if (this.sRequestResetAll) {
            this.sRequestResetAll = false;
            Train.forEach(train => TrainEditor.updateTrain(train.mEditObj));
        }
        Train.forEach(Train.calc);
    }
};
Train.write = function(train)
{
    if (!train.mHeadAnchor.mRail) { return; }
    //var up = train.mHeadAnchor.mUp;
    for (var i = 0; i < train.mCars.length; ++i) {
        var car = train.mCars[i];
        TrainCar.write(car);
    }
    if (IsEnableDebugDraw() && train.mSensorAnchor.mRail) {
        g_sphere_drawer.pushSphere(AddRailTotalHeight(
            train.mSensorAnchor.mPos, train.mSensorAnchor.mUp), 2, v4.Make(0, 1, 1, 1));
    }
};
Train.writeAll = function()
{
    Train.forEach(Train.write);
};
Train.forEachCar = function(f, a_this)
{
    this.forEach(function(train) {
        train.mCars.forEach(function(car) {
            f.apply(a_this, [train, car]);
        });
    });
};
var TrainSetter = CreateInstance();
TrainSetter.cMinDist = 5.0;
TrainSetter.mCursorPos = v3.Makes(0);
TrainSetter.mCursorDir = v3.Makes(0);
TrainSetter.mCursorDirBasePos = v3.Makes(0);
TrainSetter.mIsTooClose = false;
TrainSetter.putTrain = function()
{
    if (this.mNearestRail) {
        var con = this.mNearestRail;
        var tr = TrainEditor.getSelected();
        if (!tr) return;
        var train = tr.user_data.sim_obj;
        Log(LangJoin([cLang.desc_train_set, ': [' + train.mID + '] ', train.mEditObj.name]));
        var pos = v3.add(v3.Muls(con.up, RailMetric.cTotalHeight), con.pos);
        Train.put(train, con.rail, this.mNearestRailDirSide,
                  pos, con.dir, con.up);
        this.mNearestRail = null;
    }
};
TrainSetter.calc = function(wpos)
{
    this.mCursorPos = v3.Dup(wpos);
    if (v3.CalcDist(this.mCursorDirBasePos, wpos) > 0.5) {
        this.mCursorDir = v3.Sub(wpos, this.mCursorDirBasePos);
        this.mCursorDirBasePos = v3.Dup(wpos);
    }
    this.mNearestRail = null;
    var nearest_rail = Rail.searchNearestRail(wpos);
    if (nearest_rail.rail) {
        if (nearest_rail.dist < this.cMinDist) {
            if (IsMenuTrainList()) {
                this.mNearestRail = nearest_rail;
                if (v3.Dot(this.mNearestRail.dir, this.mCursorDir) < 0) {
                    v3.neg(this.mNearestRail.dir);
                    this.mNearestRailDirSide = 0;
                } else {
                    this.mNearestRailDirSide = 1;
                }
            }
        }
    }
};
TrainSetter.write = function()
{
    var nearest_point = null;
    var con_pos = null, con_dir = null;
    if (this.mNearestRail)
    {
        if (IsMenuTrainList()) {
            var rail = this.mNearestRail.rail;
            var pos = v3.add(v3.Muls(
                this.mNearestRail.up, RailMetric.cTotalHeight), this.mNearestRail.pos);
            DrawArrow(pos,
                      v3.add(v3.Muls(this.mNearestRail.dir, 2.5), pos),
                      0.5, v4.Make(1, 0, 0, 1), this.mNearestRail.up);
        }
    }
};
  </script>
  <!-- <script src="train_model.js"></script> -->
  <script>
'use strict';
var TrainModel = CreateIDMgr(null, true);
TrainModel.mModelsObj = null;
TrainModel.mRadioMgr = UI_Radios.createMgr({
    name : 'train-model-default',
    title : 'preview model',
    for_each : function(f) {
        TrainModel.forEach(function(mdl) { f(mdl.user_data.def_radio); });
    }, });
TrainModel.mIdToData = {};
TrainModel.mSelectMgr = UI_Select.createMgr({
    clip_name : 't-model-sel', no_ctrl_br : true, disable_undo : true, fixed : true, });
TrainModel.mInstMgr = UI_Struct.createMgr({
    name : 'train model', clip_name : 't-model',
    on_create_instance : function(elem_inst) {
        var val = elem_inst.mValue;
        val.user_data = TrainModel.issueID(val.user_data);
        val.user_data.def_radio = TrainModel.mRadioMgr.createInstance({
            parent : elem_inst.mTitleObj, prepend : true, id : val.user_data.uuid, });
        UI_Radios.setCheck(val.user_data.def_radio);
    },
    on_update : function(inst) {
        TrainModel.updateList();
        TrainModel.updateMatrix(inst.mValue);
    },
    on_activate : function(inst) { UI_Radios.setCheck(inst.mValue.user_data.def_radio); }, });
TrainModel.mInstMgr.getUUID = function(value) { return value.user_data.uuid; };
TrainModel.mInstMgr.pushStruct({
    key : 'name', title : cLang.cmn_name, def_value : 't-model', labeled : 'value',
    mgr : UI_LangText.createMgr({ parent_mgr : TrainModel.mInstMgr, fixed : true, }), });
TrainModel.mInstMgr.pushStruct({
    key : 'author', title : cLang.cmn_author, def_value : null,
    mgr : FileMode.createAuthorInfoMgr(TrainModel.mInstMgr), });
TrainModel.mInstMgr.pushStruct({
    key : 'length', def_value : 20, labeled : true,
    title : cLang.train_length, title_sub : ' [m]',
    mgr : UI_Slider.createMgr({
        parent_mgr : TrainModel.mInstMgr, fixed : true,
        min : 0, max : 50, slide_round : 0.01, }), });
TrainModel.mInstMgr.pushStruct({
    key : 'rail_type', def_value : 'narrow',
    title : cLang.train_railtype,
    mgr : UI_Select.createMgr({
        fixed : true, clip_name : 'preview-rail-type',
        options : [
            { label : cLang.cmn_none     , value : 'none'    , },
            { label : cLang.rail_narrow  , value : 'narrow'  , },
            { label : cLang.rail_standard, value : 'standard', },
            { label : cLang.rail_safege  , value : 'safege'  , },
            { label : cLang.rail_alweg   , value : 'alweg'   , },
        ], }), });
TrainModel.mPartMgr = UI_Struct.createMgr({ clip_name : 'part', disable_undo : true, });
TrainModel.mPartMgr.pushStruct({
    key : 'model', title : cLang.cmn_model, def_value : '', labeled : 'value',
    get_def_value : function() {
        var v = EditModel.getDefaultValue(); return v === null ? '' : v;
    },
    mgr : EditModel.createSelectMgr({
        parent_mgr : TrainModel.mPartMgr, fixed : true, no_ctrl_br : true, }), });
TrainModel.mPartMgr.pushStruct({
    key : 'type', title : cLang.cmn_type, def_value : 'wheel',
    mgr : UI_Select.createMgr({
        parent_mgr : TrainModel.mPartMgr, fixed : true, clip_name : 't-model-part-type',
        options : [
            { label : cLang.train_part_wheel    , value : 'wheel'    , },
            { label : cLang.train_part_bogie    , value : 'bogie'    , },
            { label : cLang.train_part_body     , value : 'body'     , },
            { label : cLang.train_part_rod_tri  , value : 'rod_tri'  , },
            { label : cLang.train_part_rod_slide, value : 'rod_slide', },
        ], }), });
TrainModel.mPartMgr.pushStruct({
    key : 'id', title : 'ID', def_value : '', labeled : true,
    mgr : UI_Text.createMgr({
        parent_mgr : TrainModel.mPartMgr, fixed : true, size : 8, type : 'id', }), });
TrainModel.mPartMgr.pushStruct({
    key : 'mount_ids', def_value : [], labeled : true,
    title : LangJoin([cLang.train_fixed_to, ' ', cLang.cmn_ids]),
    mgr : UI_Text.createMgr({
        parent_mgr : TrainModel.mPartMgr, fixed : true, size : 8, type : 'ids', }), });
TrainModel.mPartMgr.pushStruct({
    key : 'scale', title : cLang.cmn_scale, def_value : v3.Makes(1),
    condition : function(value) { return !value.type.startsWith('rod'); },
    mgr : UI_Vector.createMgr({
        parent_mgr : TrainModel.mPartMgr, fixed : true, dim : 3, min : 0, max : 10, }), });
TrainModel.mPartMgr.pushStruct({
    key : 'rotate', title : cLang.cmn_rotate, def_value : v3.Makes(0),
    condition : function(value) { return !value.type.startsWith('rod'); },
    mgr : UI_Vector.createMgr({
        parent_mgr : TrainModel.mPartMgr, fixed : true,
        dim : 3, min : -180, max : 180, size : 4, slide_round : 0.1, }), });
TrainModel.mPartMgr.pushStruct({
    key : 'trans', title : cLang.cmn_trans, def_value : v3.Makes(0),
    condition : function(value) { return !value.type.startsWith('rod'); },
    mgr : UI_Vector.createMgr({
        parent_mgr : TrainModel.mPartMgr, fixed : true, dim : 3, min : -50, max : 50, }), });
TrainModel.mSubPartMgr = UI_Struct.createMgr({
    clip_name : 'sub-part', fixed : true, parent_mgr : TrainModel.mPartMgr, });
TrainModel.mSubPartMgr.pushStruct({
    key : 'model', title : LangAppend(cLang.cmn_model, ' 2'), def_value : '', labeled : 'value',
    mgr : EditModel.createSelectMgr({
        parent_mgr : TrainModel.mSubPartMgr, fixed : true, no_ctrl_br : true, }), });
TrainModel.mSubPartMgr.pushStruct({
    key : 'id', title : 'ID 2', def_value : '', labeled : true,
    mgr : UI_Text.createMgr({
        parent_mgr : TrainModel.mSubPartMgr, fixed : true, size : 8, type : 'id', }), });
TrainModel.mSubPartMgr.pushStruct({
    key : 'fix_to_pos1', title : LangAppend(cLang.train_fixed_to_pos, ' 1'),
    def_value : v3.Makes(0),
    mgr : UI_Vector.createMgr({
        parent_mgr : TrainModel.mSubPartMgr, fixed : true, dim : 3, min : -10, max : 10, }), });
TrainModel.mSubPartMgr.pushStruct({
    key : 'rod_len1', title : LangAppend(cLang.train_rod_length, ' 1'),
    def_value : 1, mgr : UI_Slider.createMgr({
        parent_mgr : TrainModel.mSubPartMgr, fixed : true, min : 0, max : 10, }), });
TrainModel.mSubPartMgr.pushStruct({
    key : 'fix_to_pos2', title : LangAppend(cLang.train_fixed_to_pos, ' 2'),
    def_value : v3.Makes(0),
    mgr : UI_Vector.createMgr({
        parent_mgr : TrainModel.mSubPartMgr, fixed : true, dim : 3, min : -10, max : 10, }), });
TrainModel.mSubPartMgr.pushStruct({
    key : 'rod_len2', title : LangAppend(cLang.train_rod_length, ' 2'),
    def_value : 1, mgr : UI_Slider.createMgr({
        parent_mgr : TrainModel.mSubPartMgr, fixed : true, min : 0, max : 10, }), });
TrainModel.mSubPartMgr.initializeStruct();
TrainModel.mPartMgr.pushStruct({
    key : 'sub_part', title : '', def_value : null,
    condition : function(value) { return value.type.startsWith('rod'); },
    mgr : TrainModel.mSubPartMgr, });
TrainModel.mPartMgr.pushStruct({
    key : 'accept_focus', title : cLang.model_accept_focus, def_value : true,
    mgr : UI_Check.createMgr({ parent_mgr : TrainModel.mPartMgr, fixed : true, }), });
TrainModel.mPartMgr.pushStruct({
    key : 'condition', title : cLang.cmn_condition, def_value : null,
    mgr : ModelSwitch.createConditionMgr(TrainModel.mPartMgr), });
TrainModel.mPartMgr.initializeStruct();
TrainModel.mPartsMgr = UI_Array.createMgr({
    parent_mgr : TrainModel.mInstMgr, fixed : true,
    element_mgr : TrainModel.mPartMgr, init_element_value : null, });
TrainModel.mInstMgr.pushStruct({
    key : 'parts', title : cLang.cmn_parts, labeled : true, def_value : [],
    get_def_value : function() {
        return [TrainModel.mPartMgr.makeDefaultValue()];
    },
    mgr : TrainModel.mPartsMgr, });
TrainModel.mInstMgr.pushStruct({
    key : 'smokes', title : cLang.cmn_smokes, labeled : true, def_value : [],
    mgr : ModelSmoke.createSmokesMgr(TrainModel, TrainModel.mInstMgr, true), });
TrainModel.mInstMgr.pushStruct({
    key : 'switches', title : cLang.cmn_switches, labeled : true, def_value : [],
    mgr : ModelSwitch.createSwitchesMgr(TrainModel, TrainModel.mInstMgr), });
TrainModel.mInstMgr.initializeStruct();
TrainModel.mInstsMgr = UI_Array.createMgr({
    fixed : true, root : true, element_mgr : TrainModel.mInstMgr, init_element_value : null,
    on_update_array : function() {
        TrainModel.updateList();
    },
    is_deletable : function(inst) {
        var ret = true;
        Train.forEachCar(function(train, car) {
            if (car.mEditObj.model != inst.mValue.uuid) { return; }
            Log(LangJoin([cLang.error_not_deletable, ': ', inst.mValue.name, ' (',
                          cLang.error_used_by, ': ', train.mEditObj.name, ')']));
            if (!ret) { return; }
            DebugLog.show();
            ret = false;
        });
        return ret;
    }, });
TrainModel.initialize = function()
{
    this.mListObj = CreateEditPane('train-model', cLang.head_train_model, function(div_on) {
        this.mInsts = this.mInstsMgr.createInstance({
            parent : div_on, value : [], });
        this.mInstsMgr.activate(this.mInsts);
    }, this);
};
TrainModel.forEach = function(f, a_this)
{
    this.mInstsMgr.mElements.forEach(function(elem_inst) {
        f.apply(a_this, [elem_inst.mValue]);
    });
};
TrainModel.clear = function() { this.mInstsMgr.deleteAll(); };
TrainModel.updateList = function()
{
    this.mRadioMgr.updateCheck();
    this.mIdToData = {};
    this.mSelectMgr.clear();
    this.forEach(function(mdl) {
        this.mIdToData[mdl.user_data.uuid] = mdl;
        this.mSelectMgr.addOption({
            label : mdl.name, value : mdl.user_data.uuid, user_data : mdl,
            author : mdl.author, });
    }, this);
    if (TrainEditor.mCarsMgr.mActiveInst) {
        TrainEditor.mCarsMgr.mElements.forEach(function(elem) {
            TrainEditor.mCarMgr.updateLabel(elem);
        });
    }
};
TrainModel.updateMatrix = function(mdl)
{
    mdl.user_data = CreateInstance(mdl.user_data);
    mdl.user_data.parts_info = [];
    mdl.user_data.wheels_info = [];
    mdl.user_data.bodies_info = [];
    mdl.user_data.smokes_info = [];
    var i_part = 0, half_len = mdl.length * 0.5;
    mdl.parts.forEach(function(part) {
        var part_info = {
            index : i_part++,
            sub_index : -1,
            part : part,
            mtx : m34.MakeSRTDeg(part.scale, part.rotate,
                                 v3.Make(part.trans[0], part.trans[1], 0)),
            world_mtx : null,
            z : half_len - part.trans[2],
            radius : part.type == 'wheel' ? part.trans[1] : 0,
        };
        part_info.mounts = [];
        var sub_mdl = TrainModel.getSubModel(part);
        if (sub_mdl) { part_info.sub_index = i_part++; }
        part.mount_ids.forEach(function(mount_id) {
            if (mount_id == '') { return; }
            function do_push(o) { part_info.mounts.push(o); }
            for (var i = 0; i < mdl.user_data.parts_info.length; ++i) {
                var part_info2 = mdl.user_data.parts_info[i];
                if (part_info2.part.id == mount_id) { do_push(part_info2); }
                var sub_mdl2 = TrainModel.getSubModel(part_info2.part);
                if (sub_mdl2 && part_info2.part.sub_part.id == mount_id) {
                    do_push({ is_sub : true, part : part_info2, });
                }
            }
        });
        mdl.user_data.parts_info.push(part_info);
        if (part_info.mounts.length == 0) {
            mdl.user_data.wheels_info.push(part_info);
        } else {
            var z_min = null, z_max = null;
            part_info.mounts.forEach(function(part_info2) {
                if (part_info2.is_sub) { return; }
                var part2 = part_info2.part;
                if (z_min === null) {
                    z_min = z_max = part2.trans[2];
                } else {
                    z_min = Math.min(z_min, part2.trans[2]);
                    z_max = Math.max(z_max, part2.trans[2]);
                }
            });
            if (z_min === null) {
                mdl.user_data.wheels_info.push(part_info);
            } else {
                part_info.z_ofs = part.trans[2] - (z_max + z_min) / 2;
                mdl.user_data.bodies_info.push(part_info);
            }
        }
    });
    mdl.smokes.forEach(function(smoke) {
        var smoke_info = {
            smoke : smoke,
            mtx : m34.MakeSRTDeg(smoke.scale, v3.Makes(0), smoke.trans),
            world_mtx : null,
        };
        if (smoke.mount_id) {
            for (var i = 0; i < mdl.user_data.parts_info.length; ++i) {
                var part_info2 = mdl.user_data.parts_info[i];
                if (part_info2.part.id == smoke.mount_id) {
                    smoke_info.mount = part_info2;
                }
            }
        }
        mdl.user_data.smokes_info.push(smoke_info);
    });
    mdl.user_data.wheels_info.sort(function(a, b) {
        var dz = a.z - b.z;
        if (dz) { return dz; }
        return a.index - b.index;
    });
    Train.forEachCar(function(train, car) {
        if (car.mEditObj.model == mdl.user_data.uuid) {
            car.mWheelsAtt = [];
        }
    });
};
TrainModel.getSubModel = function(part)
{
    if (!part.type.startsWith('rod')) { return null; }
    var ret = EditModel.mIdToData[part.sub_part.model];
    return ret || { is_dummy : true, };
};
TrainModel.write = function(mdl, wheels_att, parts_sw, smokes_sw)
{
    var wheels_info = mdl.user_data.wheels_info, bodies_info = mdl.user_data.bodies_info;
    for (var i = 0; i < wheels_info.length; ++i) {
        var wheel_info = wheels_info[i], part = wheel_info.part, att = wheels_att[i];
        var mdl_mtx = m34.MakeSRT(part.scale, v3.addX(v3.Muls(part.rotate, cDeg2Rad), att.rot),
                                  m34.GetTrans(wheel_info.mtx));
        var mtx = m34.MakeOrtho(
            att.dir, att.up, v3.add(v3.Muls(att.up, RailMetric.cTotalHeight), att.pos));
        m34.setMul(mtx, mtx, mdl_mtx);
        var part_sw = parts_sw[wheel_info.index]
        wheel_info.visible = false;
        if (!part_sw || part_sw.enabled) {
            wheel_info.visible = true;
            EditModel.write(EditModel.mIdToData[part.model], mtx,
                            part_sw && part_sw.insert_colors);
        }
        wheel_info.work_att = att;
        wheel_info.world_mtx = mtx;
    }
    function get_part_att(part_ref) {
        if (part_ref.is_sub) { return part_ref.part.work_att; }
        return part_ref.work_att;
    }
    function get_part_mtx(part_ref) {
        if (part_ref.is_sub) { return part_ref.part.world_mtx2; }
        return part_ref.world_mtx;
    }
    for (var i = 0; i < bodies_info.length; ++i) {
        var body_info = bodies_info[i], part = body_info.part;
        var att = get_part_att(body_info.mounts[0]);
        if (body_info.mounts.length > 1) {
            var att1 = get_part_att(body_info.mounts[body_info.mounts.length - 1]);
            var mdir = v3.normalize(v3.Add(att.dir, att1.dir));
            att = {
                pos : v3.Lerp(att.pos, att1.pos, 0.5),
                dir : v3.normalize(v3.Sub(att.pos, att1.pos)),
                up : v3.normalize(v3.Add(att.up, att1.up)),
            };
            if (v3.Dot(mdir, att.dir) < 0) { v3.neg(att.dir); }
        } else {
            att = Object.assign({}, att);
        }
        att.pos = v3.Add(att.pos, v3.Muls(att.dir, body_info.z_ofs));
        var mtx = m34.MakeOrtho(
            att.dir, att.up, v3.add(v3.Muls(att.up, RailMetric.cTotalHeight), att.pos));
        m34.setMul(mtx, mtx, body_info.mtx);
        var part_sw = parts_sw[body_info.index];
        body_info.visible = false;
        if (!part_sw || part_sw.enabled) {
            body_info.visible = true;
            var sub_mdl = TrainModel.getSubModel(part);
            if (sub_mdl) {
                var sub_part = part.sub_part, mtx2, npos;
                var sub_part_sw = parts_sw[body_info.sub_index];
                var fix_to_mtx1 = get_part_mtx(body_info.mounts[0]);
                var fix_to_mtx2 = get_part_mtx(body_info.mounts[body_info.mounts.length - 1]);
                if (!fix_to_mtx1 || !fix_to_mtx2) { continue; }
                var fpos1 = m34.MulV3(fix_to_mtx1, sub_part.fix_to_pos1);
                var fpos2 = m34.MulV3(fix_to_mtx2, sub_part.fix_to_pos2);
                var mleft = m34.GetCol(fix_to_mtx1, 0);
                var nleft = m34.GetCol(fix_to_mtx2, 0);
                if (part.type.endsWith('tri')) {
                    var ddir = v3.Sub(fpos2, fpos1), rdist = v3.Length(ddir);
                    if (sub_part.rod_len1 + sub_part.rod_len2 < rdist) {
                        npos = v3.Mid(fpos1, fpos2);
                    } else {
                        var ddist = this.solveTriangle(
                            sub_part.rod_len1, sub_part.rod_len2, rdist);
                        v3.muls(ddir, 1 / rdist);
                        var adist = Math.sqrt(
                            sub_part.rod_len1 * sub_part.rod_len1 - ddist * ddist);
                        var dup = v3.normalize(v3.Cross(v3.Mid(mleft, nleft), ddir));
                        npos = v3.add(v3.add(v3.Muls(ddir, adist), fpos1),
                                          v3.Muls(dup, ddist));
                    }
                    ndir = v3.Sub(fpos2, npos);
                } else {
                    mtx = m34.MakeST(v3.ones, fpos1);
                    var sdir = get_part_att(body_info.mounts[0]).dir;
                    var cdir = v3.Sub(fpos2, fpos1), cdist = v3.Dot(cdir, sdir);
                    npos = v3.Add(fpos1, v3.Muls(sdir, cdist));
                    //mtx2 = m34.MakeST(v3.ones, fpos2);
                    var ndir = v3.Sub(npos, fpos2), ndist = v3.Length(ndir);
                    var clen = sub_part.rod_len2;
                    if (clen <= 0) {
                        npos = fpos2;
                    } else if (ndist < clen) {
                        var zofs = Math.sqrt(clen * clen - ndist * ndist);
                        v3.add(npos, v3.Muls(sdir, zofs));
                        ndir = v3.Sub(fpos2, npos);
                    }
                }
                body_info.fpos1 = fpos1;
                body_info.fpos2 = fpos2;
                body_info.npos = npos;
                var mdir = v3.Sub(fpos1, npos);
                var mup = v3.Cross(mdir, mleft);
                mtx = m34.MakeOrtho(mdir, mup, npos, v3.ones);
                var nup = v3.Cross(ndir, nleft);
                mtx2 = m34.MakeOrtho(ndir, nup, npos, v3.ones);
                if (!sub_mdl.is_dummy) {
                    EditModel.write(sub_mdl, mtx2, sub_part_sw && sub_part_sw.insert_colors);
                }
                body_info.world_mtx2 = mtx2;
            }
            EditModel.write(EditModel.mIdToData[part.model], mtx,
                            part_sw && part_sw.insert_colors);
        }
        body_info.work_att = att;
        body_info.world_mtx = mtx;
    }
    var smokes_info = mdl.user_data.smokes_info;
    for (var i = 0; i < smokes_info.length; ++i) {
        var smoke_sw = smokes_sw[i];
        if (smoke_sw && !smoke_sw.enabled) { continue; }
        var smoke_info = smokes_info[i];
        var smoke = smoke_info.smoke;
        if (!smoke_info.mount) { continue; }
        var fix_to_mtx = get_part_mtx(smoke_info.mount);
        if (!fix_to_mtx) { continue; }
        if (Math.random() > smoke.emit_ratio) { continue; }
        var smoke_pos = m34.MulV3(fix_to_mtx, smoke.trans);
        var smoke_dir = m34.RotV3(fix_to_mtx, smoke.direction);
        g_smoke_drawer.pushSmoke(smoke_pos, smoke_dir, smoke);
    }
};
TrainModel.solveTriangle = function(a, b, c)
{
    var a2 = a * a, b2 = b * b, c2 = c * c, t = a2 + b2 - c2;
    return Math.sqrt(4 * a2 * b2 - t * t) / (2 * c);
};
TrainModel.writeEditor = function()
{
    var mdl = TrainModel.getDefault();
    if (mdl) {
        var wheels_att = [], half_len = mdl.length * 0.5
        mdl.user_data.wheels_info.forEach(function(wheel_info) {
            wheels_att.push({
                rot : 0,
                pos : v3.Make(0, 0, half_len - wheel_info.z),
                dir : v3.Make(0, 0, 1),
                up : v3.Make(0, 1, 0),
            });
        });
        var tmp_state = TrainModel.applySwitches(mdl, [], true);
        var tmp_smoke_state = ModelSmoke.applySmokeSwitches(mdl, [], true);
        TrainModel.write(mdl, wheels_att, tmp_state, tmp_smoke_state);
        if (document.body.contains(TrainModel.mSubPartMgr.mEditArea)) {
            function draw_joint_pos(pos) {
                g_line_drawer.pushDualAxis(m34.MakeST(v3.ones, pos));
            }
            if (this.mInstMgr.mActiveInst.mValue.user_data == mdl.user_data) {
                var i_part = 0;
                this.mPartsMgr.mElements.forEach(function(elem) {
                    if (elem == this.mPartMgr.mActiveInst) {
                        mdl.user_data.bodies_info.forEach(function(body_info) {
                            if (i_part != body_info.index) { return; }
                            if (body_info.fpos1) { draw_joint_pos(body_info.fpos1); }
                            if (body_info.fpos2) { draw_joint_pos(body_info.fpos2); }
                            if (body_info.npos ) { draw_joint_pos(body_info.npos ); }
                        });
                    }
                    ++i_part;
                    if (this.getSubModel(elem.mValue)) { ++i_part; }
                }, this);
            }
        }
    }
};
TrainModel.applySwitches = function(mdl, values, is_preview)
{
    //Log('applySwitches ' + mdl.name);
    var ret = [];
    mdl.parts.forEach(function(part) {
        var e_mdl = EditModel.mIdToData[part.model];
        ret.push(EditModel.applySwitches(mdl, values, is_preview, part, e_mdl));
        var sub_mdl = TrainModel.getSubModel(part);
        if (sub_mdl) {
            if (sub_mdl.is_dummy) { ret.push(null); }
            else { ret.push(EditModel.applySwitches(mdl, values, is_preview, part, sub_mdl)); }
        }
    });
    return ret;
};
TrainModel.draw = function(gl, view_ctx)
{
    var mdl = this.getDefault();
    if (!mdl) { return; }
    var t_mdl = this.mInstMgr.getValue();
    var drawers = this.mPreviewRailDrawers[
        t_mdl.user_data && t_mdl.user_data.uuid == mdl.user_data.uuid
            ? t_mdl.rail_type : mdl.rail_type];
    if (!drawers) { return; }
    drawers.rail_drawer.draw(gl, view_ctx);
    if (drawers.ballast_drawer) { drawers.ballast_drawer.draw(gl, view_ctx); }
};
TrainModel.getDefaultValue = function() { return this.mRadioMgr.getValue(); };
TrainModel.getDefault = function()
{
    var def = this.getDefaultValue(), ret = null;
    this.forEach(function(mdl) {
        if (mdl.user_data.uuid == def) { ret = mdl; }
    });
    return ret;
};
TrainModel.getName = function(uuid) {
    return this.mIdToData[uuid].name;
};
TrainModel.getDefaultSwitches = function(uuid)
{
    var ret = [], mdl = TrainModel.mIdToData[uuid];
    if (!mdl) { return ret; }
    mdl.switches.forEach(function(a_switch) {
        ret.push(a_switch.id + ':' + a_switch.default_value_id);
    });
    return ret;
};
TrainModel.saveAll = function(data)
{
    this.mInstsMgr.updateArray();
    data.train_models = TrainModel.saveInsts(function(mdl) {
        if (data.type == cFileType_Model && !mdl.user_data.is_checked) { return null; }
        var ret = this.mInstMgr.saveData(mdl);
        ret.uuid = mdl.user_data.uuid;
        ret.parts.forEach(function(part) {
            part.model = EditModel.mIdToData[part.model].user_data.uuid;
        });
        return ret;
    });
};
TrainModel.loadAll = function(gl, data)
{
    this.loadInsts(data.train_models, function(inst) {
        if (data.type == cFileType_Model && this.mIdToData[inst.uuid]) {
            Log(LangJoin([cLang.warn_tag, cLang.warn_already_exist,
                          ': ', cLang.menu_train_model, ' [', inst.uuid, '] ',
                          this.mIdToData[inst.uuid].name]));
            return;
        }
        this.mInstMgr.setDefaultValues(inst);
        inst.user_data = CreateInstance(inst.user_data);
        inst.user_data.uuid = inst.uuid;
        inst.parts.forEach(function(part) {
            this.mPartMgr.setDefaultValues(part);
            this.mSubPartMgr.setDefaultValues(part.sub_part);
        }, this);
        inst.smokes.forEach(function(smoke) {
            this.mSmokeMgr.setDefaultValues(smoke);
        }, this);
        inst.switches.forEach(function(a_switch) {
            this.mSwitchMgr.setDefaultValues(a_switch);
            a_switch.values.forEach(function(a_value) {
                this.mValueMgr.setDefaultValues(a_value);
            }, this);
        }, this);
        var elem_inst = this.mInstsMgr.createElementInst(inst);
        this.updateMatrix(elem_inst.mValue);
    });
    this.mInstsMgr.updateArray();
    this.updateList();
};
TrainModel.createPreviewRailImpl = function(gl, args)
{
    var ret = {};
    ret.rail_drawer = RailDrawer.create(args.rail);
    ret.rail_drawer.initialize(gl, 32);
    ret.rail_drawer.beginWrite();
    if (args.tie >= 0) {
        ret.ballast_drawer = RailDrawer.create(args.tie);
        ret.ballast_drawer.initialize(gl, 32);
        ret.ballast_drawer.beginWrite();
    }
    var length = cGridWidth, acc_len = 0;
    for (var i = 0; i < 2; ++i ) {
        var seg = { pos : v3.Make(0, 0, (i - 0.5) * length),
                    left : v3.Make(1, 0, 0), up : v3.Make(0, 1, 0),
                    fleft : v3.Make(1, 0, 0), fup : v3.Make(0, 1, 0),
                    ballast_v : acc_len * RailMetric.calcTieNum(acc_len) / length, };
        var d_args = { gauge : args.gauge, ballast_ofs : [0, 0], };
        ret.rail_drawer.pushSegment(seg, d_args, i == 0, i == 1);
        if (args.tie >= 0) { ret.ballast_drawer.pushSegment(seg, d_args, i == 0, i == 1); }
        acc_len += length;
    }
    ret.rail_drawer.endWrite(gl);
    if (args.tie >= 0) { ret.ballast_drawer.endWrite(gl); }
    return ret;
};
TrainModel.createPreviewRail = function(gl)
{
    this.mPreviewRailDrawers = {};
    [
        { type : 'narrow'  , rail : RailDrawerType.cDefault,
          tie : RailDrawerType.cBallast, gauge : 0, },
        { type : 'standard', rail : RailDrawerType.cDefault,
          tie : RailDrawerType.cBallast, gauge : 1, },
        { type : 'safege'  , rail : RailDrawerType.cSafege ,
          tie : -1, gauge : 0, },
        { type : 'alweg'   , rail : RailDrawerType.cAlweg  ,
          tie : -1, gauge : 0, },
    ].forEach(function(args) {
        this.mPreviewRailDrawers[args.type] = this.createPreviewRailImpl(gl, args);
    }, this);
    this.mPreviewRailDrawers.safege.rail_drawer.setDrawProfileNum(cSafegeBottomProfileNum  );
    this.mPreviewRailDrawers.alweg .rail_drawer.setDrawProfileNum(cAlwegNonBottomProfileNum);
};
TrainModel.initialize();
function AddTrainModel() { TrainModel.mInstsMgr.birthElement(); }
  </script>
  <!-- <script src="train_editor.js"></script> -->
  <script>
'use strict';
var TrainEditor = CreateInstance();
TrainEditor.mRadioMgr = UI_Radios.createMgr({
    name : 'train-list-default',
    title : 'put train',
    for_each : function(f) {
        TrainEditor.forEach(function(tr) { f(tr.user_data.def_radio); });
    }, });
TrainEditor.mIdToData = {};
TrainEditor.mSelectMgrs = [];
TrainEditor.createSelectMgr = function(args) {
    var mgr = UI_Select.createMgr(Object.assign({ clip_name : 't-selection', }, args));
    this.mSelectMgrs.push(mgr);
    return mgr;
};
TrainEditor.mInstMgr = UI_Struct.createMgr({
    name : 'train', clip_name : 'train',
    on_create_instance : function(elem_inst) {
        var val = elem_inst.mValue, sim_obj = Train.create(val);
        val.user_data = CreateInstance(val.user_data);
        val.user_data.sim_obj = sim_obj;
        val.user_data.def_radio = TrainEditor.mRadioMgr.createInstance({
            parent : elem_inst.mTitleObj, prepend : true, id : sim_obj.mID, });
        UI_Radios.setCheck(val.user_data.def_radio);
    },
    on_update : function(inst, src_mgr) {
        TrainEditor.updateList();
        TrainEditor.updateTrain(
            inst.mValue, !src_mgr || src_mgr == TrainEditor.mGoMgr
                || src_mgr == TrainEditor.mBackMgr || src_mgr == TrainEditor.mSpeedMgr
                || src_mgr == TrainEditor.mSwitchSelectMgr
                || src_mgr == TrainEditor.mSwitchSelectsMgr);
    },
    on_activate : function(inst) { UI_Radios.setCheck(inst.mValue.user_data.def_radio); }, });
TrainEditor.mInstMgr.pushStruct({
    title : cLang.cmn_remove, link_title : cLang.desc_remove_train,
    cmd : function(inst) { Train.remove(inst.user_data.sim_obj); }, });
TrainEditor.mInstMgr.pushStruct({
    key : 'name', title : cLang.cmn_name, def_value : 'train', labeled : 'value',
    mgr : UI_LangText.createMgr({ parent_mgr : TrainEditor.mInstMgr, fixed : true, }), });
TrainEditor.mInstMgr.pushStruct({
    key : 'go', title : cLang.train_go, def_value : true,
    mgr : TrainEditor.mGoMgr = UI_Check.createMgr({
        parent_mgr : TrainEditor.mInstMgr, fixed : true, }), });
TrainEditor.mInstMgr.pushStruct({
    key : 'back', title : cLang.train_back, def_value : false,
    mgr : TrainEditor.mBackMgr = UI_Check.createMgr({
        parent_mgr : TrainEditor.mInstMgr, fixed : true, }), });
TrainEditor.mInstMgr.pushStruct({
    key : 'speed', def_value : 80, labeled : true,
    title : cLang.train_speed, title_sub : ' [km/h]',
    mgr : TrainEditor.mSpeedMgr = UI_Slider.createMgr({
        parent_mgr : TrainEditor.mInstMgr, fixed : true,
        min : 0, max : 300, slide_round : 10, }), });
/*TrainEditor.mInstMgr.pushStruct({
    key : 'accel', def_value : 3, labeled : true,
    title : cLang.train_accel, title_sub : ' [km/h/s]',
    mgr : TrainEditor.mAccelMgr = UI_Slider.createMgr({
        parent_mgr : TrainEditor.mInstMgr, fixed : true,
        min : 1, max : 60, slide_round : 0.5, }), });
TrainEditor.mInstMgr.pushStruct({
    key : 'decel', def_value : 4, labeled : true,
    title : cLang.train_decel, title_sub : ' [km/h/s]',
    mgr : TrainEditor.mDecelMgr = UI_Slider.createMgr({
        parent_mgr : TrainEditor.mInstMgr, fixed : true,
        min : 1, max : 60, slide_round : 0.5, }), });*/
TrainEditor.mCarMgr = UI_Struct.createMgr({ clip_name : 'car', disable_undo : true, });
TrainModel.mSelectMgr.mParentMgr = TrainEditor.mCarMgr;
TrainEditor.mCarMgr.pushStruct({
    key : 'model', title : cLang.train_model, def_value : '', labeled : true,
    get_def_value : function() {
        var v = TrainModel.getDefaultValue(); return v === null ? '' : v;
    },
    mgr : TrainModel.mSelectMgr, });
TrainEditor.mCarMgr.pushStruct({
    key : 'flip', title : cLang.train_flip, def_value : false, labeled : true,
    mgr : UI_Check.createMgr({
        parent_mgr : TrainEditor.mCarMgr, fixed : true, no_ctrl_br : true, }), });
TrainEditor.mSwitchSelectsMgr = ModelSwitch.createSwitchSelectsMgr(
    TrainEditor, TrainEditor.mCarMgr,
    // update_switches
    function(mgr, value) {
        mgr.mElementNames = [];
        var t_value = [];
        var mdl = TrainModel.mIdToData[TrainModel.mSelectMgr.getValue()];
        if (mdl) {
            mdl.switches.forEach(function(a_switch) {
                mgr.mElementNames.push(a_switch.label);
                var switch_value = ':';
                for (var i = 0; i < value.length; ++i) {
                    if (value[i].startsWith(a_switch.id + ':')) {
                        switch_value = value[i].match(/:.*$/)[0];
                    }
                }
                t_value.push(a_switch.id + switch_value);
            });
        }
        value.splice(0, value.length);
        t_value.forEach(v => value.push(v));
    },
    // update_sel
    function(mgr, value) {
        mgr.clear();
        var mdl = TrainModel.mIdToData[TrainModel.mSelectMgr.getValue()];
        if (!mdl) { return; }
        mdl.switches.forEach(function(a_switch) {
            if (!value.startsWith(a_switch.id + ':')) { return; }
            a_switch.values.forEach(function(a_value) {
                mgr.addOption({ label : a_value.label,
                                value : a_switch.id + ':' + a_value.id, });
            });
        });
        mgr.activateOption(value);
    });
TrainEditor.mCarMgr.pushStruct({
    key : 'switches', title : cLang.cmn_switches, def_value : null,
    get_def_value : function() {
        return TrainModel.getDefaultSwitches(TrainModel.getDefaultValue());
    },
    mgr : TrainEditor.mSwitchSelectsMgr, });
TrainEditor.mCarMgr.initializeStruct();
TrainEditor.mCarsMgr = UI_Array.createMgr({
    parent_mgr : TrainEditor.mInstMgr, fixed : true,
    element_mgr : TrainEditor.mCarMgr, init_element_value : null, });
TrainEditor.mInstMgr.pushStruct({
    key : 'cars', title : cLang.train_cars, labeled : true, def_value : [],
    get_def_value : function() {
        return [TrainEditor.mCarMgr.makeDefaultValue()];
    },
    mgr : TrainEditor.mCarsMgr, });
TrainModel.mSelectMgr.mOnUpdate = function(inst, src_mgr) {
    var sels = TrainEditor.mSwitchSelectsMgr;
    sels.updateValue(sels.mActiveInst, TrainModel.getDefaultSwitches(inst.mValue));
};
TrainEditor.mInstMgr.initializeStruct();
TrainEditor.mInstsMgr = UI_Array.createMgr({
    fixed : true, root : true, element_mgr : TrainEditor.mInstMgr, init_element_value : null,
    on_update_array : function() {
        TrainEditor.updateList();
    }, });
TrainEditor.initialize = function()
{
    this.mListObj = CreateEditPane('train', cLang.head_train_list, function(div_on) {
        this.mInsts = this.mInstsMgr.createInstance({
            parent : div_on, value : [], });
        this.mInstsMgr.activate(this.mInsts);
    }, this);
};
TrainEditor.forEach = function(f, a_this)
{
    this.mInstsMgr.mElements.forEach(function(elem_inst) {
        f.apply(a_this, [elem_inst.mValue]);
    });
};
TrainEditor.clear = function() { this.mInstsMgr.deleteAll(); };
TrainEditor.updateList = function()
{
    this.mRadioMgr.updateCheck();
    this.mIdToData = {};
    this.mSelectMgrs.forEach(function(mgr) {
        mgr.clear();
        if (mgr.mIsEnableEmptyOption) { mgr.addOption({
            label : cLang.cmn_any, value : '', }); }
    });
    var prev_objs = {};
    Train.forEach(train => prev_objs[train.mID] = train);
    Train.sObjs = [];
    var tr_idx = 0;
    this.forEach(function(tr) {
        var sim_id = tr.user_data.sim_obj.mID;
        Train.sObjs.push(tr.user_data.sim_obj);
        this.mIdToData[sim_id] = tr;
        delete prev_objs[sim_id];
        this.mSelectMgrs.forEach(
            mgr => mgr.addOption({
                label : LangAppend(tr_idx + ': ', tr.name), value : sim_id, }));
        ++tr_idx;
    }, this);
    for (var id in prev_objs) { Train.remove(prev_objs[id]); }
};
TrainEditor.updateTrain = function(tr, keep_wheels_att)
{
    if (!tr.user_data) { return; }
    var sim_obj = tr.user_data.sim_obj, old_cars = sim_obj.mCars;
    sim_obj.mEditObj = tr;
    Train.clearCar(sim_obj);
    tr.cars.forEach(function(car) {
        Train.pushCar(sim_obj, TrainCar.create(car));
    });
    function if_car_focus(f) {
        for (var i_focus = 0; i_focus < g_model_focuses.length; ++i_focus) {
            var model_focus = g_model_focuses[i_focus];
            if (model_focus.type != 'train') { continue; }
            for (var i_car = 0; i_car < old_cars.length; ++i_car) {
                if (model_focus.inst == old_cars[i_car]) {
                    f(i_focus, i_car); return;
                }
            }
        }
    }
    if (keep_wheels_att && old_cars.length == sim_obj.mCars.length) {
        for (var i = 0; i < old_cars.length; ++i) {
            sim_obj.mCars[i].mWheelsAtt = old_cars[i].mWheelsAtt;
        }
        if_car_focus(function(i_focus, i_car) {
            g_model_focuses[i_focus].inst = sim_obj.mCars[i_car];
        });
    } else {
        if_car_focus(function(i_focus, i_car) {
            g_model_focuses.splice(i_focus, 1);
        });
    }
};
TrainEditor.getDefaultValue = function() { return this.mRadioMgr.getValue(); };
TrainEditor.getSelected = function() {
    var v = this.mRadioMgr.getValue();
    return v === null ? null : this.mIdToData[v];
};
TrainEditor.saveAll = function(data)
{
    this.mInstsMgr.updateArray();
    data.trains = Train.saveInsts(function(tr) {
        if (data.type == cFileType_Model && !tr.mEditObj.user_data.is_checked) { return null; }
        var ret = TrainEditor.mInstMgr.saveData(tr.mEditObj);
        ret.id = tr.mID;
        ret.cars.forEach(function(car) {
            car.model = TrainModel.mIdToData[car.model].user_data.uuid;
        })
        if (tr.mHeadAnchor.mRail) {
            ret.head_anchor = {
                rail : tr.mHeadAnchor.mRail.mID,
                dir_side : tr.mHeadAnchor.mDirSide,
                pos : v3.ToArray(tr.mHeadAnchor.mPos),
                dir : v3.ToArray(tr.mHeadAnchor.mDir),
                up : v3.ToArray(tr.mHeadAnchor.mUp),
            };
            ret.sim_speed = tr.mSpeed;
            ret.sim_reverse = tr.mReverse;
        }
        return ret;
    });
};
TrainEditor.loadAll = function(data)
{
    Train.loadInsts(data.trains, function(inst) {
        if (data.type != cFileType_Model) { Train.setLoadingID(inst.id); }
        TrainEditor.mInstMgr.setDefaultValues(inst);
        inst.cars.forEach(function(car) {
            TrainEditor.mCarMgr.setDefaultValues(car);
        });
        var elem_inst = TrainEditor.mInstsMgr.createElementInst(inst);
        TrainEditor.updateTrain(elem_inst.mValue);
        if (!inst.head_anchor) { return; }
        var tr = inst.user_data.sim_obj;
        tr.mHeadAnchor.mRail = Rail.searchObj(inst.head_anchor.rail);
        if (!tr.mHeadAnchor.mRail) { Log('Load train failed: invalid rail ID'); return; }
        tr.mHeadAnchor.mDirSide = inst.head_anchor.dir_side;
        tr.mHeadAnchor.mPos = v3.FromArray(inst.head_anchor.pos);
        tr.mHeadAnchor.mDir = v3.FromArray(inst.head_anchor.dir);
        tr.mHeadAnchor.mUp = v3.FromArray(inst.head_anchor.up);
        tr.mSpeed = inst.sim_speed;
        tr.mReverse = inst.sim_reverse;
    });
    this.mInstsMgr.updateArray();
    this.updateList();
};
TrainEditor.initialize();
function AddTrain() { TrainEditor.mInstsMgr.birthElement(); }
  </script>
  <!-- <script src="struct.js"></script> -->
  <script>
'use strict';
var Struct = CreateObjMgr();
Struct.create = function(edit_obj)
{
    var strc = this.createObj();
    strc.mEditObj = edit_obj;
    strc.mPartsAtt = [];
    strc.mPartsSwitchState = [];
    strc.mSmokesSwitchState = [];
    strc.mModel = this.getModelData(strc);
    strc.mIsPut = false;
    this.updateMatrix(strc);
    this.applySwitches(strc);
    return strc;
};
Struct.getModelData = function(strc)
{
    return StructModel.mIdToData[strc.mEditObj.model];
};
Struct.updateStruct = function(strc)
{
    strc.mModel = this.getModelData(strc);
    this.updateByField(strc);
    this.updateMatrix(strc);
    this.applySwitches(strc);
};
Struct.write = function(strc)
{
    if (!strc.mIsPut) { return; }
    var mdl = strc.mModel;
    strc.mPartsAtt = [];
    if (!mdl) { return; }
    StructModel.write(mdl, strc.mMtx, strc.mPartsSwitchState, strc.mSmokesSwitchState);
    mdl.user_data.parts_info.forEach(info => strc.mPartsAtt.push(
        info.visible ? info.world_mtx : null));
};
Struct.writeAABB = function(strc)
{
    if (!strc.mIsPut) { return; }
    var mdl = strc.mModel;
    if (!mdl) { return; }
    StructModel.writeAABB(mdl, strc.mMtx, strc.mPartsSwitchState);
};
Struct.applySwitches = function(strc)
{
    if (!strc.mModel) { return; }
    strc.mPartsSwitchState = StructModel.applySwitches(strc.mModel, strc.mEditObj.switches);
    strc.mSmokesSwitchState = ModelSmoke.applySmokeSwitches(strc.mModel, strc.mEditObj.switches);
};
Struct.updateMatrix = function(strc)
{
    var tmp_ofs = m34.MakeST(v3.ones, strc.mEditObj.offset);
    if (strc.mFieldNrm) {
        var tmp_r = m34.MakeSRTDeg(v3.ones, strc.mEditObj.rotate, v3.zero);
        var field_dir = v3.normalize(v3.Cross(v3.ex, strc.mFieldNrm));
        var field_mtx = m34.MakeOrtho(
            field_dir, strc.mFieldNrm, strc.mEditObj.position, v3.ones);
        strc.mMtx = m34.setMul(tmp_r, tmp_r, tmp_ofs);
        m34.setMul(strc.mMtx, field_mtx, strc.mMtx);
    } else {
        var tmp_rt = m34.MakeSRTDeg(v3.ones, strc.mEditObj.rotate, strc.mEditObj.position);
        strc.mMtx = m34.setMul(tmp_rt, tmp_rt, tmp_ofs);
    }
};
Struct.updateByField = function(strc)
{
    strc.mFieldNrm = null;
    var pos = strc.mEditObj.position;
    var field_args = {}, field_height = FieldEditor.getFieldHeight(pos, field_args);
    if (field_height !== null) {
        var field_setting = strc.mEditObj.field_setting;
        if (field_setting == 'pos' || field_setting == 'nrm') {
            pos[1] = field_height;
            if (field_setting == 'nrm') {
                strc.mFieldNrm = field_args.nrm;
            }
        }
    }
};
Struct.put = function(strc, pos)
{
    strc.mIsPut = true;
    v3.copy(strc.mEditObj.position, pos);
    this.updateByField(strc);
    var editor_active = StructEditor.mInstMgr.mActiveInst;
    if (editor_active && editor_active.mValue.user_data.sim_obj == strc) {
        StructEditor.mPositionMgr.setValue(pos);
    }
    this.updateMatrix(strc);
};
Struct.isPut = function(strc) { return strc.mIsPut; };
Struct.remove = function(strc)
{
    if (!this.isPut(strc)) { return; }
    strc.mIsPut = false;
};
Struct.calc = function(strc)
{
    if (!this.isPut(strc)) { return; }
    var mdl = strc.mModel;
    if (!mdl) { return; }
    //var parts_info = mdl.user_data.parts_info;
};
Struct.requestResetAll = function() { this.sRequestResetAll = true; };
Struct.calcAll = function()
{
    if (!IsEditorMode()) {
        if (this.sRequestResetAll) {
            this.sRequestResetAll = false;
            this.forEach(strc => StructEditor.updateStruct(strc.mEditObj));
        }
        this.forEach(this.calc, this);
    }
};
Struct.writeAll = function()
{
    Struct.forEach(Struct.write);
};
var StructSetter = CreateInstance();
StructSetter.mCursorPos = v3.Makes(0);
StructSetter.mCursorDir = v3.Make(0, 0, 1);
StructSetter.putStruct = function()
{
    var strc = StructEditor.getSelected();
    if (!strc) return;
    var active_inst = StructEditor.mInstMgr.mActiveInst;
    if (active_inst && active_inst.mValue == strc) {
        StructEditor.mInstMgr.activate(active_inst);
    }
    var sim_obj = strc.user_data.sim_obj;
    Log(LangJoin([cLang.struct_put_struct,
                  ' [' + sim_obj.mID + ']: ' + v3.ToFixed(this.mCursorPos, 2)]));
    var prev_is_put = sim_obj.mIsPut;
    var prev_pos = v3.Dup(sim_obj.mEditObj.position);
    var new_pos = v3.Dup(this.mCursorPos);
    PushUndo(function() {
        if (prev_is_put) {
            Struct.put(sim_obj, prev_pos);
        } else {
            Struct.remove(sim_obj);
        }
    }, function() {
        Struct.put(sim_obj, new_pos);
    }, cLang.struct_put_struct, true);
};
StructSetter.calc = function(wpos)
{
    this.mCursorPos = v3.Dup(wpos);
};
StructSetter.write = function()
{
    if (IsMenuStructList()) {
        DrawArrow(this.mCursorPos,
                  v3.add(v3.Muls(this.mCursorDir, 2.5), this.mCursorPos),
                  0.5, v4.Make(1, 0, 0, 1));
    }
};
  </script>
  <!-- <script src="struct_model.js"></script> -->
  <script>
'use strict';
var StructModel = CreateIDMgr(null, true);
StructModel.mModelsObj = null;
StructModel.mRadioMgr = UI_Radios.createMgr({
    name : 'struct-model-default',
    title : 'preview model',
    for_each : function(f) {
        StructModel.forEach(function(mdl) { f(mdl.user_data.def_radio); });
    }, });
StructModel.mIdToData = {};
StructModel.mSelectMgr = UI_Select.createMgr({
    clip_name : 's-model-sel', no_ctrl_br : true, disable_undo : true, fixed : true, });
StructModel.mInstMgr = UI_Struct.createMgr({
    name : 'struct model', clip_name : 's-model',
    on_create_instance : function(elem_inst) {
        var val = elem_inst.mValue;
        val.user_data = StructModel.issueID(val.user_data);
        val.user_data.def_radio = StructModel.mRadioMgr.createInstance({
            parent : elem_inst.mTitleObj, prepend : true, id : val.user_data.uuid, });
        UI_Radios.setCheck(val.user_data.def_radio);
    },
    on_update : function(inst) {
        StructModel.updateList();
        StructModel.updateMatrix(inst.mValue);
    },
    on_activate : function(inst) { UI_Radios.setCheck(inst.mValue.user_data.def_radio); }, });
StructModel.mInstMgr.getUUID = function(value) { return value.user_data.uuid; };
StructModel.mInstMgr.pushStruct({
    key : 'name', title : cLang.cmn_name, def_value : 's-model', labeled : 'value',
    mgr : UI_LangText.createMgr({ parent_mgr : StructModel.mInstMgr, fixed : true, }), });
StructModel.mInstMgr.pushStruct({
    key : 'author', title : cLang.cmn_author, def_value : null,
    mgr : FileMode.createAuthorInfoMgr(StructModel.mInstMgr), });
StructModel.mPartMgr = UI_Struct.createMgr({ clip_name : 'part', disable_undo : true, });
StructModel.mPartMgr.pushStruct({
    key : 'model', title : cLang.struct_model, def_value : '', labeled : 'value',
    get_def_value : function() {
        var v = EditModel.getDefaultValue(); return v === null ? '' : v;
    },
    mgr : EditModel.createSelectMgr({
        parent_mgr : StructModel.mPartMgr, fixed : true, no_ctrl_br : true, }), });
StructModel.mPartMgr.pushStruct({
    key : 'scale', title : cLang.cmn_scale, def_value : v3.Makes(1),
    mgr : UI_Vector.createMgr({
        parent_mgr : StructModel.mPartMgr, fixed : true, dim : 3, min : 0, max : 10, }), });
StructModel.mPartMgr.pushStruct({
    key : 'rotate', title : cLang.cmn_rotate, def_value : v3.Makes(0),
    mgr : UI_Vector.createMgr({
        parent_mgr : StructModel.mPartMgr, fixed : true,
        dim : 3, min : -180, max : 180, size : 4, slide_round : 0.1, }), });
StructModel.mPartMgr.pushStruct({
    key : 'trans', title : cLang.cmn_trans, def_value : v3.Makes(0),
    mgr : UI_Vector.createMgr({
        parent_mgr : StructModel.mPartMgr, fixed : true, dim : 3, min : -50, max : 50, }), });
StructModel.mPartMgr.pushStruct({
    key : 'accept_focus', title : cLang.model_accept_focus, def_value : true,
    mgr : UI_Check.createMgr({ parent_mgr : StructModel.mPartMgr, fixed : true, }), });
StructModel.mPartMgr.pushStruct({
    key : 'condition', title : cLang.cmn_condition, def_value : null,
    mgr : ModelSwitch.createConditionMgr(StructModel.mPartMgr), });
StructModel.mPartMgr.initializeStruct();
StructModel.mPartsMgr = UI_Array.createMgr({
    parent_mgr : StructModel.mInstMgr, fixed : true,
    element_mgr : StructModel.mPartMgr, init_element_value : null, });
StructModel.mInstMgr.pushStruct({
    key : 'parts', title : cLang.cmn_parts, labeled : true, def_value : [],
    get_def_value : function() {
        return [StructModel.mPartMgr.makeDefaultValue()];
    },
    mgr : StructModel.mPartsMgr, });
StructModel.mInstMgr.pushStruct({
    key : 'smokes', title : cLang.cmn_smokes, labeled : true, def_value : [],
    mgr : ModelSmoke.createSmokesMgr(StructModel, StructModel.mInstMgr), });
StructModel.mInstMgr.pushStruct({
    key : 'switches', title : cLang.cmn_switches, labeled : true, def_value : [],
    mgr : ModelSwitch.createSwitchesMgr(StructModel, StructModel.mInstMgr), });
StructModel.mInstMgr.initializeStruct();
StructModel.mInstsMgr = UI_Array.createMgr({
    fixed : true, root : true, element_mgr : StructModel.mInstMgr, init_element_value : null,
    on_update_array : function() {
        StructModel.updateList();
    },
    is_deletable : function(inst) {
        var ret = true;
        Struct.forEach(function(strc) {
            if (strc.mEditObj.model != inst.mValue.uuid) { return; }
            Log(LangJoin([cLang.error_not_deletable, ': ', inst.mValue.name, ' (',
                          cLang.error_used_by, ': ', strc.mEditObj.name, ')']));
            if (!ret) { return; }
            DebugLog.show();
            ret = false;
        });
        return ret;
    }, });
StructModel.initialize = function()
{
    this.mListObj = CreateEditPane(
        'struct-model', cLang.head_struct_model, function(div_on) {
            this.mInsts = this.mInstsMgr.createInstance({
                parent : div_on, value : [], });
            this.mInstsMgr.activate(this.mInsts);
        }, this);
};
StructModel.forEach = function(f, a_this)
{
    this.mInstsMgr.mElements.forEach(function(elem_inst) {
        f.apply(a_this, [elem_inst.mValue]);
    });
};
StructModel.clear = function() { this.mInstsMgr.deleteAll(); };
StructModel.updateList = function()
{
    this.mRadioMgr.updateCheck();
    this.mIdToData = {};
    this.mSelectMgr.clear();
    this.forEach(function(mdl) {
        this.mIdToData[mdl.user_data.uuid] = mdl;
        this.mSelectMgr.addOption({
            label : mdl.name, value : mdl.user_data.uuid, user_data : mdl,
            author : mdl.author, });
    }, this);
    if (StructEditor.mInstMgr.mActiveInst) {
        StructEditor.mInstMgr.updateLabel(StructEditor.mInstMgr.mActiveInst);
    }
};
StructModel.updateMatrix = function(mdl)
{
    mdl.user_data = CreateInstance(mdl.user_data);
    mdl.user_data.parts_info = [];
    mdl.user_data.smokes_info = [];
    var i_part = 0, half_len = mdl.length * 0.5;
    mdl.parts.forEach(function(part) {
        var part_info = {
            index : i_part++,
            part : part,
            mtx : m34.MakeSRTDeg(part.scale, part.rotate, part.trans),
            world_mtx : null,
        };
        mdl.user_data.parts_info.push(part_info);
    });
    mdl.smokes.forEach(function(smoke) {
        var smoke_info = {
            smoke : smoke,
            mtx : m34.MakeSRTDeg(smoke.scale, v3.Makes(0), smoke.trans),
            world_mtx : null,
        };
        mdl.user_data.smokes_info.push(smoke_info);
    });
};
StructModel.write = function(mdl, base_mtx, parts_sw, smokes_sw)
{
    var parts_info = mdl.user_data.parts_info;
    for (var i = 0; i < parts_info.length; ++i) {
        var part_info = parts_info[i], part = part_info.part;
        var mdl_mtx = part_info.mtx;
        var mtx = m34.Mul(base_mtx, mdl_mtx);
        var part_sw = parts_sw[part_info.index]
        part_info.visible = false;
        if (!part_sw || part_sw.enabled) {
            part_info.visible = true;
            EditModel.write(EditModel.mIdToData[part.model], mtx,
                            part_sw && part_sw.insert_colors);
        }
        //part_info.work_att = att;
        part_info.world_mtx = mtx;
    }
    var smokes_info = mdl.user_data.smokes_info;
    for (var i = 0; i < smokes_info.length; ++i) {
        var smoke_sw = smokes_sw[i];
        if (smoke_sw && !smoke_sw.enabled) { continue; }
        var smoke_info = smokes_info[i];
        var smoke = smoke_info.smoke;
        if (Math.random() > smoke.emit_ratio) { continue; }
        var smoke_pos = m34.MulV3(base_mtx, smoke.trans);
        var smoke_dir = m34.RotV3(base_mtx, smoke.direction);
        g_smoke_drawer.pushSmoke(smoke_pos, smoke_dir, smoke);
    }
};
StructModel.writeAABB = function(mdl, base_mtx, parts_sw)
{
    var parts_info = mdl.user_data.parts_info;
    for (var i = 0; i < parts_info.length; ++i) {
        var part_info = parts_info[i], part = part_info.part;
        var part_sw = parts_sw[part_info.index]
        if (!part_sw || part_sw.enabled) {
            var mdl_mtx = part_info.mtx;
            var mtx = m34.Mul(base_mtx, mdl_mtx);
            var e_mdl = EditModel.mIdToData[part.model];
            if (!e_mdl) { continue; }
            g_line_drawer.pushAABB(e_mdl.user_data.drawer.mAABB, v4.Make(1, 0, 0, 1), mtx);
        }
    }
};
StructModel.writeEditor = function()
{
    var mdl = StructModel.getDefault();
    if (mdl) {
        var tmp_state = StructModel.applySwitches(mdl, [], true);
        var tmp_smoke_state = ModelSmoke.applySmokeSwitches(mdl, [], true);
        StructModel.write(mdl, m34.MakeIdent(), tmp_state, tmp_smoke_state);
    }
};
StructModel.applySwitches = function(mdl, values, is_preview)
{
    //Log('applySwitches ' + mdl.name);
    var ret = [];
    mdl.parts.forEach(function(part) {
        var e_mdl = EditModel.mIdToData[part.model];
        ret.push(EditModel.applySwitches(mdl, values, is_preview, part, e_mdl));
    });
    return ret;
};
StructModel.draw = function(gl, view_ctx)
{
};
StructModel.getDefaultValue = function() { return this.mRadioMgr.getValue(); };
StructModel.getDefault = function()
{
    var def = this.getDefaultValue(), ret = null;
    this.forEach(function(mdl) {
        if (mdl.user_data.uuid == def) { ret = mdl; }
    });
    return ret;
};
StructModel.getName = function(uuid) {
    return this.mIdToData[uuid].name;
};
StructModel.getDefaultSwitches = function(uuid)
{
    var ret = [], mdl = StructModel.mIdToData[uuid];
    if (!mdl) { return ret; }
    mdl.switches.forEach(function(a_switch) {
        ret.push(a_switch.id + ':' + a_switch.default_value_id);
    });
    return ret;
};
StructModel.saveAll = function(data)
{
    this.mInstsMgr.updateArray();
    data.struct_models = StructModel.saveInsts(function(mdl) {
        if (data.type == cFileType_Model && !mdl.user_data.is_checked) { return null; }
        var ret = this.mInstMgr.saveData(mdl);
        ret.uuid = mdl.user_data.uuid;
        ret.parts.forEach(function(part) {
            part.model = EditModel.mIdToData[part.model].user_data.uuid;
        });
        return ret;
    });
};
StructModel.loadAll = function(gl, data)
{
    this.loadInsts(data.struct_models, function(inst) {
        if (data.type == cFileType_Model && this.mIdToData[inst.uuid]) {
            Log(LangJoin([cLang.warn_tag, cLang.warn_already_exist,
                          ': ', cLang.menu_struct_model, ' [', inst.uuid, '] ',
                          this.mIdToData[inst.uuid].name]));
            return;
        }
        this.mInstMgr.setDefaultValues(inst);
        inst.user_data = CreateInstance(inst.user_data);
        inst.user_data.uuid = inst.uuid;
        inst.parts.forEach(function(part) {
            this.mPartMgr.setDefaultValues(part);
        }, this);
        inst.smokes.forEach(function(smoke) {
            this.mSmokeMgr.setDefaultValues(smoke);
        }, this);
        inst.switches.forEach(function(a_switch) {
            this.mSwitchMgr.setDefaultValues(a_switch);
            a_switch.values.forEach(function(a_value) {
                this.mValueMgr.setDefaultValues(a_value);
            }, this);
        }, this);
        var elem_inst = this.mInstsMgr.createElementInst(inst);
        this.updateMatrix(elem_inst.mValue);
    });
    this.mInstsMgr.updateArray();
    this.updateList();
};
StructModel.initialize();
function AddStructModel() { StructModel.mInstsMgr.birthElement(); }
  </script>
  <!-- <script src="struct_editor.js"></script> -->
  <script>
'use strict';
var StructEditor = CreateInstance();
StructEditor.mRadioMgr = UI_Radios.createMgr({
    name : 'struct-list-default',
    title : 'put struct',
    for_each : function(f) {
        StructEditor.forEach(function(tr) { f(tr.user_data.def_radio); });
    }, });
StructEditor.mIdToData = {};
StructEditor.mSelectMgrs = [];
StructEditor.createSelectMgr = function(args) {
    var mgr = UI_Select.createMgr(Object.assign({ clip_name : 't-selection', }, args));
    this.mSelectMgrs.push(mgr);
    return mgr;
};
StructEditor.mInstMgr = UI_Struct.createMgr({
    name : 'struct', clip_name : 'struct',
    on_create_instance : function(elem_inst) {
        var val = elem_inst.mValue, sim_obj = Struct.create(val);
        val.user_data = CreateInstance(val.user_data);
        val.user_data.sim_obj = sim_obj;
        val.user_data.def_radio = StructEditor.mRadioMgr.createInstance({
            parent : elem_inst.mTitleObj, prepend : true, id : sim_obj.mID, });
        UI_Radios.setCheck(val.user_data.def_radio);
    },
    on_update : function(inst, src_mgr) {
        StructEditor.updateList();
        StructEditor.updateStruct(inst.mValue);
    },
    on_activate : function(inst) { UI_Radios.setCheck(inst.mValue.user_data.def_radio); }, });
StructEditor.mInstMgr.pushStruct({
    title : cLang.cmn_remove, link_title : 'remove struct from scene',
    cmd : function(inst) { Struct.remove(inst.user_data.sim_obj); }, });
StructEditor.mInstMgr.pushStruct({
    key : 'name', title : cLang.cmn_name, def_value : 'struct', labeled : 'value',
    mgr : UI_LangText.createMgr({ parent_mgr : StructEditor.mInstMgr, fixed : true, }), });
StructModel.mSelectMgr.mParentMgr = StructEditor.mInstMgr;
StructEditor.mInstMgr.pushStruct({
    key : 'model', title : cLang.struct_model, def_value : '', labeled : true,
    get_def_value : function() {
        var v = StructModel.getDefaultValue(); return v === null ? '' : v;
    },
    mgr : StructModel.mSelectMgr, });
StructEditor.mInstMgr.pushStruct({
    key : 'field_setting', title : cLang.struct_field_setting, def_value : 'pos',
    mgr : UI_Select.createMgr({
        parent_mgr : StructEditor.mInstMgr, fixed : true,
        options : [
            { label : cLang.struct_fs_none  , value : 'none', },
            { label : cLang.struct_fs_height, value : 'pos' , },
            { label : cLang.struct_fs_normal, value : 'nrm' , },
        ], }), });
StructEditor.mInstMgr.pushStruct({
    key : 'position', title : cLang.cmn_position, def_value : v3.Makes(0),
    mgr : StructEditor.mPositionMgr = UI_Vector.createMgr({
        parent_mgr : StructEditor.mInstMgr, fixed : true, dim : 3, min : -500, max : 500, }), });
StructEditor.mInstMgr.pushStruct({
    key : 'rotate', title : cLang.cmn_rotate, def_value : v3.Makes(0),
    mgr : UI_Vector.createMgr({
        parent_mgr : StructEditor.mInstMgr, fixed : true,
        dim : 3, min : -180, max : 180, size : 4, slide_round : 5, }), });
StructEditor.mInstMgr.pushStruct({
    key : 'offset', title : cLang.cmn_offset, def_value : v3.Makes(0),
    mgr : UI_Vector.createMgr({
        parent_mgr : StructEditor.mInstMgr, fixed : true, dim : 3, min : -50, max : 50, }), });
StructEditor.mSwitchSelectsMgr = ModelSwitch.createSwitchSelectsMgr(
    StructEditor, StructEditor.mInstMgr,
    // update_switches
    function(mgr, value) {
        mgr.mElementNames = [];
        var t_value = [];
        var mdl = StructModel.mIdToData[StructModel.mSelectMgr.getValue()];
        if (mdl) {
            mdl.switches.forEach(function(a_switch) {
                mgr.mElementNames.push(a_switch.label);
                var switch_value = ':';
                for (var i = 0; i < value.length; ++i) {
                    if (value[i].startsWith(a_switch.id + ':')) {
                        switch_value = value[i].match(/:.*$/)[0];
                    }
                }
                t_value.push(a_switch.id + switch_value);
            });
        }
        value.splice(0, value.length);
        t_value.forEach(v => value.push(v));
    },
    // update_sel
    function(mgr, value) {
        mgr.clear();
        var mdl = StructModel.mIdToData[StructModel.mSelectMgr.getValue()];
        if (!mdl) { return; }
        mdl.switches.forEach(function(a_switch) {
            if (!value.startsWith(a_switch.id + ':')) { return; }
            a_switch.values.forEach(function(a_value) {
                mgr.addOption({ label : a_value.label,
                                value : a_switch.id + ':' + a_value.id, });
            });
        });
        mgr.activateOption(value);
    });
StructEditor.mInstMgr.pushStruct({
    key : 'switches', title : cLang.cmn_switches, def_value : null,
    get_def_value : function() {
        return StructModel.getDefaultSwitches(StructModel.getDefaultValue());
    },
    mgr : StructEditor.mSwitchSelectsMgr, });
StructModel.mSelectMgr.mOnUpdate = function(inst, src_mgr) {
    var sels = StructEditor.mSwitchSelectsMgr;
    if (!sels.mActiveInst) { return; }
    sels.updateValue(sels.mActiveInst, StructModel.getDefaultSwitches(inst.mValue));
};
StructEditor.mInstMgr.initializeStruct();
StructEditor.mInstsMgr = UI_Array.createMgr({
    fixed : true, root : true, element_mgr : StructEditor.mInstMgr, init_element_value : null,
    on_update_array : function() {
        StructEditor.updateList();
    }, });
StructEditor.initialize = function()
{
    this.mListObj = CreateEditPane('struct', cLang.head_struct_list, function(div_on) {
        this.mInsts = this.mInstsMgr.createInstance({
            parent : div_on, value : [], });
        this.mInstsMgr.activate(this.mInsts);
    }, this);
};
StructEditor.write = function()
{
    var editor_active = StructEditor.mInstMgr.mActiveInst;
    if (editor_active) {
        var strc = editor_active.mValue.user_data.sim_obj;
        Struct.writeAABB(strc);
    }
};
StructEditor.forEach = function(f, a_this)
{
    this.mInstsMgr.mElements.forEach(function(elem_inst) {
        f.apply(a_this, [elem_inst.mValue]);
    });
};
StructEditor.clear = function() { this.mInstsMgr.deleteAll(); };
StructEditor.updateList = function()
{
    this.mRadioMgr.updateCheck();
    this.mIdToData = {};
    this.mSelectMgrs.forEach(function(mgr) {
        mgr.clear();
        if (mgr.mIsEnableEmptyOption) { mgr.addOption({ label : cLang.cmn_any, value : '', }); }
    });
    var prev_objs = {};
    Struct.forEach(struct => prev_objs[struct.mID] = struct);
    Struct.sObjs = [];
    var strc_idx = 0;
    this.forEach(function(strc) {
        var sim_id = strc.user_data.sim_obj.mID;
        Struct.sObjs.push(strc.user_data.sim_obj);
        this.mIdToData[sim_id] = strc;
        delete prev_objs[sim_id];
        this.mSelectMgrs.forEach(
            mgr => mgr.addOption({
                label : LangAppend(strc_idx + ': ', strc.name), value : sim_id, }));
        ++strc_idx;
    }, this);
    for (var id in prev_objs) { Struct.remove(prev_objs[id]); }
};
StructEditor.updateStruct = function(strc)
{
    if (!strc.user_data) { return; }
    var sim_obj = strc.user_data.sim_obj;
    sim_obj.mEditObj = strc;
    Struct.updateStruct(sim_obj);
};
StructEditor.getDefaultValue = function() { return this.mRadioMgr.getValue(); };
StructEditor.getSelected = function() {
    var v = this.mRadioMgr.getValue();
    return v === null ? null : this.mIdToData[v];
};
StructEditor.saveAll = function(data)
{
    this.mInstsMgr.updateArray();
    data.structs = Struct.saveInsts(function(strc) {
        var ret = StructEditor.mInstMgr.saveData(strc.mEditObj);
        ret.id = strc.mID;
        ret.is_put = Struct.isPut(strc);
        ret.model = StructModel.mIdToData[ret.model].user_data.uuid;
        return ret;
    });
};
StructEditor.loadAll = function(data)
{
    Struct.loadInsts(data.structs, function(inst) {
        Struct.setLoadingID(inst.id);
        StructEditor.mInstMgr.setDefaultValues(inst);
        var elem_inst = StructEditor.mInstsMgr.createElementInst(inst);
        StructEditor.updateStruct(elem_inst.mValue);
        var strc = inst.user_data.sim_obj;
        if (inst.is_put) { Struct.put(strc, inst.position); }
    });
    this.mInstsMgr.updateArray();
    this.updateList();
};
StructEditor.initialize();
function AddStruct() { StructEditor.mInstsMgr.birthElement(); }
  </script>
  <!-- <script src="rail_builder.js"></script> -->
  <script>
'use strict';
var RailBuilder = CreateInstance();
RailBuilder.cMinDist = 1.0;
RailBuilder.mFirstRail  = null;
RailBuilder.mFirstPoint = null;
RailBuilder.mIsTooClose = false;
RailBuilder.mSelectedRail = null;
RailBuilder.mSelectedPoint = null;
RailBuilder.mSelectedSwitch = null;
RailBuilder.mSelectedSwitchSide = 0;
RailBuilder.mFieldSettingMgr = UI_Check.createMgr({ fixed : true, });
RailBuilder.mFieldHeightMgr = UI_Slider.createMgr({
    fixed : true, min : -20, max : 20, slide_round : 1, size : 4, })
RailBuilder.mHeightMgr = UI_Slider.createMgr({
    fixed : true, min : -50, max : 50, slide_round : 1, size : 4, })
RailBuilder.mCurveFactorMgr = UI_Slider.createMgr({
    fixed : true, min : 0, max : 1, slide_round : 0.05, size : 4, fixed_range : true,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangeRailFlag(inst.mValue, 'mCurveFactor', cLang.act_set_curve_factor);
    }, });
RailBuilder.mRailFlagMgr = UI_Check.createMgr({
    fixed : true,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangeRailFlag(inst.mValue, 'mRailFlag', cLang.act_toggle_rail);
    }, });
RailBuilder.mRailTypeMgr = UI_Select.createMgr({
    fixed : true, clip_name : 'rail-type',
    options : [
        { label : cLang.rail_narrow  , value : 'narrow'  , },
        { label : cLang.rail_standard, value : 'standard', },
        { label : cLang.rail_safege  , value : 'safege'  , },
        { label : cLang.rail_alweg   , value : 'alweg'   , },
    ],
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangeRailFlag(
            inst.mValue, 'mRailType', cLang.act_set_rail_type,
            function(rail) {
                if (rail.mSwitchPoints[0] || rail.mSwitchPoints[1]) {
                    rail.mPoints.forEach(point => RailBuilder.updateSwitchPoint(point));
                }
            });
    }, });
RailBuilder.mTieFlagMgr = UI_Check.createMgr({
    fixed : true,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangeRailFlag(inst.mValue, 'mTieFlag', cLang.act_toggle_tie);
    }, });
RailBuilder.mTieTypeMgr = UI_Select.createMgr({
    fixed : true, clip_name : 'tie-type',
    options : [
        { label : cLang.tie_ballast, value : 'ballast', },
        { label : cLang.tie_slab   , value : 'slab'   , },
    ],
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangeRailFlag(inst.mValue, 'mTieType', cLang.act_set_tie_type);
    }, });
RailBuilder.mGirderFlagMgr = UI_Check.createMgr({
    fixed : true,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangeRailFlag(inst.mValue, 'mGirderFlag', cLang.act_toggle_girder);
    }, });
RailBuilder.mGirderTypeMgr = UI_Select.createMgr({
    fixed : true, clip_name : 'girder-type',
    options : [
        { label : cLang.girder_girder, value : 'girder', },
        { label : cLang.girder_tunnel, value : 'tunnel', },
    ],
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangeRailFlag(inst.mValue, 'mGirderType', cLang.act_set_girder_type);
    }, });
RailBuilder.mPierFlagMgr = UI_Check.createMgr({
    fixed : true,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangeRailFlag(inst.mValue, 'mPierFlag', cLang.act_toggle_pier);
    }, });
RailBuilder.mPierTypeMgr = UI_Select.createMgr({
    fixed : true, clip_name : 'pier-type',
    options : [
        { label : cLang.pier_center, value : 'center', },
        { label : cLang.pier_both  , value : 'both'  , },
        { label : cLang.pier_left  , value : 'left'  , },
        { label : cLang.pier_right , value : 'right' , },
    ],
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangeRailFlag(inst.mValue, 'mPierType', cLang.act_set_pier_type);
    }, });
RailBuilder.mPierIntervalMgr = UI_Slider.createMgr({
    fixed : true, size : 4, min : 0, max : 100, slide_round : 0.1,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangeRailFlag(inst.mValue, 'mPierInterval', cLang.act_set_pier_interval);
    }, });
RailBuilder.mPierOffsetMgr = UI_Slider.createMgr({
    fixed : true, fixed_range : true, size : 4, min : 0, max : 1, slide_round : 0.001,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangeRailFlag(inst.mValue, 'mPierOffset', cLang.act_set_pier_offset);
    }, });
RailBuilder.mRailPartMgr = UI_Struct.createMgr({
    clip_name : 'rail-part', disable_undo : true,
    on_update : function(inst, src_mgr) {
        if (inst == RailBuilder.mLeftPart) {
            RailBuilder.onChangeRailFlag(inst.mValue, 'mLeftPart', cLang.act_set_left_part);
        } else {
            RailBuilder.onChangeRailFlag(inst.mValue, 'mRightPart', cLang.act_set_right_part);
        }
    }, });
RailBuilder.mRailPartMgr.pushStruct({
    key : 'flag', title : cLang.cmn_enable, def_value : false, labeled : 'value',
    mgr : UI_Check.createMgr({ fixed : true, parent_mgr : RailBuilder.mRailPartMgr, }), });
RailBuilder.mRailPartMgr.pushStruct({
    key : 'type', title : cLang.cmn_type, def_value : 'plt', labeled : 'value',
    mgr : UI_Select.createMgr({
        fixed : true, clip_name : 'rail-part-type',
        options : [
            { value : 'plt'  , label : cLang.part_platform, },
            { value : 'wall' , label : cLang.part_wall    , },
            { value : 'floor', label : cLang.part_floor   , },
        ],
        parent_mgr : RailBuilder.mRailPartMgr, }), });
RailBuilder.mRailPartMetricMgr = UI_Struct.createMgr({
    clip_name : 'rail-part-metric', disable_undo : true, });
RailBuilder.mRailPartMetricMgr.pushStruct({
    key : 'offset', title : cLang.cmn_offset, def_value : 1.7, labeled : true,
    mgr : UI_Slider.createMgr({
        fixed : true, size : 4, min : 0, max : 10, slide_round : 0.1,
        parent_mgr : RailBuilder.mRailPartMetricMgr, }), });
RailBuilder.mRailPartMetricMgr.pushStruct({
    key : 'width', title : cLang.cmn_width, def_value : 2.0, labeled : true,
    mgr : UI_Slider.createMgr({
        fixed : true, size : 4, min : 0, max : 10, slide_round : 0.1,
        parent_mgr : RailBuilder.mRailPartMetricMgr, }), });
RailBuilder.mRailPartMetricMgr.pushStruct({
    key : 'height', title : cLang.cmn_height, def_value : 1.5, labeled : true,
    mgr : UI_Slider.createMgr({
        fixed : true, size : 4, min : 0, max : 10, slide_round : 0.1,
        parent_mgr : RailBuilder.mRailPartMetricMgr, }), });
RailBuilder.mRailPartMetricMgr.initializeStruct();
RailBuilder.mRailPartMetricsMgr = UI_Array.createMgr({
    fixed : true, element_mgr : RailBuilder.mRailPartMetricMgr, init_element_value : null,
    min_element_num : 1, parent_mgr : RailBuilder.mRailPartMgr, });
RailBuilder.mRailPartMgr.pushStruct({
    key : 'metrics', title : cLang.part_dimensions, def_value : [
        RailBuilder.mRailPartMetricMgr.makeDefaultValue()], labeled : true,
    mgr : RailBuilder.mRailPartMetricsMgr, });
RailBuilder.mRailPartMgr.initializeStruct();
RailBuilder.onChangeRailFlag = function(new_value, value_name, mes, on_update) {
    var rail = RailBuilder.mSelectedRail;
    if (!rail) { return; }
    var old_value = rail[value_name];
    if (old_value != new_value) {
        PushUndo(function() {
            rail[value_name] = old_value;
            if (on_update) { on_update(rail); }
            Rail.writeAll();
        }, function() {
            rail[value_name] = new_value;
            if (on_update) { on_update(rail); }
            Rail.writeAll();
        }, mes, true, rail);
    }
};
RailBuilder.onChangePointPos = function(new_value, dim, mes) {
    var point = RailBuilder.mSelectedPoint;
    if (!point) { return; }
    var old_value = point.mPos[dim];
    if (old_value != new_value) {
        PushUndo(function() {
            point.mPos[dim] = old_value;
            RailBuilder.updateSwitchPoint(point);
            Rail.writeAll();
        }, function() {
            point.mPos[dim] = new_value;
            RailBuilder.updateSwitchPoint(point);
            Rail.writeAll();
        }, mes, true, point);
    }
};
RailBuilder.mDiableOnChangePointDir = false;
RailBuilder.onChangePointDir = function(dir, slope, cant, mes) {
    if (RailBuilder.mDiableOnChangePointDir) { return; }
    var point = RailBuilder.mSelectedPoint;
    if (!point) { return; }
    var old_dir = v3.Dup(point.mDir), old_up = v3.Dup(point.mUp);
    var xz_len = v3.Length(v3.SetY(old_dir, 0));
    var dir_rad = dir * cDeg2Rad, slope_rad = slope * cDeg2Rad, cant_rad = cant * cDeg2Rad;
    var slope_cos = Math.cos(slope_rad);
    var new_dir = v3.Make(xz_len * Math.cos(dir_rad) * slope_cos, Math.sin(slope_rad),
                          xz_len * Math.sin(dir_rad) * slope_cos);
    var tmp_left = v3.normalize(v3.Cross(v3.ey, new_dir));
    var tmp_up = v3.normalize(v3.Cross(new_dir, tmp_left));
    var new_up = v3.add(v3.Muls(tmp_up, Math.cos(cant_rad)),
                        v3.Muls(tmp_left, Math.sin(cant_rad)));
    Log('up = ' + v3.ToFixed(new_up, 2));
    var cDirEpsilon = 1e-5;
    if (v3.Length(v3.Sub(old_dir, new_dir)) > cDirEpsilon ||
        v3.Length(v3.Sub(old_up, new_up)) > cDirEpsilon)
    {
        PushUndo(function() {
            ControlPoint.setDir(point, old_dir, old_up);
            RailBuilder.updateSwitchPoint(point);
            Rail.writeAll();
        }, function() {
            ControlPoint.setDir(point, new_dir, new_up);
            RailBuilder.updateSwitchPoint(point);
            Rail.writeAll();
        }, mes, true, point);
    }
};
RailBuilder.mPointXMgr = UI_Slider.createMgr({
    fixed : true, min : -1000, max : 1000, slide_round : 0.1,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangePointPos(inst.mValue, 0, cLang.act_set_point_x);
    }, });
RailBuilder.mPointZMgr = UI_Slider.createMgr({
    fixed : true, min : -1000, max : 1000, slide_round : 0.1,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangePointPos(inst.mValue, 2, cLang.act_set_point_z);
    }, });
RailBuilder.mPointHeightMgr = UI_Slider.createMgr({
    fixed : true, min : -50, max : 50, slide_round : 0.1,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangePointPos(inst.mValue, 1, cLang.act_set_point_height);
    }, });
RailBuilder.mPointDirMgr = UI_Slider.createMgr({
    fixed : true, min : -180, max : 180, slide_round : 0.1,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangePointDir(
            inst.mValue, RailBuilder.mPointSlopeMgr.getValue(),
            RailBuilder.mPointCantMgr.getValue(), cLang.act_set_point_dir);
    }, });
RailBuilder.mPointSlopeMgr = UI_Slider.createMgr({
    fixed : true, min : -50, max : 50, slide_round : 0.1,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangePointDir(
            RailBuilder.mPointDirMgr.getValue(), inst.mValue,
            RailBuilder.mPointCantMgr.getValue(), cLang.act_set_point_slope);
    }, });
RailBuilder.mPointCantMgr = UI_Slider.createMgr({
    fixed : true, min : -20, max : 20, slide_round : 0.1,
    on_update : function(inst, src_mgr) {
        RailBuilder.onChangePointDir(
            RailBuilder.mPointDirMgr.getValue(), RailBuilder.mPointSlopeMgr.getValue(),
            inst.mValue, cLang.act_set_point_cant);
    }, });
RailBuilder.mSwitchSettingMgr = UI_Struct.createMgr({
    clip_name : 'schedule-switch-setting', disable_undo : true, });
RailBuilder.mSwitchSettingMgr.pushStruct({
    key : 'train_id', title : LangAppend(cLang.cmn_train, ' ID'), def_value : '', labeled : true,
    get_def_value : function() {
        var v = TrainEditor.getDefaultValue(); return v === null ? '' : v;
    },
    mgr : RailBuilder.mSwitchTrainSelectMgr = TrainEditor.createSelectMgr({
        parent_mgr : RailBuilder.mSwitchSettingMgr, fixed : true, }), });
RailBuilder.mSwitchSettingMgr.pushStruct({
    key : 'schedule', title : cLang.travel_dir, def_value : 'main', labeled : true,
    mgr : RailBuilder.mTurnFlagMgr = UI_Radio.createMgr({
        clip_name : 'switch-turn-flag', fixed : true, dom_name : 'radio-sched-sw-turn-flag',
        parent_mgr : RailBuilder.mSwitchSettingMgr,
        options : [
            { value : 'main', label : cLang.switch_dir_main, },
            { value : 'sub' , label : cLang.switch_dir_sub , },
            { value : 'alt' , label : cLang.switch_dir_alt , },
            { value : 'rnd' , label : cLang.switch_dir_rnd , },
        ], }), });
RailBuilder.mSwitchSettingMgr.initializeStruct();
RailBuilder.mSwitchSettingsMgr = UI_Array.createMgr({
    fixed : true, element_mgr : RailBuilder.mSwitchSettingMgr, init_element_value : null,
    fixed_elements : [cLang.cmn_default],
    on_update : function(inst, src_mgr) {
        var rail = RailBuilder.mSelectedSwitch, rail_side = RailBuilder.mSelectedSwitchSide;
        if (!rail) { return; }
        var old_value = rail.mSwitchInfos[rail_side];
        var new_value = RailBuilder.mSwitchSettingsMgr.getValue();
        PushUndo(function() {
            rail.mSwitchInfos[rail_side] = old_value;
        }, function() {
            rail.mSwitchInfos[rail_side] = new_value;
        }, cLang.act_set_sw_schedule, true, rail);
    }, });
RailBuilder.mSignalNameMgr = UI_Text.createMgr({
    size : 16, fixed : true, type : 'id',
    on_update : function(inst, src_mgr) {
        var rail = RailBuilder.mSelectedRail;
        if (!rail) { return; }
        var old_value = rail.mSignalName;
        var new_value = RailBuilder.mSignalNameMgr.getValue();
        if (old_value == new_value) { return; }
        PushUndo(function() {
            rail.mSignalName = old_value;
        }, function() {
            rail.mSignalName = new_value;
        }, cLang.act_set_signal_name, true, rail);
    }, });
RailBuilder.mStationSettingMgr = UI_Struct.createMgr({
    clip_name : 'schedule-station-setting', disable_undo : true, });
RailBuilder.mStationSettingMgr.pushStruct({
    key : 'train_id', title : LangAppend(cLang.cmn_train, ' ID'), def_value : '', labeled : true,
    get_def_value : function() {
        var v = TrainEditor.getDefaultValue(); return v === null ? '' : v;
    },
    mgr : RailBuilder.mStationTrainSelectMgr = TrainEditor.createSelectMgr({
        parent_mgr : RailBuilder.mStationSettingMgr, fixed : true, }), });
RailBuilder.mStationTrainSelectMgr.mIsEnableEmptyOption = true;
RailBuilder.mStationSettingMgr.pushStruct({
    key : 'direction', title : cLang.travel_dir, def_value : 'all', labeled : true,
    mgr : RailBuilder.mTrainDirectionMgr = UI_Radio.createMgr({
        clip_name : 'train-direction', fixed : true, dom_name : 'radio-sched-train-dir',
        parent_mgr : RailBuilder.mStationSettingMgr,
        options : [
            { value : 'all', label : cLang.station_dir_any, },
            { value : '0', label : '0', },
            { value : '1', label : '1', },
        ], }), });
RailBuilder.mStationSettingMgr.pushStruct({
    key : 'stop', title : cLang.station_stop, def_value : true, labeled : true,
    mgr : UI_Check.createMgr({ parent_mgr : RailBuilder.mStationSettingMgr, fixed : true, }), });
RailBuilder.mStationSettingMgr.pushStruct({
    key : 'turnaround', title : cLang.station_turnaround, def_value : false, labeled : true,
    mgr : UI_Check.createMgr({ parent_mgr : RailBuilder.mStationSettingMgr, fixed : true, }), });
RailBuilder.mStationSettingMgr.pushStruct({
    key : 'duration', def_value : 5,
    title : LangJoin([cLang.station_time, ' [', cLang.cmn_sec, ']']),
    mgr : UI_Slider.createMgr({
        parent_mgr : RailBuilder.mStationSettingMgr, fixed : true,
        min : 0, max : 60, slide_round : 1, }), });
RailBuilder.mStationSettingMgr.pushStruct({
    key : 'duration_rnd', def_value : 0,
    title : LangAppendSp(cLang.station_time, cLang.cmn_random),
    mgr : UI_Slider.createMgr({
        parent_mgr : RailBuilder.mStationSettingMgr, fixed : true,
        min : 0, max : 60, slide_round : 1, }), });
RailBuilder.mStationSettingMgr.pushStruct({
    key : 'offset', title : cLang.cmn_position, def_value : 0,
    mgr : RailBuilder.mStationOffsetMgr = UI_Slider.createMgr({
        parent_mgr : RailBuilder.mStationSettingMgr, fixed : true, fixed_range : true,
        min : 0, max : 1, slide_round : 0.01, }), });
RailBuilder.mStationSettingMgr.initializeStruct();
RailBuilder.mStationSettingsMgr = UI_Array.createMgr({
    fixed : true, element_mgr : RailBuilder.mStationSettingMgr, init_element_value : null,
    on_update : function(inst, src_mgr) {
        var rail = RailBuilder.mSelectedRail;
        if (!rail) { return; }
        var old_value = rail.mStationInfo
        var new_value = RailBuilder.mStationSettingsMgr.getValue();
        PushUndo(function() {
            rail.mStationInfo = old_value;
        }, function() {
            rail.mStationInfo = new_value;
        }, cLang.act_set_stn_schedule, true, rail);
    }, });
RailBuilder.initialize = function()
{
    this.mRailPane = CreateEditPane('rail', cLang.head_rail, function(div_on) {
        this.mFieldSetting = this.mFieldSettingMgr.createActiveInstance({
            parent : div_on, value : true, title : cLang.struct_field_setting, });
        div_on.append(CreateHBR());
        this.mFieldHeight = this.mFieldHeightMgr.createActiveInstance({
            parent : div_on, value : 0, title : cLang.track_field_height, });
        div_on.append(CreateBR());
        this.mRailHintArea = CreateElement('span');
        this.mRailHintArea.append(LangSpan(cLang.desc_select_rail_end));
        this.mRailArea = CreateElement('span');
        this.mHeight = this.mHeightMgr.createActiveInstance({
            parent : this.mRailArea, value : 0, title : cLang.track_elevated, });
        this.mRailArea.append(CreateHBR());
        this.mCurveFactor = this.mCurveFactorMgr.createActiveInstance({
            parent : this.mRailArea, value : 0.5, title : cLang.track_curve_factor, });
        this.mRailArea.append(CreateHBR());
        this.mRailFlag = this.mRailFlagMgr.createActiveInstance({
            parent : this.mRailArea, value : true, title : cLang.track_rail, });
        this.mRailType = this.mRailTypeMgr.createActiveInstance({
            parent : this.mRailArea, value : 'narrow', title : cLang.cmn_type, });
        this.mRailArea.append(CreateHBR());
        this.mTieFlag = this.mTieFlagMgr.createActiveInstance({
            parent : this.mRailArea, value : true, title : cLang.track_tie, });
        this.mTieType = this.mTieTypeMgr.createActiveInstance({
            parent : this.mRailArea, value : 'ballast', title : cLang.cmn_type, });
        this.mRailArea.append(CreateHBR());
        this.mGirderFlag = this.mGirderFlagMgr.createActiveInstance({
            parent : this.mRailArea, value : false, title : cLang.track_girder, });
        this.mGirderType = this.mGirderTypeMgr.createActiveInstance({
            parent : this.mRailArea, value : 'girder', title : cLang.cmn_type, });
        this.mRailArea.append(CreateHBR());
        this.mPierFlag = this.mPierFlagMgr.createActiveInstance({
            parent : this.mRailArea, value : false, title : cLang.track_pier, });
        this.mPierType = this.mPierTypeMgr.createActiveInstance({
            parent : this.mRailArea, value : 'center', title : cLang.cmn_type, });
        this.mRailArea.append(CreateHBR());
        this.mPierInterval = this.mPierIntervalMgr.createActiveInstance({
            parent : this.mRailArea, value : RailMetric.cPierIntervalDefault,
            title : cLang.track_interval, });
        this.mRailArea.append(CreateHBR());
        this.mPierOffset = this.mPierOffsetMgr.createActiveInstance({
            parent : this.mRailArea, value : 0, title : cLang.cmn_position, });
        this.mRailArea.append(CreateHBR());
        this.mLeftPart = this.mRailPartMgr.createInstance({
            parent : this.mRailArea, value : this.mRailPartMgr.makeDefaultValue(),
            title : LangAppendSp(cLang.cmn_left, cLang.track_part), });
        this.mRailArea.append(CreateHBR());
        this.mRightPart = this.mRailPartMgr.createInstance({
            parent : this.mRailArea, value : this.mRailPartMgr.makeDefaultValue(),
            title : LangAppendSp(cLang.cmn_right, cLang.track_part), });
        this.mRailArea.append(CreateHBRVSL());
        this.mRailArea.append(CreateScriptLinkEdit(cLang.cmn_cancel, function() {
            RailBuilder.deleteControlPoint(); }, cLang.desc_delete_last_ctrl_point), ' / ');
        this.mRailArea.append(CreateScriptLinkEdit(cLang.cmn_delete, function() {
            RailBuilder.deleteSelectedRail(); }, cLang.desc_delete_selected_rail));
        this.mPointArea = CreateElement('span');
        this.mPointX = this.mPointXMgr.createActiveInstance({
            parent : this.mPointArea, value : 0,
            title : LangAppend(cLang.cmn_position, ' (X)'), });
        this.mPointArea.append(CreateHBR());
        this.mPointZ = this.mPointZMgr.createActiveInstance({
            parent : this.mPointArea, value : 0,
            title : LangAppend(cLang.cmn_position, ' (Z)'), });
        this.mPointArea.append(CreateHBR());
        this.mPointHeight = this.mPointHeightMgr.createActiveInstance({
            parent : this.mPointArea, value : 0,
            title : LangAppend(cLang.track_elevated, ' (Y)'), });
        this.mPointArea.append(CreateHBR());
        this.mPointDir = this.mPointDirMgr.createActiveInstance({
            parent : this.mPointArea, value : 0, title : cLang.cmn_direction, });
        this.mPointArea.append(CreateHBR());
        this.mPointSlope = this.mPointSlopeMgr.createActiveInstance({
            parent : this.mPointArea, value : 0, title : cLang.cmn_slope, });
        this.mPointArea.append(CreateHBR());
        this.mPointCant = this.mPointCantMgr.createActiveInstance({
            parent : this.mPointArea, value : 0, title : cLang.cmn_cant, });
        this.mActiveRailArea = this.mRailArea;
        div_on.append(this.mActiveRailArea);
        OnNextCalc(function() {
            if (!this.mFieldHeightMgr.isVisible()) { return true; }
            this.mFieldHeightMgr.updateSlider(this.mHeight.mValue);
        }, this);
        OnNextCalc(function() {
            if (!this.mHeightMgr.isVisible()) { return true; }
            this.mHeightMgr.updateSlider(this.mHeight.mValue);
            this.mCurveFactorMgr.updateSlider(this.mCurveFactor.mValue);
            this.mPierIntervalMgr.updateSlider(this.mPierInterval.mValue);
            this.mPierOffsetMgr.updateSlider(this.mPierOffset.mValue);
        }, this);
        OnNextCalc(function() {
            if (!this.mPointHeightMgr.isVisible()) { return true; }
            this.mPointXMgr.updateSlider(this.mPointX.mValue);
            this.mPointZMgr.updateSlider(this.mPointZ.mValue);
            this.mPointHeightMgr.updateSlider(this.mPointHeight.mValue);
            this.mPointDirMgr.updateSlider(this.mPointDir.mValue);
            this.mPointSlopeMgr.updateSlider(this.mPointSlope.mValue);
            this.mPointCantMgr.updateSlider(this.mPointCant.mValue);
        }, this);
    }, this);
    this.mSchedulePane = CreateEditPane('schedule', cLang.head_schedule, function(div_on) {
        this.mScheduleHintArea = CreateElement('span');
        this.mScheduleHintArea.append(LangSpan(cLang.desc_select_rail_switch));
        this.mSwitchArea = CreateElement('span');
        this.mSwitchSettings = this.mSwitchSettingsMgr.createActiveInstance({
            parent : this.mSwitchArea, value : [{ train_id : 'default', schedule : 'main', }],
            title : LangAppendSp(cLang.cmn_turnout, cLang.cmn_settings), });
        this.mStationArea = CreateElement('span');
        this.mSignalName = this.mSignalNameMgr.createActiveInstance({
            parent : this.mStationArea, title : cLang.station_signal_name, value : '', });
        this.mStationArea.append(CreateBR());
        this.mStationSettings = this.mStationSettingsMgr.createActiveInstance({
            parent : this.mStationArea, value : [],
            title : LangAppendSp(cLang.cmn_station, cLang.cmn_settings), });
        this.mActiveScheduleArea = this.mScheduleHintArea;
        div_on.append(this.mActiveScheduleArea);
    }, this);
};
RailBuilder.getCurveFactor  = function() { return this.mCurveFactor .mValue; };
RailBuilder.getRailFlag     = function() { return this.mRailFlag    .mValue; };
RailBuilder.getRailType     = function() { return this.mRailType    .mValue; };
RailBuilder.getTieFlag      = function() { return this.mTieFlag     .mValue; };
RailBuilder.getTieType      = function() { return this.mTieType     .mValue; };
RailBuilder.getGirderFlag   = function() { return this.mGirderFlag  .mValue; };
RailBuilder.getGirderType   = function() { return this.mGirderType  .mValue; };
RailBuilder.getPierFlag     = function() { return this.mPierFlag    .mValue; };
RailBuilder.getPierType     = function() { return this.mPierType    .mValue; };
RailBuilder.getPierInterval = function() { return this.mPierInterval.mValue; };
RailBuilder.getPierOffset   = function() { return this.mPierOffset  .mValue; };
RailBuilder.getLeftPart     = function() { return this.mLeftPart    .mValue; };
RailBuilder.getRightPart    = function() { return this.mRightPart   .mValue; };
RailBuilder.getSignalName   = function() { return this.mSignalName  .mValue; };
RailBuilder.selectRailArea = function(area)
{
    if (this.mActiveRailArea != area) {
        var parent = this.mActiveRailArea.parentNode;
        parent.insertBefore(area, this.mActiveRailArea);
        parent.removeChild(this.mActiveRailArea);
        this.mActiveRailArea = area;
    }
};
RailBuilder.selectScheduleArea = function(area)
{
    if (this.mActiveScheduleArea != area) {
        var parent = this.mActiveScheduleArea.parentNode;
        parent.insertBefore(area, this.mActiveScheduleArea);
        parent.removeChild(this.mActiveScheduleArea);
        this.mActiveScheduleArea = area;
    }
};
RailBuilder.deselectRail = function()
{
    this.mSelectedRail = this.mSelectedPoint = RailBuilder.mSelectedSwitch = null;
    this.selectRailArea(this.mRailHintArea);
    this.selectScheduleArea(this.mScheduleHintArea);
}
RailBuilder.addCtrlPoint = function(wpos)
{
    if (!wpos) { wpos = this.mCursorPos; }
    if (!wpos) { return; }
    var point = null, split_info = this.mRailSplitInfo;
    if (split_info)
    {
        var del_rail = split_info.rail;
        point = ControlPoint.create(split_info.pos);
        ControlPoint.setDir(point, split_info.dir, split_info.up);
        var point0 = del_rail.mPoints[0], point1 = del_rail.mPoints[1];
        var point_side0 = ControlPoint.checkSide(point0, del_rail);
        var point_side1 = ControlPoint.checkSide(point1, del_rail);
        Rail.deleteRail(del_rail);
        var rail0 = Rail.create(point0, point_side0, point, 0);
        var rail1 = Rail.create(point, 1, point1, point_side1);
        Rail.cRailOptions.forEach(name =>
            rail0['m' + name.m] = rail1['m' + name.m] = del_rail['m' + name.m]);
        Rail.writeAll();
        PushUndo(function() {
            Rail.deleteRail(rail0);
            Rail.deleteRail(rail1);
            Rail.connect(del_rail, point0, point_side0, point1, point_side1);
            Rail.pushObj(del_rail);
            Rail.writeAll();
        }, function() {
            Rail.deleteRail(del_rail);
            Rail.connect(rail0, point0, point_side0, point, 0);
            Rail.connect(rail1, point, 1, point1, point_side1);
            Rail.pushObj(rail0);
            Rail.pushObj(rail1);
            Rail.writeAll();
        }, cLang.act_split_rail);
        return;
    }
    var point_side = 0;
    if (this.mNearestEnd) {
        point = Rail.getPoint(this.mNearestEnd.rail,
                              this.mNearestEnd.side, this.mNearestEnd.sw);
        point_side = this.mNearestEndPointSide;
    } else {
        point = ControlPoint.create(wpos);
        point_side = this.mFirstPoint ? 0 : 1;
    }
    if (this.mFirstPoint)
    {
        var dist = v3.CalcDist(this.mFirstPoint.mPos, point.mPos);
        if (dist < this.cMinDist || this.mIsTooClose) {
            this.deleteControlPoint();
        } else if (this.mSwitchPointInfo) {
            var switch_side = 1 - this.mFirstRailSide;
            Log(LangJoin([cLang.act_create_sw_point, ': ' + switch_side]));
            if (switch_side == 0) { v3.neg(this.mSwitchPointInfo.dir); }
            point.mPos = this.mSwitchPointInfo.pos;
            point.mLeftSign = this.mSwitchPointInfo.left_sign;
            ControlPoint.setDir(point, this.mSwitchPointInfo.dir);
            var rail = this.mFirstRail;
            PushUndo(function() {
                Rail.setSwitchPoint(rail, switch_side, null);
                Rail.writeAll();
            }, function() {
                Rail.setSwitchPoint(rail, switch_side, point);
                Rail.writeAll();
            }, cLang.act_create_sw_point, true);
            this.resetControlPoint();
            this.mSwitchPointInfo = null;
        } else {
            Log(LangJoin([cLang.act_build_track, ': ' + v3.ToFixed(wpos, 2)]));
            var point0 = this.mFirstPoint;
            var point_side0 = this.mFirstPointSide;
            var pos0 = point0.mPos, pos1 = point.mPos;
            if (!point0.mDir || !point.mDir) {
                if (point0.mDir) {
                    var cdir = v3.Muls(point0.mDir, point_side0 ? 1 : -1);
                    ControlPoint.setDir(point, this.CalcCounterDir(pos0, cdir, pos1, true));
                } else if (point.mDir) {
                    var cdir = v3.Muls(point.mDir, point_side ? -1 : 1);
                    ControlPoint.setDir(point0, this.CalcCounterDir(pos1, cdir, pos0, false));
                } else {
                    var dir = v3.normalize(v3.Sub(pos1, pos0));
                    ControlPoint.setDir(point0, dir);
                    ControlPoint.setDir(point, dir);
                }
            }
            var rail = Rail.create(point0, point_side0, point, point_side);
            Rail.writeAll();
            PushUndo(function() {
                Rail.deleteRail(rail);
                Rail.writeAll();
            }, function() {
                Rail.connect(rail, point0, point_side0, point, point_side);
                Rail.pushObj(rail);
                Rail.writeAll();
            }, cLang.act_build_track);
            this.resetControlPoint();
        }
    }
    else
    {
        this.mFirstRail     = this.mNearestEnd && this.mNearestEnd.rail;
        this.mFirstRailSide = this.mNearestEnd && this.mNearestEnd.side;
        this.mFirstRailSw   = this.mNearestEnd && this.mNearestEnd.sw  ;
        this.mFirstPoint     = point;
        this.mFirstPointSide = point_side;
        Log(LangJoin([cLang.act_ctrl_point, ': ' + v3.ToFixed(wpos, 2)]));
    }
};
RailBuilder.deleteControlPoint = function()
{
    if (this.mFirstPoint) {
        this.resetControlPoint();
    }
};
RailBuilder.resetControlPoint = function()
{
    this.mFirstRail  = null;
    this.mFirstPoint = null;
};
RailBuilder.CalcCounterDir = function(pos0, dir0, pos1, is_flat)
{
    var dir = v3.normalize(v3.Sub(pos1, pos0));
    v3.muls(dir, v3.Dot(dir, dir0));
    dir = v3.Lerp(dir0, dir, 2);
    if (is_flat) { dir[1] = 0; }
    return v3.normalize(dir);
};
RailBuilder.CalcSwitchPointInfo = function(
    pos0, tpos1, tup1, tdir1, tleft1, left_sign, rail_type)
{
    var gauge = rail_type == 'narrow' ? RailMetric.cGauge
        : rail_type == 'standard' ? RailMetric.cGaugeStd
        : rail_type == 'safege' ? RailMetric.cSafegeWidth
        : rail_type == 'alweg' ? RailMetric.cAlwegSwitchWidth : 0;
    var width = rail_type == 'narrow' || rail_type == 'standard' ? RailMetric.cWidth : 0;
    var pos1 = v3.Add(
        tpos1, v3.Muls(tleft1, left_sign * (gauge + width)));
    var dir1 = this.CalcCounterDir(
        v3.Add(tpos1, v3.Muls(tdir1, v3.CalcDist(pos0, tpos1))), v3.Neg(tdir1), pos1);
    //var dir1 = this.CalcCounterDir(pos0, v3.Neg(tdir1), pos1);
    var left1 = v3.normalize(v3.Cross(tup1, dir1));
    v3.sub(pos1, v3.Muls(tleft1, left_sign * gauge * 0.5));
    v3.sub(pos1, v3.Muls( left1, left_sign * gauge * 0.5));
    return { pos : pos1, dir : dir1, };
};
// for automatic control
RailBuilder.setConnectionPoint = function(wpos)
{
    if (!this.mNearestEnd) {
        var nearest_end = Rail.searchNearestEnd(wpos);
        if (nearest_end.rail) {
            var con = Rail.getConnection(
                nearest_end.rail, nearest_end.side, nearest_end.sw);
            if (/*!con.rail*/true) {
                this.mNearestEnd = nearest_end;
                this.mNearestEndPointSide = con.point_side;
                this.addCtrlPoint(wpos);
                this.mNearestEnd = null;
            }
        }
    }
};
// for automatic control
RailBuilder.completeSwitchPoint = function(wpos)
{
    this.calc(wpos);
    this.addCtrlPoint(wpos);
};
RailBuilder.updateSwitchPoint = function(bpoint) {
    for (var i = 0; i < bpoint.mRails.length; ++i) {
        var rail = bpoint.mRails[i];
        if (!rail) { continue; }
        var rail_end = Rail.checkEnd(rail, bpoint);
        var spoint = Rail.getPoint(rail, rail_end, 1);
        if (!spoint) { continue; }
        var point0 = Rail.getPoint(rail, 1 - rail_end, 0);
        var pos0 = point0.mPos, dir0 = point0.mDir, up0 = point0.mUp;
        if (ControlPoint.checkSide(point0, rail) == 0) {
            dir0 = v3.Neg(dir0);
        }
        var pos1 = bpoint.mPos, up1 = bpoint.mUp;
        var tdir1 = v3.Muls(bpoint.mDir, RailMetric.cEndSign[
            ControlPoint.checkSide(bpoint, rail)]);
        var tleft1 = v3.normalize(v3.Cross(up1, tdir1));
        var left_sign = spoint.mLeftSign;
        var sinfo = RailBuilder.CalcSwitchPointInfo(
            pos0, pos1, up1, tdir1, tleft1, left_sign, rail.mRailType);
        spoint.mPos = sinfo.pos;
        if (rail_end == 0) { v3.neg(sinfo.dir); }
        ControlPoint.setDir(spoint, sinfo.dir, up1);
    }
};
RailBuilder.endMovePoint = function()
{
    var point = this.mMovePoint;
    var prev_pos  = v3.Dup(this.mMoveBasePointPos );
    var prev_dir  = v3.Dup(this.mMoveBasePointDir );
    var prev_left = v3.Dup(this.mMoveBasePointLeft);
    var next_pos  = v3.Dup(this.mMovePoint.mPos );
    var next_dir  = v3.Dup(this.mMovePoint.mDir );
    var next_left = v3.Dup(this.mMovePoint.mLeft);
    var eps = 1.0e-6;
    if (v3.CalcDist(prev_pos , next_pos ) > eps ||
        v3.CalcDist(prev_dir , next_dir ) > eps ||
        v3.CalcDist(prev_left, next_left) > eps) {
        var update_switch_points = function() {
            RailBuilder.updateSwitchPoint(point);
            for (var i = 0; i < point.mRails.length; ++i) {
                var rail = point.mRails[i];
                if (!rail) { continue; }
                var rail_end = Rail.checkEnd(rail, point);
                var cpoint = Rail.getPoint(rail, 1 - rail_end, 0)
                if (!cpoint || cpoint.mSwitchFrom >= 0) { continue; }
                RailBuilder.updateSwitchPoint(cpoint);
            }
            Rail.writeAll();
        }
        function undo_point() {
            point.mPos  = v3.Dup(prev_pos );
            point.mDir  = v3.Dup(prev_dir );
            point.mLeft = v3.Dup(prev_left);
        }
        if (g_mouse.isTouchMoved()) {
            PushUndo(function() {
                undo_point();
                update_switch_points();
            }, function() {
                point.mPos  = v3.Dup(next_pos );
                point.mDir  = v3.Dup(next_dir );
                point.mLeft = v3.Dup(next_left);
                update_switch_points();
            }, cLang.act_move_rail);
            update_switch_points();
        } else {
            undo_point();
        }
    }
};
RailBuilder.endRotatePoint = function()
{
    Rail.writeAll();
};
RailBuilder.turnSwitch = function()
{
    var rail = this.mTurnSwitchRail;
    if (rail) {
        var side = 1 - this.mTurnSwitchRailSide;
        var state = rail.mDrawBlock.mSwitchState;
        state[side] = 1 - state[side];
    }
};
RailBuilder.deleteSelectedRail = function()
{
    if (this.mSelectedRail) {
        var del_rail = this.mSelectedRail;
        var del_info = [[null, null], [null, null]];
        for (var side = 0; side < 2; ++side) {
            for (var sw = 0; sw < 2; ++sw) {
                var point = (sw ? del_rail.mSwitchPoints : del_rail.mPoints)[side];
                if (!point) { continue; }
                del_info[side][sw] = {
                    point : point,
                    pside : point.mRails[0] == del_rail ? 0 : 1,
                    sfrom : sw ? point.mSwitchFrom : -1,
                };
            }
        }
        this.mSelectedRail = null;
        PushUndo(function() {
            Rail.pushObj(del_rail);
            for (var side = 0; side < 2; ++side) {
                for (var sw = 0; sw < 2; ++sw) {
                    var info = del_info[side][sw];
                    if (!info) { continue; }
                    info.point.mRails[info.pside] = del_rail;
                    if (info.sfrom >= 0) { info.point.mSwitchFrom = info.sfrom; }
                }
            }
            Rail.writeAll();
        }, function() {
            Rail.deleteRail(del_rail);
            Rail.writeAll();
        }, cLang.act_delete_rail, true);
    }
};
RailBuilder.calc = function(wpos)
{
    if (this.mFieldSetting.mValue) {
        var field_args = {}, field_height = FieldEditor.getFieldHeight(wpos, field_args);
        if (field_height !== null) { wpos[1] = field_height + this.mFieldHeight.mValue; }
    }
    this.mCursorPos = v3.Dup(wpos);
    if (this.mFirstPoint)
    {
        var dist = g_camera.calcSphereIntersection(
            g_cursor_ray, v4.FromV3(this.mFirstPoint.mPos, this.cMinDist));
        this.mIsTooClose = dist >= 0;
    }
    this.mNearestEnd = null;
    this.mNearestRail = null;
    this.mNearestSwitch = null;
    this.mSwitchPointInfo = null;
    this.mRailSplitInfo = null;
    var nearest_end = Rail.searchNearestEnd(wpos, IsMenuSchedule() ? 10 : 1);
    if (nearest_end.rail) {
        if (nearest_end.dist < this.cMinDist) {
            var con = Rail.getConnection(
                nearest_end.rail, nearest_end.side, nearest_end.sw);
            if (!(IsMenuBuildRail() &&
                  (this.mFirstRail && nearest_end.rail == this.mFirstRail
                   || nearest_end.sw && con.rail
                   || con.rail && nearest_end.rail && Rail.getPoint(
                       nearest_end.rail, 1 - Rail.checkEnd(nearest_end.rail, con.point), 1)))) {
                if (IsMenuEditRail() ? con.point.mSwitchFrom < 0
                    : !this.mFirstPoint || !con.rail) {
                    this.mNearestEnd = nearest_end;
                    this.mNearestEndPointSide = con.point_side;
                }
            }
        }
    }
    function calc_selection() {
        if (RailBuilder.mNearestEnd) { return; }
        var nearest_rail = Rail.searchNearestRail(wpos);
        if (nearest_rail.rail && nearest_rail.dist < RailBuilder.cMinDist) {
            RailBuilder.mNearestRail = nearest_rail.rail;
            Rail.setHighlight(RailBuilder.mNearestRail);
        }
        Rail.setSelected(RailBuilder.mSelectedRail);
    }
    if (IsMenuBuildRail())
    {
        this.selectRailArea(this.mRailArea);
        if (this.mFirstPoint && this.mFirstRail &&
            this.mFirstPoint.mRails[this.mFirstPointSide]) {
            var pos0 = this.mFirstPoint.mPos;
            var dir0 = this.mFirstPoint.mDir;
            var up0 = v3.ey, up1 = v3.ey;
            if (this.mFirstPointSide == 1) {
                dir0 = v3.Neg(dir0);
            }
            //var point1 = this.mFirstRail.mPoints[1 - this.mFirstRailSide];
            var point1 = Rail.getPoint(
                this.mFirstRail, 1 - this.mFirstRailSide, this.mFirstRailSw);
            var pos1 = point1.mPos;
            var tdir1 = v3.Muls(point1.mDir, RailMetric.cEndSign[
                ControlPoint.checkSide(point1, this.mFirstRail)]);
            var tleft1 = v3.normalize(v3.Cross(up0, tdir1));
            var left_sign = 1;
            if (v3.Dot(tleft1, v3.Sub(this.mCursorPos, pos1)) < 0) {
                left_sign = -1;
            }
            var rail_type = this.getRailType();
            this.mSwitchPointInfo = this.CalcSwitchPointInfo(
                pos0, pos1, up1, tdir1, tleft1, left_sign, rail_type);
            this.mSwitchPointInfo.left_sign = left_sign;
        }
        else if (!nearest_end.rail)
        {
            var nearest_rail = Rail.searchNearestRail(wpos);
            if (nearest_rail.rail && nearest_rail.dist < this.cMinDist) {
                for (var i = 0; i < 2; ++i) {
                    if (v3.CalcDist(nearest_rail.rail.mPoints[i].mPos, nearest_rail.pos)
                        < this.cMinDist || nearest_rail.rail.mSwitchPoints[i]) {
                        nearest_rail = null; break;
                    }
                }
                if (nearest_rail) {
                    this.mRailSplitInfo = nearest_rail;
                }
            }
        }
        if (g_keyboard.getEscapeTrig()) {
            RailBuilder.deleteControlPoint();
        }
    }
    else if (IsMenuEditRail())
    {
        this.selectRailArea(this.mSelectedRail ? this.mRailArea :
                            this.mSelectedPoint ? this.mPointArea : this.mRailHintArea);
        calc_selection();
        if (g_ctrl_state == CtrlState.cMouseDown) {
            if (g_mouse.wasShortTouch()) {
                var rail = this.mSelectedRail = this.mNearestRail;
                this.mSelectedPoint = null;
                if (rail) {
                    this.selectRailArea(this.mRailArea);
                    var pos0 = rail.mPoints[0].mPos, pos1 = rail.mPoints[1].mPos;
                    var hpos = CalcCursorRayDist(pos0) < CalcCursorRayDist(pos1) ? pos0 : pos1;
                    this.mHeightMgr.updateValue(this.mHeight, hpos[1]);
                    this.mCurveFactorMgr.updateValue(this.mCurveFactor, rail.mCurveFactor);
                    this.mRailFlagMgr.updateValue(this.mRailFlag, rail.mRailFlag);
                    this.mRailTypeMgr.updateValue(this.mRailType, rail.mRailType);
                    this.mTieFlagMgr.updateValue(this.mTieFlag, rail.mTieFlag);
                    this.mTieTypeMgr.updateValue(this.mTieType, rail.mTieType);
                    this.mGirderFlagMgr.updateValue(this.mGirderFlag, rail.mGirderFlag);
                    this.mGirderTypeMgr.updateValue(this.mGirderType, rail.mGirderType);
                    this.mPierFlagMgr.updateValue(this.mPierFlag, rail.mPierFlag);
                    this.mPierTypeMgr.updateValue(this.mPierType, rail.mPierType);
                    this.mPierIntervalMgr.updateValue(
                        this.mPierInterval, rail.mPierInterval);
                    this.mPierOffsetMgr.updateValue(this.mPierOffset, rail.mPierOffset);
                    this.mRailPartMgr.updateValue(this.mLeftPart, rail.mLeftPart);
                    this.mRailPartMgr.updateValue(this.mRightPart, rail.mRightPart);
                }
            } else if (this.mNearestEnd) {
                g_ctrl_state = g_keyboard.isAltDown()
                    ? CtrlState.cRotatePoint : CtrlState.cMovePoint;
                g_mouse.resetDelta();
                this.mMovePoint = this.mNearestEnd.rail.mPoints[this.mNearestEnd.side];
                this.mMoveBasePointPos = v3.Dup(this.mMovePoint.mPos);
                this.mMoveBasePointDir = v3.Dup(this.mMovePoint.mDir);
                this.mMoveBasePointLeft = v3.Dup(this.mMovePoint.mLeft);
                v3.copy(wpos, this.mMovePoint.mPos);
                this.mMoveBaseCursorPos = v3.Dup(wpos);
                this.mHeightMgr.updateValue(this.mHeight, wpos[1]);
            }
        } else if (g_ctrl_state == CtrlState.cMovePoint) {
            if (g_mouse.wasShortTouch()) {
                this.selectRailArea(this.mPointArea);
                this.mSelectedPoint = this.mMovePoint;
                this.mSelectedRail = null;
                RailBuilder.mDiableOnChangePointDir = true;
                this.mPointXMgr.updateValue(this.mPointX, this.mSelectedPoint.mPos[0]);
                this.mPointZMgr.updateValue(this.mPointZ, this.mSelectedPoint.mPos[2]);
                this.mPointHeightMgr.updateValue(this.mPointHeight, this.mSelectedPoint.mPos[1]);
                this.mPointDirMgr.updateValue(this.mPointDir, Math.atan2(
                    this.mSelectedPoint.mDir[2], this.mSelectedPoint.mDir[0]) * cRad2Deg);
                this.mPointSlopeMgr.updateValue(this.mPointSlope, Math.atan2(
                    this.mSelectedPoint.mDir[1],
                    v3.Length(v3.SetY(this.mSelectedPoint.mDir, 0))) * cRad2Deg);
                var tmp_left = v3.normalize(v3.Cross(v3.ey, this.mSelectedPoint.mDir));
                var tmp_up = v3.normalize(v3.Cross(this.mSelectedPoint.mDir, tmp_left));
                this.mPointCantMgr.updateValue(this.mPointCant, Math.atan2(
                    v3.Dot(tmp_left, this.mSelectedPoint.mUp),
                    v3.Dot(tmp_up, this.mSelectedPoint.mUp)) * cRad2Deg);
                RailBuilder.mDiableOnChangePointDir = false;
            } else if (g_mouse.isTouchMoved()) {
                this.mMovePoint.mPos = v3.add(
                    v3.Sub(wpos, this.mMoveBaseCursorPos),
                    this.mMoveBasePointPos);
                if (g_keyboard.isShiftDown()) {
                    var cSnap = 2.5;
                    function round(x) {
                        return Math.round(x / cSnap) * cSnap;
                    }
                    function round_v3(v) {
                        v[0] = round(v[0]);
                        v[1] = round(v[1]);
                        v[2] = round(v[2]);
                    }
                    round_v3(this.mMovePoint.mPos);
                }
            }
        } else if (g_ctrl_state == CtrlState.cRotatePoint) {
            var theta = g_mouse.getDelta()[0] * 5.0;
            var base_dir = this.mMoveBasePointDir;
            var base_left = this.mMoveBasePointLeft;
            if (g_keyboard.isShiftDown()) {
                var base_up = v3.Cross(base_dir, base_left);
                base_dir = v3.Cross(v3.ex, base_up);
                base_left = v3.Cross(base_up, base_dir);
                var dot_dir = v3.Dot(this.mMoveBasePointDir, base_dir);
                var dot_left = v3.Dot(this.mMoveBasePointDir, base_left);
                var base_theta = Math.atan2(-dot_left, dot_dir);
                theta += base_theta;
                var cSnap = Math.PI / 12;
                theta = Math.round(theta / cSnap) * cSnap;
            }
            var cos_theta = Math.cos(theta);
            var sin_theta = Math.sin(theta);
            this.mMovePoint.mDir = v3.add(
                v3.Muls(base_dir, cos_theta),
                v3.Muls(base_left, -sin_theta));
            v3.setCross(this.mMovePoint.mLeft,
                        this.mMovePoint.mUp, this.mMovePoint.mDir);
        } else if (g_keyboard.getCommonDeleteTrig()) {
            this.deleteSelectedRail();
        }
    }
    else if (IsMenuSchedule())
    {
        calc_selection();
        function select_switch_or_rail() {
            if (nearest_end.rail && nearest_end.rail.mSwitchPoints[nearest_end.side]) {
                var cMaxHitDist = RailMetric.cGauge * 3;
                if (nearest_end.dist < cMaxHitDist) { return true; }
            }
            return false;
        }
        if (g_ctrl_state == CtrlState.cMouseDown) {
            if (g_mouse.wasShortTouch()) {
                this.mSelectedRail = null;
                this.mSelectedSwitch = null;
                if (select_switch_or_rail()) {
                    this.mSelectedSwitch = nearest_end.rail;
                    this.mSelectedSwitchSide = nearest_end.side;
                    this.mSelectedRail = null;
                    this.selectScheduleArea(this.mSwitchArea);
                    var infos = this.mSelectedSwitch.mSwitchInfos;
                    if (!infos[this.mSelectedSwitchSide]) {
                        infos[this.mSelectedSwitchSide] = [
                            {train_id : null, schedule : 'main', }];
                    }
                    this.mSwitchSettingsMgr.updateValue(
                        this.mSwitchSettings, infos[this.mSelectedSwitchSide]);
                } else if (this.mNearestRail) {
                    this.mSelectedRail = this.mNearestRail;
                    this.selectScheduleArea(this.mStationArea);
                    this.mSignalNameMgr.updateValue(
                        this.mSignalName, this.mSelectedRail.mSignalName);
                    this.mStationSettingsMgr.updateValue(
                        this.mStationSettings, this.mSelectedRail.mStationInfo);
                } else {
                    this.selectScheduleArea(this.mScheduleHintArea);
                }
            }
        } else {
            if (select_switch_or_rail()) {
                this.mNearestSwitch = nearest_end.rail;
                this.mNearestSwitchSide = nearest_end.side;
                this.mNearestRail = null;
                Rail.setHighlight(null);
            }
        }
        //this.mTurnSwitchRail = null;
        //Rail.resetDrawBlockColors(v4.cWhite);
        //var rail = nearest_end.rail;
        //if (rail && rail.mDrawBlock
        //    && rail.mSwitchPoints[nearest_end.side]) {
        //    var cMaxHitDist = RailMetric.cGauge * 10;
        //    if (nearest_end.dist < cMaxHitDist) {
        //        rail.mDrawBlock.mColor = v4.cRed;
        //        this.mTurnSwitchRail = rail;
        //        this.mTurnSwitchRailSide = nearest_end.side;
        //    }
        //}
    }
};
RailBuilder.write = function()
{
    if (this.mFirstPoint && IsMenuBuildRail())
    {
        var height = 5.0;
        var mtx = m34.MakeST(v3.Make(1, height, 1),
                             v3.AddY(this.mFirstPoint.mPos, height * 0.5));
        g_box_drawer.pushBox(
            mtx, this.mIsTooClose ? v4.Make(1, 0, 0, 1) : v4.Make(1, 1, 0, 1));
        FieldEditor.drawHeightLine(this.mFirstPoint.mPos);
    }
    var nearest_point = null;
    var con_pos = null, con_dir = null;
    if (this.mNearestEnd)
    {
        var rail = this.mNearestEnd.rail;
        var side = this.mNearestEnd.side;
        var sw   = this.mNearestEnd.sw  ;
        var point_side = this.mNearestEndPointSide;
        var sign = RailMetric.cEndSign[point_side];
        nearest_point = Rail.getPoint(rail, side, sw);
        if (IsMenuBuildRail()) {
            con_pos = AddRailTotalHeight(nearest_point.mPos, nearest_point.mUp);
            con_dir = v3.Muls(nearest_point.mDir, -sign);
            var len = 5.0;
            if (nearest_point.mRails[point_side]) {
                var con_perp = v3.normalize(v3.Cross(v3.ey, con_dir));
                var con_dir0 = v3.normalize(v3.add(v3.Muls(con_dir, 2), con_perp));
                var con_dir1 = v3.normalize(v3.sub(v3.Muls(con_dir, 2), con_perp));
                var color = v4.Make(1, 0.5, 0, 1);
                DrawArrow(con_pos, v3.add(v3.Muls(con_dir0, len), con_pos), 0.5, color);
                DrawArrow(con_pos, v3.add(v3.Muls(con_dir1, len), con_pos), 0.5, color);
            } else {
                DrawArrow(con_pos, v3.add(v3.Muls(con_dir, -len), con_pos),
                          0.5, v4.Make(1, 0, 0, 1));
            }
        }
    }
    var split_info = this.mRailSplitInfo;
    if (split_info)
    {
        g_box_drawer.pushBox(m34.MakeOrtho(
            split_info.dir, split_info.up, split_info.pos,
            v3.muls(v3.Make(4, 4, 0.2), RailMetric.cGauge)), v4.Make(0, 0, 1, 1));
    }
    var line_color = v4.Make(1, 0, 0, 1);
    function draw_line(seg0, seg1) {
        g_line_drawer.pushLine(
            AddRailTotalHeight(seg0.pos, seg0.up),
            AddRailTotalHeight(seg1.pos, seg1.up),
            line_color);
    }
    if (IsMenuBuildRail() && this.mFirstPoint) {
        var args = { curve_factor : this.getCurveFactor(), };
        if (this.mSwitchPointInfo) {
            var seg0 = { pos : this.mFirstPoint.mPos, dir : this.mFirstPoint.mDir,
                         up : v3.ey };
            var seg1 = { pos : this.mSwitchPointInfo.pos, dir : this.mSwitchPointInfo.dir,
                         up : v3.ey, };
            if (this.mFirstPointSide == 1) {
                seg0.dir = v3.Neg(seg0.dir);
            }
            line_color = v4.Make(1, 1, 0, 1);
            Rail.CalcCurve(seg0, seg1, draw_line, args);
        } else if (v3.CalcDist(this.mFirstPoint.mPos, this.mCursorPos) >= this.cMinDist) {
            var seg0 = { pos : this.mFirstPoint.mPos, dir : this.mFirstPoint.mDir,
                         up : v3.ey, };
            if (seg0.dir && this.mFirstPointSide == 0) {
                seg0.dir = v3.Neg(seg0.dir);
            }
            var seg1 = { pos : (con_pos ? con_pos : this.mCursorPos), dir : con_dir,
                         up : v3.ey, };
            if (!seg0.dir || !seg1.dir) {
                if (seg0.dir) {
                    seg1.dir = this.CalcCounterDir(seg0.pos, seg0.dir, seg1.pos, true);
                } else if (seg1.dir) {
                    seg0.dir = this.CalcCounterDir(seg1.pos, seg1.dir, seg0.pos, false);
                } else {
                    seg0.dir = seg1.dir = v3.normalize(v3.Sub(seg1.pos, seg0.pos));
                }
            }
            Rail.CalcCurve(seg0, seg1, draw_line, args);
        }
    }
    if (IsMenuBuildRail() || IsMenuEditRail()) {
        ControlPoint.forEach(function(point) {
            if (point.mSwitchFrom >= 0) { return; }
            var height = 2.0;
            var pos = AddRailTotalHeight(point.mPos, point.mUp);
            var mtx = m34.MakeOrtho(point.mDir, point.mUp, pos, v3.muls(
                v3.Make(0.5, 0.5, 2.0), RailMetric.cGauge));
            var color = v4.Make(0.5, 0.5, 1, 1);
            if (point == nearest_point) {
                color = v4.Make(1, point == this.mSelectedPoint ? 1 : 0, 0, 1);
            } else if (point == this.mSelectedPoint) {
                color = v4.Make(0, 1, 0, 1)
            }
            g_box_drawer.pushBox(mtx, color);
        }, this);
    }
    if (IsMenuEditRail()) {
        if (g_ctrl_state == CtrlState.cMovePoint ||
            g_ctrl_state == CtrlState.cRotatePoint) {
            for (var i = 0; i < this.mMovePoint.mRails.length; ++i) {
                if (this.mMovePoint.mRails[i]) {
                    Rail.calcCurve(
                        this.mMovePoint.mRails[i],
                        /*temp*/0, /*temp*/0, draw_line);
                }
            }
        }
    }
    if (IsMenuSchedule()) {
        function spoint_arrow_pos(pos, up) {
            return AddRailTotalHeight(pos, up);
        };
        function point_arrow_pos(pos, up) {
            return v3.add(AddRailTotalHeight(pos, up), v3.Make(0, 0.01, 0));
        };
        if (this.mSelectedRail &&
            document.body.contains(RailBuilder.mTrainDirectionMgr.mEditArea)) {
            var trdir = RailBuilder.mTrainDirectionMgr.getValue();
            var trofs = RailBuilder.mStationOffsetMgr.getValue();
            for (var i = 0; i < 2; ++i) {
                if (trdir != 'all' && trdir != (i ? '1' : '0')) { continue; }
                var ipos = Rail.getInterpolatedPos(this.mSelectedRail, i ? trofs : 1 - trofs);
                DrawArrow(spoint_arrow_pos(v3.add(v3.Muls(
                    ipos.dir, 2 * (i ? 1 : -1)), ipos.pos)),
                          spoint_arrow_pos(ipos.pos), 0.4, v4.Make(1, 0, 0, 1), ipos.up);
            }
        }
        Rail.forEach(function(rail) {
            for (var i = 0; i < rail.mPoints.length; ++i) {
                var spoint = rail.mSwitchPoints[i];
                if (!spoint) { continue; }
                var point = rail.mPoints[i];
                var state = rail.mDrawBlock.mSwitchState[1 - i];
                var color = v4.Make(1, 1, 0, 1);
                var pcolor = v4.Make(0.5, 0.5, 1, 1), scolor = pcolor;
                var is_poi = this.mNearestSwitch == rail && this.mNearestSwitchSide == i;
                var is_sel = this.mSelectedSwitch == rail && this.mSelectedSwitchSide == i;
                if (is_sel) {
                    pcolor = scolor = v4.Make(0.5, 1, 0.5, 1);
                    if (document.body.contains(RailBuilder.mTurnFlagMgr.mEditArea)) {
                        var c0 = v4.Make(0.9, 1, 0.9, 1), c1 = v4.Make(0, 1, 0, 1);
                        var turn_flag = RailBuilder.mTurnFlagMgr.getValue();
                        if (turn_flag == 'main') { pcolor = c1; scolor = c0; }
                        else if (turn_flag == 'sub') { pcolor = c0; scolor = c1; }
                    }
                    if (is_poi) { pcolor[0] = scolor[0] = 1; }
                } else if (is_poi) {
                    pcolor = scolor = v4.Make(1, 0.5, 0.5, 1);
                }
                var width = 0.2;
                if (rail.mDoubleSlipPivot) {
                    DrawArrow(spoint_arrow_pos(rail.mDoubleSlipPivot),
                              spoint_arrow_pos(spoint.mPos, spoint.mUp),
                              width, scolor, spoint.mUp);
                    DrawArrow(point_arrow_pos(rail.mDoubleSlipPivot),
                              point_arrow_pos(point.mPos, point.mUp),
                              width, pcolor, point.mUp);
                } else {
                    var cpoint = rail.mPoints[1 - i];
                    DrawArrow(
                        spoint_arrow_pos(cpoint.mPos, cpoint.mUp),
                        spoint_arrow_pos(spoint.mPos, spoint.mUp),
                        width, scolor, spoint.mUp);
                    DrawArrow(
                        point_arrow_pos(cpoint.mPos, cpoint.mUp),
                        point_arrow_pos(point.mPos, point.mUp),
                        width, pcolor, point.mUp);
                }
            }
        }, this);
    }
    if (this.mCursorPos) { FieldEditor.drawHeightLine(this.mCursorPos); }
};
RailBuilder.initialize();
g_undo_redo_callback.push(function() {
    RailBuilder.deleteControlPoint();
    RailBuilder.deselectRail();
});
  </script>
  <!-- <script src="field_editor.js"></script> -->
  <script>
'use strict';
var FieldEditor = CreateInstance();
FieldEditor.cRotMax = 4;
FieldEditor.mLayerRadioMgr = UI_Radio.createMgr({
    fixed : true, dom_name : 'radio-field-layer-sel',
    options : function(){
        var ret = [];
        for (var unit = g_field_unit_min; unit <= g_field_unit_max; unit *= 2) {
            ret.push({ value : '' + unit, });
        }
        return ret;
    }(), });
FieldEditor.mLayerDrawMgr = UI_Radio.createMgr({
    fixed : true, dom_name : 'radio-field-layer-draw',
    options : [
        { value : 'all'    , label : cLang.field_draw_all    , },
        { value : 'current', label : cLang.field_draw_current, },
        { value : 'others' , label : cLang.field_draw_others , },
    ], });
FieldEditor.mModeMgr = UI_Radio.createMgr({
    fixed : true, dom_name : 'radio-field-layer-draw',
    options : [
        { value : 'write', label : cLang.field_mode_write, },
        { value : 'erase', label : cLang.field_mode_erase, },
        { value : 'pick' , label : cLang.field_mode_pick , },
    ], });
FieldEditor.mHeightMgr = UI_Slider.createMgr({
    fixed : true, min : -100, max : 100, slide_round : 5, size : 4, width : '10em', })
FieldEditor.mSlopeMgr = UI_Vector.createMgr({
    fixed : true, dim : 2, min : -100, max : 100, slide_round : 5, size : 4,
    width : '10em', labels : ['X', 'Z'], });
FieldEditor.mFieldTypeMgr = UI_Select.createMgr({
    fixed : true, clip_name : 'field-type',
    options : [
        { label : cLang.field_grass , value : 'grass' , },
        { label : cLang.field_desert, value : 'desert', },
        { label : cLang.field_rock  , value : 'rock'  , },
        { label : cLang.field_snow  , value : 'snow'  , },
        { label : cLang.field_water , value : 'water' , },
    ], });
FieldEditor.initialize = function()
{
    this.mEditPane = CreateEditPane('field', cLang.head_field_editor, function(div_on) {
        this.mLayerRadio = this.mLayerRadioMgr.createActiveInstance({
            parent : div_on, value : '160', title : cLang.field_layer, });
        div_on.append(CreateHBR());
        this.mLayerDraw = this.mLayerDrawMgr.createActiveInstance({
            parent : div_on, value : 'all', title : cLang.field_draw, });
        div_on.append(CreateHBR());
        this.mMode = this.mModeMgr.createActiveInstance({
            parent : div_on, value : 'write', title : cLang.cmn_mode, });
        div_on.append(CreateHBR());
        this.mHeight = this.mHeightMgr.createActiveInstance({
            parent : div_on, value : 0, title : cLang.cmn_height, });
        div_on.append(CreateHBR());
        this.mSlope = this.mSlopeMgr.createActiveInstance({
            parent : div_on, value : v2.Makes(0), title : cLang.cmn_slope, });
        div_on.append(CreateHBR());
        this.mFieldType = this.mFieldTypeMgr.createActiveInstance({
            parent : div_on, value : 'grass', title : cLang.cmn_type, });
        div_on.append(CreateHBR());
        div_on.append(CreateScriptLinkEdit(
            cLang.field_update_rail, function() { Rail.writeAll(); }));
        OnNextCalc(function() {
            if (!this.mHeightMgr.isVisible()) { return true; }
            this.mHeightMgr.updateSlider(this.mHeight.mValue);
            this.mSlopeMgr.updateSlider(this.mSlope.mValue);
        }, this);
    }, this);
    this.clearField();
    this.mSelectedField = null;
    this.mPreviewInfo = null;
    this.mGridDrawer = GridDrawer.create(5);
};
FieldEditor.initializeGrid = function(gl)
{
    this.mGridDrawer.initialize(gl);
    this.mGridDrawer.beginWrite();
    var gn = 16;
    //var cx = Math.round(g_camera.mAt[0] / move_unit) * move_unit;
    //var cz = Math.round(g_camera.mAt[2] / move_unit) * move_unit;
    var min_x = -gn, max_x = gn, min_z = -gn, max_z = gn;
    for (var i = -gn; i <= gn; ++i) {
        var gx = i, gz = i;
        var c = v4.Make(1, 1, 1, !(i % 4) ? 1 : !(i % 2) ? 0.3 : 0.09);
        if (i) {
            this.mGridDrawer.pushLine(v3.Make(gx, 0, min_z), v3.Make(gx, 0, max_z), c);
            this.mGridDrawer.pushLine(v3.Make(min_x, 0, gz), v3.Make(max_x, 0, gz), c);
        } else {
            this.mGridDrawer.pushLine(v3.Make(gx, 0, min_z), v3.Make(gx, 0, 0), c);
            this.mGridDrawer.pushLine(v3.Make(min_x, 0, gz), v3.Make(0, 0, gz), c);
            var red = v4.Make(1, 0, 0, 1), blue = v4.Make(0, 0, 1, 1);
            this.mGridDrawer.pushLine(v3.Make(gx, 0, 0), v3.Make(gx, 0, max_z), blue);
            this.mGridDrawer.pushLine(v3.Make(0, 0, gz), v3.Make(max_x, 0, gz), red);
        }
    }
    this.mGridDrawer.endWrite(gl);
};
FieldEditor.clearField = function()
{
    this.mFieldMaps = {};
    for (var unit = g_field_unit_min; unit <= g_field_unit_max; unit *= 2) {
        this.mFieldMaps['' + unit] = {};
    }
};
FieldEditor.createTestField = function(gl)
{
    var field_unit = 80;
    this.clearField();
    var n = 4, half_n = n / 2, r = 4, s = v2.Makes(0);
    for (var z = -half_n; z < half_n; ++z) {
        for (var x = -half_n; x < half_n; ++x) {
            this.createField(field_unit, x, z, r, s, 'grass', true);
        }
    }
    this.updateFieldAll(gl);
};
FieldEditor.getFieldUnit = function() { return parseFloat(this.mLayerRadio.mValue); };
FieldEditor.getFieldHeight = function(wpos, args)
{
    var ret = null;
    for (var unit = g_field_unit_min; unit <= g_field_unit_max; unit *= 2) {
        var field_map = this.mFieldMaps['' + unit];
        var ix = this.worldToIndex(wpos[0], unit), iz = this.worldToIndex(wpos[2], unit);
        var fx = wpos[0] / unit - ix, fz = wpos[2] / unit - iz, fvec = [fx - 0.5, fz - 0.5];
        for (var rot = 0; rot <= this.cRotMax; ++rot) {
            var field = field_map[this.getFieldKey(ix, iz, rot)];
            if (!field) { continue; }
            var y = field.y, s = field.s;
            if (rot < this.cRotMax) {
                var rx = this.cSlopeRot[rot], rz = [-rx[1], rx[0]];
                var ux = v2.Dot(rx, fvec), uz = v2.Dot(rz, fvec);
                if (ux + uz > 0) { continue; }
                y += ux * v2.Dot(s, rx) + uz * v2.Dot(s, rz);
                y += FieldDrawer.calcOffset(rot, s);
            } else {
                y += s[0] > 0 ? fx * s[0] : (1 - fx) * -s[0];
                y += s[1] > 0 ? fz * s[1] : (1 - fz) * -s[1];
            }
            if (ret === null) {
                ret = y;
            } else {
                y = Math.max(ret, y);
            }
            if (args) {
                args.nrm = v3.normalize(v3.Make(-s[0], unit, -s[1]));
            }
        }
    }
    return ret;
};
FieldEditor.drawHeightLine = function(wpos)
{
    var field_height = FieldEditor.getFieldHeight(wpos);
    if (field_height !== null) {
        g_line_drawer.pushLine(wpos, v3.SetY(wpos, field_height), v4.Make(0, 1, 0, 1));
    }
};
FieldEditor.calc = function(wpos)
{
    var field_unit = this.getFieldUnit();
    var field_map = this.mFieldMaps['' + field_unit];
    this.mCursorPos = v3.Dup(wpos);
    var kinfo = this.worldToKey(wpos, field_unit);
    var field = field_map[kinfo.key], sel_field = this.mSelectedField;
    this.mPreviewInfo = kinfo;
    var field_drawer = g_field_drawer_map[this.mLayerRadio.mValue];
    if (!field_drawer) { return; }
    field_drawer.setSelected(sel_field ? sel_field.mFieldCounter : 0);
    field_drawer.setHighlight(field ? field.mFieldCounter : 0);
    if (g_ctrl_state == CtrlState.cMouseDown) {
        if (g_mouse.wasShortTouch()) {
            if (this.mMode.mValue == 'pick') {
                if (field) {
                    //this.mSelectedField = field == sel_field ? null : field;
                    this.mHeightMgr.updateValue(this.mHeight, field.y);
                    this.mSlopeMgr.updateValue(this.mSlope, field.s);
                    this.mFieldTypeMgr.updateValue(this.mFieldType, field.type);
                }
            } else {
                if (field) { FieldEditor.deleteField(field_unit, field); }
                var new_field = null;
                if (this.mFieldType.mValue && this.mMode.mValue != 'erase') {
                    new_field = this.createField(
                        field_unit, kinfo.ix, kinfo.iz, kinfo.rot, this.mSlope.mValue,
                        this.mFieldType.mValue);
                    new_field.y = this.mHeightMgr.getValue();
                    FieldEditor.pushField(field_unit, new_field);
                }
                if (field || new_field) {
                    var ex_fields = [];
                    if (new_field) {
                        function get_ex_fields(rots) {
                            rots.forEach(function(rot) {
                                var ex_field = field_map[
                                    FieldEditor.getFieldKey(kinfo.ix, kinfo.iz, rot)];
                                if (ex_field) {
                                    ex_fields.push(ex_field);
                                    FieldEditor.deleteField(field_unit, ex_field);
                                }
                            });
                        };
                        if (new_field.r == 0 || new_field.r == 2) {
                            get_ex_fields([1, 3, 4]);
                        } else if (new_field.r == 1 || new_field.r == 3) {
                            get_ex_fields([0, 2, 4]);
                        } else if (new_field.r == 4) {
                            get_ex_fields([0, 1, 2, 3]);
                        }
                    }
                    PushUndo(function() {
                        if (new_field) { FieldEditor.deleteField(field_unit, new_field); }
                        if (field) { FieldEditor.pushField(field_unit, field); }
                        ex_fields.forEach(f => FieldEditor.pushField(field_unit, f));
                    }, function() {
                        ex_fields.forEach(f => FieldEditor.deleteField(field_unit, f));
                        if (field) { FieldEditor.deleteField(field_unit, field); }
                        if (new_field) { FieldEditor.pushField(field_unit, new_field); }
                    }, cLang.act_create_field);
                }
            }
        }
    } else if (g_keyboard.getCommonDeleteTrig()) {
        if (sel_field) {
            PushUndo(function() {
                FieldEditor.pushField(field_unit, sel_field);
            }, function() {
                FieldEditor.deleteField(field_unit, sel_field);
            }, cLang.act_delete_field, true);
        }
    }
};
FieldEditor.cSlopeRot = [[1, 0], [0, -1], [-1, 0], [0, 1], [1, 0]];
FieldEditor.writeEditor = function()
{
    var field_unit = this.getFieldUnit();
    var move_unit = field_unit * 2;
    var cy = this.mHeightMgr.getValue();
    if (this.mPreviewInfo) {
        var mtx = m34.MakeSRT(
            v3.Make(field_unit, 0, field_unit),
            v3.Make(0, -cPI * 0.5 * this.mPreviewInfo.rot, 0),
            v3.Make(this.indexToWorld(this.mPreviewInfo.ix, field_unit), cy,
                    this.indexToWorld(this.mPreviewInfo.iz, field_unit)));
        var s = this.mSlope.mValue, r = this.mPreviewInfo.rot;
        var slope_rx = this.cSlopeRot[this.mPreviewInfo.rot];
        var slope_rz = [-slope_rx[1], slope_rx[0]];
        mtx[4] = v2.Dot(s, slope_rx); mtx[6] = v2.Dot(s, slope_rz);
        mtx[7] += FieldDrawer.calcOffset(r, s);
        if (r < 4) {
            g_top_line_drawer.pushQuadTriangle(mtx, v4.Make(1, 0, 0, 1));
        } else {
            g_top_line_drawer.pushQuad(mtx, v4.Make(1, 0, 0, 1));
        }
    }
    if (this.mCursorPos && IsEnableDebugDraw()) {
        var cy = this.getFieldHeight(this.mCursorPos);
        if (cy !== null) {
            g_sphere_drawer.pushSphere(
                v3.Make(this.mCursorPos[0], cy, this.mCursorPos[2]), 3, v4.Make(1, 1, 1, 1));
        }
    }
    g_line_drawer.pushLine(
        v3.SetY(g_camera.mAt, g_grid_drawer.mCenterPosY),
        v3.SetY(g_camera.mAt, this.mHeight.mValue), v4.Make(0, 1, 0, 1));
};
FieldEditor.worldToIndex = function(wx, unit) { return Math.floor(wx / unit); };
FieldEditor.indexToWorld = function(ix, unit) { return unit * (ix + 0.5); };
FieldEditor.worldToKey = function(wpos, unit)
{
    var ret = { ix : this.worldToIndex(wpos[0], unit), iz : this.worldToIndex(wpos[2], unit) };
    var fx = wpos[0] / unit - ret.ix, fz = wpos[2] / unit - ret.iz;
    if (0.25 < fx && fx < 0.75 && 0.25 < fz && fz < 0.75) {
        ret.rot = 4;
    } else if (fx < 0.5) {
        ret.rot = fz < 0.5 ? 0 : 1;
    } else {
        ret.rot = fz < 0.5 ? 3 : 2;
    }
    ret.key = this.getFieldKey(ret.ix, ret.iz, ret.rot);
    return ret;
};
FieldEditor.getFieldKey = function(ix, iz, rot) { return ix + ',' + iz + ',' + rot; };
FieldEditor.deselectField = function()
{
    this.mSelectedField = null;
};
FieldEditor.createField = function(field_unit, ix, iz, rot, slope, type, is_push)
{
    var field_map = this.mFieldMaps['' + field_unit];
    var key = this.getFieldKey(ix, iz, rot);
    var field = field_map[key];
    if (!field) {
        field = { x : ix, z : iz , y : 0, r : rot, s : slope, type : type, };
    }
    if (is_push) { field_map[key] = field; }
    return field;
};
FieldEditor.pushField = function(field_unit, field)
{
    if (!field) { return; }
    var field_map = this.mFieldMaps['' + field_unit];
    var key = this.getFieldKey(field.x, field.z, field.r);
    if (field_map[key]) { return; }
    field_map[key] = field;
    this.updateField(g_canvas.getContext(), field_unit);
};
FieldEditor.deleteField = function(field_unit, field)
{
    if (!field) { return; }
    var field_map = this.mFieldMaps['' + field_unit];
    var key = this.getFieldKey(field.x, field.z, field.r);
    if (field_map[key] != field) { return; }
    delete field_map[key];
    this.updateField(g_canvas.getContext(), field_unit);
    if (this.mSelectedField == field) { this.mSelectedField = null; }
};
FieldEditor.updateFieldAll = function(gl)
{
    for (var unit = g_field_unit_min; unit <= g_field_unit_max; unit *= 2) {
        this.updateField(gl, unit);
    }
};
FieldEditor.updateField = function(gl, field_unit)
{
    var field_drawer = g_field_drawer_map['' + field_unit];
    if (!field_drawer) { return; }
    var field_map = this.mFieldMaps['' + field_unit];
    field_drawer.beginWrite();
    for (var key in field_map) {
        var field = field_map[key];
        var min_y = field.y;
        function update_min_y(dx, dz) {
            for (var r = 0; r <= FieldEditor.cRotMax; ++r) {
                var nf = field_map[FieldEditor.getFieldKey(field.x + dx, field.z + dz, r)];
                if (!nf) { continue; }
                min_y = Math.min(min_y, nf.y);
            }
        }
        update_min_y(0, 0);
        update_min_y(1, 0); update_min_y(-1, 0);
        update_min_y(0, 1); update_min_y(0, -1);
        if (field.r < 4) {
            field_drawer.pushField(field, null, min_y);
        } else {
            field_drawer.pushField(field, 2, min_y);
            field_drawer.pushField(field, null, min_y);
        }
    }
    field_drawer.endWrite(gl);
};
FieldEditor.drawField = function(gl, view_ctx)
{
    var field_unit = this.getFieldUnit();
    g_field_drawers.forEach(function(fd) {
        var is_curr = fd.mFieldUnit == field_unit;
        if (this.mLayerDraw.mValue == 'all' ||
            this.mLayerDraw.mValue == 'current' && is_curr ||
            this.mLayerDraw.mValue == 'others' && !is_curr) {
            fd.draw(gl, view_ctx);
        }
    }, this);
};
FieldEditor.drawEditor = function(gl, view_ctx)
{
    var field_unit = this.getFieldUnit();
    this.mGridDrawer.mSnapUnit = field_unit * 4;
    this.mGridDrawer.mDrawScale = field_unit;
    this.mGridDrawer.mCenterPosY = this.mHeight.mValue;
    this.mGridDrawer.draw(gl, view_ctx);
};
FieldEditor.save = function(data)
{
    var ret = { layers : {}, };
    for (var unit = g_field_unit_min; unit <= g_field_unit_max; unit *= 2) {
        var layer = { insts : [], };
        var field_map = this.mFieldMaps['' + unit];
        for (var key in field_map) {
            var inst = field_map[key];
            layer.insts.push(inst);
        }
        ret.layers['' + unit] = layer;
    }
    data.field = ret;
};
FieldEditor.load = function(gl, data)
{
    if (!data.field) { return; }
    this.clearField();
    for (var unit = g_field_unit_min; unit <= g_field_unit_max; unit *= 2) {
        var layer = data.field.layers['' + unit];
        var field_map = this.mFieldMaps['' + unit];
        layer.insts.forEach(function(inst) {
            inst.s = inst.s && v2.FromArray(inst.s) || v2.Makes(0);
            field_map[this.getFieldKey(inst.x, inst.z, inst.r)] = inst;
        }, this);
    }
    this.updateFieldAll(gl);
};
FieldEditor.initialize();
g_undo_redo_callback.push(function() {
    FieldEditor.deselectField();
});
  </script>
  <!-- <script src="menu.js"></script> -->
  <script>
'use strict';
var menu_id = 0;
var MenuType = {
    Scene  : 0,
    Editor : 1,
};
var MenuItem = {
    File        :  0,
    Watch       :  1,
    BuildRail   :  2,
    EditRail    :  3,
    Schedule    :  4,
    EditModel   :  5,
    TrainModel  :  6,
    TrainList   :  7,
    StructModel :  8,
    StructList  :  9,
    FieldEditor : 10,
};
var MenuItemInfo = [
    { label : cLang.menu_file        , type : MenuType.Scene , },
    { label : cLang.menu_watch       , type : MenuType.Scene , },
    { label : cLang.menu_build_rail  , type : MenuType.Scene , },
    { label : cLang.menu_edit_rail   , type : MenuType.Scene , },
    { label : cLang.menu_schedule    , type : MenuType.Scene , },
    { label : cLang.menu_edit_model  , type : MenuType.Editor, },
    { label : cLang.menu_train_model , type : MenuType.Editor, },
    { label : cLang.menu_train_list  , type : MenuType.Scene , },
    { label : cLang.menu_struct_model, type : MenuType.Editor, },
    { label : cLang.menu_struct_list , type : MenuType.Scene , },
    { label : cLang.menu_field_editor, type : MenuType.Scene , },
];
console.assert(Object.keys(MenuItem).length == MenuItemInfo.length);
WatchMode.initialize();
MenuItemInfo[MenuItem.File       ].list_obj = FileMode.mFilePane;
MenuItemInfo[MenuItem.Watch      ].list_obj = WatchMode.mWatchPane;
MenuItemInfo[MenuItem.BuildRail  ].list_obj = RailBuilder.mRailPane;
MenuItemInfo[MenuItem.EditRail   ].list_obj = RailBuilder.mRailPane;
MenuItemInfo[MenuItem.Schedule   ].list_obj = RailBuilder.mSchedulePane;
MenuItemInfo[MenuItem.EditModel  ].list_obj = EditModel.mListObj;
MenuItemInfo[MenuItem.TrainModel ].list_obj = TrainModel.mListObj;
MenuItemInfo[MenuItem.TrainList  ].list_obj = TrainEditor.mListObj;
MenuItemInfo[MenuItem.StructModel].list_obj = StructModel.mListObj;
MenuItemInfo[MenuItem.StructList ].list_obj = StructEditor.mListObj;
MenuItemInfo[MenuItem.FieldEditor].list_obj = FieldEditor.mEditPane;
var MainMenu = CreateInstance();
MainMenu.mMenuActive = -1;//MenuItem.BuildRail;
MainMenu.initialize = function()
{
    var div_list = CreateElement('div');
    g_mouse.pushCoverElements(div_list);
    div_list.className = 'menu';
    var head = CreateElement('h1');
    head.append(CreateScriptLink(cLang.head_menu, ToggleMenu));
    div_list.append(head);
    var div_on = CreateElement('div');
    div_on.id = 'menu-on';
    var foot = CreateElement('div');
    foot.className = 'edit-foot';
    div_on.append(foot);
    div_list.append(div_on);
    document.body.append(div_list);
    var p = CreateElement('p');
    var link_undo = CreateScriptLink(cLang.menu_undo, Undo);
    var link_redo = CreateScriptLink(cLang.menu_redo, Redo);
    link_undo.id = 'menu-link-undo'; link_undo.className = 'disabled';
    link_redo.id = 'menu-link-redo'; link_redo.className = 'disabled';
    p.append(link_undo, ' / ', link_redo);
    div_on.append(p);
    //p = CreateElement('p');
    //p.append(CreateScriptLink(cLang.menu_save, SaveData));
    //div_on.append(p);
    Object.keys(MenuItem).forEach(function(key) {
        var index = MenuItem[key], item = MenuItemInfo[index];
        item.id = key;
        var p = CreateElement('p');
        item.obj = p;
        if (index == MainMenu.mMenuActive) { p.className = 'active'; }
        var f_change_mode = function(no_toggle_menu) {
            MainMenu.ChangeMode(index);
            if (g_is_touch_device && !no_toggle_menu) { ToggleMenu(); }
        };
        p.append(CreateScriptLink(item.label, function() { f_change_mode(false); }));
        div_on.append(p);
        window['Menu' + key] = f_change_mode;
        window['IsMenu' + key] = function() { return MainMenu.CheckMode(index); };
    });
    var menu_file = MenuItemInfo[MenuItem.File];
    menu_file.obj.append(' / ', CreateScriptLink(cLang.menu_save, function() { SaveData(); }));
};
MainMenu.ChangeMode = function(new_mode)
{
    CancelMouse();
    if (this.CheckMode(new_mode)) { return; }
    if (this.mMenuActive >= 0) {
        var prev_info = MenuItemInfo[this.mMenuActive];
        prev_info.obj.className = '';
        if (prev_info.list_obj) { prev_info.list_obj.style.display = 'none'; }
    }
    var new_info = MenuItemInfo[new_mode];
    new_info.obj.className = 'active';
    if (new_info.list_obj) { new_info.list_obj.style.display = null/*'block'*/; }
    this.mMenuActive = new_mode;
    if (IsEditorMode()) {
        g_cam_ctrl = g_cam_ctrl_model;
        g_smoke_drawer = g_smoke_drawer_model;
        g_canvas.setClearColor(v4.Make(0, 0, 0, 1));
    } else {
        g_cam_ctrl = g_cam_ctrl_default;
        g_smoke_drawer = g_smoke_drawer_default;
        g_canvas.setClearColor(v4.Make(0.5, 0.75, 1, 1));
    }
};
MainMenu.GetListObj = function() {
    if (this.mMenuActive < 0) { return null; }
    return MenuItemInfo[this.mMenuActive].list_obj;
};
MainMenu.CheckMode = function(mode)
{
    return this.mMenuActive == mode;
};
function IsEditorMode()
{
    var info = MenuItemInfo[MainMenu.mMenuActive];
    return info.type == MenuType.Editor;
}
function IsFocusMode()
{
    return IsMenuWatch() || IsMenuFile() || IsMenuTrainList();
}
function ToggleMenu() {
    SetBodyClassName(BodyClassNameSlot.MenuDisplay,
                     ToggleContent('menu') ? 'menu-on' : 'menu-off');
}
SetBodyClassName();
  </script>
  <!-- <script src="main.js"></script> -->
  <script>
'use strict';
var cAppVersionMajor = 1;
var cAppVersionMinor = 0;
var cAppVersionMicro = 3;
var g_cam_ctrl_default = CameraControl.create({});
var g_cam_ctrl_model   = CameraControl.create({});
g_cam_ctrl_model.mYaw = cPI / 6;
g_cam_ctrl_model.mPitch = cPI / 4;
var g_cam_ctrl = g_cam_ctrl_default;
var g_camera = Camera.create();
var cGridInterval = 10.0;
var cGridDivNum = 60;
var cGridWidth = cGridInterval * cGridDivNum;
var g_grid_drawer = GridDrawer.create(100);
var g_field_drawers = [], g_field_drawer_map = {};
for (var unit = g_field_unit_min; unit <= g_field_unit_max; unit *= 2) {
    var fd = FieldDrawer.create(unit);
    g_field_drawers.push(fd);
    g_field_drawer_map['' + unit] = fd;
}
var g_line_drawer = LineDrawer.create();
var g_top_line_drawer = LineDrawer.create();
var g_rail_drawer          = RailDrawer.create(RailDrawerType.cDefault     );
var g_rail_switch_drawer   = RailDrawer.create(RailDrawerType.cSwitch      );
var g_rail_ballast_drawer  = RailDrawer.create(RailDrawerType.cBallast     );
var g_rail_slab_drawer     = RailDrawer.create(RailDrawerType.cSlab        );
var g_safege_drawer        = RailDrawer.create(RailDrawerType.cSafege      );
var g_safege_switch_drawer = RailDrawer.create(RailDrawerType.cSafegeSwitch);
var g_alweg_drawer         = RailDrawer.create(RailDrawerType.cAlweg       );
var g_alweg_switch_drawer  = RailDrawer.create(RailDrawerType.cAlwegSwitch );
var g_rail_girder_drawer   = RailDrawer.create(RailDrawerType.cGirder      );
var g_rail_tunnel_drawer   = RailDrawer.create(RailDrawerType.cTunnel      );
var g_rail_platform_drawer = RailDrawer.createPair(RailDrawerType.cPlatform);
var g_rail_wall_drawer     = RailDrawer.createPair(RailDrawerType.cWall    );
var g_rail_floor_drawer    = RailDrawer.createPair(RailDrawerType.cFloor   );
var g_rail_plt_tnl_drawer  = RailDrawer.createPair(RailDrawerType.cPltTnl  );
var g_rail_pier_drawer       = BoxDrawer .create();
var g_rail_debug_line_drawer = LineDrawer.create();
var g_rail_drawers = [
    g_rail_drawer           ,
    g_rail_switch_drawer    ,
    g_safege_drawer         ,
    g_safege_switch_drawer  ,
    g_alweg_drawer          ,
    g_alweg_switch_drawer   ,
    g_rail_ballast_drawer   ,
    g_rail_slab_drawer      ,
    g_rail_girder_drawer    ,
    g_rail_tunnel_drawer    ,
    g_rail_platform_drawer  ,
    g_rail_wall_drawer      ,
    g_rail_floor_drawer     ,
    g_rail_plt_tnl_drawer   ,
    g_rail_pier_drawer      ,
    g_rail_debug_line_drawer,
];
function ForEachRailDrawer(f, a_this)
{
    g_rail_drawers.forEach(function(drawer) {
        if (Array.isArray(drawer)) {
            drawer.forEach(function(d) { f.apply(a_this, [d]); });
        } else {
            f.apply(a_this, [drawer]);
        }
    });
}
var g_box_drawer = BoxDrawer.create();
var g_sphere_drawer = SphereDrawer.create();
var g_smoke_drawer_default = SmokeDrawer.create(true);
var g_smoke_drawer_model = SmokeDrawer.create(false);
var g_smoke_drawer = g_smoke_drawer_default;
var CtrlParam = {
    cSideAreaWidth : 0.2,
    cTopAreaWidth : 0.2,
};
var CtrlState = {
    cIdle            :  0,
    cMouseDown       :  1,
    cBeginCamera     :  2,
    cRotateCamera    :  3,
    cSlideCamera     :  4,
    cPanCamera       :  5,
    cOffCenterCamera :  6,
    cZoomCamera      :  7,
    cDollyCamera     :  8,
    cMovePoint       :  9,
    cRotatePoint     : 10,
};
function InitializeGrid(gl)
{
    g_grid_drawer.initialize(gl);
    g_grid_drawer.beginWrite();
    var cGridOfs = 0.01;
    for (var i = 0; i <= cGridDivNum; ++i) {
        var x = i * cGridInterval - cGridWidth * 0.5;
        var c = !(i % 10) ? 1 : !(i % 5) ? 0.3 : 0.09;
        g_grid_drawer.pushLine(
            v3.Make(x, cGridOfs, -cGridWidth * 0.5),
            v3.Make(x, cGridOfs, (x == 0 ? 0 : cGridWidth * 0.5)),
            v4.Make(1, 1, 1, c));
        g_grid_drawer.pushLine(
            v3.Make(-cGridWidth * 0.5, cGridOfs, x),
            v3.Make((x == 0 ? 0 : cGridWidth * 0.5), cGridOfs, x),
            v4.Make(1, 1, 1, c));
        if (x == 0) {
            g_grid_drawer.pushLine(
                v3.Make(x, cGridOfs, 0),
                v3.Make(x, cGridOfs, cGridWidth * 0.5),
                v4.Make(0, 0, 1, 1));
            g_grid_drawer.pushLine(
                v3.Make(0, cGridOfs, x),
                v3.Make(cGridWidth * 0.5, cGridOfs, x),
                v4.Make(1, 0, 0, 1));
        }
    }
    g_grid_drawer.endWrite(gl);
}
function DrawArrow(from, to, width, color, up)
{
    var dir = v3.Sub(to, from);
    var len = v3.Length(dir);
    if (len == 0) { return; }
    v3.muls(dir, 1 / len);
    if (!up) { up = v3.ey; }
    if (dir[0] == 0 && dir[2] == 0) {
        up = v3.ez;
    }
    var left = v3.normalize(v3.Cross(up, dir));
    function draw_box(a_from, a_dir) {
        var bl = v3.Length(a_dir);
        var bc = v3.add(v3.Muls(a_dir, 0.5), a_from);
        var mtx = m34.MakeOrtho(a_dir, up, bc, v3.Make(width, width, bl));
        g_box_drawer.pushBox(mtx, color)
    }
    draw_box(from, v3.Muls(dir, len - width));
    var dir1 = v3.Sub(dir, left), dir2 = v3.Add(dir, left);
    var diag_ofs = width / Math.sqrt(8), diag_len = width * 2.5;
    draw_box(v3.Sub(to, v3.Muls(dir1, diag_ofs)), v3.Muls(dir2, -diag_len));
    draw_box(v3.Sub(to, v3.Muls(dir2, diag_ofs)), v3.Muls(dir1, -diag_len));
}
function DrawDoubleArrow(from, to, width, color)
{
    var dir = v3.Sub(to, from);
    var len = v3.Length(dir);
    if (len == 0) { return; }
    v3.muls(dir, 1 / len);
    var up = v3.ey;
    if (dir[0] == 0 && dir[2] == 0) {
        up = v3.ez;
    }
    var left = v3.normalize(v3.Cross(up, dir));
    function draw_box(a_from, a_dir) {
        var bl = v3.Length(a_dir);
        var bc = v3.add(v3.Muls(a_dir, 0.5), a_from);
        var mtx = m34.MakeOrtho(a_dir, up, bc, v3.Make(width, width, bl));
        g_box_drawer.pushBox(mtx, color)
    }
    draw_box(v3.Add(from, v3.Muls(dir, width)), v3.Muls(dir, len - width * 2));
    var dir1 = v3.Sub(dir, left), dir2 = v3.Add(dir, left);
    var diag_ofs = width / Math.sqrt(8), diag_len = width * 2.5;
    draw_box(v3.Sub(from, v3.Muls(dir1, -diag_ofs)), v3.Muls(dir2, diag_len));
    draw_box(v3.Sub(from, v3.Muls(dir2, -diag_ofs)), v3.Muls(dir1, diag_len));
    draw_box(v3.Sub(to, v3.Muls(dir1, diag_ofs)), v3.Muls(dir2, -diag_len));
    draw_box(v3.Sub(to, v3.Muls(dir2, diag_ofs)), v3.Muls(dir1, -diag_len));
}
var g_ctrl_state = CtrlState.cIdle;
var g_cursor_ray = v3.Make(0, 0, 1);
var g_cursor_wpos = v3.Makes(0);
var g_model_focuses = [];
function CalcCursorRayDist(wpos)
{
    var dir = v3.Sub(wpos, g_camera.mPos), dist = v3.Dot(dir, g_cursor_ray);
    return v3.Length(v3.sub(v3.Muls(g_cursor_ray, dist), dir)) / dist;
}
function CancelMouse()
{
    g_mouse.onMouseUp();
    g_mouse.setCancel();
}
var g_time_ms = 0, g_calc_num = 0;
function CalcScene()
{
    Train.calcAll();
    Struct.calcAll();
    Rail.calcSwitchAll();
    ProcOnNextCalc();
}
function DrawScene(now_ms)
{
    g_time_ms = now_ms;
    g_fps_calculator.calc(now_ms);
    var sim_speed = WatchMode.getSimSpeed();
    g_calc_num += Math.min(g_fps_calculator.getCalcNum() * sim_speed, 60);
    // calc once per draw
    g_mouse.update();
    var cpos = v2.mul(v2.Sub(g_mouse.getPos(), v2.Makes(0.5)), v2.Make(2, -2));
    g_cursor_ray = g_camera.calcRayDir(cpos);
    var rail_builder_field_setting =
        (IsMenuBuildRail() || IsMenuEditRail()) && !RailBuilder.mFieldSetting.mValue;
    var plane_height = IsMenuFieldEditor() ? FieldEditor.mHeight.mValue
        : rail_builder_field_setting ? RailBuilder.mHeight.mValue : g_grid_drawer.mCenterPosY;
    g_cursor_wpos = g_camera.calcPlaneIntersection(
        g_cursor_ray, v3.Make(0, plane_height, 0), v3.ey);
    if (!g_mouse.isFree()) {
        function calc_touch_border() {
            var down_pos = v2.Dup(g_mouse.getDownPos());
            if (g_canvas.mIsVerticalMode) {
                down_pos[1] = (down_pos[1] * g_canvas.mDisplayHeight -
                               g_canvas.mTouchRectOffset[1]) / g_canvas.mTouchRectSize[1];
            } else {
                down_pos[0] = (down_pos[0] * g_canvas.mDisplayWidth -
                               g_canvas.mTouchRectOffset[0]) / g_canvas.mTouchRectSize[0];
            }
            //Log('down pos '+v2.ToFixed(down_pos, 3));
            var ret = 0;
            if (down_pos[0] <     CtrlParam.cSideAreaWidth) { ret += 1; }
            if (down_pos[0] > 1 - CtrlParam.cSideAreaWidth) { ret += 2; }
            if (down_pos[1] <     CtrlParam.cTopAreaWidth ) { ret += 4; }
            if (down_pos[1] > 1 - CtrlParam.cTopAreaWidth ) { ret += 8; }
            return ret;
        }
        if (g_ctrl_state == CtrlState.cIdle) {
            g_ctrl_state = CtrlState.cMouseDown;
            if (g_is_touch_device && calc_touch_border()) {
                g_ctrl_state = CtrlState.cBeginCamera;
            }
        } else if (g_ctrl_state == CtrlState.cMouseDown
                   || g_ctrl_state == CtrlState.cBeginCamera) {
            var is_slide = false, is_pan = false;
            var is_zoom = false, is_dolly = false, is_offcent = false;
            if (g_is_touch_device) {
                var touch_side = calc_touch_border();
                is_slide   = touch_side == 1 || touch_side == 2;
                is_pan     = touch_side == 9;
                is_zoom    = touch_side == 4 || touch_side == 8;
                is_dolly   = touch_side == 6;
                is_offcent = touch_side == 5 || touch_side == 10;
            } else {
                var shift = g_keyboard.isShiftDown(), alt = g_keyboard.isAltDown();
                var ctrl  = g_keyboard.isCtrlDown();
                is_zoom    =  shift && !alt && !ctrl;
                is_dolly   =  shift && !alt &&  ctrl;
                is_slide   = !shift &&  alt && !ctrl;
                is_pan     =  shift &&  alt && !ctrl;
                is_offcent = !shift && !alt &&  ctrl;
            }
            if (g_mouse.calcDeltaDist() > 0.1) {
                if (is_slide) {
                    g_ctrl_state = CtrlState.cSlideCamera;
                    g_cam_ctrl.beginSlide();
                } else if (is_pan) {
                    g_ctrl_state = CtrlState.cPanCamera;
                    g_cam_ctrl.beginPan();
                } else if (is_offcent) {
                    g_ctrl_state = CtrlState.cOffCenterCamera;
                    g_cam_ctrl.beginOffCenter();
                } else if (is_zoom) {
                    g_ctrl_state = CtrlState.cZoomCamera;
                    g_cam_ctrl.beginZoom();
                } else if (is_dolly) {
                    g_ctrl_state = CtrlState.cDollyCamera;
                    g_cam_ctrl.beginDolly();
                } else {
                    g_ctrl_state = CtrlState.cRotateCamera;
                    g_cam_ctrl.beginRotate();
                }
                g_mouse.resetDelta();
            } else if(g_mouse.wasShortTouch()) {
                g_ctrl_state = CtrlState.cMouseDown;
            }
        } else {
            var delta_with_aspect = g_mouse.getDeltaWithAspect();
            if (g_ctrl_state == CtrlState.cRotateCamera) {
                g_cam_ctrl.calcRotate(delta_with_aspect);
            } else if (g_ctrl_state == CtrlState.cSlideCamera) {
                g_cam_ctrl.calcSlide(delta_with_aspect);
            } else if (g_ctrl_state == CtrlState.cPanCamera) {
                g_cam_ctrl.calcPan(delta_with_aspect);
            } else if (g_ctrl_state == CtrlState.cOffCenterCamera) {
                g_cam_ctrl.calcOffCenter(v2.Dup(g_mouse.getDelta()));
            } else if (g_ctrl_state == CtrlState.cZoomCamera) {
                g_cam_ctrl.calcZoom(delta_with_aspect);
            } else if (g_ctrl_state == CtrlState.cDollyCamera) {
                g_cam_ctrl.calcDolly((delta_with_aspect[0] + delta_with_aspect[1]) * 90);
            }
        }
    } else {
        if (!g_mouse.isCancel()) {
            if (g_ctrl_state == CtrlState.cMouseDown) {
                if (IsMenuWatch()) {
                    PickModel();
                } else if (IsMenuBuildRail()) {
                    RailBuilder.addCtrlPoint(/*g_cursor_wpos*/);
                } else if (IsMenuTrainList()) {
                    TrainSetter.putTrain();
                } else if (IsMenuStructList()) {
                    StructSetter.putStruct();
                } else if (IsMenuSchedule()) {
                    RailBuilder.turnSwitch();
                }
            }
        }
        if (g_ctrl_state == CtrlState.cMovePoint ||
            g_ctrl_state == CtrlState.cRotatePoint)
        {
            RailBuilder.endMovePoint();
        }
        if (IsFocusMode() && g_keyboard.getEscapeTrig()) { PopFocus(); }
        g_ctrl_state = CtrlState.cIdle;
    }
    g_smoke_drawer.mIsPause = IsPause();
    g_smoke_drawer.mIsFade = sim_speed > 1;
    // calc multiple times per draw with sim speed
    do {
        CalcScene();
        if (g_calc_num >= 1) { g_calc_num -= 1; }
    } while (g_calc_num >= 1);
    // calc editor
    if (IsMenuBuildRail() || IsMenuEditRail() || IsMenuSchedule()) {
        RailBuilder.calc(g_cursor_wpos);
    } else if (IsMenuTrainList()) {
        TrainSetter.calc(g_cursor_wpos);
    } else if (IsMenuStructList()) {
        StructSetter.calc(g_cursor_wpos);
    } else if (IsMenuFieldEditor()) {
        FieldEditor.calc(g_cursor_wpos);
    }
    // end calc
    g_canvas.update();
    var gl = g_canvas.getContext();
    g_line_drawer.beginWrite();
    g_top_line_drawer.beginWrite();
    g_box_drawer.beginWrite();
    g_sphere_drawer.beginWrite();
    g_smoke_drawer.beginWrite();
    EditModel.beginWrite();
    function set_inspection_mode(f) {
        function per_drawer(drawers, n) {
            drawers.forEach(drawer => drawer.setDrawProfileNum(n));
        }
        g_rail_girder_drawer  .setDrawProfileNum(f && cGirderTopProfileNum     );
        g_safege_drawer       .setDrawProfileNum(f && cSafegeBottomProfileNum  );
        g_safege_switch_drawer.setDrawProfileNum(f && cSafegeBottomProfileNum  );
        g_alweg_drawer        .setDrawProfileNum(f && cAlwegNonBottomProfileNum);
        g_alweg_switch_drawer .setDrawProfileNum(f && cAlwegNonBottomProfileNum);
        per_drawer(g_rail_platform_drawer, f && cPlatformTopProfileNum);
        per_drawer(g_rail_wall_drawer    , f && cWallTopProfileNum    );
        per_drawer(g_rail_floor_drawer   , f && cFloorTopProfileNum   );
    }
    set_inspection_mode(IsInspectMode());
    if (IsMenuEditModel()) { EditModel.writeEditor(); }
    else if (IsMenuTrainModel()) { TrainModel.writeEditor(); }
    else if (IsMenuStructModel()) { StructModel.writeEditor(); }
    else if (IsMenuStructModel()) { StructModel.writeEditor(); }
    else {
        if (IsMenuFieldEditor()) { FieldEditor.writeEditor(); }
        Train.writeAll();
        Struct.writeAll();
    }
    if (!IsEditorMode() && !IsMenuWatch() && !IsMenuFile()) {
        RailBuilder.write();
        TrainSetter.write();
        if (IsMenuStructList()) { StructEditor.write(); }
        g_line_drawer.pushLine(v3.SetY(g_cursor_wpos, 0), g_cursor_wpos, v4.Make(0, 1, 0, 1));
        if (!IsMenuEditRail() && !IsMenuSchedule() && !IsMenuTrainList()) {
            DrawArrow(v3.add(v3.Make(0, Math.max(10, -g_cursor_wpos[1] + 1), 0),
                             g_cursor_wpos), g_cursor_wpos, 0.5, v4.Makes(1));
        }
    }
    g_cam_ctrl.setAtt();
    g_cam_ctrl.setEnableCalcPos(true);
    if (IsFocusMode() && g_model_focuses.length > 0) {
        var focus_pos = v3.Makes(0), focus_dx = null, focus_dz = null, rot_base = null;
        var aabb_centers = [], dist_factor = 0;
        for (var i_focus = 0; i_focus < g_model_focuses.length; ++i_focus ) {
            var model_focus = g_model_focuses[i_focus];
            var inst = model_focus.inst, i_part = model_focus.part_index;
            var info = inst.mModel.user_data.parts_info[i_part];
            var part_att = inst.mPartsAtt[i_part];
            var mdl = EditModel.mIdToData[info.part.model];
            var drawer = mdl.user_data.drawer;
            if (model_focus.hilite_frame > 0 || IsEnableDebugDraw()) {
                model_focus.hilite_frame -= 1;
                if (!IsPhotoMode()) {
                    g_line_drawer.pushAABB(drawer.mAABB, v4.Make(1, 0, 0, 1), part_att);
                }
            }
            var aabb_center = aabb3.CalcCenter(drawer.mAABB, part_att);
            aabb_centers.push(aabb_center);
            v3.add(focus_pos, aabb_center);
            if (WatchMode.isFocusRot()) {
                if (focus_dz) {
                    var dz = v3.normalize(v3.Sub(aabb_center, rot_base));
                    if (i_focus <= 1) {
                        focus_dz = dz;
                    } else {
                        v3.sub(dz, v3.Muls(focus_dz, v3.Dot(focus_dz, dz)));
                        v3.normalize(v3.add(focus_dz, dz));
                    }
                } else {
                    rot_base = aabb_center;
                    if (info.part.type == 'wheel') {
                        focus_dz = v3.normalize(v3.Cross(m34.GetCol(part_att, 0), v3.ey));
                    } else {
                        focus_dz = v3.normalize(v3.setY(m34.GetCol(part_att, 2), 0));
                    }
                }
            }
        }
        v3.muls(focus_pos, 1 / g_model_focuses.length);
        if (WatchMode.isFocusZoom() && g_model_focuses.length > 1) {
            aabb_centers.forEach(center => dist_factor = Math.max(
                dist_factor, (v3.CalcDist(center, focus_pos) + 20) * 0.1));
        }
        g_cam_ctrl.setDistFactor(dist_factor);
        if (WatchMode.isFixCamera()) {
            g_camera.setAt(focus_pos);
            g_cam_ctrl.setAt(focus_pos);
            g_cam_ctrl.setEnableCalcPos(false);
        } else if (WatchMode.isFocusRot()) {
            focus_dx = v3.normalize(v3.Cross(v3.ey, v3.normalize(focus_dz)));
            g_cam_ctrl.setAtt(focus_dx, focus_dz);
            g_cam_ctrl.setAt(focus_pos);
        } else {
            g_cam_ctrl.setAt(focus_pos);
        }
    } else {
        g_cam_ctrl.setDistFactor(0);
    }
    g_cam_ctrl_default.setFov(FileMode.mCameraFov.mValue * cDeg2Rad);
    g_cam_ctrl.apply(g_camera);
    var field_height = null, is_draw_cam_height = false;
    function get_field_height() {
        if (field_height === null) {
            field_height = FieldEditor.getFieldHeight(g_camera.mAt) || 0;
        }
        return field_height;
    }
    function draw_cam_height() {
        if (is_draw_cam_height) { return; }
        is_draw_cam_height = true;
        g_line_drawer.pushLine(g_camera.mAt, v3.SetY(
            g_camera.mAt, get_field_height()), v4.Make(0, 1, 0, 1));
    }
    g_grid_drawer.mCenterPosY = rail_builder_field_setting
        ? RailBuilder.mHeight.mValue : get_field_height();
    if (!IsMenuWatch() || IsEnableDebugDraw()) {
        g_line_drawer.pushLine(v3.zero, v3.Make(
            0, 10 * cGridInterval * g_grid_drawer.mDrawScale, 0), v4.Make(0, 1, 0, 1));
    }
    if ((g_ctrl_state == CtrlState.cRotateCamera    ||
         g_ctrl_state == CtrlState.cSlideCamera     ||
         g_ctrl_state == CtrlState.cPanCamera       ||
         g_ctrl_state == CtrlState.cOffCenterCamera ||
         g_ctrl_state == CtrlState.cZoomCamera      ) && !IsPhotoMode())
    {
        var mtx = m34.MakeST(v3.Makes(g_cam_ctrl.calcDist() * 0.2), g_camera.mAt);
        g_line_drawer.pushAxis(mtx);
        draw_cam_height();
    }
    Rail.writeDynamicAll();
    g_line_drawer.endWrite(gl);
    g_top_line_drawer.endWrite(gl);
    g_box_drawer.endWrite(gl);
    g_sphere_drawer.endWrite(gl);
    g_smoke_drawer.endWrite(gl);
    EditModel.endWrite(gl);
    g_camera.update();
    var view_ctx = {
        view_mtx : g_camera.getViewMatrix(),
        proj_mtx : g_camera.getProjectionMatrix(),
        view_pos : v3.Dup(g_camera.mPos),
        camera_at : v3.Dup(g_camera.mAt),
    };
    view_ctx.view_proj_mtx = m44.Mul34(view_ctx.proj_mtx, view_ctx.view_mtx);
    EditModel.draw(gl, view_ctx, 'field');
    if (!IsEditorMode()) {
        if (IsMenuFieldEditor()) {
            FieldEditor.drawField(gl, view_ctx);
        } else {
            g_field_drawers.forEach(fd => fd.draw(gl, view_ctx));
        }
        g_rail_tunnel_drawer.draw(gl, view_ctx);
        g_rail_plt_tnl_drawer.forEach(drawer => drawer.draw(gl, view_ctx));
    }
    EditModel.draw(gl, view_ctx, 'tunnel');
    g_box_drawer.draw(gl, view_ctx);
    g_sphere_drawer.draw(gl, view_ctx);
    g_smoke_drawer.draw(gl, view_ctx);
    EditModel.draw(gl, view_ctx, 'default');
    if (IsMenuEditModel()) {}
    else if (IsMenuTrainModel()) { TrainModel.draw(gl, view_ctx); }
    else if (IsMenuStructModel()) { StructModel.draw(gl, view_ctx); }
    else {
        ForEachRailDrawer(function(drawer) {
            if (!drawer.mIsTunnel) { drawer.draw(gl, view_ctx); }
        });
        if (IsMenuFieldEditor()) { FieldEditor.drawEditor(gl, view_ctx); }
    }
    if (!IsMenuWatch() && !IsMenuFieldEditor()) {
        if (g_cam_ctrl.mDist > 500) {
            g_grid_drawer.mSnapUnit = 1000;
            g_grid_drawer.mDrawScale = 10;
        } else {
            g_grid_drawer.mSnapUnit = 100;
            g_grid_drawer.mDrawScale = 1;
        }
        g_grid_drawer.draw(gl, view_ctx);
    }
    g_line_drawer.draw(gl, view_ctx);
    g_top_line_drawer.draw(gl, view_ctx);
    requestAnimationFrame(DrawScene);
}
function PickModel()
{
    var model_focus = null;
    function pick_impl(inst, focus_type) {
        var i = 0;
        inst.mModel.user_data.parts_info.forEach(function(info) {
            var i_part = i++, part_att = inst.mPartsAtt[i_part];
            if (!part_att) { return; }
            if (!info.part.accept_focus) { return; }
            var mdl = EditModel.mIdToData[info.part.model];
            var drawer = mdl.user_data.drawer;
            var bsp = aabb3.CalcBoundingSphere(drawer.mAABB, part_att);
            var hit_dist = g_camera.calcSphereIntersection(g_cursor_ray, bsp);
            if (hit_dist < 0) { return; }
            if (model_focus && hit_dist >= model_focus.dist) { return; }
            model_focus = {
                type : focus_type,
                dist : hit_dist,
                inst : inst,
                part_index : i_part,
            };
        });
    }
    Train.forEachCar(function(train, car) {
        pick_impl(car, 'train');
    });
    Struct.forEach(function(strc) {
        pick_impl(strc, 'struct');
    });
    g_cam_ctrl.setAtt();
    g_cam_ctrl.calcPos();
    if (model_focus) {
        var is_add_focus = true;
        if (g_is_touch_device ? !WatchMode.isMultiFocus()
            : !g_keyboard.isShiftDown() && !g_keyboard.isCtrlDown()) {
            g_model_focuses = [];
        }
        for (var i = 0; i < g_model_focuses.length;) {
            if (g_model_focuses[i].inst == model_focus.inst) {
                if (g_model_focuses[i].part_index == model_focus.part_index) {
                    is_add_focus = false;
                }
                g_model_focuses.splice(i, 1);
            } else {
                ++i;
            }
        }
        if (is_add_focus) {
            if (g_model_focuses.length >= g_max_focus_num) { g_model_focuses.pop(); }
            g_model_focuses.push(model_focus);
        }
    } else {
        PopFocus();
    }
    g_model_focuses.forEach(mf => mf.hilite_frame = 60);
}
function PopFocus()
{
    if (g_model_focuses.length > 0) {
        g_model_focuses.pop();
    } else {
        SetPhotoMode(false);
    }
}
var SplashObj = {
    elem : GetElement('splash'),
    version_elem : GetElement('splash-version'),
    config_elem : GetElement('splash-config'),
    opt_aa : GetElement('opt-aa'),
    opt_reso : GetElements('opt-reso'),
    opt_undo_size : GetElement('opt-undo-size'),
};
SplashObj.opt_aa.checked = g_opt_enable_aa;
SplashObj.opt_reso.forEach(el => { if (el.value == g_opt_resolution) { el.checked = true; } });
SplashObj.opt_undo_size.value = g_opt_undo_stack_size;
function main(lang)
{
    SetBodyClassName(BodyClassNameSlot.Language, 'lang-' + lang);
    SplashObj.elem.style.display = 'none';
    g_opt_enable_aa = SplashObj.opt_aa.checked;
    SplashObj.opt_reso.forEach(el => { if (el.checked) { g_opt_resolution = el.value; } });
    g_opt_undo_stack_size = parseIntWithDefault(SplashObj.opt_undo_size.value, 0);
    g_mouse.initialize();
    g_keyboard.initialize();
    DebugLog.initialize();
    MainMenu.initialize();
    Log('RailSimWeb');
    if (!g_canvas.initialize(GetElement('canvas'))) { return; }
    if (g_is_touch_device) { Log(cLang.desc_touch_device_mode); }
    var gl = g_canvas.getContext();
    webgl.initialize(gl);
    g_fps_calculator.initialize();
    g_camera.initialize();
    InitializeGrid(gl);
    g_line_drawer.initialize(gl);
    g_top_line_drawer.initialize(gl); g_top_line_drawer.setIgnoreDepth(true);
    g_box_drawer.initialize(gl);
    g_sphere_drawer.initialize(gl);
    g_smoke_drawer_default.initialize(gl);
    g_smoke_drawer_model.initialize(gl);
    g_field_drawers.forEach(fd => fd.initialize(gl));
    ForEachRailDrawer(drawer => drawer.initialize(gl));
    TrainModel.createPreviewRail(gl);
    FieldEditor.initializeGrid(gl);
    FieldEditor.createTestField(gl);
    var def_menu_func = window['Menu' + g_default_mode];
    if (def_menu_func) { def_menu_func(true); }
    else { MenuWatch(true); }
    if (g_enable_load_data) { LoadData(gl, g_layout_data); }
    window.addEventListener('beforeunload', function(event) {
        if (!g_is_confirm_navigation) { return; }
        event.preventDefault();
        event.returnValue = '';
    });
    requestAnimationFrame(DrawScene);
}
function GetVersionText()
{
    return 'Version ' + cAppVersionMajor + '.' + cAppVersionMinor + '.' + cAppVersionMicro;
}
function boot()
{
    SplashObj.version_elem.innerText = GetVersionText();
    GetElement('loading').style.display = 'none';
    if (g_is_auto_start) {
        SplashObj.elem.style.display = 'none';
        main(g_language);
    } else {
        SplashObj.config_elem.style.display = 'block';
    }
}
  </script>
  <!-- <script src="default.rsw.layout.js"></script> -->
  <script>
//embedded-data-begin
var g_layout_data = {"version":1,"name":["RailSimWeb Sample Layout","RailSimWeb サンプルレイアウト"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"type":"RailSimWeb-layout-data","is_pause":false,"cam_guide":true,"cam_ctrl":{"at":[27.363643646240234,2.640000104904175,57.828590393066406],"pitch":0.2799385326877728,"yaw":2.5341603541633395,"dist":80.8572687504279,"off_center":[-0.06803345680236816,-0.00020390748977661133]},"cam_fov":62,"field":{"layers":{"5":{"insts":[]},"10":{"insts":[]},"20":{"insts":[]},"40":{"insts":[]},"80":{"insts":[{"x":-3,"z":1,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920928955078125e-7},{"x":-3,"z":0,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920930376163597e-7},{"x":-3,"z":2,"y":0,"r":3,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920931797249068e-7},{"x":-2,"z":2,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.192093321833454e-7},{"x":-1,"z":2,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.192093463942001e-7},{"x":0,"z":2,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920936060505483e-7},{"x":-3,"z":-1,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920937481590954e-7},{"x":1,"z":2,"y":0,"r":0,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920938902676426e-7},{"x":1,"z":2,"y":-10,"r":2,"s":{"0":-10,"1":-10},"type":"desert","mFieldCounter":1.1920940323761897e-7},{"x":1,"z":3,"y":-10,"r":0,"s":{"0":-10,"1":-10},"type":"desert","mFieldCounter":1.192094174484737e-7},{"x":0,"z":3,"y":-10,"r":4,"s":{"0":0,"1":-10},"type":"desert","mFieldCounter":1.192094316593284e-7},{"x":-1,"z":3,"y":-10,"r":4,"s":{"0":0,"1":-10},"type":"desert","mFieldCounter":1.1920944587018312e-7},{"x":-2,"z":3,"y":-10,"r":4,"s":{"0":0,"1":-10},"type":"desert","mFieldCounter":1.1920946008103783e-7},{"x":-3,"z":3,"y":-10,"r":3,"s":{"0":10,"1":-10},"type":"desert","mFieldCounter":1.1920947429189255e-7},{"x":-3,"z":2,"y":-10,"r":1,"s":{"0":10,"1":-10},"type":"desert","mFieldCounter":1.1920948850274726e-7},{"x":-4,"z":2,"y":-10,"r":3,"s":{"0":10,"1":-10},"type":"desert","mFieldCounter":1.1920950271360198e-7},{"x":-4,"z":1,"y":-10,"r":4,"s":{"0":10,"1":0},"type":"desert","mFieldCounter":1.192095169244567e-7},{"x":-4,"z":0,"y":-10,"r":4,"s":{"0":10,"1":0},"type":"desert","mFieldCounter":1.192095311353114e-7},{"x":1,"z":3,"y":-10,"r":2,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920954534616612e-7},{"x":2,"z":3,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920955955702084e-7},{"x":3,"z":3,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920957376787555e-7},{"x":4,"z":3,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920958797873027e-7},{"x":5,"z":3,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920960218958498e-7},{"x":2,"z":2,"y":-10,"r":4,"s":{"0":0,"1":-10},"type":"desert","mFieldCounter":1.192096164004397e-7},{"x":3,"z":2,"y":-10,"r":4,"s":{"0":0,"1":-10},"type":"desert","mFieldCounter":1.1920963061129441e-7},{"x":4,"z":2,"y":-10,"r":4,"s":{"0":0,"1":-10},"type":"desert","mFieldCounter":1.1920964482214913e-7},{"x":5,"z":2,"y":-10,"r":4,"s":{"0":0,"1":-10},"type":"desert","mFieldCounter":1.1920965903300385e-7},{"x":-6,"z":-2,"y":-10,"r":4,"s":{"0":0,"1":-10},"type":"desert","mFieldCounter":1.1920967324385856e-7},{"x":-6,"z":-1,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920968745471328e-7},{"x":-5,"z":-1,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.19209701665568e-7},{"x":-3,"z":-2,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.192097158764227e-7},{"x":-4,"z":-1,"y":-10,"r":0,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920973008727742e-7},{"x":-4,"z":-2,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920974429813214e-7},{"x":-3,"z":-3,"y":-10,"r":0,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920975850898685e-7},{"x":-3,"z":-4,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920977271984157e-7},{"x":-3,"z":-5,"y":-10,"r":2,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920978693069628e-7},{"x":-2,"z":-5,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.19209801141551e-7},{"x":-1,"z":-5,"y":-10,"r":0,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.192098153524057e-7},{"x":-1,"z":-6,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920982956326043e-7},{"x":-5,"z":-2,"y":-10,"r":2,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920984377411514e-7},{"x":-6,"z":-3,"y":0,"r":2,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920985798496986e-7},{"x":-5,"z":-3,"y":0,"r":0,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920987219582457e-7},{"x":-4,"z":-5,"y":0,"r":2,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.192098864066793e-7},{"x":-3,"z":-5,"y":0,"r":0,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.19209900617534e-7},{"x":-3,"z":-6,"y":0,"r":2,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920991482838872e-7},{"x":-2,"z":-6,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920992903924343e-7},{"x":-1,"z":-5,"y":0,"r":2,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920994325009815e-7},{"x":-1,"z":-4,"y":0,"r":0,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920995746095286e-7},{"x":-2,"z":-4,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920997167180758e-7},{"x":-2,"z":-3,"y":0,"r":0,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.192099858826623e-7},{"x":-3,"z":-3,"y":0,"r":2,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.19210000093517e-7},{"x":-4,"z":-1,"y":-10,"r":2,"s":{"0":10,"1":0},"type":"desert","mFieldCounter":1.1921001430437173e-7},{"x":-5,"z":-2,"y":-10,"r":0,"s":{"0":-10,"1":-10},"type":"desert","mFieldCounter":1.1921002851522644e-7},{"x":-5,"z":-3,"y":-10,"r":2,"s":{"0":-10,"1":-10},"type":"desert","mFieldCounter":1.1921004272608116e-7},{"x":0,"z":-6,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1921005693693587e-7},{"x":0,"z":-5,"y":0,"r":0,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1921007114779059e-7},{"x":1,"z":-6,"y":0,"r":0,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.192100853586453e-7},{"x":-4,"z":-4,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1921009956950002e-7},{"x":-4,"z":-3,"y":-10,"r":2,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1921011378035473e-7},{"x":-4,"z":-3,"y":-10,"r":0,"s":{"0":-10,"1":-10},"type":"desert","mFieldCounter":1.1921012799120945e-7},{"x":-5,"z":-4,"y":0,"r":2,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1921014220206416e-7}]},"160":{"insts":[{"x":0,"z":0,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920928955078125e-7},{"x":-1,"z":0,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920930376163597e-7},{"x":-1,"z":-1,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920931797249068e-7},{"x":0,"z":-1,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.192093321833454e-7},{"x":-3,"z":0,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.192093463942001e-7},{"x":-3,"z":1,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920936060505483e-7},{"x":-3,"z":2,"y":-10,"r":3,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920937481590954e-7},{"x":-2,"z":1,"y":-10,"r":1,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920938902676426e-7},{"x":-2,"z":2,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920940323761897e-7},{"x":-1,"z":2,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.192094174484737e-7},{"x":0,"z":2,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.192094316593284e-7},{"x":1,"z":2,"y":-10,"r":4,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920944587018312e-7},{"x":2,"z":2,"y":-10,"r":0,"s":{"0":0,"1":0},"type":"water","mFieldCounter":1.1920946008103783e-7},{"x":0,"z":-2,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920947429189255e-7},{"x":1,"z":-2,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920948850274726e-7},{"x":1,"z":-3,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920950271360198e-7},{"x":2,"z":-3,"y":0,"r":1,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.192095169244567e-7},{"x":2,"z":-2,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.192095311353114e-7},{"x":2,"z":-1,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920954534616612e-7},{"x":2,"z":0,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920955955702084e-7},{"x":1,"z":-1,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920957376787555e-7},{"x":1,"z":0,"y":0,"r":4,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920958797873027e-7},{"x":-1,"z":-2,"y":0,"r":2,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920960218958498e-7},{"x":0,"z":-3,"y":0,"r":2,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.192096164004397e-7},{"x":-2,"z":-3,"y":0,"r":0,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920963061129441e-7},{"x":-3,"z":-3,"y":0,"r":2,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920964482214913e-7},{"x":-3,"z":-2,"y":0,"r":0,"s":{"0":0,"1":0},"type":"grass","mFieldCounter":1.1920965903300385e-7}]}}},"point":{"insts":[{"id":39,"pos":[10.073198318481445,0,0.06512641906738281],"dir":[0.9999801516532898,0,0.006304475944489241],"up":[0,1,0],"rails":[32,50],"switch_from":-1},{"id":42,"pos":[10.020136833190918,0,-1.0638258457183838],"dir":[0.9943094849586487,0,-0.10653001815080643],"up":[0,1,0],"rails":[32,35],"switch_from":0,"left_sign":-1},{"id":48,"pos":[33.91103744506836,0,-4.679176330566406],"dir":[0.9965441226959229,0,0.08306528627872467],"up":[0,1,0],"rails":[35,80],"switch_from":-1},{"id":45,"pos":[-9.880839347839355,0,1.0679419040679932],"dir":[0.9943094849586487,0,-0.10653001815080643],"up":[0,1,0],"rails":[36,32],"switch_from":1,"left_sign":-1},{"id":49,"pos":[-33.73960876464844,0,3.952363967895508],"dir":[-0.9985175132751465,0,-0.0544317327439785],"up":[0,1,0],"rails":[36,82],"switch_from":-1},{"id":69,"pos":[20.385499954223633,0,0.45615237951278687],"dir":[0.9987959265708923,0,0.04905765503644943],"up":[0,1,0],"rails":[50,52],"switch_from":-1},{"id":38,"pos":[-9.933900833129883,0,-0.06101036071777344],"dir":[0.9999801516532898,0,0.006304475944489241],"up":[0,1,0],"rails":[51,32],"switch_from":-1},{"id":70,"pos":[-19.473617553710938,0,-0.35703468322753906],"dir":[-0.9984471201896667,0,-0.05570816993713379],"up":[0,1,0],"rails":[51,53],"switch_from":-1},{"id":71,"pos":[33.72338104248047,0,1.5208778381347656],"dir":[0.9959688186645508,0,0.08969982713460922],"up":[0,1,0],"rails":[52,120],"switch_from":-1},{"id":72,"pos":[33.53325653076172,0,2.6327226161956787],"dir":[0.9667432308197021,0,0.255748987197876],"up":[0,1,0],"rails":[52,116],"switch_from":0,"left_sign":1},{"id":73,"pos":[-33.98362350463867,0,-1.675321340560913],"dir":[-0.9921386241912842,0,-0.12514375150203705],"up":[0,1,0],"rails":[53,125],"switch_from":-1},{"id":74,"pos":[-33.761009216308594,0,-2.7817580699920654],"dir":[-0.9609029293060303,0,-0.2768855392932892],"up":[0,1,0],"rails":[53,123],"switch_from":0,"left_sign":1},{"id":80,"pos":[-12.151000022888184,10,-52.54887771606445],"dir":[-0.22723288834095,0,-0.9738404750823975],"up":[0,1,0],"rails":[58,59],"switch_from":-1},{"id":79,"pos":[12.447965621948242,10,48.44330978393555],"dir":[-0.24544572830200195,0,-0.9694103598594666],"up":[0,1,0],"rails":[60,58],"switch_from":-1},{"id":105,"pos":[-84.1185302734375,-10,37.28345489501953],"dir":[0.14823374152183533,0,-0.9889523386955261],"up":[0,1,0],"rails":[88,82],"switch_from":-1},{"id":101,"pos":[84.04060363769531,-10,-40.78501892089844],"dir":[0,0,1],"up":[0,1,0],"rails":[91,80],"switch_from":-1},{"id":110,"pos":[16.795085906982422,-10,-48.26873779296875],"dir":[-0.24340680241584778,0,0.96992427110672],"up":[0,1,0],"rails":[91,115],"switch_from":-1},{"id":77,"pos":[67.06658935546875,0,44.04843521118164],"dir":[0.06502983719110489,0,0.9978833198547363],"up":[0,1,0],"rails":[93,60],"switch_from":-1},{"id":111,"pos":[65.80570983886719,0,30.170734405517578],"dir":[-0.12749642133712769,0,-0.9918390512466431],"up":[0,1,0],"rails":[93,119],"switch_from":-1},{"id":113,"pos":[66.9325180053711,0,30.112709045410156],"dir":[0.0342639796435833,0,-0.9994128346443176],"up":[0,1,0],"rails":[93,94],"switch_from":0,"left_sign":1},{"id":114,"pos":[68.4758529663086,0,21.36834716796875],"dir":[0.31666356325149536,0,-0.9485379457473755],"up":[0,1,0],"rails":[94,98],"switch_from":-1},{"id":100,"pos":[90,0,-40],"dir":[1.2246468525851679e-16,0,-1],"up":[0,1,0],"rails":[97,84],"switch_from":-1},{"id":116,"pos":[88.81289672851562,0,-20.551795959472656],"dir":[-0.11495734751224518,0,0.9933704137802124],"up":[0,1,0],"rails":[97,98],"switch_from":-1},{"id":117,"pos":[87.69906616210938,0,-20.742887496948242],"dir":[-0.22922101616859436,0,0.9733744263648987],"up":[0,1,0],"rails":[97,99],"switch_from":0,"left_sign":1},{"id":99,"pos":[-89.67420959472656,0,36.60277557373047],"dir":[-0.15683023631572723,0,0.9876255989074707],"up":[0,1,0],"rails":[100,107],"switch_from":-1},{"id":120,"pos":[-85.34170532226562,0,20.136554718017578],"dir":[0.38384735584259033,0,-0.9233965873718262],"up":[0,1,0],"rails":[100,124],"switch_from":-1},{"id":121,"pos":[-86.4097671508789,0,19.769058227539062],"dir":[0.25822681188583374,0,-0.9660843014717102],"up":[0,1,0],"rails":[100,105],"switch_from":0,"left_sign":-1},{"id":78,"pos":[-64.8436508178711,0,-48.35914993286133],"dir":[-0.024894891306757927,0,-0.999690055847168],"up":[0,1,0],"rails":[102,59],"switch_from":-1},{"id":122,"pos":[-64.2230453491211,0,-34.61780548095703],"dir":[0.0377114973962307,0,0.9992886781692505],"up":[0,1,0],"rails":[102,126],"switch_from":-1},{"id":123,"pos":[-65.35035705566406,0,-34.662540435791016],"dir":[-0.12616248428821564,0,0.9920095801353455],"up":[0,1,0],"rails":[102,104],"switch_from":0,"left_sign":1},{"id":124,"pos":[-67.38240814208984,0,-25.087932586669922],"dir":[-0.2836591899394989,0,0.958925187587738],"up":[0,1,0],"rails":[104,105],"switch_from":-1},{"id":126,"pos":[-24.60618782043457,0,58.19517135620117],"dir":[0.5,0,-0.8660253882408142],"up":[0,1,0],"rails":[107,108],"switch_from":-1},{"id":127,"pos":[-1.3784408569335938,-10,-1.4711036682128906],"dir":[0.258819043636322,0,-0.9659258127212524],"up":[0,1,0],"rails":[108,109],"switch_from":-1},{"id":95,"pos":[10.321569442749023,-10,-49.16978454589844],"dir":[0.2223512828350067,0,-0.9749666452407837],"up":[0,1,0],"rails":[109,84],"switch_from":-1},{"id":107,"pos":[-17.362571716308594,-10,58.691932678222656],"dir":[-0.5,0,0.8660253882408142],"up":[0,1,0],"rails":[114,88],"switch_from":-1},{"id":130,"pos":[5.3097381591796875,-10,0.3167877197265625],"dir":[0.22344927489757538,0,-0.974715530872345],"up":[0,1,0],"rails":[114,115],"switch_from":-1},{"id":131,"pos":[48.47962188720703,0,7.414549827575684],"dir":[0.9193534255027771,0,0.39343270659446716],"up":[0,1,0],"rails":[116,118],"switch_from":-1},{"id":132,"pos":[63.59370803833008,0,21.301942825317383],"dir":[0.37983810901641846,0,0.9250530004501343],"up":[0,1,0],"rails":[118,119],"switch_from":-1},{"id":133,"pos":[49.056121826171875,0,2.4390110969543457],"dir":[0.9999818801879883,0,0.0060181813314557076],"up":[0,1,0],"rails":[120,121],"switch_from":-1},{"id":115,"pos":[80.09346008300781,0,-7.577378273010254],"dir":[0.6634314060211182,0,-0.748237133026123],"up":[0,1,0],"rails":[121,99],"switch_from":-1},{"id":135,"pos":[-46.51116943359375,0,-2.814344882965088],"dir":[0.9990389943122864,0,0.04383087903261185],"up":[0,1,0],"rails":[124,125],"switch_from":-1},{"id":136,"pos":[-62.841617584228516,0,-24.878463745117188],"dir":[0.2672145664691925,0,0.9636370539665222],"up":[0,1,0],"rails":[126,127],"switch_from":-1},{"id":134,"pos":[-45.80516052246094,0,-7.026147365570068],"dir":[0.9126448035240173,0,0.40875351428985596],"up":[0,1,0],"rails":[127,123],"switch_from":-1},{"id":142,"pos":[11.066726684570312,0,154.86737060546875],"dir":[0.9997266530990601,0,-0.023381024599075317],"up":[0,1,0],"rails":[131,133],"switch_from":-1},{"id":143,"pos":[100.60124969482422,0,-171.84588623046875],"dir":[0.9997298717498779,0,0.023242034018039703],"up":[0,1,0],"rails":[132,135],"switch_from":-1},{"id":144,"pos":[99.89918518066406,0,99.34939575195312],"dir":[0.37395361065864563,0,-0.9274474382400513],"up":[0,1,0],"rails":[133,134],"switch_from":-1},{"id":145,"pos":[167.27195739746094,0,-71.24111938476562],"dir":[0.36953553557395935,0,-0.9292166233062744],"up":[0,1,0],"rails":[134,135],"switch_from":-1},{"id":148,"pos":[156.01808166503906,10,-62.81446838378906],"dir":[0.3731144368648529,0,-0.927785336971283],"up":[0,1,0],"rails":[136,173],"switch_from":-1},{"id":150,"pos":[93.07801818847656,10,-162.03126525878906],"dir":[0.9992828965187073,0,0.03786451742053032],"up":[0,1,0],"rails":[137,176],"switch_from":-1},{"id":152,"pos":[-59.145355224609375,10,145.1225128173828],"dir":[-0.9995800256729126,0,0.028978105634450912],"up":[0,1,0],"rails":[138,184],"switch_from":-1},{"id":139,"pos":[-71.6491928100586,10,-124.78599548339844],"dir":[0.3436170816421509,0,-0.9391098618507385],"up":[0.04914921149611473,0.9986295104026794,0.01798352785408497],"rails":[144,163],"switch_from":-1},{"id":156,"pos":[-70.27196502685547,9.92170238494873,-124.20210266113281],"dir":[0.4398983418941498,-0.0054784007370471954,-0.8980308771133423],"up":[0.04914921149611473,0.9986295104026794,0.01798352785408497],"rails":[144,161],"switch_from":0,"left_sign":1},{"id":157,"pos":[-128.80563354492188,10,31.423423767089844],"dir":[0.343616783618927,0,-0.9391099810600281],"up":[0,1,0],"rails":[146,147],"switch_from":-1},{"id":155,"pos":[-81.469970703125,10,-97.9456787109375],"dir":[0.343616783618927,0,-0.9391099810600281],"up":[0,1,0],"rails":[147,144],"switch_from":-1},{"id":138,"pos":[-138.8106231689453,10,58.76722717285156],"dir":[0.3436170816421509,0,-0.9391098618507385],"up":[0.04914921149611473,0.9986295104026794,0.01798352785408497],"rails":[157,146],"switch_from":-1},{"id":163,"pos":[-146.82521057128906,10.012918472290039,93.11962127685547],"dir":[-0.07451052218675613,-0.00083775824168697,0.9972198605537415],"up":[0.0521281436085701,0.9986292123794556,0.004733865614980459],"rails":[157,158],"switch_from":-1},{"id":158,"pos":[-137.38211059570312,9.9216947555542,59.211402893066406],"dir":[0.24542643129825592,0.005378065165132284,-0.9694002866744995],"up":[0.049149248749017715,0.9986295104026794,0.017983509227633476],"rails":[159,146],"switch_from":1,"left_sign":-1},{"id":164,"pos":[-141.20941162109375,10,93.1930160522461],"dir":[0.06597784161567688,0,0.9978210926055908],"up":[0.08696583658456802,0.9961947202682495,-0.00575034786015749],"rails":[159,183],"switch_from":-1},{"id":165,"pos":[-47.22334289550781,10,-153.49710083007812],"dir":[0.8096976280212402,0,-0.5868473052978516],"up":[0.05114711448550224,0.9961947202682495,0.07056979835033417],"rails":[161,185],"switch_from":-1},{"id":166,"pos":[-51.35248565673828,9.093135833740234,-158.26760864257812],"dir":[0.7295666933059692,-0.04987552762031555,-0.6820886135101318],"up":[0.07212517410516739,0.9973866939544678,0.00421490054577589],"rails":[163,164],"switch_from":-1},{"id":140,"pos":[5.114295959472656,5,-174.63490295410156],"dir":[0.9975079298019409,-0.06644557416439056,0.023725321516394615],"up":[0.06642679125070572,0.9977900385856628,0.001579918316565454],"rails":[164,132],"switch_from":-1},{"id":141,"pos":[-68.38944244384766,5,156.52467346191406],"dir":[0.9964298605918884,-0.08248719573020935,-0.017982490360736847],"up":[0.0824582427740097,0.9965917468070984,-0.002346958965063095],"rails":[158,131],"switch_from":-1},{"id":179,"pos":[162.12168884277344,10,-80.94041442871094],"dir":[0.25722387433052063,0,-0.9663518667221069],"up":[-0.08422311395406723,0.9961947202682495,-0.022418538108468056],"rails":[173,175],"switch_from":-1},{"id":180,"pos":[111.75820922851562,10,-160.3814239501953],"dir":[-0.989420473575592,0,-0.14507634937763214],"up":[-0.012644236907362938,0.9961947202682495,0.08623367547988892],"rails":[175,176],"switch_from":-1},{"id":151,"pos":[6.648674011230469,10,143.2759552001953],"dir":[-0.9995800256729126,0,0.028978105634450912],"up":[0,1,0],"rails":[177,138],"switch_from":-1},{"id":181,"pos":[23.4533634185791,10,142.0341033935547],"dir":[0.9922102093696594,0,-0.12457477301359177],"up":[-0.010857399553060532,0.9961947202682495,-0.08647675812244415],"rails":[177,181],"switch_from":-1},{"id":183,"pos":[90.31905364990234,10,97.57521057128906],"dir":[0.4731828272342682,0,-0.8809642791748047],"up":[-0.07678109407424927,0.9961947202682495,-0.04124060273170471],"rails":[181,182],"switch_from":-1},{"id":147,"pos":[98.14380645751953,10,80.65015411376953],"dir":[0.3731144368648529,0,-0.927785336971283],"up":[0,1,0],"rails":[182,136],"switch_from":-1},{"id":184,"pos":[-82.89993286132812,10,145.0121307373047],"dir":[0.9986585974693298,0,0.05177820473909378],"up":[0.00451276171952486,0.9961947202682495,-0.08703871816396713],"rails":[183,184],"switch_from":-1},{"id":185,"pos":[-4.420147895812988,10,-165.13792419433594],"dir":[0.9999791979789734,0,-0.006452437490224838],"up":[0.000562373548746109,0.99619460105896,0.08715494722127914],"rails":[185,186],"switch_from":-1},{"id":149,"pos":[12.46356201171875,10,-164.84268188476562],"dir":[0.9996911883354187,0,0.024850081652402878],"up":[0,1,0],"rails":[186,137],"switch_from":-1},{"id":240,"pos":[-61.162574768066406,10,122.37890625],"dir":[-1,0,6.123234924670329e-17],"up":[0,1,0],"rails":[213,249],"switch_from":-1},{"id":244,"pos":[-20,10,117.5],"dir":[1,0,6.123234262925839e-17],"up":[0,1,0],"rails":[215,243],"switch_from":-1},{"id":249,"pos":[25.303329467773438,10,115.36494445800781],"dir":[0.9999998807907104,0,-0.00045573708484880626],"up":[0,1,0],"rails":[219,239],"switch_from":-1},{"id":267,"pos":[25.084537506103516,10,113.18682098388672],"dir":[0.980111837387085,0,-0.19844600558280945],"up":[0,1,0],"rails":[219,242],"switch_from":0,"left_sign":-1},{"id":256,"pos":[-108.76414489746094,10,174.77630615234375],"dir":[-0.9999933838844299,0,-0.0036315075121819973],"up":[0,1,0],"rails":[223,226],"switch_from":-1},{"id":259,"pos":[-173.60975646972656,10,135.9152374267578],"dir":[-0.20396775007247925,0,-0.978977620601654],"up":[0,1,0],"rails":[226,227],"switch_from":-1},{"id":260,"pos":[-144.22555541992188,6,83.77888488769531],"dir":[0.999993622303009,0,0.0035662951413542032],"up":[0,1,0],"rails":[227,251],"switch_from":-1},{"id":276,"pos":[33.66519546508789,10.997151374816895,115.28079986572266],"dir":[0.974875271320343,0.22197838127613068,-0.018541645258665085],"up":[-0.22193817794322968,0.9750515818595886,0.004224640317261219],"rails":[239,240],"switch_from":-1},{"id":250,"pos":[85.14468383789062,22,117.59788513183594],"dir":[0.9997209906578064,0,-0.023619698360562325],"up":[0,1,0],"rails":[240,255],"switch_from":-1},{"id":272,"pos":[21.65687370300293,10,80.71304321289062],"dir":[-0.999972939491272,0,0.007359987124800682],"up":[0.0006414634408429265,0.9961947202682495,0.08715315163135529],"rails":[241,259],"switch_from":-1},{"id":277,"pos":[32.69489288330078,10,109.94435119628906],"dir":[-0.803331196308136,0,0.5955324769020081],"up":[-0.05190407484769821,0.9961947202682495,-0.07001492381095886],"rails":[241,242],"switch_from":-1},{"id":278,"pos":[-2.189387559890747,10,116.88951873779297],"dir":[0.99770188331604,0,-0.067756287753582],"up":[0,1,0],"rails":[243,244],"switch_from":-1},{"id":248,"pos":[3.328369379043579,10,116.46094512939453],"dir":[0.9961044192314148,0,-0.08818161487579346],"up":[0,1,0],"rails":[244,219],"switch_from":-1},{"id":251,"pos":[3.7373993396759033,10,118.6114730834961],"dir":[0.9589237570762634,0,-0.28366389870643616],"up":[0,1,0],"rails":[245,219],"switch_from":1,"left_sign":-1},{"id":279,"pos":[-1.324482798576355,10,119.99098205566406],"dir":[-0.9701108336448669,0,0.24266217648983002],"up":[0,1,0],"rails":[245,246],"switch_from":-1},{"id":239,"pos":[-20,10,122.5],"dir":[-1,0,6.123234262925839e-17],"up":[0,1,0],"rails":[246,213],"switch_from":-1},{"id":280,"pos":[-75.08995056152344,10,116.36993408203125],"dir":[0.9859893321990967,0,0.16680842638015747],"up":[0,1,0],"rails":[247,248],"switch_from":-1},{"id":243,"pos":[-61.20958709716797,10,117.52951049804688],"dir":[1,0,6.123234262925839e-17],"up":[0,1,0],"rails":[248,215],"switch_from":-1},{"id":281,"pos":[-75.9735107421875,10,120.35962677001953],"dir":[-0.9624090194702148,0,-0.2716042399406433],"up":[0,1,0],"rails":[249,264],"switch_from":-1},{"id":282,"pos":[-127.31727600097656,8.800000190734863,88.72659301757812],"dir":[0.8543005585670471,0.2015703171491623,0.47910332679748535],"up":[-0.17584189772605896,0.9794740676879883,-0.09854047000408173],"rails":[251,252],"switch_from":-1},{"id":261,"pos":[-115.06973266601562,10,96.07954406738281],"dir":[0.8141533732414246,0,0.5806498527526855],"up":[0,1,0],"rails":[252,261],"switch_from":-1},{"id":255,"pos":[81.87638854980469,10,175.31100463867188],"dir":[-0.9999933838844299,0,-0.0036315075121819973],"up":[0,1,0],"rails":[255,223],"switch_from":-1},{"id":283,"pos":[-121.99724578857422,10,84.33478546142578],"dir":[0.5605349540710449,0.013562720268964767,0.8280196785926819],"up":[0.0637257918715477,0.9961947202682495,-0.059457093477249146],"rails":[256,263],"switch_from":-1},{"id":284,"pos":[-75.28448486328125,10,62.907291412353516],"dir":[-0.697740375995636,0,-0.7163506746292114],"up":[0,1,0],"rails":[257,258],"switch_from":-1},{"id":274,"pos":[-82.72140502929688,10,53.999603271484375],"dir":[-0.5867229104042053,0,-0.8097877502441406],"up":[-0.07057765126228333,0.9961947202682495,0.05113626644015312],"rails":[258,256],"switch_from":-1},{"id":285,"pos":[5.983545303344727,10,81.00875854492188],"dir":[-0.999972939491272,0,0.007360333111137152],"up":[0,1,0],"rails":[259,260],"switch_from":-1},{"id":273,"pos":[-22.437850952148438,10,81.21795654296875],"dir":[-0.999972939491272,0,0.007360333111137152],"up":[0,1,0],"rails":[260,257],"switch_from":-1},{"id":288,"pos":[-113.59783935546875,10,94.46578216552734],"dir":[-0.6529024839401245,0,-0.7574419379234314],"up":[0,1,0],"rails":[261,263],"switch_from":0,"left_sign":1},{"id":286,"pos":[-99.98028564453125,10,106.35533142089844],"dir":[-0.8259890079498291,0,-0.563686192035675],"up":[0,1,0],"rails":[262,261],"switch_from":-1},{"id":264,"pos":[-85.1689682006836,10,113.7308578491211],"dir":[0.9480961561203003,0,0.3179837167263031],"up":[0,1,0],"rails":[262,247],"switch_from":-1},{"id":287,"pos":[-86.12889099121094,10,115.68903350830078],"dir":[0.8320658206939697,0,0.55467689037323],"up":[0,1,0],"rails":[262,264],"switch_from":0,"left_sign":1},{"id":328,"pos":[0,17,-140],"dir":[1,0,0],"up":[0,1,0],"rails":[286,326],"switch_from":-1},{"id":326,"pos":[60,17,-110],"dir":[-1,0,1.2246468525851679e-16],"up":[0,1,0],"rails":[287,322],"switch_from":-1},{"id":329,"pos":[60,17,-140],"dir":[1,0,0],"up":[0,1,0],"rails":[291,316],"switch_from":-1},{"id":327,"pos":[0,17,-110],"dir":[-1,0,1.2246468525851679e-16],"up":[0,1,0],"rails":[293,312],"switch_from":-1},{"id":338,"pos":[20,7,-140],"dir":[1,0,0],"up":[0,1,0],"rails":[295,328],"switch_from":-1},{"id":344,"pos":[19.55990219116211,7,-137.06600952148438],"dir":[0.9559902548789978,0,0.29339849948883057],"up":[0,1,0],"rails":[295,331],"switch_from":0,"left_sign":1},{"id":339,"pos":[40,7,-110],"dir":[-1,0,1.2246468525851679e-16],"up":[0,1,0],"rails":[297,298],"switch_from":-1},{"id":345,"pos":[40.44009780883789,7,-112.9339828491211],"dir":[-0.9559902548789978,0,-0.29339849948883057],"up":[0,1,0],"rails":[297,330],"switch_from":0,"left_sign":1},{"id":323,"pos":[0,7,-110],"dir":[-1,0,1.2246468525851679e-16],"up":[0,1,0],"rails":[298,286],"switch_from":-1},{"id":324,"pos":[0,7,-140],"dir":[1,0,0],"up":[0,1,0],"rails":[301,295],"switch_from":-1},{"id":343,"pos":[-44.88965606689453,1,-151.06369018554688],"dir":[0.9356052279472351,0,0.3530479669570923],"up":[0,1,0],"rails":[305,301],"switch_from":-1},{"id":350,"pos":[-57.02410125732422,1,-155.38442993164062],"dir":[-0.943733811378479,0,-0.3307059705257416],"up":[0,1,0],"rails":[305,313],"switch_from":-1},{"id":360,"pos":[-133.93690490722656,14,-99.24372863769531],"dir":[-0.40009140968322754,0,0.916475236415863],"up":[0,1,0],"rails":[309,310],"switch_from":-1},{"id":361,"pos":[-107.23997497558594,22,-67.30439758300781],"dir":[0.9658358693122864,0,-0.25915443897247314],"up":[0,1,0],"rails":[310,311],"switch_from":-1},{"id":362,"pos":[-82.03607177734375,22,-78.58152770996094],"dir":[0.8368502259254456,0,-0.5474319458007812],"up":[0,1,0],"rails":[311,312],"switch_from":-1},{"id":359,"pos":[-116.12641906738281,14,-140.0415802001953],"dir":[-0.40009140968322754,0,0.916475236415863],"up":[0,1,0],"rails":[313,309],"switch_from":-1},{"id":370,"pos":[103.07936096191406,10,-128.11598205566406],"dir":[-0.6041824817657471,0,-0.7968460321426392],"up":[0,1,0],"rails":[315,316],"switch_from":-1},{"id":369,"pos":[129.33314514160156,10,-93.49031066894531],"dir":[-0.6041824817657471,0,-0.7968460321426392],"up":[0,1,0],"rails":[317,315],"switch_from":-1},{"id":347,"pos":[103.5186767578125,10,-73.59205627441406],"dir":[-0.6565666198730469,0,-0.7542680501937866],"up":[0,1,0],"rails":[317,318],"switch_from":-1},{"id":322,"pos":[60,7,-110],"dir":[-1,0,1.2246468525851679e-16],"up":[0,1,0],"rails":[318,297],"switch_from":-1},{"id":335,"pos":[20,17,-110],"dir":[-1,0,1.2246468525851679e-16],"up":[0,1,0],"rails":[322,293],"switch_from":-1},{"id":371,"pos":[19.55990219116211,17,-112.9339828491211],"dir":[-0.9559902548789978,0,0.29339849948883057],"up":[0,1,0],"rails":[324,293],"switch_from":1,"left_sign":-1},{"id":373,"pos":[30,17,-125],"dir":[0.4226182699203491,0,-0.9063078165054321],"up":[0,1,0],"rails":[324,325],"switch_from":-1},{"id":372,"pos":[40.43049240112305,17,-137.0645751953125],"dir":[0.9569453597068787,0,-0.2902680039405823],"up":[0,1,0],"rails":[325,291],"switch_from":1,"left_sign":-1},{"id":374,"pos":[34.96708679199219,17,-140],"dir":[0.9999958872795105,0,0.0028611687012016773],"up":[0,1,0],"rails":[326,327],"switch_from":-1},{"id":334,"pos":[40,17,-140],"dir":[0.9999946355819702,0,0.003272982779890299],"up":[0,1,0],"rails":[327,291],"switch_from":-1},{"id":377,"pos":[27.335224151611328,7,-140],"dir":[1,0,0],"up":[0,1,0],"rails":[328,329],"switch_from":-1},{"id":325,"pos":[60,7,-140],"dir":[1,0,0],"up":[0,1,0],"rails":[329,287],"switch_from":-1},{"id":378,"pos":[30,7,-125],"dir":[-0.4226182699203491,0,-0.9063078165054321],"up":[0,1,0],"rails":[330,331],"switch_from":-1},{"id":392,"pos":[-4.982994079589844,0,-391.6882629394531],"dir":[0.9713778495788574,0,0.2375396490097046],"up":[0,1,0],"rails":[338,341],"switch_from":-1},{"id":396,"pos":[162.33541870117188,0,-285.6762390136719],"dir":[0.8132423758506775,0,0.5819251537322998],"up":[0,1,0],"rails":[340,345],"switch_from":-1},{"id":395,"pos":[35.20948028564453,0,-376.6427001953125],"dir":[0.8132423758506775,0,0.5819251537322998],"up":[0,1,0],"rails":[341,340],"switch_from":-1},{"id":400,"pos":[412.519287109375,0,-151.80825805664062],"dir":[0.6337763071060181,0,0.7735163569450378],"up":[0,1,0],"rails":[342,362],"switch_from":-1},{"id":399,"pos":[264.1531066894531,0,-224.547119140625],"dir":[0.9557982683181763,0,0.2940232753753662],"up":[0,1,0],"rails":[345,342],"switch_from":-1},{"id":391,"pos":[-81.54023742675781,0,-410.40948486328125],"dir":[0.9713778495788574,0,0.2375396490097046],"up":[0,1,0],"rails":[346,338],"switch_from":-1},{"id":403,"pos":[-222.99012756347656,0,-462.0775146484375],"dir":[-0.9924178123474121,0,-0.12291031330823898],"up":[0,1,0],"rails":[346,371],"switch_from":-1},{"id":423,"pos":[295.9117126464844,0,87.58699035644531],"dir":[-0.7502257227897644,0,0.6611818075180054],"up":[0,1,0],"rails":[360,363],"switch_from":-1},{"id":425,"pos":[133.3007354736328,0,140.60128784179688],"dir":[-0.9761635065078735,0,0.2170364111661911],"up":[0,1,0],"rails":[361,367],"switch_from":-1},{"id":422,"pos":[399.73321533203125,0,-4.767543792724609],"dir":[-0.7502257227897644,0,0.6611818075180054],"up":[0,1,0],"rails":[362,360],"switch_from":-1},{"id":424,"pos":[217.91763305664062,0,130.8616943359375],"dir":[-0.9621343016624451,0,0.2725757658481598],"up":[0,1,0],"rails":[363,361],"switch_from":-1},{"id":428,"pos":[-93.32492065429688,0,202.68589782714844],"dir":[-0.9999944567680359,0,-0.0033276742324233055],"up":[0,1,0],"rails":[364,366],"switch_from":-1},{"id":430,"pos":[-168.29315185546875,0,-88.3798828125],"dir":[0.00684801209717989,0,-0.9999765753746033],"up":[0,1,0],"rails":[365,369],"switch_from":-1},{"id":429,"pos":[-206.91798400878906,0,68.30877685546875],"dir":[0.00684801209717989,0,-0.9999765753746033],"up":[0,1,0],"rails":[366,365],"switch_from":-1},{"id":427,"pos":[0.8600273132324219,0,202.10781860351562],"dir":[-0.9999944567680359,0,-0.0033276742324233055],"up":[0,1,0],"rails":[367,364],"switch_from":-1},{"id":432,"pos":[-241.659912109375,0,-247.6951141357422],"dir":[-0.5081875324249268,0,-0.8612464666366577],"up":[0,1,0],"rails":[368,370],"switch_from":-1},{"id":431,"pos":[-207.6295166015625,0,-190.31622314453125],"dir":[-0.5081875324249268,0,-0.8612464666366577],"up":[0,1,0],"rails":[369,368],"switch_from":-1},{"id":433,"pos":[-291.7375183105469,0,-309.439697265625],"dir":[-0.6759583950042725,0,-0.7369397878646851],"up":[0,1,0],"rails":[370,371],"switch_from":-1}],"cur_id":434},"rail":{"insts":[{"id":32,"points":[38,39],"sinfos":[[{"train_id":null,"schedule":"sub"}],[{"train_id":null,"schedule":"main"},{"train_id":1,"schedule":"sub"}]],"alt_sw":[1,1],"st_info":[],"spoints":[45,42],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block1","switch_state":[0,0],"ds_pivot":[0.06964874267578125,0,0.0020580291748046875]},{"id":35,"points":[42,48],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block1"},{"id":36,"points":[45,49],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block1"},{"id":50,"points":[39,69],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block1"},{"id":51,"points":[38,70],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block1"},{"id":52,"points":[69,71],"sinfos":[null,[{"train_id":null,"schedule":"main"},{"train_id":"2","schedule":"sub"}]],"alt_sw":[0,0],"st_info":[],"spoints":[null,72],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block1","switch_state":[1,0]},{"id":53,"points":[70,73],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"spoints":[null,74],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block1","switch_state":[1,0]},{"id":58,"points":[79,80],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[{"train_id":"","direction":"0","stop":true,"turnaround":false,"duration":1,"duration_rnd":9,"offset":0.04}],"left_part":{"flag":true,"type":"plt","metrics":[{"offset":2.4,"width":1.8,"height":1.5},{"offset":1.7,"width":2.5,"height":1.5},{"offset":1.7,"width":2.5,"height":1.5},{"offset":1.7,"width":2.5,"height":1.5},{"offset":3.2,"width":1,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":3.5,"width":2,"height":3},{"offset":2,"width":2,"height":3},{"offset":2,"width":2,"height":3},{"offset":2,"width":2,"height":3},{"offset":2.5,"width":2,"height":3}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.619,"signal":"block2"},{"id":59,"points":[80,78],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.517,"signal":"block2"},{"id":60,"points":[79,77],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.475,"signal":"block2"},{"id":80,"points":[101,48],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.4,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"tunnel","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":82,"points":[105,49],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"tunnel","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":84,"points":[95,100],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"tunnel","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":88,"points":[107,105],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"tunnel","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":91,"points":[101,110],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"tunnel","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":93,"points":[77,111],"sinfos":[null,[{"train_id":null,"schedule":"sub"}]],"alt_sw":[0,0],"st_info":[],"spoints":[null,113],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block2","switch_state":[0,0]},{"id":94,"points":[113,114],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block2"},{"id":97,"points":[100,116],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"spoints":[null,117],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"","switch_state":[0,0]},{"id":98,"points":[116,114],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":99,"points":[117,115],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":100,"points":[99,120],"sinfos":[null,[{"train_id":null,"schedule":"alt"}]],"alt_sw":[1,1],"st_info":[],"spoints":[null,121],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"","switch_state":[1,0]},{"id":102,"points":[78,122],"sinfos":[null,[{"train_id":null,"schedule":"main"}]],"alt_sw":[0,0],"st_info":[],"spoints":[null,123],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block2","switch_state":[1,0]},{"id":104,"points":[123,124],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block2"},{"id":105,"points":[124,121],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":107,"points":[99,126],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":108,"points":[126,127],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"tunnel","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":109,"points":[127,95],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[{"train_id":"0","direction":"all","stop":true,"turnaround":false,"duration":1,"duration_rnd":9,"offset":0}],"left_part":{"flag":true,"type":"plt","metrics":[{"offset":1.7,"width":4,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"tunnel","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":114,"points":[107,130],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5},{"offset":1.7,"width":4,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"tunnel","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":115,"points":[130,110],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[{"train_id":"1","direction":"all","stop":true,"turnaround":false,"duration":1,"duration_rnd":9,"offset":0.09}],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"plt","metrics":[{"offset":1.7,"width":4,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"tunnel","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":116,"points":[72,131],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block1"},{"id":118,"points":[131,132],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":119,"points":[132,111],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block2"},{"id":120,"points":[71,133],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block1"},{"id":121,"points":[133,115],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":123,"points":[134,74],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block1"},{"id":124,"points":[120,135],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":125,"points":[135,73],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block1"},{"id":126,"points":[122,136],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":"block2"},{"id":127,"points":[136,134],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":131,"points":[141,142],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.466,"signal":""},{"id":132,"points":[140,143],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.907,"signal":""},{"id":133,"points":[142,144],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":134,"points":[144,145],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[{"train_id":"","direction":"all","stop":true,"turnaround":false,"duration":5,"duration_rnd":0,"offset":0.02}],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"plt","metrics":[{"offset":1.7,"width":4,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":135,"points":[145,143],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.45,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":136,"points":[147,148],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.619,"signal":""},{"id":137,"points":[149,150],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.365,"signal":""},{"id":138,"points":[151,152],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.797,"signal":""},{"id":144,"points":[155,139],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"spoints":[null,156],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.026,"signal":"","switch_state":[1,0]},{"id":146,"points":[138,157],"sinfos":[[{"train_id":null,"schedule":"alt"}],null],"alt_sw":[1,0],"st_info":[],"spoints":[158,null],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.797,"signal":"","switch_state":[0,1]},{"id":147,"points":[157,155],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.797,"signal":""},{"id":157,"points":[138,163],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"floor","metrics":[{"offset":1,"width":2,"height":1.5},{"offset":4,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":159,"points":[158,164],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5},{"offset":3,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.128,"signal":""},{"id":161,"points":[156,165],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5},{"offset":4,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.797,"signal":""},{"id":163,"points":[139,166],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"floor","metrics":[{"offset":1,"width":2,"height":1.5},{"offset":4.5,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":164,"points":[166,140],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":3.3,"width":2,"height":1.5},{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":158,"points":[163,141],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2.6,"width":2,"height":1.5},{"offset":4,"width":2,"height":1.5},{"offset":4,"width":2,"height":1.5},{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.4,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.39,"signal":""},{"id":173,"points":[148,179],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.221,"signal":""},{"id":175,"points":[179,180],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5},{"offset":4,"width":2,"height":1.5},{"offset":4,"width":2,"height":1.5},{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.45,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.221,"signal":""},{"id":176,"points":[180,150],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.221,"signal":""},{"id":177,"points":[151,181],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.212,"signal":""},{"id":181,"points":[181,183],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5},{"offset":4,"width":2,"height":1.5},{"offset":4,"width":2,"height":1.5},{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.212,"signal":""},{"id":182,"points":[183,147],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.212,"signal":""},{"id":183,"points":[164,184],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":3,"width":2,"height":1.5},{"offset":4,"width":2,"height":1.5},{"offset":4,"width":2,"height":1.5},{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.4,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.797,"signal":""},{"id":184,"points":[184,152],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.797,"signal":""},{"id":185,"points":[165,185],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":4,"width":2,"height":1.5},{"offset":4,"width":2,"height":1.5},{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.797,"signal":""},{"id":186,"points":[185,149],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"wall","metrics":[{"offset":2,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"standard","tie_flag":true,"tie_type":"slab","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0.797,"signal":""},{"id":213,"points":[239,240],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[{"train_id":"","direction":"all","stop":true,"turnaround":false,"duration":3,"duration_rnd":0,"offset":0}],"left_part":{"flag":true,"type":"plt","metrics":[{"offset":1.7,"width":4,"height":1}]},"right_part":{"flag":true,"type":"floor","metrics":[{"offset":3,"width":3,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.517,"signal":""},{"id":215,"points":[243,244],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[{"train_id":"","direction":"all","stop":true,"turnaround":false,"duration":3,"duration_rnd":0,"offset":0}],"left_part":{"flag":true,"type":"plt","metrics":[{"offset":1.7,"width":4,"height":1}]},"right_part":{"flag":true,"type":"floor","metrics":[{"offset":3,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":""},{"id":219,"points":[248,249],"sinfos":[[{"train_id":null,"schedule":"sub"}],[{"train_id":null,"schedule":"main"}]],"alt_sw":[0,0],"st_info":[],"spoints":[251,267],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":"mono1","switch_state":[0,0],"ds_pivot":[14.327868461608887,10,115.66778564453125]},{"id":223,"points":[255,256],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":""},{"id":226,"points":[256,259],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":""},{"id":227,"points":[259,260],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.4,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.161,"signal":""},{"id":239,"points":[249,276],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":"mono1"},{"id":240,"points":[276,250],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.678,"signal":""},{"id":241,"points":[272,277],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.3,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":0.534,"signal":""},{"id":242,"points":[277,267],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":0.534,"signal":"mono1"},{"id":243,"points":[244,278],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":""},{"id":244,"points":[278,248],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":"mono1"},{"id":245,"points":[251,279],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":"mono1"},{"id":246,"points":[279,239],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":""},{"id":247,"points":[264,280],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.772,"signal":"mono2"},{"id":248,"points":[280,243],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.365,"signal":""},{"id":249,"points":[240,281],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.373,"signal":""},{"id":251,"points":[260,282],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":0.526,"signal":""},{"id":252,"points":[282,261],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":0.636,"signal":"mono2"},{"id":255,"points":[250,255],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.755,"signal":""},{"id":256,"points":[283,274],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":0.111,"signal":""},{"id":257,"points":[273,284],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":0.534,"signal":""},{"id":258,"points":[284,274],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":0.433,"signal":""},{"id":259,"points":[272,285],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":""},{"id":260,"points":[285,273],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":""},{"id":261,"points":[286,261],"sinfos":[null,[{"train_id":null,"schedule":"sub"}]],"alt_sw":[0,0],"st_info":[],"spoints":[null,288],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.153,"signal":"mono2","switch_state":[1,0]},{"id":262,"points":[286,264],"sinfos":[null,[{"train_id":null,"schedule":"main"}]],"alt_sw":[0,0],"st_info":[],"spoints":[null,287],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.534,"signal":"mono2","switch_state":[1,0]},{"id":263,"points":[288,283],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":0.068,"signal":"mono2"},{"id":264,"points":[287,281],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"safege","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":0.983,"signal":"mono2"},{"id":286,"points":[328,323],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":""},{"id":287,"points":[326,325],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":""},{"id":291,"points":[334,329],"sinfos":[[{"train_id":null,"schedule":"rnd"}],null],"alt_sw":[0,0],"st_info":[],"spoints":[372,null],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":"mono_a1","switch_state":[0,0]},{"id":293,"points":[335,327],"sinfos":[[{"train_id":null,"schedule":"alt"}],null],"alt_sw":[0,0],"st_info":[],"spoints":[371,null],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":"","switch_state":[0,0]},{"id":295,"points":[324,338],"sinfos":[null,[{"train_id":null,"schedule":"rnd"}]],"alt_sw":[0,0],"st_info":[],"spoints":[null,344],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":"mono_a2","switch_state":[1,0]},{"id":297,"points":[322,339],"sinfos":[null,[{"train_id":null,"schedule":"alt"}]],"alt_sw":[1,1],"st_info":[],"spoints":[null,345],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":"","switch_state":[1,0]},{"id":298,"points":[339,323],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":""},{"id":301,"points":[343,324],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":20,"pier_offset":0.1,"signal":""},{"id":305,"points":[343,350],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":""},{"id":309,"points":[359,360],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[{"train_id":"","direction":"all","stop":true,"turnaround":false,"duration":3,"duration_rnd":0,"offset":0.06}],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"plt","metrics":[{"offset":1.7,"width":3,"height":2.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":0.1,"signal":""},{"id":310,"points":[360,361],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":3,"height":1.5}]},"curve_factor":0.35,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":20,"pier_offset":0.966,"signal":""},{"id":311,"points":[361,362],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":3,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":20,"pier_offset":0.39,"signal":""},{"id":312,"points":[362,327],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":3,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":20,"pier_offset":0.661,"signal":""},{"id":313,"points":[350,359],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":3,"height":1.5}]},"curve_factor":0.4,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":20,"pier_offset":0.865,"signal":""},{"id":315,"points":[369,370],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[{"train_id":"","direction":"all","stop":true,"turnaround":false,"duration":3,"duration_rnd":0,"offset":0.04}],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":true,"type":"plt","metrics":[{"offset":1.7,"width":3,"height":2.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":0.1,"signal":""},{"id":316,"points":[370,329],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":3,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"right","pier_interval":20,"pier_offset":1,"signal":""},{"id":317,"points":[369,347],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":3,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":20,"pier_offset":0.721,"signal":""},{"id":318,"points":[347,322],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":20,"pier_offset":0.331,"signal":""},{"id":322,"points":[326,335],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":""},{"id":324,"points":[371,373],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.4,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":15,"pier_offset":0.594,"signal":""},{"id":325,"points":[373,372],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.4,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":15,"pier_offset":0.534,"signal":"mono_a1"},{"id":326,"points":[328,374],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":""},{"id":327,"points":[374,334],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":false,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":"mono_a1"},{"id":328,"points":[338,377],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.1,"signal":"mono_a2"},{"id":329,"points":[377,325],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"left","pier_interval":20,"pier_offset":0.734,"signal":""},{"id":330,"points":[345,378],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.4,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":15,"pier_offset":0.628,"signal":""},{"id":331,"points":[378,344],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.4,"rail_flag":true,"rail_type":"alweg","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":15,"pier_offset":0.526,"signal":"mono_a2"},{"id":338,"points":[391,392],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":340,"points":[395,396],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":341,"points":[392,395],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":342,"points":[399,400],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":345,"points":[399,396],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":346,"points":[391,403],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":360,"points":[422,423],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":361,"points":[424,425],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":362,"points":[400,422],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":363,"points":[423,424],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":364,"points":[427,428],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":365,"points":[429,430],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":366,"points":[428,429],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":367,"points":[425,427],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":368,"points":[431,432],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":true,"girder_type":"girder","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":369,"points":[430,431],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":370,"points":[432,433],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""},{"id":371,"points":[433,403],"sinfos":[null,null],"alt_sw":[0,0],"st_info":[],"left_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"right_part":{"flag":false,"type":"plt","metrics":[{"offset":1.7,"width":2,"height":1.5}]},"curve_factor":0.5,"rail_flag":true,"rail_type":"narrow","tie_flag":true,"tie_type":"ballast","girder_flag":false,"girder_type":"tunnel","pier_flag":true,"pier_type":"center","pier_interval":10,"pier_offset":0,"signal":""}],"cur_id":372},"edit_models":{"insts":[{"name":["Default-narrow-wheel","デフォルト狭軌車輪"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"axis","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.20000000298023224,1.5],"rotate":[0,90,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0.1,"scale":[0.8999999761581421,0.8999999761581421,0.15000000596046448],"rotate":[0,90,0],"trans":[-0.550000011920929,0,0],"base_color":[0.75,0.75,0.75],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":-0.1,"scale":[0.8999999761581421,0.8999999761581421,0.15000000596046448],"rotate":[0,90,0],"trans":[0.550000011920929,0,0],"base_color":[0.75,0.75,0.75],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.2,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"c39df367-c132-4155-b0a0-a04908f6d014"},{"name":["Default-narrow-bogie","デフォルト狭軌台車"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.30000001192092896,3],"rotate":[0,0,0],"trans":[0.75,0.15000000596046448,0],"base_color":[0.5,0.5,0.5],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[-80,0,0],"pos":[0,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[-80,180,0],"pos":[0,0,0]}]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.30000001192092896,3],"rotate":[0,0,0],"trans":[-0.75,0.15000000596046448,0],"base_color":[0.5,0.5,0.5],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[-80,0,0],"pos":[0,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[-80,180,0],"pos":[0,0,0]}]},{"comment":"box","type":"cube","face":"front","split":6,"taper":0,"scale":[0.800000011920929,0.5,0.800000011920929],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]}],"painters":[],"uuid":"d161e5a3-3579-420b-b365-c97d32fa3dcf"},{"name":["Default-standard-wheel","デフォルト標準軌車輪"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"axis","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.20000000298023224,1.8600000143051147],"rotate":[0,90,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0.1,"scale":[0.8999999761581421,0.8999999761581421,0.15000000596046448],"rotate":[0,90,0],"trans":[-0.7350000143051147,0,0],"base_color":[0.75,0.75,0.75],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":-0.1,"scale":[0.8999999761581421,0.8999999761581421,0.15000000596046448],"rotate":[0,90,0],"trans":[0.7350000143051147,0,0],"base_color":[0.75,0.75,0.75],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.2,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"c36e0a0b-600e-4543-bdf2-4cfb64f743e9"},{"name":["Default-standard-bogie","デフォルト標準軌台車"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.30000001192092896,3],"rotate":[0,0,0],"trans":[0.9350000023841858,0.15000000596046448,0],"base_color":[0.5,0.5,0.5],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[-80,0,0],"pos":[0,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[-80,180,0],"pos":[0,0,0]}]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.30000001192092896,3],"rotate":[0,0,0],"trans":[-0.9350000023841858,0.15000000596046448,0],"base_color":[0.5,0.5,0.5],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[-80,0,0],"pos":[0,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[-80,180,0],"pos":[0,0,0]}]},{"comment":"box","type":"cube","face":"front","split":6,"taper":0,"scale":[0.800000011920929,0.5,0.800000011920929],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]}],"painters":[],"uuid":"28a74439-6232-43a3-9091-7418a843edd5"},{"name":["AizenGL-01-body","アイゼンGL-01-車体"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[3,3,19.399999618530273],"rotate":[0,0,0],"trans":[0,1.5,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[35,0,-10],"pos":[0,0.5,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[35,0,10],"pos":[0,0.5,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,-12.399999618530273],"pos":[0,0.5,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,12.399999618530273],"pos":[0,0.5,9.699999809265137]}]},{"comment":"skirt","type":"cube","face":"front","split":6,"taper":0,"scale":[2.799999952316284,0.800000011920929,1],"rotate":[0,0,0],"trans":[0,-0.4000000059604645,9.100000381469727],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-20,12.399999618530273,0],"pos":[0,0,9.600000381469727]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-20,-12.399999618530273,0],"pos":[0,0,9.600000381469727]}]}],"painters":[{"comment":"stripe","color":{"default_value":[1,0,0,1],"override_color_id":"stripe"},"bounds":[{"type":"mask_gt","shape":"plane","bound":1,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"alt_lt","shape":"plane","bound":0.5,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0.20000000298023224,0.20000000298023224,0.20000000298023224,1],"override_color_id":"sub_stripe"}},{"type":"mask_lt","shape":"plane","bound":0.35,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"window","color":{"default_value":[0,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":1.3,"width":1,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0,0.699999988079071,0.699999988079071,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":7.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":7,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":4.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":2.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":2,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":-0.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-2.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":-3,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":-5.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-7.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":1.3,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":2.5,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"tail light","color":{"default_value":[2.803999900817871,0,0,1],"override_color_id":""},"bounds":[{"type":"mask_lt","shape":"plane","bound":0.65,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":1.3,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":-0.65,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-1.3,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0.475,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0.375,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"skirt","color":{"default_value":[0.800000011920929,0.800000011920929,0.800000011920929,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.01,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"aizentranza logo","color":{"default_value":[1,1,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-8.45,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"alt_lt","shape":"plane","bound":-8.45,"width":0.6,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0.5,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":6.35,"width":0,"angle":[120,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":5.65,"width":0,"angle":[120,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-9.05,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0.5,0,1],"override_color_id":""}}]},{"comment":"aizentranza logo","color":{"default_value":[0,0,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-8.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"alt_lt","shape":"plane","bound":-8.5,"width":0.5,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-9,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":6.3,"width":0,"angle":[120,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":5.7,"width":0,"angle":[120,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"head light","color":{"default_value":[5,5,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"circle","bound":0.15,"width":0,"angle":[0,0,0],"pos":[1.149999976158142,0.699999988079071,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"circle","bound":0.15,"width":0,"angle":[0,0,0],"pos":[0.800000011920929,0.699999988079071,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"circle","bound":0.15,"width":0,"angle":[0,0,0],"pos":[-1.149999976158142,0.699999988079071,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"circle","bound":0.15,"width":0,"angle":[0,0,0],"pos":[-0.800000011920929,0.699999988079071,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[180,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"53621286-66ea-4fe1-b8ec-db8bb2665223"},{"name":["AizenGL-02-body","アイゼンGL-02-車体"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[3,3,19.399999618530273],"rotate":[0,0,0],"trans":[0,1.5,0],"base_color":[1,1,1],"slicers":[]}],"painters":[{"comment":"stripe","color":{"default_value":[1,0,0,1],"override_color_id":"stripe"},"bounds":[{"type":"mask_gt","shape":"plane","bound":1,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":1.41,"angle":[62.70000076293945,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"alt_lt","shape":"plane","bound":0.5,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0.20000000298023224,0.20000000298023224,0.20000000298023224,1],"override_color_id":"sub_stripe"}},{"type":"mask_lt","shape":"plane","bound":0.35,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"window","color":{"default_value":[0,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":1.3,"width":1,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0,0.699999988079071,0.699999988079071,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":7.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":7,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":4.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":2.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":2,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":-0.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-2.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":-3,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":-5.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-7.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":1.3,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":2.5,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":8.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"0d171c81-748c-41fb-9049-b545d73b120b"},{"name":["Shiki400-wheel","シキ400-車輪"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"axis","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.20000000298023224,1.100000023841858],"rotate":[0,90,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0.1,"scale":[0.8999999761581421,0.8999999761581421,0.15000000596046448],"rotate":[0,90,0],"trans":[-0.550000011920929,0,0],"base_color":[0.75,0.75,0.75],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":-0.1,"scale":[0.8999999761581421,0.8999999761581421,0.15000000596046448],"rotate":[0,90,0],"trans":[0.550000011920929,0,0],"base_color":[0.75,0.75,0.75],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.2,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037"},{"name":["Shiki400-bogie","シキ400-台車"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.800000011920929,0.6000000238418579,5.400000095367432],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]}],"painters":[],"uuid":"9227b576-940f-478e-bd88-4e51ccaafec8"},{"name":["Shiki400-frame1","シキ400-台枠1"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[1.2000000476837158,0.6000000238418579,0.4000000059604645],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.800000011920929,0.4000000059604645,0.4000000059604645],"rotate":[0,0,0],"trans":[0,-0.10000000149011612,2.9000000953674316],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.800000011920929,0.4000000059604645,0.4000000059604645],"rotate":[0,0,0],"trans":[0,-0.10000000149011612,-2.9000000953674316],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[1.2000000476837158,0.6000000238418579,6.199999809265137],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[0.4000000059604645,0,0]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[-0.4000000059604645,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[86,0,0],"pos":[0,0.10000000149011612,3.0999999046325684]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[86,180,0],"pos":[0,0.10000000149011612,-3.0999999046325684]}]}],"painters":[],"uuid":"383adf04-f127-4a8b-be8e-26651be39ca3"},{"name":["Shiki400-frame2","シキ400-台枠2"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[1.2000000476837158,0.6000000238418579,0.4000000059604645],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.800000011920929,0.4000000059604645,0.4000000059604645],"rotate":[0,0,0],"trans":[0,-0.10000000149011612,2.9000000953674316],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.800000011920929,0.4000000059604645,0.4000000059604645],"rotate":[0,0,0],"trans":[0,-0.800000011920929,-5.800000190734863],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[1.2000000476837158,1.2999999523162842,9.100000381469727],"rotate":[0,0,0],"trans":[0,-0.3499999940395355,-1.4500000476837158],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[0.4000000059604645,0,0]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[-0.4000000059604645,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[86,0,0],"pos":[0,0.10000000149011612,3.0999999046325684]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[81.0999984741211,180,0],"pos":[0,-0.6000000238418579,-6]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-85.4000015258789,0,0],"pos":[0,-0.30000001192092896,3.0999999046325684]}]}],"painters":[],"uuid":"7e7943bb-fe23-4ef4-9e39-332c466bd5bb"},{"name":["Shiki400-frame3","シキ400-台枠3"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[1.2000000476837158,0.6000000238418579,0.800000011920929],"rotate":[0,0,0],"trans":[0,0,-0.20000000298023224],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.799999952316284,0.4000000059604645,0.4000000059604645],"rotate":[0,0,0],"trans":[0,-0.8999999761581421,-8.800000190734863],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.799999952316284,0.4000000059604645,0.4000000059604645],"rotate":[0,0,0],"trans":[0,0.6000000238418579,-8.800000190734863],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.799999952316284,1.899999976158142,9.199999809265137],"rotate":[0,0,0],"trans":[0,-0.15000000596046448,-4.400000095367432],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,-6]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,-6.199999809265137]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,95.19999694824219,0],"pos":[0.4000000059604645,0,-0.20000000298023224]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,-84.80000305175781,0],"pos":[0.6000000238418579,0,0.20000000298023224]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,-95.19999694824219,0],"pos":[-0.4000000059604645,0,-0.20000000298023224]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,84.80000305175781,0],"pos":[-0.6000000238418579,0,0.20000000298023224]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[86.69999694824219,0,0],"pos":[0,0.30000001192092896,0.20000000298023224]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-84.80000305175781,0,0],"pos":[0,-0.30000001192092896,0.20000000298023224]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-15,0,0],"pos":[0,0.10000000149011612,-8.800000190734863]}]}],"painters":[],"uuid":"281c6e28-77a2-4b36-999c-f83f6c321dac"},{"name":["Shiki400-load","シキ400-貨物"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9000000953674316,3,7.599999904632568],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[1.4500000476837158,1.2999999523162842,3.799999952316284]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,-45,0],"pos":[1.25,1.5,3.799999952316284]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,-90,0],"pos":[1.4500000476837158,1.2999999523162842,3.799999952316284]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-45,0,0],"pos":[1.4500000476837158,-1.2999999523162842,3.799999952316284]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,45,0],"pos":[-1.25,1.5,3.799999952316284]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-45,-90,0],"pos":[1.4500000476837158,-1.2999999523162842,3.799999952316284]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[-1.4500000476837158,-1.2999999523162842,-3.799999952316284]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,-45,0],"pos":[-1.25,-1.5,-3.799999952316284]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[45,-90,0],"pos":[-1.4500000476837158,-1.2999999523162842,-3.799999952316284]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-45,0,0],"pos":[-1.4500000476837158,1.2999999523162842,-3.799999952316284]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,45,0],"pos":[1.25,-1.5,-3.799999952316284]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-45,-90,0],"pos":[-1.4500000476837158,1.2999999523162842,-3.799999952316284]}]}],"painters":[],"uuid":"718c4240-bbbb-49a6-83d3-97af26f7439f"},{"name":["Shiki400-dummy-frame","シキ400-ダミー枠"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[3,1,7.599999904632568],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":-3.6,"angle":[0,0,0],"pos":[0,0,0]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":3.6,"angle":[0,0,0],"pos":[0,0,0]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":1.3,"angle":[0,90,0],"pos":[0,0,0]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":-1.3,"angle":[0,90,0],"pos":[0,0,0]}]}],"painters":[],"uuid":"ac31c2ce-be5a-43e2-b916-69b364151ec8"},{"name":["EF200-body","EF200-車体"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9000000953674316,2.799999952316284,19.399999618530273],"rotate":[0,0,0],"trans":[0,1.399999976158142,0],"base_color":[0,0.4000000059604645,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,9.399999618530273]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,-9.399999618530273]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,0.800000011920929,9.399999618530273]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[-1,0.800000011920929,9.399999618530273]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[1,0.800000011920929,9.399999618530273]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,0],"pos":[0,1,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,0],"pos":[0,1.2000000476837158,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,45],"pos":[1.2999999523162842,1.2000000476837158,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,45],"pos":[1.2999999523162842,1,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,49],"pos":[1.2999999523162842,1,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,-45],"pos":[-1.2999999523162842,1.2000000476837158,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,-45],"pos":[-1.2999999523162842,1,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,-49],"pos":[-1.2999999523162842,1,9.699999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,0],"pos":[0,1,-9.699999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,0],"pos":[0,1.2000000476837158,-9.699999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,-45],"pos":[1.2999999523162842,1.2000000476837158,-9.699999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,-45],"pos":[1.2999999523162842,1,-9.699999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,-49],"pos":[1.2999999523162842,1,-9.699999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,45],"pos":[-1.2999999523162842,1.2000000476837158,-9.699999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,45],"pos":[-1.2999999523162842,1,-9.699999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,49],"pos":[-1.2999999523162842,1,-9.699999809265137]}]},{"comment":"skirt","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9000000953674316,1.2000000476837158,2],"rotate":[0,0,0],"trans":[0,-0.4000000059604645,8.699999809265137],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-10,0,0],"pos":[0,0.20000000298023224,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-10,-10,0],"pos":[0.5,0.20000000298023224,9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-10,10,0],"pos":[-0.5,0.20000000298023224,9.699999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,0],"pos":[0,0,8.5]}]},{"comment":"skirt","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9000000953674316,1.2000000476837158,2],"rotate":[0,0,0],"trans":[0,-0.4000000059604645,-8.699999809265137],"base_color":[1,1,1],"slicers":[{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[10,0,0],"pos":[0,0.20000000298023224,-9.699999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[10,-10,0],"pos":[-0.5,0.20000000298023224,-9.699999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[10,10,0],"pos":[0.5,0.20000000298023224,-9.699999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,0],"pos":[0,0,-8.5]}]}],"painters":[{"comment":"","color":{"default_value":[0.20000000298023224,0.20000000298023224,0.20000000298023224,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":7.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-7.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0.4,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":2.6,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":"side"},"bounds":[{"type":"mask_gt","shape":"plane","bound":2.6,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":7.3,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-7.3,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0.21,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"alt_lt","shape":"plane","bound":0.21,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0.8999999761581421,0.8999999761581421,0.8999999761581421,1],"override_color_id":""}},{"type":"alt_lt","shape":"plane","bound":-0.01,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0.699999988079071,0.699999988079071,0.699999988079071,1],"override_color_id":""}}]},{"comment":"door","color":{"default_value":[1,1,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":8.15,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":7.65,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":-7.65,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0.45,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":2.4,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-8.15,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"window","color":{"default_value":[0.20000000298023224,0.20000000298023224,0.20000000298023224,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":1.6,"width":1,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0.4000000059604645,0.4000000059604645,0.4000000059604645,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":7.75,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":-7.75,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":8.05,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":2.3,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":8.3,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-8.05,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":-8.3,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":1.6,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":2.6,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.6000000238418579,0.6000000238418579,0.6000000238418579,1],"override_color_id":"side2"},"bounds":[{"type":"mask_lt","shape":"plane","bound":1.6,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":2.1,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":7,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-7,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0.81,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0.48,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":1.01,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-1.01,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"tail light","color":{"default_value":[5,0,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0.73,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0.55,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0.93,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0.7,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"tail light","color":{"default_value":[5,0,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0.73,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0.55,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-0.93,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":-0.7,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"head light","color":{"default_value":[5,5,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0.73,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0.55,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0.68,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0.45,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"head light","color":{"default_value":[5,5,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0.73,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0.55,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-0.68,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":-0.45,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"819d5449-4d0a-44e0-8ff8-80bb4ef2e07d"},{"name":["EF200-wheel","EF200-車輪"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"axis","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.20000000298023224,1.5],"rotate":[0,90,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0.1,"scale":[1.2000000476837158,1.2000000476837158,0.15000000596046448],"rotate":[0,90,0],"trans":[-0.550000011920929,0,0],"base_color":[0.75,0.75,0.75],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":-0.1,"scale":[1.2000000476837158,1.2000000476837158,0.15000000596046448],"rotate":[0,90,0],"trans":[0.550000011920929,0,0],"base_color":[0.75,0.75,0.75],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.3,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"df32df2d-af19-4d17-aebd-7494bef2089e"},{"name":["EF200-bogie","EF200-台車"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.30000001192092896,4],"rotate":[0,0,0],"trans":[0.75,0.15000000596046448,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.30000001192092896,4],"rotate":[0,0,0],"trans":[-0.75,0.15000000596046448,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"box","type":"cube","face":"front","split":6,"taper":0,"scale":[0.800000011920929,0.5,0.800000011920929],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]}],"painters":[],"uuid":"6c83016c-b241-4cac-b3e7-86f4f4d04539"},{"name":["Koki100","コキ100"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.640000104904175,0.800000011920929,20],"rotate":[0,0,0],"trans":[0,-0.20000000298023224,0],"base_color":[0.30000001192092896,0.4000000059604645,0.6000000238418579],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,-5]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,-3]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,-2.799999952316284]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,-0.10000000149011612]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,0.10000000149011612]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,2.799999952316284]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,3]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,5]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[1,0,0]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[-1,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-75,0,0],"pos":[0,0,6]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[75,0,0],"pos":[0,0,-6]}]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.640000104904175,0.20000000298023224,19.399999618530273],"rotate":[0,0,0],"trans":[0,0.10000000149011612,0],"base_color":[0.30000001192092896,0.4000000059604645,0.6000000238418579],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,-5]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,5]}]}],"painters":[],"uuid":"2643b49e-85c0-43a2-8816-bb726e9a66ec"},{"name":["Container-12ft","コンテナ-12ft"],"author":{"name":"","url":""},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.2799999713897705,2.259999990463257,3.6500000953674316],"rotate":[0,0,0],"trans":[0,1.1299999952316284,0],"base_color":[0.6000000238418579,0.20000000298023224,0.30000001192092896],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":""},"bounds":[{"type":"mask_lt","shape":"plane","bound":0.5,"width":0,"angle":[45,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":1,"width":0,"angle":[45,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":-1.1,"width":0,"angle":[-90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":-1,"width":0,"angle":[-90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"641271e7-b2ca-430a-92c3-45f42eca9cd6"},{"name":["Container-20ft-tank","コンテナ-20ft-タンク"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"frame","type":"cube","face":"front","split":6,"taper":0,"scale":[2.2799999713897705,2.259999990463257,6.099999904632568],"rotate":[0,0,0],"trans":[0,1.1299999952316284,0],"base_color":[0,0.699999988079071,1],"slicers":[{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[1.0399999618530273,2.1600000858306885,2.950000047683716]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,-45,0],"pos":[1.0399999618530273,2.1600000858306885,2.950000047683716]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[-45,90,0],"pos":[1.0399999618530273,2.1600000858306885,2.950000047683716]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[-45,0,0],"pos":[1.0399999618530273,0.10000000149011612,2.950000047683716]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,45,0],"pos":[-1.0399999618530273,2.1600000858306885,2.950000047683716]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[45,90,0],"pos":[1.0399999618530273,0.10000000149011612,2.950000047683716]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[1.0399999618530273,0.10000000149011612,-2.950000047683716]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,-45,0],"pos":[-1.0399999618530273,2.1600000858306885,-2.950000047683716]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[-45,90,0],"pos":[-1.0399999618530273,0.10000000149011612,2.950000047683716]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[-45,0,0],"pos":[1.0399999618530273,2.1600000858306885,-2.950000047683716]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,45,0],"pos":[1.0399999618530273,2.1600000858306885,-2.950000047683716]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,90,0],"pos":[-1.0399999618530273,2.1600000858306885,2.950000047683716]}]},{"comment":"tank","type":"cylinder","face":"front","split":12,"taper":0,"scale":[2.200000047683716,2.200000047683716,6],"rotate":[0,0,0],"trans":[0,1.1299999952316284,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[10,0,0],"pos":[0,1.1299999952316284,3]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[-10,0,0],"pos":[0,1.1299999952316284,3]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[0,90,80],"pos":[0,1.1299999952316284,3]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[0,90,100],"pos":[0,1.1299999952316284,3]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[170,0,0],"pos":[0,1.1299999952316284,-3]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[-170,0,0],"pos":[0,1.1299999952316284,-3]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[0,90,-80],"pos":[0,1.1299999952316284,-3]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0.1,"angle":[0,90,-100],"pos":[0,1.1299999952316284,-3]}]}],"painters":[],"uuid":"3713ef97-bebf-4409-b972-2146bcc3e445"},{"name":["UCIT2030-bogie","UCIT2030-台車"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.800000011920929,0.5,0.800000011920929],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[3.4000000953674316,0.699999988079071,3.4000000953674316],"rotate":[0,0,0],"trans":[0,0.15000000596046448,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[1,0,0]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[-1,0,0]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[15,90,0],"pos":[1.7000000476837158,0.6000000238418579,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-15,90,0],"pos":[-1.7000000476837158,0.6000000238418579,0]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,0],"pos":[0,-0.20000000298023224,-1.7000000476837158]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,0],"pos":[0,-0.20000000298023224,1.7000000476837158]}]}],"painters":[{"comment":"","color":{"default_value":[0.5,0.75,1,1],"override_color_id":"base"},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[0.8999999761581421,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[-0.8999999761581421,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"89d22195-5df9-41de-befb-ba4fbe1e59f3"},{"name":["UCIT2030-01-body","UCIT2030-01-車体"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[3.4000000953674316,4.300000190734863,24.700000762939453],"rotate":[0,0,0],"trans":[0,1.350000023841858,0.15000000596046448],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,0],"pos":[0,-0.800000011920929,6.75]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,0],"pos":[0,-0.800000011920929,10.75]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,0],"pos":[0,-0.800000011920929,-10.5]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-60,0,0],"pos":[0,0,12.5]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[60,0,0],"pos":[0,0.20000000298023224,12.5]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[60,0,45],"pos":[0.800000011920929,0.20000000298023224,12.5]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[60,0,-45],"pos":[-0.800000011920929,0.20000000298023224,12.5]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,60],"pos":[0.800000011920929,0,12.5]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,-60],"pos":[-0.800000011920929,0,12.5]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":3.3,"angle":[90,0,45],"pos":[0,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":3.3,"angle":[90,0,-45],"pos":[0,0,0]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[15,90,0],"pos":[1.7000000476837158,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-15,90,0],"pos":[-1.7000000476837158,0,0]}]}],"painters":[{"comment":"","color":{"default_value":[0.5,0.75,1,1],"override_color_id":"base"},"bounds":[]},{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":"body"},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,1.399999976158142,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[60,0,0],"pos":[0,1.399999976158142,8],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0,0,1,1],"override_color_id":"stripe"},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.009999999776482582,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.20000000298023224,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"alt_gt","shape":"plane","bound":0,"width":0,"angle":[60,0,0],"pos":[0,0,11.5],"alt_color":{"default_value":[5,5,0,1],"override_color_id":""}},{"type":"alt_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,11.899999618530273],"alt_color":{"default_value":[5,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[-60,0,0],"pos":[0,0,12],"alt_color":{"default_value":[5,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":0,"width":0.7,"angle":[90,0,0],"pos":[0,2.0999999046325684,0],"alt_color":{"default_value":[0,0.699999988079071,0.699999988079071,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[60,0,0],"pos":[0,2.200000047683716,8],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.200000047683716,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[120,0,0],"pos":[0,2.9000000953674316,8],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0,0,0,0],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":0,"width":0.4,"angle":[90,0,0],"pos":[0,2.5,0],"alt_color":{"default_value":[0,0,0,0.20000000298023224],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,5],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-2],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-4],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-9],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.5,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.9000000953674316,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0,0,0,0],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":0,"width":0.4,"angle":[90,0,0],"pos":[0,0.4000000059604645,0],"alt_color":{"default_value":[0,0,0,0.20000000298023224],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,5],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-2],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-4],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-9],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.4000000059604645,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.800000011920929,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[1,1,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-10.45,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"alt_lt","shape":"plane","bound":-10.45,"width":0.6,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0.5,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":7.55,"width":0,"angle":[120,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":6.85,"width":0,"angle":[120,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-11.05,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0.5,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0,0,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-10.5,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"alt_lt","shape":"plane","bound":-10.5,"width":0.5,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-11,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":7.5,"width":0,"angle":[120,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":6.9,"width":0,"angle":[120,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"03ba15e2-79cb-4033-99b4-c52653dca291"},{"name":["UCIT2030-02-body","UCIT2030-02-車体"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[3.4000000953674316,4.300000190734863,24.700000762939453],"rotate":[0,0,0],"trans":[0,1.350000023841858,0.15000000596046448],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,0],"pos":[0,-0.800000011920929,10.5]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,0],"pos":[0,-0.800000011920929,-10.5]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,0,0]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[15,90,0],"pos":[1.7000000476837158,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-15,90,0],"pos":[-1.7000000476837158,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":3.3,"angle":[90,0,45],"pos":[0,0,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":3.3,"angle":[90,0,-45],"pos":[0,0,0]}]}],"painters":[{"comment":"","color":{"default_value":[0.5,0.75,1,1],"override_color_id":"base"},"bounds":[]},{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":"body"},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,1.399999976158142,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0,0,1,1],"override_color_id":"stripe"},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.009999999776482582,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.20000000298023224,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":0,"width":0.74,"angle":[90,0,0],"pos":[0,2.200000047683716,0],"alt_color":{"default_value":[0,0.699999988079071,0.699999988079071,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,8.199999809265137],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,6.199999809265137],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,5.800000190734863],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,3.799999952316284],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,3.4000000953674316],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,1.399999976158142],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,1],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-1],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-1.399999976158142],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-3.4000000953674316],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-3.799999952316284],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-5.800000190734863],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-6.199999809265137],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-8.199999809265137],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.200000047683716,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.9000000953674316,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":0,"width":0.7,"angle":[90,0,0],"pos":[0,0.10000000149011612,0],"alt_color":{"default_value":[0,0.699999988079071,0.699999988079071,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,8.199999809265137],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,6.199999809265137],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,5.800000190734863],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,3.799999952316284],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,3.4000000953674316],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,1.399999976158142],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,1],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-1],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-1.399999976158142],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-3.4000000953674316],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-3.799999952316284],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-5.800000190734863],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-6.199999809265137],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-8.199999809265137],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.10000000149011612,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.800000011920929,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"e8e462c8-e8a9-44ad-b2ca-91002f87a16a"},{"name":["Mono-S-tire","Mono-S-タイヤ"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cylinder","face":"front","split":10,"taper":0,"scale":[1,1,0.25],"rotate":[0,90,0],"trans":[0.5,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0.2,"scale":[1,1,0.05000000074505806],"rotate":[0,90,0],"trans":[0.3499999940395355,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":-0.2,"scale":[1,1,0.05000000074505806],"rotate":[0,90,0],"trans":[0.6499999761581421,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0,"scale":[0.5,0.5,0.36000001430511475],"rotate":[0,90,0],"trans":[0.5,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0,"scale":[1,1,0.25],"rotate":[0,90,0],"trans":[-0.5,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":-0.2,"scale":[1,1,0.05000000074505806],"rotate":[0,90,0],"trans":[-0.3499999940395355,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0.2,"scale":[1,1,0.05000000074505806],"rotate":[0,90,0],"trans":[-0.6499999761581421,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0,"scale":[0.5,0.5,0.36000001430511475],"rotate":[0,90,0],"trans":[-0.5,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.20000000298023224,1],"rotate":[0,90,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.49,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"fc27c3db-dd56-487c-9c38-bdce511d224c"},{"name":["Mono-S-bogie","Mono-S-台車"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.5,0.5,3],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0.459,"scale":[0.5,1,2],"rotate":[90,0,0],"trans":[0,-1,0],"base_color":[0.5,0.5,0.5],"slicers":[]}],"painters":[],"uuid":"ead7714b-6619-4353-9df9-69b76ea3e02e"},{"name":["Mono-S-01-body","Mono-S-01-車体"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.5999999046325684,3,12.399999618530273],"rotate":[0,0,0],"trans":[0,-1.5,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":false,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,5.550000190734863]}]},{"comment":"","type":"cylinder","face":"front","split":12,"taper":0,"scale":[2.5999999046325684,1.5,3],"rotate":[90,0,0],"trans":[0,-1.5,5.550000190734863],"base_color":[1,1,1],"slicers":[{"type":"erase_lt","solid":false,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,5.550000190734863]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[120,0,0],"pos":[0,-3,5.550000190734863]}]}],"painters":[{"comment":"","color":{"default_value":[1,0.6000000238418579,0.20000000298023224,1],"override_color_id":"base"},"bounds":[]},{"comment":"","color":{"default_value":[0,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":-2,"width":1.5,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0,0.699999988079071,0.699999988079071,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-2,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-0.5,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,5.550000190734863],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[125,0,0],"pos":[0,-1,5.550000190734863],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":-2,"width":1,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0,0.699999988079071,0.699999988079071,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,4],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,3.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0.25],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-0.25],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-3.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-4],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-2,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-1,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.20000000298023224,0.20000000298023224,0.20000000298023224,1],"override_color_id":"stripe"},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-2.299999952316284,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-2.700000047683716,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[-60,0,0],"pos":[0,-2.700000047683716,6],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[5,5,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"circle","bound":0.15,"width":0,"angle":[0,0,0],"pos":[1.100000023841858,-2.5,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"circle","bound":0.15,"width":0,"angle":[0,0,0],"pos":[-1.100000023841858,-2.5,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[5,0,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"circle","bound":0.1,"width":0,"angle":[0,0,0],"pos":[0.800000011920929,-2.450000047683716,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"circle","bound":0.1,"width":0,"angle":[0,0,0],"pos":[-0.800000011920929,-2.450000047683716,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"d4065b74-724d-4bb6-b278-06d807cdfea6"},{"name":["Mono-S-02-body","Mono-S-02-車体"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.5999999046325684,3,12.399999618530273],"rotate":[0,0,0],"trans":[0,-1.5,0],"base_color":[1,1,1],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[1,0.6000000238418579,0.20000000298023224,1],"override_color_id":"base"},"bounds":[]},{"comment":"","color":{"default_value":[0,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":-2,"width":1,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0,0.699999988079071,0.699999988079071,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,4],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,3.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0.25],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-0.25],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-3.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-4],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-2,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-1,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.20000000298023224,0.20000000298023224,0.20000000298023224,1],"override_color_id":"stripe"},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-2.299999952316284,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-2.700000047683716,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"917de8b5-6067-4ce0-8ade-6e2acf80aa98"},{"name":["Mono-A-tire","Mono-A-タイヤ"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cylinder","face":"front","split":10,"taper":0,"scale":[1,1,0.25],"rotate":[0,90,0],"trans":[0.20000000298023224,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0.2,"scale":[1,1,0.05000000074505806],"rotate":[0,90,0],"trans":[0.05000000074505806,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":-0.2,"scale":[1,1,0.05000000074505806],"rotate":[0,90,0],"trans":[0.3499999940395355,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0,"scale":[0.5,0.5,0.36000001430511475],"rotate":[0,90,0],"trans":[0.20000000298023224,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0,"scale":[1,1,0.25],"rotate":[0,90,0],"trans":[-0.20000000298023224,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":-0.2,"scale":[1,1,0.05000000074505806],"rotate":[0,90,0],"trans":[-0.05000000074505806,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0.2,"scale":[1,1,0.05000000074505806],"rotate":[0,90,0],"trans":[-0.3499999940395355,0,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0,"scale":[0.5,0.5,0.36000001430511475],"rotate":[0,90,0],"trans":[-0.20000000298023224,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.20000000298023224,1],"rotate":[0,90,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.49,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"fda93023-8c2b-4779-8a31-e6328eaf3137"},{"name":["Mono-A-bogie","Mono-A-台車"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.10000000149011612,0.20000000298023224,3],"rotate":[0,0,0],"trans":[0.5,-0.20000000298023224,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[1.5,0.20000000298023224,0.20000000298023224],"rotate":[0,0,0],"trans":[0,-0.20000000298023224,1.399999976158142],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.10000000149011612,0.20000000298023224,3],"rotate":[0,0,0],"trans":[-0.5,-0.20000000298023224,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[1.5,0.20000000298023224,0.20000000298023224],"rotate":[0,0,0],"trans":[0,-0.20000000298023224,-1.399999976158142],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.049999952316284,0.800000011920929,0.4000000059604645],"rotate":[0,0,0],"trans":[0,0,0],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.6000000238418579,0.6000000238418579,0.20000000298023224],"rotate":[90,0,0],"trans":[0.7250000238418579,-0.6499999761581421,1.399999976158142],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.6000000238418579,0.6000000238418579,0.20000000298023224],"rotate":[90,0,0],"trans":[-0.7250000238418579,-0.6499999761581421,1.399999976158142],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.6000000238418579,0.6000000238418579,0.20000000298023224],"rotate":[90,0,0],"trans":[0.7250000238418579,-0.6499999761581421,-1.399999976158142],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.6000000238418579,0.6000000238418579,0.20000000298023224],"rotate":[90,0,0],"trans":[-0.7250000238418579,-0.6499999761581421,-1.399999976158142],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.6000000238418579,0.6000000238418579,0.20000000298023224],"rotate":[90,0,0],"trans":[0.7250000238418579,-1.649999976158142,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.6000000238418579,0.6000000238418579,0.20000000298023224],"rotate":[90,0,0],"trans":[-0.7250000238418579,-1.649999976158142,0],"base_color":[0.10000000149011612,0.10000000149011612,0.10000000149011612],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.6000000238418579,0.20000000298023224],"rotate":[0,0,0],"trans":[0.7250000238418579,-0.4000000059604645,1.399999976158142],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.6000000238418579,0.20000000298023224],"rotate":[0,0,0],"trans":[-0.7250000238418579,-0.4000000059604645,1.399999976158142],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.6000000238418579,0.20000000298023224],"rotate":[0,0,0],"trans":[0.7250000238418579,-0.4000000059604645,-1.399999976158142],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.6000000238418579,0.20000000298023224],"rotate":[0,0,0],"trans":[-0.7250000238418579,-0.4000000059604645,-1.399999976158142],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.4000000059604645,1.5,0.20000000298023224],"rotate":[0,0,0],"trans":[0.824999988079071,-0.800000011920929,0],"base_color":[0.5,0.5,0.5],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":1.1,"angle":[-13,-90,0],"pos":[0,0,0]}]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.6000000238418579,0.20000000298023224],"rotate":[0,0,0],"trans":[-0.7250000238418579,-0.4000000059604645,1.399999976158142],"base_color":[0.5,0.5,0.5],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.4000000059604645,1.5,0.20000000298023224],"rotate":[0,0,0],"trans":[-0.824999988079071,-0.800000011920929,0],"base_color":[0.5,0.5,0.5],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":1.1,"angle":[-13,90,0],"pos":[0,0,0]}]}],"painters":[],"uuid":"f060b8b5-c0d6-444b-a426-6a060e1cbb55"},{"name":["Mono-A-01-body","Mono-A-01-車体"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[3,3,12.399999618530273],"rotate":[0,0,0],"trans":[0,1.5,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,23],"pos":[0.5,0,6.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,-23],"pos":[-0.5,0,6.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,20],"pos":[0.5,0.5,6.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,-20],"pos":[-0.5,0.5,6.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[30,0,0],"pos":[0,0.5,6.199999809265137]}]},{"comment":"","type":"cube","face":"both","split":6,"taper":0,"scale":[3,5,12.399999618530273],"rotate":[0,0,0],"trans":[0,-1.399999976158142,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":false,"offset":0,"angle":[-30,0,20.200000762939453],"pos":[0.5,0,6.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":false,"offset":0,"angle":[-30,0,-20.200000762939453],"pos":[-0.5,0,6.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":false,"offset":0,"angle":[-30,0,0],"pos":[0,0,6.199999809265137]},{"type":"erase_gt","solid":false,"reshapable":false,"offset":0,"angle":[90,0,0],"pos":[0,0,0]},{"type":"erase_gt","solid":true,"reshapable":false,"offset":0,"angle":[-90,0,0],"pos":[0,-2.299999952316284,0]},{"type":"erase_gt","solid":true,"reshapable":false,"offset":0,"angle":[-30,180,0],"pos":[0,0,-6.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,0],"pos":[0,0,-0.800000011920929]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[-30,180,0],"pos":[0,0,0.800000011920929]},{"type":"reshape_gt","solid":false,"reshapable":false,"offset":0,"angle":[90,0,0],"pos":[0,-1.399999976158142,0]},{"type":"erase_lt","solid":false,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[-1,0,0]},{"type":"reshape_lt","solid":false,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[1,0,0]},{"type":"reshape_gt","solid":false,"reshapable":false,"offset":0,"angle":[90,0,0],"pos":[0,-0.699999988079071,0]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[10,90,0],"pos":[1.5,-1.399999976158142,0]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[10,-90,0],"pos":[-1.5,-1.399999976158142,0]}]},{"comment":"","type":"plane","face":"back","split":6,"taper":0,"scale":[3,1,3.2200000286102295],"rotate":[0,0,0],"trans":[0,-1.399999976158142,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[1,0,0]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,-90,0],"pos":[-1,0,0]}]}],"painters":[{"comment":"","color":{"default_value":[0.800000011920929,0.800000011920929,0.800000011920929,1],"override_color_id":"base"},"bounds":[]},{"comment":"","color":{"default_value":[0,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":0,"width":1.5,"angle":[90,0,0],"pos":[0,1,0],"alt_color":{"default_value":[0,0.699999988079071,0.699999988079071,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,1,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.5,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,4],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":0,"width":1.2,"angle":[90,0,0],"pos":[0,1,0],"alt_color":{"default_value":[0,0.699999988079071,0.699999988079071,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,3.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0.25],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-0.25],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-3.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-4],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,1,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.200000047683716,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[5,5,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[-1.399999976158142,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[10,90,0],"pos":[-0.8999999761581421,0.5,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[-10,90,0],"pos":[0.8999999761581421,0.5,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[1.399999976158142,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.4000000059604645,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.20000000298023224,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[5,0,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[-1.399999976158142,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[10,90,0],"pos":[-0.8999999761581421,0.5,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[-10,90,0],"pos":[0.8999999761581421,0.5,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[1.399999976158142,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.17000000178813934,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.05000000074505806,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":""},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.799999952316284,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.800000011920929,0.800000011920929,0.800000011920929,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.4000000059604645,0.4000000059604645,0.4000000059604645,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-1.2000000476837158,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"24f28b8d-c853-45be-9b96-977a4053dfc0"},{"name":["Mono-A-02-body","Mono-A-02-車体"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[3,3,12.399999618530273],"rotate":[0,0,0],"trans":[0,1.5,0],"base_color":[1,1,1],"slicers":[]},{"comment":"","type":"cube","face":"both","split":6,"taper":0,"scale":[3,5,12.399999618530273],"rotate":[0,0,0],"trans":[0,-1.399999976158142,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":false,"offset":0,"angle":[-30,0,0],"pos":[0,0,6.199999809265137]},{"type":"erase_gt","solid":false,"reshapable":false,"offset":0,"angle":[90,0,0],"pos":[0,0,0]},{"type":"erase_gt","solid":true,"reshapable":false,"offset":0,"angle":[-90,0,0],"pos":[0,-2.299999952316284,0]},{"type":"erase_gt","solid":true,"reshapable":false,"offset":0,"angle":[-30,180,0],"pos":[0,0,-6.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-30,0,0],"pos":[0,0,-0.800000011920929]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[-30,180,0],"pos":[0,0,0.800000011920929]},{"type":"reshape_gt","solid":false,"reshapable":false,"offset":0,"angle":[90,0,0],"pos":[0,-1.399999976158142,0]},{"type":"erase_lt","solid":false,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[-1,0,0]},{"type":"reshape_lt","solid":false,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[1,0,0]},{"type":"reshape_gt","solid":false,"reshapable":false,"offset":0,"angle":[90,0,0],"pos":[0,-0.699999988079071,0]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[10,90,0],"pos":[1.5,-1.399999976158142,0]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[10,-90,0],"pos":[-1.5,-1.399999976158142,0]}]},{"comment":"","type":"plane","face":"back","split":6,"taper":0,"scale":[3,1,3.2200000286102295],"rotate":[0,0,0],"trans":[0,-1.399999976158142,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[1,0,0]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,-90,0],"pos":[-1,0,0]}]}],"painters":[{"comment":"","color":{"default_value":[0.800000011920929,0.800000011920929,0.800000011920929,1],"override_color_id":"base"},"bounds":[]},{"comment":"","color":{"default_value":[0,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":0,"width":1.2,"angle":[90,0,0],"pos":[0,1,0],"alt_color":{"default_value":[0,0.699999988079071,0.699999988079071,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,4],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,3.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0.25],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-0.25],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-3.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-4],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,1,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.200000047683716,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":""},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.799999952316284,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.800000011920929,0.800000011920929,0.800000011920929,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.4000000059604645,0.4000000059604645,0.4000000059604645,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-1.2000000476837158,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"de2285fb-7709-4c9b-b4e3-8a4c20d560e1"},{"name":["House01","家屋01"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[9,16,7],"rotate":[0,0,0],"trans":[0,8,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,90,0],"pos":[-4.5,6.800000190734863,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,-90,0],"pos":[4.5,6.800000190734863,0]}]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[8,8,8],"rotate":[45,90,0],"trans":[0,6,0],"base_color":[1,1,1],"slicers":[{"type":"erase_gt","solid":true,"reshapable":false,"offset":0,"angle":[-90,0,0],"pos":[0,6,0]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[45,90,0],"pos":[-4.5,6.800000190734863,0]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,-90,0],"pos":[4.5,6.800000190734863,0]}]}],"painters":[{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":"wall"},"bounds":[]},{"comment":"","color":{"default_value":[1,0,0,1],"override_color_id":"roof"},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[45,90,0],"pos":[-4.5,6.789999961853027,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":0,"width":0,"angle":[45,-90,0],"pos":[4.5,6.789999961853027,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.4000000059604645,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-3.11,"width":0,"angle":[0,40,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-3.87,"width":0,"angle":[0,40,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":1.89,"width":0,"angle":[0,30,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":2.84,"width":0,"angle":[0,30,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":2.2,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":1.2,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"alt_gt","shape":"plane","bound":1.2,"width":1,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0.800000011920929,0.800000011920929,0.699999988079071,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.4000000059604645,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-1.31,"width":0,"angle":[0,30,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-3.34,"width":0,"angle":[0,30,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":2.89,"width":0,"angle":[0,30,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":4.47,"width":0,"angle":[0,30,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":5.2,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":4.2,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"alt_gt","shape":"plane","bound":4.2,"width":1,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0.800000011920929,0.800000011920929,0.699999988079071,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.4000000059604645,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0.5,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-0.5,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":8.2,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":7.2,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"alt_gt","shape":"plane","bound":7.2,"width":1,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0.800000011920929,0.800000011920929,0.699999988079071,1],"override_color_id":""}}]}],"uuid":"1d7a27cd-ec32-4a4d-8771-b7ac3446d12b"},{"name":["Building01","ビル01"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[40,25,40],"rotate":[0,0,0],"trans":[0,12.5,0],"base_color":[1,1,1],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":"color"},"bounds":[]},{"comment":"","color":{"default_value":[0.5,0.699999988079071,0.699999988079071,1],"override_color_id":""},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.10000000149011612,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"alt_gt","shape":"plane","bound":0,"width":4,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[0.699999988079071,0.8999999761581421,0.8999999761581421,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,4,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.5,0.699999988079071,0.699999988079071,1],"override_color_id":""},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,5.099999904632568,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"alt_gt","shape":"plane","bound":0,"width":4,"angle":[90,0,0],"pos":[0,5,0],"alt_color":{"default_value":[0.699999988079071,0.8999999761581421,0.8999999761581421,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,9,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.5,0.699999988079071,0.699999988079071,1],"override_color_id":""},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,10.100000381469727,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"alt_gt","shape":"plane","bound":0,"width":4,"angle":[90,0,0],"pos":[0,10,0],"alt_color":{"default_value":[0.699999988079071,0.8999999761581421,0.8999999761581421,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,14,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.5,0.699999988079071,0.699999988079071,1],"override_color_id":""},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,15.100000381469727,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"alt_gt","shape":"plane","bound":0,"width":4,"angle":[90,0,0],"pos":[0,15,0],"alt_color":{"default_value":[0.699999988079071,0.8999999761581421,0.8999999761581421,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,19,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.5,0.699999988079071,0.699999988079071,1],"override_color_id":""},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,20.100000381469727,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"alt_gt","shape":"plane","bound":0,"width":4,"angle":[90,0,0],"pos":[0,20,0],"alt_color":{"default_value":[0.699999988079071,0.8999999761581421,0.8999999761581421,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,24,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":"color"},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-10.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-9.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-0.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,9.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,10.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":"color"},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,-90,0],"pos":[-10.5,0,50],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,-90,0],"pos":[-9.5,0,50],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":0,"width":0,"angle":[0,-90,0],"pos":[-0.5,0,50],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,-90,0],"pos":[0.5,0,50],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":0,"width":0,"angle":[0,-90,0],"pos":[9.5,0,50],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,-90,0],"pos":[10.5,0,50],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":"color"},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,-45,0],"pos":[20,0,19.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,45,0],"pos":[20,0,-19.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":0,"width":0,"angle":[0,135,0],"pos":[-20,0,-19.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,-135,0],"pos":[-20,0,19.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"8e7c0aba-3f04-4120-b726-2cca5cb290fa"},{"name":["Mountain01","山01"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"field","primitives":[{"comment":"","type":"sphere","face":"front","split":6,"taper":0.7,"scale":[300,300,200],"rotate":[90,0,0],"trans":[0,0,0],"base_color":[0.30000001192092896,0.5,0.10000000149011612],"slicers":[{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,0,0]}]}],"painters":[],"uuid":"99e1877a-d80a-4ee3-b580-26e7fe04c79b"},{"name":["D51-body","D51-車体"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"boiler","type":"cylinder","face":"front","split":12,"taper":0,"scale":[1.7999999523162842,1.7999999523162842,10],"rotate":[0,0,0],"trans":[0,2.5,3.690000057220459],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"sphere","face":"front","split":2,"taper":0,"scale":[1.600000023841858,1.600000023841858,0.4000000059604645],"rotate":[0,0,0],"trans":[0,2.5,8.6899995803833],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,2.5,8.6899995803833]}]},{"comment":"cabin","type":"cube","face":"front","split":6,"taper":0,"scale":[2.940000057220459,2.4000000953674316,2.200000047683716],"rotate":[0,0,0],"trans":[0,2.5999999046325684,-2.200000047683716],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,0,0],"pos":[0,0,-2.4000000953674316]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,3.246799945831299,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,30],"pos":[0,4.199999809265137,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,-30],"pos":[0,4.199999809265137,0]}]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.6000000238418579,0.6000000238418579,1],"rotate":[90,0,0],"trans":[0,3.4800000190734863,7.639999866485596],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"main frame","type":"cube","face":"front","split":6,"taper":0,"scale":[0.5,1,11.550000190734863],"rotate":[0,0,0],"trans":[0,1.2000000476837158,3.565000057220459],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[0,1.2000000476837158,9]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,1.2000000476837158,0]}]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.5,1,2],"rotate":[0,0,0],"trans":[0,0.800000011920929,8],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[0,1.2000000476837158,9]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,1.2000000476837158,0]}]},{"comment":"step","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9100000858306885,0.05000000074505806,6],"rotate":[0,0,0],"trans":[0,2,5.190000057220459],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"step","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9100000858306885,0.05000000074505806,0.36000001430511475],"rotate":[0,0,0],"trans":[0,1.2000000476837158,9.15999984741211],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"step","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9100000858306885,0.5,0.05000000074505806],"rotate":[0,0,0],"trans":[0,0.949999988079071,9.3149995803833],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[70,90,0],"pos":[0,0.5,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-70,90,0],"pos":[0,0.5,0]}]},{"comment":"step","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9100000858306885,0.05000000074505806,1.149999976158142],"rotate":[-45,0,0],"trans":[0,1.600000023841858,8.59000015258789],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"step","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9100000858306885,0.05000000074505806,2],"rotate":[0,0,0],"trans":[0,2,-0.4000000059604645],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"step","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9100000858306885,0.05000000074505806,0.8199999928474426],"rotate":[0,0,0],"trans":[0,2.4000000953674316,1.399999976158142],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"step","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9100000858306885,0.05000000074505806,0.5799999833106995],"rotate":[-45,0,0],"trans":[0,2.200000047683716,2],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"step","type":"cube","face":"front","split":6,"taper":0,"scale":[2.9100000858306885,0.05000000074505806,0.5799999833106995],"rotate":[45,0,0],"trans":[0,2.200000047683716,0.800000011920929],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[1.7999999523162842,0.5,1.100000023841858],"rotate":[0,0,0],"trans":[0,1.4500000476837158,8.699999809265137],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"deflector","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,2,2],"rotate":[0,0,0],"trans":[1.340000033378601,2.200000047683716,8.100000381469727],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[0,2,8.199999809265137]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,2,8.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[1.4199999570846558,3,8.199999809265137]},{"type":"reshape_lt","solid":true,"reshapable":true,"offset":0,"angle":[-15,90,0],"pos":[1.4199999570846558,3,8.199999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-15,90,0],"pos":[1.440000057220459,3,8.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[1.440000057220459,3,8.800000190734863]}]},{"comment":"deflector","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,2,2],"rotate":[0,0,0],"trans":[-1.340000033378601,2.200000047683716,8.100000381469727],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[0,2,8.199999809265137]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,2,8.199999809265137]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[0,90,0],"pos":[-1.4199999570846558,3,8.199999809265137]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[15,90,0],"pos":[-1.4199999570846558,3,8.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[15,90,0],"pos":[-1.440000057220459,3,8.199999809265137]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[-1.440000057220459,3,8.800000190734863]}]},{"comment":"beam","type":"cube","face":"front","split":6,"taper":0,"scale":[2.75,0.019999999552965164,0.10000000149011612],"rotate":[0,0,0],"trans":[0,3.190000057220459,8.5],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"dome","type":"cylinder","face":"front","split":10,"taper":0,"scale":[1.600000023841858,1.0499999523162842,6],"rotate":[0,0,90],"trans":[0,3.200000047683716,4.699999809265137],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,3,0]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[15,84,0],"pos":[-0.30000001192092896,3.299999952316284,7.599999904632568]},{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[15,-84,0],"pos":[0.30000001192092896,3.299999952316284,7.599999904632568]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-45,0,0],"pos":[0,3.4000000953674316,2.4000000953674316]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-45,0,45],"pos":[0,3.5999999046325684,2.4000000953674316]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-45,0,-45],"pos":[0,3.5999999046325684,2.4000000953674316]},{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-65,0,0],"pos":[0,3.5999999046325684,2.4000000953674316]}]},{"comment":"light","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.4000000059604645,0.4000000059604645,0.4000000059604645],"rotate":[0,0,0],"trans":[0,3.5999999046325684,8.699999809265137],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[1,1.2999999523162842,1],"rotate":[0,0,0],"trans":[0.949999988079071,1.350000023841858,7.639999866485596],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[15,90,0],"pos":[1.25,0.699999988079071,0]}]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[1,1.2999999523162842,1],"rotate":[0,0,0],"trans":[-0.949999988079071,1.350000023841858,7.639999866485596],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[-15,90,0],"pos":[-1.25,0.699999988079071,0]}]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.800000011920929,0.800000011920929,1],"rotate":[0,0,0],"trans":[0.8500000238418579,0.699999988079071,7.639999866485596],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_gt","solid":false,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,0.699999988079071,0]}]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.800000011920929,0.800000011920929,1],"rotate":[0,0,0],"trans":[-0.8500000238418579,0.699999988079071,7.639999866485596],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_gt","solid":false,"reshapable":true,"offset":0,"angle":[90,0,0],"pos":[0,0.699999988079071,0]}]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.15000000596046448,0.15000000596046448,1],"rotate":[0,0,0],"trans":[0.8500000238418579,0.699999988079071,8.5],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.15000000596046448,0.15000000596046448,1],"rotate":[0,0,0],"trans":[-0.8500000238418579,0.699999988079071,8.5],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.5,0.5,1.2999999523162842],"rotate":[0,0,0],"trans":[1.0499999523162842,1.2000000476837158,7.639999866485596],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.5,0.5,1.2999999523162842],"rotate":[0,0,0],"trans":[-1.0499999523162842,1.2000000476837158,7.639999866485596],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.10000000149011612,0.15000000596046448,2],"rotate":[0,0,0],"trans":[0.8500000238418579,0.949999988079071,6.699999809265137],"base_color":[1,1,1],"slicers":[]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.10000000149011612,0.15000000596046448,2],"rotate":[0,0,0],"trans":[-0.8500000238418579,0.949999988079071,6.699999809265137],"base_color":[1,1,1],"slicers":[]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.019999999552965164,0.15000000596046448,1.5],"rotate":[0,0,0],"trans":[1.149999976158142,1.5,4.949999809265137],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[0,1.5,5.650000095367432]}]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.019999999552965164,0.44999998807907104,0.15000000596046448],"rotate":[0,0,0],"trans":[1.149999976158142,1.225000023841858,5.625],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.019999999552965164,0.15000000596046448,1.5],"rotate":[0,0,0],"trans":[0.949999988079071,1.5,4.949999809265137],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[0,1.5,5.650000095367432]}]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.019999999552965164,0.44999998807907104,0.15000000596046448],"rotate":[0,0,0],"trans":[0.949999988079071,1.225000023841858,5.625],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.4000000059604645,0.05000000074505806,0.15000000596046448],"rotate":[0,0,0],"trans":[0.949999988079071,1.024999976158142,5.625],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.20000000298023224,0.5,0.15000000596046448],"rotate":[0,0,0],"trans":[1.0499999523162842,1.7699999809265137,4.300000190734863],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.019999999552965164,0.15000000596046448,1.5],"rotate":[0,0,0],"trans":[-1.149999976158142,1.5,4.949999809265137],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[0,1.5,5.650000095367432]}]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.019999999552965164,0.44999998807907104,0.15000000596046448],"rotate":[0,0,0],"trans":[-1.149999976158142,1.225000023841858,5.625],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.019999999552965164,0.15000000596046448,1.5],"rotate":[0,0,0],"trans":[-0.949999988079071,1.5,4.949999809265137],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[{"type":"erase_gt","solid":true,"reshapable":true,"offset":0,"angle":[45,0,0],"pos":[0,1.5,5.650000095367432]}]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.019999999552965164,0.44999998807907104,0.15000000596046448],"rotate":[0,0,0],"trans":[-0.949999988079071,1.225000023841858,5.625],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.4000000059604645,0.05000000074505806,0.15000000596046448],"rotate":[0,0,0],"trans":[-0.949999988079071,1.024999976158142,5.625],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[]},{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.20000000298023224,0.5,0.15000000596046448],"rotate":[0,0,0],"trans":[-1.0499999523162842,1.7699999809265137,4.300000190734863],"base_color":[0.30000001192092896,0.30000001192092896,0.30000001192092896],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[1,1,1,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-1.451,"width":0,"angle":[0,0,90],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":1.451,"width":0,"angle":[0,0,90],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":-1.09,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"light","color":{"default_value":[5,5,0,1],"override_color_id":""},"bounds":[{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,3.5999999046325684,8.699999809265137],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"circle","bound":0.15,"width":0,"angle":[0,0,0],"pos":[0,3.5999999046325684,8.699999809265137],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"window","color":{"default_value":[0.25,0.25,0.25,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":0,"width":0.7,"angle":[90,0,0],"pos":[0,2.4000000953674316,0],"alt_color":{"default_value":[0.4000000059604645,0.4000000059604645,0.4000000059604645,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.4000000953674316,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,3.0999999046325684,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,3.0999999046325684,-1.399999976158142],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,3.0999999046325684,-2.299999952316284],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"window","color":{"default_value":[0.25,0.25,0.25,1],"override_color_id":""},"bounds":[{"type":"alt_gt","shape":"plane","bound":0,"width":0.5,"angle":[90,0,0],"pos":[0,2.5999999046325684,0],"alt_color":{"default_value":[0.4000000059604645,0.4000000059604645,0.4000000059604645,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[1.350000023841858,2.5999999046325684,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[0.8999999761581421,2.5999999046325684,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[-0.8999999761581421,2.5999999046325684,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[-1.350000023841858,2.5999999046325684,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,2.5999999046325684,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,3.0999999046325684,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-1.5],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.800000011920929,0,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[0.800000011920929,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[-0.800000011920929,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,6.800000190734863],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,5.724999904632568],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,1,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.8999999761581421,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"8d942bcc-1420-49e7-9f34-32c9b1f30d4f"},{"name":["D51-trailing-wheel","D51-従輪"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"axis","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.20000000298023224,1],"rotate":[0,90,0],"trans":[0,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0.1,"scale":[0.8999999761581421,0.8999999761581421,0.15000000596046448],"rotate":[0,90,0],"trans":[-0.550000011920929,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":-0.1,"scale":[0.8999999761581421,0.8999999761581421,0.15000000596046448],"rotate":[0,90,0],"trans":[0.550000011920929,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.2,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"8d221d99-806c-4b9f-b178-c9fb800b8217"},{"name":["D51-main-driving-wheel","D51-主動輪"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"axis","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.20000000298023224,1],"rotate":[0,90,0],"trans":[0,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":12,"taper":0.067,"scale":[1.5,1.5,0.15000000596046448],"rotate":[0,90,0],"trans":[-0.550000011920929,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":12,"taper":-0.066,"scale":[1.5,1.5,0.15000000596046448],"rotate":[0,90,0],"trans":[0.550000011920929,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.10000000149011612,0.6000000238418579,0.15000000596046448],"rotate":[-35,0,0],"trans":[0.949999988079071,-0.18000000715255737,0.12999999523162842],"base_color":[1,1,1],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.10000000149011612,0.6000000238418579,0.15000000596046448],"rotate":[-125,0,0],"trans":[-0.949999988079071,-0.12999999523162842,-0.18000000715255737],"base_color":[1,1,1],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.2,"width":0,"angle":[180,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.2,"width":0,"angle":[-90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.62,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":0.62,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"circle","bound":0.6,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"ed47688a-bbef-4aab-8a83-18c9c6ff5a24"},{"name":["D51-connecting-driving-wheel","D51-連結動輪"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"axis","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.20000000298023224,1],"rotate":[0,90,0],"trans":[0,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":12,"taper":0.067,"scale":[1.5,1.5,0.15000000596046448],"rotate":[0,90,0],"trans":[-0.550000011920929,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":12,"taper":-0.066,"scale":[1.5,1.5,0.15000000596046448],"rotate":[0,90,0],"trans":[0.550000011920929,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.4,"width":0,"angle":[180,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.4,"width":0,"angle":[-90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]},{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.62,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_gt","shape":"plane","bound":0.62,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"circle","bound":0.6,"width":0,"angle":[0,90,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"7714444f-d7c4-48dc-8ab5-b32f8b0cd106"},{"name":["D51-trailing-bogie","D51-従輪台車"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.4000000059604645,2],"rotate":[0,0,0],"trans":[0.75,0.15000000596046448,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.4000000059604645,2],"rotate":[0,0,0],"trans":[-0.75,0.15000000596046448,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2,0.20000000298023224,0.20000000298023224],"rotate":[0,0,0],"trans":[0,0.30000001192092896,1],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2,0.20000000298023224,0.20000000298023224],"rotate":[0,0,0],"trans":[0,0.30000001192092896,-1],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"prism","face":"front","split":6,"taper":0,"scale":[1,0.4000000059604645,0.20000000298023224],"rotate":[0,90,180],"trans":[0.75,0.5,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"prism","face":"front","split":6,"taper":0,"scale":[1,0.4000000059604645,0.20000000298023224],"rotate":[0,90,180],"trans":[-0.75,0.5,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2,0.20000000298023224,0.20000000298023224],"rotate":[0,0,0],"trans":[0,0.800000011920929,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]}],"painters":[],"uuid":"08ce7f47-cc93-4ade-bb67-a1071e517ef7"},{"name":["D51-tender-wheel","D51-炭水車車輪"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"axis","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.20000000298023224,1.5],"rotate":[0,90,0],"trans":[0,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":0.1,"scale":[0.8999999761581421,0.8999999761581421,0.15000000596046448],"rotate":[0,90,0],"trans":[-0.550000011920929,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":10,"taper":-0.1,"scale":[0.8999999761581421,0.8999999761581421,0.15000000596046448],"rotate":[0,90,0],"trans":[0.550000011920929,0,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[0.5,0.5,0.5,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":-0.2,"width":0,"angle":[90,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,1,1,1],"override_color_id":""}}]}],"uuid":"21d360ac-c199-4adf-9c15-69023b0d9448"},{"name":["D51-tender-bogie","D51-炭水車台車"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.4000000059604645,3],"rotate":[0,0,0],"trans":[0.75,0.15000000596046448,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.4000000059604645,3],"rotate":[0,0,0],"trans":[-0.75,0.15000000596046448,0],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]}],"painters":[],"uuid":"7e731f56-fe16-441d-9d76-65f60754a35c"},{"name":["D51-tender-body","D51-炭水車車体"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.799999952316284,0.20000000298023224,6.925000190734863],"rotate":[0,0,0],"trans":[0,1.100000023841858,-6],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[2.940000057220459,1.7999999523162842,6.125],"rotate":[0,0,0],"trans":[0,2.0999999046325684,-6.400000095367432],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[{"type":"erase_lt","solid":true,"reshapable":true,"offset":0,"angle":[-45,0,0],"pos":[0,0,-11]},{"type":"reshape_gt","solid":true,"reshapable":true,"offset":0,"angle":[-90,0,0],"pos":[0,2.5,-11]}]},{"comment":"","type":"cube","face":"front","split":6,"taper":0.3,"scale":[1,0.4000000059604645,0.800000011920929],"rotate":[0,0,0],"trans":[0,2,-3],"base_color":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"slicers":[]},{"comment":"coal","type":"cube","face":"front","split":3,"taper":0.8,"scale":[2.5999999046325684,4.300000190734863,0.5],"rotate":[90,0,0],"trans":[0,3.25,-5.650000095367432],"base_color":[0.05000000074505806,0.05000000074505806,0.05000000074505806],"slicers":[]}],"painters":[],"uuid":"a7ef3471-2ff0-47b2-835d-39862f0d4615"},{"name":["D51-piston","D51-ピストン"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.10000000149011612,0.10000000149011612,2.0999999046325684],"rotate":[0,0,0],"trans":[0,0,1],"base_color":[1,1,1],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.5,0.30000001192092896],"rotate":[0,0,0],"trans":[0,0.10000000149011612,0],"base_color":[1,1,1],"slicers":[]},{"comment":"","type":"cube","face":"front","split":6,"taper":0,"scale":[0.20000000298023224,0.20000000298023224,0.20000000298023224],"rotate":[0,0,0],"trans":[0,-0.25,0],"base_color":[1,1,1],"slicers":[]}],"painters":[],"uuid":"46c928c4-8386-4ed2-bf8f-30c7c023fc54"},{"name":["D51-main-rod","D51-主連棒"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.10000000149011612,0.20000000298023224,3.200000047683716],"rotate":[0,0,0],"trans":[0,0,1.5499999523162842],"base_color":[1,1,1],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[0.800000011920929,0,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,3.0999999046325684],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.05000000074505806,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-0.05000000074505806,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"768f0435-7021-4b32-8802-400ba7055719"},{"name":["D51-coupling-rod","D51-連結棒"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.10000000149011612,0.15000000596046448,4.75],"rotate":[0,0,0],"trans":[0,0,0.7749999761581421],"base_color":[1,1,1],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.4000000059604645,0.4000000059604645,0.25],"rotate":[0,90,90],"trans":[0,0,0],"base_color":[1,1,1],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.4000000059604645,0.4000000059604645,0.10000000149011612],"rotate":[0,90,90],"trans":[0,0,1.5499999523162842],"base_color":[1,1,1],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.4000000059604645,0.4000000059604645,0.10000000149011612],"rotate":[0,90,90],"trans":[0,0,3.0999999046325684],"base_color":[1,1,1],"slicers":[]},{"comment":"","type":"cylinder","face":"front","split":6,"taper":0,"scale":[0.4000000059604645,0.4000000059604645,0.10000000149011612],"rotate":[0,90,90],"trans":[0,0,-1.5499999523162842],"base_color":[1,1,1],"slicers":[]}],"painters":[{"comment":"","color":{"default_value":[0.800000011920929,0,0,1],"override_color_id":""},"bounds":[{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,2.9000000953674316],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,1.75],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,1.350000023841858],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,0.20000000298023224],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"paint_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-0.20000000298023224],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[0,0,0],"pos":[0,0,-1.350000023841858],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_gt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,0.05000000074505806,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}},{"type":"mask_lt","shape":"plane","bound":0,"width":0,"angle":[90,0,0],"pos":[0,-0.05000000074505806,0],"alt_color":{"default_value":[1,0,0,1],"override_color_id":""}}]}],"uuid":"3496795d-4388-444f-a8a0-95ab299ebb2a"},{"name":["D51-eccentric-rod","D51-偏心棒"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.10000000149011612,0.10000000149011612,2.0999999046325684],"rotate":[0,0,0],"trans":[0,0,1],"base_color":[1,1,1],"slicers":[]}],"painters":[],"uuid":"fb7adbdb-4959-426e-a181-8449975c2e61"},{"name":["D51-expansion-link","D51-加減リンク"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.10000000149011612,0.10000000149011612,1.100000023841858],"rotate":[0,0,0],"trans":[0,0,0.5],"base_color":[1,1,1],"slicers":[]}],"painters":[],"uuid":"e5dd75c1-ac26-4e3c-a8d8-e16954ced2f9"},{"name":["D51-lifting-link","D51-吊りリンク"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.05000000074505806,0.05000000074505806,0.5],"rotate":[0,0,0],"trans":[0,0,0.20000000298023224],"base_color":[1,1,1],"slicers":[]}],"painters":[],"uuid":"b0bc56be-b0b0-4120-8eb7-6263ed6cbee8"},{"name":["D51-radius-bar","D51-心向棒"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.10000000149011612,0.10000000149011612,1.899999976158142],"rotate":[0,0,0],"trans":[0,0,0.8999999761581421],"base_color":[1,1,1],"slicers":[]}],"painters":[],"uuid":"90d64a63-9c51-4887-b220-2bf28a9a4749"},{"name":["D51-union-link","D51-結びリンク"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.10000000149011612,0.10000000149011612,0.5],"rotate":[0,0,0],"trans":[0,0,0.20000000298023224],"base_color":[1,1,1],"slicers":[]}],"painters":[],"uuid":"6a2fbb19-5322-4360-babb-ef8d9a77fefa"},{"name":["D51-combination-lever","D51-合併リンク"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cube","face":"front","split":8,"taper":0,"scale":[0.10000000149011612,0.10000000149011612,1],"rotate":[0,0,0],"trans":[0,0,0.44999998807907104],"base_color":[1,1,1],"slicers":[]}],"painters":[],"uuid":"4bbd7491-2b01-43df-bc1c-b5b6f683e578"},{"name":["D51-valve-stem","D51-弁心棒"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"draw_pass":"default","primitives":[{"comment":"","type":"cylinder","face":"front","split":8,"taper":0,"scale":[0.10000000149011612,0.10000000149011612,0.8999999761581421],"rotate":[0,0,0],"trans":[0,0,0.4000000059604645],"base_color":[1,1,1],"slicers":[]}],"painters":[],"uuid":"bc535753-8a63-4aea-9854-7d779eab53c1"}]},"train_models":{"insts":[{"name":["AizenGL-01","アイゼンGL-01"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":20,"rail_type":"narrow","parts":[{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,8],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,6],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-8],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-6],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"d161e5a3-3579-420b-b365-c97d32fa3dcf","type":"bogie","id":"bg","mount_ids":["wf"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,7],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"d161e5a3-3579-420b-b365-c97d32fa3dcf","type":"bogie","id":"bg","mount_ids":["wr"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-7],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"53621286-66ea-4fe1-b8ec-db8bb2665223","type":"body","id":"","mount_ids":["bg"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[],"switches":[{"id":"stripe_color","label":["Stripe Color","ストライプ色"],"default_value_id":"red","preview_value_id":"red","values":[{"id":"red","label":["Aizen Red","アイゼンレッド"],"colors":[{"id":"stripe","color":[1,0,0,1]},{"id":"sub_stripe","color":[0,0,0,1]}]},{"id":"blue","label":["RS Blue","RSブルー"],"colors":[{"id":"stripe","color":[0.5,0.75,1,1]},{"id":"sub_stripe","color":[0,0,1,1]}]}]}],"uuid":"c4700291-a9ee-48e4-8a62-d88295af4348"},{"name":["AizenGL-02","アイゼンGL-02"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":20,"rail_type":"narrow","parts":[{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,8],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,6],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-8],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-6],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"d161e5a3-3579-420b-b365-c97d32fa3dcf","type":"bogie","id":"bg","mount_ids":["wf"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,7],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"d161e5a3-3579-420b-b365-c97d32fa3dcf","type":"bogie","id":"bg","mount_ids":["wr"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-7],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"0d171c81-748c-41fb-9049-b545d73b120b","type":"body","id":"","mount_ids":["bg"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[],"switches":[{"id":"stripe_color","label":["Stripe Color","ストライプ色"],"default_value_id":"red","preview_value_id":"red","values":[{"id":"red","label":["Aizen Red","アイゼンレッド"],"colors":[{"id":"stripe","color":[1,0,0,1]},{"id":"sub_stripe","color":[0,0,0,1]}]},{"id":"blue","label":["RS Blue","RSブルー"],"colors":[{"id":"stripe","color":[0.5,0.75,1,1]},{"id":"sub_stripe","color":[0,0,1,1]}]}]}],"uuid":"0e83c0d0-ae09-438c-8587-114e40eb3fda"},{"name":["EF200","EF200"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":20,"rail_type":"narrow","parts":[{"model":"df32df2d-af19-4d17-aebd-7494bef2089e","type":"wheel","id":"w1","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.550000011920929,7.449999809265137],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"df32df2d-af19-4d17-aebd-7494bef2089e","type":"wheel","id":"w1","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.550000011920929,4.849999904632568],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"df32df2d-af19-4d17-aebd-7494bef2089e","type":"wheel","id":"w2","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.550000011920929,1.2999999523162842],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"df32df2d-af19-4d17-aebd-7494bef2089e","type":"wheel","id":"w2","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.550000011920929,-1.2999999523162842],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"df32df2d-af19-4d17-aebd-7494bef2089e","type":"wheel","id":"w3","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.550000011920929,-4.849999904632568],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"df32df2d-af19-4d17-aebd-7494bef2089e","type":"wheel","id":"w3","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.550000011920929,-7.449999809265137],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"6c83016c-b241-4cac-b3e7-86f4f4d04539","type":"bogie","id":"bg","mount_ids":["w1"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.699999988079071,6.150000095367432],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"6c83016c-b241-4cac-b3e7-86f4f4d04539","type":"bogie","id":"bg","mount_ids":["w2"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.699999988079071,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"6c83016c-b241-4cac-b3e7-86f4f4d04539","type":"bogie","id":"bg","mount_ids":["w3"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.699999988079071,-6.150000095367432],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"819d5449-4d0a-44e0-8ff8-80bb4ef2e07d","type":"body","id":"","mount_ids":["bg"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1.2000000476837158,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[],"switches":[{"id":"color","label":["Color","色"],"default_value_id":"original","preview_value_id":"updated","values":[{"id":"original","label":["Original","初期色"],"colors":[{"id":"side","color":[1,1,1,1]},{"id":"side2","color":[0.6000000238418579,0.6000000238418579,0.6000000238418579,1]}]},{"id":"updated","label":["Updated","更新色"],"colors":[{"id":"side","color":[0.6000000238418579,0.6000000238418579,0.6000000238418579,1]},{"id":"side2","color":[0.4000000059604645,0.4000000059604645,0.4000000059604645,1]}]}]}],"uuid":"221dcc5c-8b16-4763-9310-6d05df878c8b"},{"name":["Shiki400","シキ400"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":43,"rail_type":"narrow","parts":[{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw3","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,4.900000095367432],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw3","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,6.300000190734863],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw3","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,7.699999809265137],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw3","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,9],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw2","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,10.699999809265137],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw2","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,12.100000381469727],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw2","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,13.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw2","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,14.899999618530273],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw1","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,16.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw1","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,17.899999618530273],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw1","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,19.299999237060547],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw1","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,20.700000762939453],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"9227b576-940f-478e-bd88-4e51ccaafec8","type":"bogie","id":"fb1","mount_ids":["fw1"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.6000000238418579,18.600000381469727],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"9227b576-940f-478e-bd88-4e51ccaafec8","type":"bogie","id":"fb1","mount_ids":["fw2"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.6000000238418579,12.800000190734863],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"9227b576-940f-478e-bd88-4e51ccaafec8","type":"body","id":"fb2","mount_ids":["fw3"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.6000000238418579,7],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"383adf04-f127-4a8b-be8e-26651be39ca3","type":"body","id":"fb2","mount_ids":["fb1"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1.2999999523162842,15.699999809265137],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"7e7943bb-fe23-4ef4-9e39-332c466bd5bb","type":"body","id":"b3","mount_ids":["fb2"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,2,12.800000190734863],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"rw3","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-4.900000095367432],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"rw3","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-6.300000190734863],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"rw3","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-7.699999809265137],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"rw3","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-9],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"rw2","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-10.699999809265137],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"fw2","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-12.100000381469727],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"rw2","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-13.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"rw2","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-14.899999618530273],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"rw1","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-16.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"rw1","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-17.899999618530273],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"rw1","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-19.299999237060547],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bab1451a-9c71-4ddc-a5bb-aa049eeb0037","type":"wheel","id":"rw1","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-20.700000762939453],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"9227b576-940f-478e-bd88-4e51ccaafec8","type":"bogie","id":"rb1","mount_ids":["rw1"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.6000000238418579,-18.600000381469727],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"9227b576-940f-478e-bd88-4e51ccaafec8","type":"bogie","id":"rb1","mount_ids":["rw2"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.6000000238418579,-12.800000190734863],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"9227b576-940f-478e-bd88-4e51ccaafec8","type":"bogie","id":"rb2","mount_ids":["rw3"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.6000000238418579,-7],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"383adf04-f127-4a8b-be8e-26651be39ca3","type":"body","id":"rb2","mount_ids":["rb1"],"scale":[1,1,1],"rotate":[0,180,0],"trans":[0,1.2999999523162842,-15.699999809265137],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"7e7943bb-fe23-4ef4-9e39-332c466bd5bb","type":"body","id":"b3","mount_ids":["rb2"],"scale":[1,1,1],"rotate":[0,180,0],"trans":[0,2,-12.800000190734863],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"281c6e28-77a2-4b36-999c-f83f6c321dac","type":"body","id":"b4","mount_ids":["b3"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,2.700000047683716,12.800000190734863],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"281c6e28-77a2-4b36-999c-f83f6c321dac","type":"body","id":"b4","mount_ids":["b3"],"scale":[1,1,1],"rotate":[0,180,0],"trans":[0,2.700000047683716,-12.800000190734863],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"718c4240-bbbb-49a6-83d3-97af26f7439f","type":"body","id":"","mount_ids":["b4"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,2.200000047683716,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"load-type","op":"is_not","value_id":["off"]}},{"model":"ac31c2ce-be5a-43e2-b916-69b364151ec8","type":"body","id":"","mount_ids":["b4"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,2,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"load-type","op":"is","value_id":["off"]}}],"smokes":[],"switches":[{"id":"load-type","label":["Load Type","積載状態"],"default_value_id":"on","preview_value_id":"off","values":[{"id":"on","label":["ON","有"],"colors":[]},{"id":"off","label":["OFF","無"],"colors":[]}]}],"uuid":"7b25a896-80f8-4bae-9ce0-2d7c5391dbc1"},{"name":["Koki100","コキ100"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":20,"rail_type":"narrow","parts":[{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,8.149999618530273],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,6.050000190734863],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-8.149999618530273],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c39df367-c132-4155-b0a0-a04908f6d014","type":"wheel","id":"wr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-6.050000190734863],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"d161e5a3-3579-420b-b365-c97d32fa3dcf","type":"bogie","id":"bg","mount_ids":["wf"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,7.099999904632568],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"d161e5a3-3579-420b-b365-c97d32fa3dcf","type":"bogie","id":"bg","mount_ids":["wr"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-7.099999904632568],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"2643b49e-85c0-43a2-8816-bb726e9a66ec","type":"body","id":"body","mount_ids":["bg"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.8999999761581421,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"641271e7-b2ca-430a-92c3-45f42eca9cd6","type":"body","id":"","mount_ids":["body"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1.100000023841858,7.599999904632568],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"type","op":"is","value_id":["containers"]}},{"model":"641271e7-b2ca-430a-92c3-45f42eca9cd6","type":"body","id":"","mount_ids":["body"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1.100000023841858,3.799999952316284],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"type","op":"is","value_id":["containers"]}},{"model":"641271e7-b2ca-430a-92c3-45f42eca9cd6","type":"body","id":"","mount_ids":["body"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1.100000023841858,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"type","op":"is","value_id":["containers"]}},{"model":"641271e7-b2ca-430a-92c3-45f42eca9cd6","type":"body","id":"","mount_ids":["body"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1.100000023841858,-3.799999952316284],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"type","op":"is","value_id":["containers"]}},{"model":"641271e7-b2ca-430a-92c3-45f42eca9cd6","type":"body","id":"","mount_ids":["body"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1.100000023841858,-7.599999904632568],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"type","op":"is","value_id":["containers"]}},{"model":"3713ef97-bebf-4409-b972-2146bcc3e445","type":"body","id":"","mount_ids":["body"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1.100000023841858,6.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"type","op":"is","value_id":["tanks"]}},{"model":"3713ef97-bebf-4409-b972-2146bcc3e445","type":"body","id":"","mount_ids":["body"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1.100000023841858,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"type","op":"is","value_id":["tanks"]}},{"model":"3713ef97-bebf-4409-b972-2146bcc3e445","type":"body","id":"","mount_ids":["body"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1.100000023841858,-6.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"type","op":"is","value_id":["tanks"]}}],"smokes":[],"switches":[{"id":"type","label":["Container Type","コンテナ種別"],"default_value_id":"containers","preview_value_id":"tanks","values":[{"id":"none","label":["None","無"],"colors":[]},{"id":"containers","label":["Containers","コンテナ"],"colors":[]},{"id":"tanks","label":["Tanks","タンク"],"colors":[]}]}],"uuid":"1d0bc77e-b7a1-47d5-9128-b7d75f5aab58"},{"name":["UCIT2030-01","UCIT2030-01"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":25,"rail_type":"standard","parts":[{"model":"c36e0a0b-600e-4543-bdf2-4cfb64f743e9","type":"wheel","id":"wf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,10],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c36e0a0b-600e-4543-bdf2-4cfb64f743e9","type":"wheel","id":"wf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,7.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c36e0a0b-600e-4543-bdf2-4cfb64f743e9","type":"wheel","id":"wr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-13.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"bogie","op":"is","value_id":["on"]}},{"model":"c36e0a0b-600e-4543-bdf2-4cfb64f743e9","type":"wheel","id":"wr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-11.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"bogie","op":"is","value_id":["on"]}},{"model":"89d22195-5df9-41de-befb-ba4fbe1e59f3","type":"bogie","id":"bg","mount_ids":["wf"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,8.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"89d22195-5df9-41de-befb-ba4fbe1e59f3","type":"bogie","id":"bg","mount_ids":["wr"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-12.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"bogie","op":"is","value_id":["on"]}},{"model":"03ba15e2-79cb-4033-99b4-c52653dca291","type":"body","id":"","mount_ids":["bg"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[],"switches":[{"id":"bogie","label":["Bogie","台車"],"default_value_id":"on","preview_value_id":"on","values":[{"id":"off","label":["Off","なし"],"colors":[]},{"id":"on","label":["On","あり"],"colors":[]}]},{"id":"color","label":["Color","色"],"default_value_id":"blue","preview_value_id":"orange","values":[{"id":"blue","label":["RS Blue","RSブルー"],"colors":[]},{"id":"orange","label":["Orange","オレンジ"],"colors":[{"id":"base","color":[1,0.5,0,1]},{"id":"body","color":[0.4000000059604645,0.4000000059604645,0.4000000059604645,1]},{"id":"stripe","color":[1,1,1,1]}]}]}],"uuid":"601a3ec4-d8f9-47db-b848-ca01ce3df3e5"},{"name":["UCIT2030-02","UCIT2030-02"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":25,"rail_type":"standard","parts":[{"model":"c36e0a0b-600e-4543-bdf2-4cfb64f743e9","type":"wheel","id":"wf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,13.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"bogie","op":"is","value_id":["on"]}},{"model":"c36e0a0b-600e-4543-bdf2-4cfb64f743e9","type":"wheel","id":"wf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,11.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"bogie","op":"is","value_id":["on"]}},{"model":"c36e0a0b-600e-4543-bdf2-4cfb64f743e9","type":"wheel","id":"wr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-13.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"c36e0a0b-600e-4543-bdf2-4cfb64f743e9","type":"wheel","id":"wr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-11.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"89d22195-5df9-41de-befb-ba4fbe1e59f3","type":"bogie","id":"bg","mount_ids":["wf"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,12.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"bogie","op":"is","value_id":["on"]}},{"model":"89d22195-5df9-41de-befb-ba4fbe1e59f3","type":"bogie","id":"bg","mount_ids":["wr"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4000000059604645,-12.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"e8e462c8-e8a9-44ad-b2ca-91002f87a16a","type":"body","id":"","mount_ids":["bg"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[],"switches":[{"id":"bogie","label":["Bogie","台車"],"default_value_id":"off","preview_value_id":"off","values":[{"id":"off","label":["Off","なし"],"colors":[]},{"id":"on","label":["On","あり"],"colors":[]}]},{"id":"color","label":["Color","色"],"default_value_id":"blue","preview_value_id":"orange","values":[{"id":"blue","label":["RS Blue","RSブルー"],"colors":[]},{"id":"orange","label":["Orange","オレンジ"],"colors":[{"id":"base","color":[1,0.5,0,1]},{"id":"body","color":[0.4000000059604645,0.4000000059604645,0.4000000059604645,1]},{"id":"stripe","color":[1,1,1,1]}]}]}],"uuid":"994dd1aa-2045-4f32-b73d-7e6c7ad30a2b"},{"name":["Mono-S-01 (suspended)","Mono-S-01 (懸垂式)"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":13,"rail_type":"safege","parts":[{"model":"fc27c3db-dd56-487c-9c38-bdce511d224c","type":"wheel","id":"ft","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,4.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fc27c3db-dd56-487c-9c38-bdce511d224c","type":"wheel","id":"ft","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,2.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fc27c3db-dd56-487c-9c38-bdce511d224c","type":"wheel","id":"rt","mount_ids":["rt"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-4.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fc27c3db-dd56-487c-9c38-bdce511d224c","type":"wheel","id":"rt","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-2.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"ead7714b-6619-4353-9df9-69b76ea3e02e","type":"bogie","id":"bg","mount_ids":["ft"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,3.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"ead7714b-6619-4353-9df9-69b76ea3e02e","type":"bogie","id":"bg","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-3.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"d4065b74-724d-4bb6-b278-06d807cdfea6","type":"body","id":"","mount_ids":["bg"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,-0.5,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[],"switches":[{"id":"color","label":["Color","色"],"default_value_id":"orange","preview_value_id":"green","values":[{"id":"orange","label":["Orange","オレンジ"],"colors":[]},{"id":"purple","label":["Purple","パープル"],"colors":[{"id":"base","color":[0.800000011920929,0.30000001192092896,0.6000000238418579,1]}]},{"id":"green","label":["Green","グリーン"],"colors":[{"id":"base","color":[0.4000000059604645,0.8999999761581421,0.4000000059604645,1]}]}]}],"uuid":"91a09ccc-86d3-4fa8-b600-c616b67f87b6"},{"name":["Mono-S-02 (suspended)","Mono-S-02 (懸垂式)"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":13,"rail_type":"safege","parts":[{"model":"fc27c3db-dd56-487c-9c38-bdce511d224c","type":"wheel","id":"ft","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,4.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fc27c3db-dd56-487c-9c38-bdce511d224c","type":"wheel","id":"ft","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,2.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fc27c3db-dd56-487c-9c38-bdce511d224c","type":"wheel","id":"rt","mount_ids":["rt"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-4.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fc27c3db-dd56-487c-9c38-bdce511d224c","type":"wheel","id":"rt","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-2.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"ead7714b-6619-4353-9df9-69b76ea3e02e","type":"bogie","id":"bg","mount_ids":["ft"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,3.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"ead7714b-6619-4353-9df9-69b76ea3e02e","type":"bogie","id":"bg","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-3.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"917de8b5-6067-4ce0-8ade-6e2acf80aa98","type":"body","id":"","mount_ids":["bg"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,-0.5,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[],"switches":[{"id":"color","label":["Color","色"],"default_value_id":"orange","preview_value_id":"green","values":[{"id":"orange","label":["Orange","オレンジ"],"colors":[]},{"id":"purple","label":["Purple","パープル"],"colors":[{"id":"base","color":[0.800000011920929,0.30000001192092896,0.6000000238418579,1]}]},{"id":"green","label":["Green","グリーン"],"colors":[{"id":"base","color":[0.4000000059604645,0.8999999761581421,0.4000000059604645,1]}]}]}],"uuid":"1d3fba90-71f2-45d4-8bf9-1f747f66bfde"},{"name":["Mono-A-01 (straddling)","Mono-A-01 (跨座式)"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":13,"rail_type":"alweg","parts":[{"model":"fda93023-8c2b-4779-8a31-e6328eaf3137","type":"wheel","id":"ft","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,4.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fda93023-8c2b-4779-8a31-e6328eaf3137","type":"wheel","id":"ft","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,2.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fda93023-8c2b-4779-8a31-e6328eaf3137","type":"wheel","id":"rt","mount_ids":["rt"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-4.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fda93023-8c2b-4779-8a31-e6328eaf3137","type":"wheel","id":"rt","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-2.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"f060b8b5-c0d6-444b-a426-6a060e1cbb55","type":"bogie","id":"bg","mount_ids":["ft"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,3.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"f060b8b5-c0d6-444b-a426-6a060e1cbb55","type":"bogie","id":"bg","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-3.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"24f28b8d-c853-45be-9b96-977a4053dfc0","type":"body","id":"","mount_ids":["bg"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[],"switches":[{"id":"color","label":["Color","色"],"default_value_id":"white","preview_value_id":"red","values":[{"id":"white","label":["White","白"],"colors":[]},{"id":"red","label":["Red","赤"],"colors":[{"id":"base","color":[0.800000011920929,0,0.10000000149011612,1]}]},{"id":"blue","label":["Blue","青"],"colors":[{"id":"base","color":[0,0.20000000298023224,0.8999999761581421,1]}]}]}],"uuid":"b000ae6f-dbd4-43c0-9972-70a420fc78c3"},{"name":["Mono-A-02(straddling)","Mono-A-02 (跨座式)"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":13,"rail_type":"alweg","parts":[{"model":"fda93023-8c2b-4779-8a31-e6328eaf3137","type":"wheel","id":"ft","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,4.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fda93023-8c2b-4779-8a31-e6328eaf3137","type":"wheel","id":"ft","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,2.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fda93023-8c2b-4779-8a31-e6328eaf3137","type":"wheel","id":"rt","mount_ids":["rt"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-4.25],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fda93023-8c2b-4779-8a31-e6328eaf3137","type":"wheel","id":"rt","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-2.75],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"f060b8b5-c0d6-444b-a426-6a060e1cbb55","type":"bogie","id":"bg","mount_ids":["ft"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,3.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"f060b8b5-c0d6-444b-a426-6a060e1cbb55","type":"bogie","id":"bg","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.5,-3.5],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"de2285fb-7709-4c9b-b4e3-8a4c20d560e1","type":"body","id":"","mount_ids":["bg"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,1,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[],"switches":[{"id":"color","label":["Color","色"],"default_value_id":"white","preview_value_id":"red","values":[{"id":"white","label":["White","白"],"colors":[]},{"id":"red","label":["Red","赤"],"colors":[{"id":"base","color":[0.800000011920929,0,0.10000000149011612,1]}]},{"id":"blue","label":["Blue","青"],"colors":[{"id":"base","color":[0,0.20000000298023224,0.8999999761581421,1]}]}]}],"uuid":"adff4b70-c453-49fc-bbb6-030cf3ea84d0"},{"name":["D51","D51"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"length":19.73,"rail_type":"narrow","parts":[{"model":"8d221d99-806c-4b9f-b178-c9fb800b8217","type":"wheel","id":"","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4300000071525574,8.6899995803833],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"8d221d99-806c-4b9f-b178-c9fb800b8217","type":"wheel","id":"","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4300000071525574,-0.7599999904632568],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"7714444f-d7c4-48dc-8ab5-b32f8b0cd106","type":"wheel","id":"dw1","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.699999988079071,6.239999771118164],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"7714444f-d7c4-48dc-8ab5-b32f8b0cd106","type":"wheel","id":"dw2","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.699999988079071,4.690000057220459],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"ed47688a-bbef-4aab-8a83-18c9c6ff5a24","type":"wheel","id":"dw3","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.699999988079071,3.140000104904175],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"7714444f-d7c4-48dc-8ab5-b32f8b0cd106","type":"wheel","id":"dw4","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.699999988079071,1.590000033378601],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"08ce7f47-cc93-4ade-bb67-a1071e517ef7","type":"bogie","id":"","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4300000071525574,-0.7599999904632568],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"8d942bcc-1420-49e7-9f34-32c9b1f30d4f","type":"body","id":"body","mount_ids":["dw1","dw4"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"21d360ac-c199-4adf-9c15-69023b0d9448","type":"wheel","id":"twr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4300000071525574,-8.670000076293945],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"21d360ac-c199-4adf-9c15-69023b0d9448","type":"wheel","id":"twr","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4300000071525574,-7.070000171661377],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"21d360ac-c199-4adf-9c15-69023b0d9448","type":"wheel","id":"twf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4300000071525574,-5.070000171661377],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"21d360ac-c199-4adf-9c15-69023b0d9448","type":"wheel","id":"twf","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4300000071525574,-3.4700000286102295],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"7e731f56-fe16-441d-9d76-65f60754a35c","type":"bogie","id":"tb","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4300000071525574,-7.869999885559082],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"7e731f56-fe16-441d-9d76-65f60754a35c","type":"bogie","id":"tb","mount_ids":[""],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0.4300000071525574,-4.269999980926514],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"a7ef3471-2ff0-47b2-835d-39862f0d4615","type":"body","id":"","mount_ids":["tb"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0,0,0],"rod_len1":1,"fix_to_pos2":[0,0,0],"rod_len2":1},"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"46c928c4-8386-4ed2-bf8f-30c7c023fc54","type":"rod_slide","id":"rod1L","mount_ids":["body","dw3"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"768f0435-7021-4b32-8802-400ba7055719","id":"rod2L","fix_to_pos1":[0.8500000238418579,0.699999988079071,7.639999866485596],"rod_len1":1,"fix_to_pos2":[0.8500000238418579,-0.3499999940395355,0],"rod_len2":3.1},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"3496795d-4388-444f-a8a0-95ab299ebb2a","type":"rod_slide","id":"rod3L","mount_ids":["dw2","dw3"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"","id":"","fix_to_pos1":[0.6800000071525574,-0.3499999940395355,0],"rod_len1":1,"fix_to_pos2":[0.6800000071525574,-0.3499999940395355,0],"rod_len2":0},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fb7adbdb-4959-426e-a181-8449975c2e61","type":"rod_tri","id":"rod4L","mount_ids":["dw3","body"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"e5dd75c1-ac26-4e3c-a8d8-e16954ced2f9","id":"rod5L","fix_to_pos1":[1.0499999523162842,0,0.25],"rod_len1":2,"fix_to_pos2":[1.0499999523162842,1.399999976158142,5.099999904632568],"rod_len2":0.6},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"b0bc56be-b0b0-4120-8eb7-6263ed6cbee8","type":"rod_tri","id":"rod6L","mount_ids":["body","rod5L"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"90d64a63-9c51-4887-b220-2bf28a9a4749","id":"rod7L","fix_to_pos1":[1.0499999523162842,1.4500000476837158,4.800000190734863],"rod_len1":0.4,"fix_to_pos2":[0,0,0.30000001192092896],"rod_len2":0.3},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"6a2fbb19-5322-4360-babb-ef8d9a77fefa","type":"rod_tri","id":"rod8L","mount_ids":["rod1L","rod7L"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"4bbd7491-2b01-43df-bc1c-b5b6f683e578","id":"rod9L","fix_to_pos1":[0.15000000596046448,-0.30000001192092896,0],"rod_len1":0.4,"fix_to_pos2":[0,0,1.7999999523162842],"rod_len2":0.9},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bc535753-8a63-4aea-9854-7d779eab53c1","type":"rod_slide","id":"rod10L","mount_ids":["body","rod9L"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"","id":"rod2","fix_to_pos1":[1.0499999523162842,1.2000000476837158,7.639999866485596],"rod_len1":1,"fix_to_pos2":[0,0,0.6700000166893005],"rod_len2":0.08},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"46c928c4-8386-4ed2-bf8f-30c7c023fc54","type":"rod_slide","id":"rod1R","mount_ids":["body","dw3"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"768f0435-7021-4b32-8802-400ba7055719","id":"rod2R","fix_to_pos1":[-0.8500000238418579,0.699999988079071,7.639999866485596],"rod_len1":1,"fix_to_pos2":[-0.8500000238418579,0,-0.3499999940395355],"rod_len2":3.1},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"3496795d-4388-444f-a8a0-95ab299ebb2a","type":"rod_slide","id":"rod3R","mount_ids":["dw2","dw3"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"","id":"","fix_to_pos1":[-0.6800000071525574,0,-0.3499999940395355],"rod_len1":1,"fix_to_pos2":[-0.6800000071525574,0,-0.3499999940395355],"rod_len2":0},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"fb7adbdb-4959-426e-a181-8449975c2e61","type":"rod_tri","id":"rod4R","mount_ids":["dw3","body"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"e5dd75c1-ac26-4e3c-a8d8-e16954ced2f9","id":"rod5R","fix_to_pos1":[-1.0499999523162842,-0.25,0],"rod_len1":2,"fix_to_pos2":[-1.0499999523162842,1.399999976158142,5.099999904632568],"rod_len2":0.6},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"b0bc56be-b0b0-4120-8eb7-6263ed6cbee8","type":"rod_tri","id":"rod6R","mount_ids":["body","rod5R"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"90d64a63-9c51-4887-b220-2bf28a9a4749","id":"rod7R","fix_to_pos1":[-1.0499999523162842,1.4500000476837158,4.800000190734863],"rod_len1":0.4,"fix_to_pos2":[0,0,0.30000001192092896],"rod_len2":0.3},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"6a2fbb19-5322-4360-babb-ef8d9a77fefa","type":"rod_tri","id":"rod8R","mount_ids":["rod1R","rod7R"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"4bbd7491-2b01-43df-bc1c-b5b6f683e578","id":"rod9R","fix_to_pos1":[-0.15000000596046448,-0.30000001192092896,0],"rod_len1":0.4,"fix_to_pos2":[0,0,1.7999999523162842],"rod_len2":0.9},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"bc535753-8a63-4aea-9854-7d779eab53c1","type":"rod_slide","id":"rod10R","mount_ids":["body","rod9R"],"scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"sub_part":{"model":"","id":"rod2","fix_to_pos1":[-1.0499999523162842,1.2000000476837158,7.639999866485596],"rod_len1":1,"fix_to_pos2":[0,0,0.6700000166893005],"rod_len2":0.08},"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[{"mount_id":"body","life":2,"scale":0.6,"scale_fin":8,"damp":0.95,"emit_ratio":0.3,"turbulence":0.15,"direction":[0,0.30000001192092896,0],"trans":[0,4.099999904632568,7.639999866485596],"color":[0.30000001192092896,0.30000001192092896,0.30000001192092896,1],"color_fin":[1,1,1,0],"condition":{"switch_id":"smoke","op":"is","value_id":["on"]}},{"mount_id":"body","life":1,"scale":1,"scale_fin":3,"damp":0.95,"emit_ratio":0.2,"turbulence":0.2,"direction":[0,0,0],"trans":[1,0.30000001192092896,7.639999866485596],"color":[1,1,1,0.5],"color_fin":[1,1,1,0],"condition":{"switch_id":"smoke","op":"is","value_id":["on"]}},{"mount_id":"body","life":1,"scale":1,"scale_fin":3,"damp":0.95,"emit_ratio":0.2,"turbulence":0.2,"direction":[0,0,0],"trans":[-1,0.30000001192092896,7.639999866485596],"color":[1,1,1,0.5],"color_fin":[1,1,1,0],"condition":{"switch_id":"smoke","op":"is","value_id":["on"]}}],"switches":[{"id":"smoke","label":["Smoke","煙"],"default_value_id":"on","preview_value_id":"on","values":[{"id":"on","label":["On","有効"],"colors":[]},{"id":"off","label":["Off","無効"],"colors":[]}]}],"uuid":"06d299ae-2de0-40d0-b4f3-304011d6953f"}]},"trains":{"insts":[{"name":["Train1","列車1"],"go":true,"back":false,"speed":120,"cars":[{"model":"c4700291-a9ee-48e4-8a62-d88295af4348","flip":false,"switches":["stripe_color:blue"]},{"model":"0e83c0d0-ae09-438c-8587-114e40eb3fda","flip":false,"switches":["stripe_color:blue"]},{"model":"c4700291-a9ee-48e4-8a62-d88295af4348","flip":true,"switches":["stripe_color:blue"]}],"id":0,"head_anchor":{"rail":109,"dir_side":0,"pos":[7.5383524894714355,-10,-37.14186096191406],"dir":[-0.22883042693138123,0,0.9734662771224976],"up":[0,1,0]},"sim_speed":120,"sim_reverse":false},{"name":["Train2","列車2"],"go":true,"back":true,"speed":80,"cars":[{"model":"c4700291-a9ee-48e4-8a62-d88295af4348","flip":false,"switches":["stripe_color:red"]},{"model":"0e83c0d0-ae09-438c-8587-114e40eb3fda","flip":false,"switches":["stripe_color:red"]},{"model":"0e83c0d0-ae09-438c-8587-114e40eb3fda","flip":false,"switches":["stripe_color:red"]},{"model":"0e83c0d0-ae09-438c-8587-114e40eb3fda","flip":false,"switches":["stripe_color:red"]},{"model":"c4700291-a9ee-48e4-8a62-d88295af4348","flip":true,"switches":["stripe_color:red"]}],"id":1,"head_anchor":{"rail":80,"dir_side":1,"pos":[33.91377639770508,-2.8142533636810185e-8,-4.678947925567627],"dir":[-0.9965458512306213,0.000020491261238930747,-0.08304417133331299],"up":[6.078872161197069e-8,1,3.696732475688691e-9]},"sim_speed":0,"sim_reverse":true},{"name":["Train3","列車3"],"go":true,"back":true,"speed":120,"cars":[{"model":"c4700291-a9ee-48e4-8a62-d88295af4348","flip":false,"switches":["stripe_color:blue"]},{"model":"0e83c0d0-ae09-438c-8587-114e40eb3fda","flip":false,"switches":["stripe_color:blue"]},{"model":"c4700291-a9ee-48e4-8a62-d88295af4348","flip":true,"switches":["stripe_color:blue"]}],"id":16},{"name":["Freight1","貨物1"],"go":true,"back":false,"speed":50,"cars":[{"model":"221dcc5c-8b16-4763-9310-6d05df878c8b","flip":false,"switches":["color:original"]},{"model":"1d0bc77e-b7a1-47d5-9128-b7d75f5aab58","flip":false,"switches":["type:none"]},{"model":"1d0bc77e-b7a1-47d5-9128-b7d75f5aab58","flip":false,"switches":["type:containers"]},{"model":"1d0bc77e-b7a1-47d5-9128-b7d75f5aab58","flip":false,"switches":["type:tanks"]}],"id":2,"head_anchor":{"rail":60,"dir_side":0,"pos":[54.46210861206055,2.9109225273132324,70.47471618652344],"dir":[-0.8614611625671387,0.1783667504787445,0.47546815872192383],"up":[0.1568153351545334,0.9839073419570923,-0.08561033755540848]},"sim_speed":50,"sim_reverse":false},{"name":["Bullet1","新幹線1"],"go":true,"back":false,"speed":200,"cars":[{"model":"601a3ec4-d8f9-47db-b848-ca01ce3df3e5","flip":false,"switches":["bogie:on","color:blue"]},{"model":"994dd1aa-2045-4f32-b73d-7e6c7ad30a2b","flip":false,"switches":["bogie:off","color:blue"]},{"model":"994dd1aa-2045-4f32-b73d-7e6c7ad30a2b","flip":false,"switches":["bogie:off","color:blue"]},{"model":"994dd1aa-2045-4f32-b73d-7e6c7ad30a2b","flip":false,"switches":["bogie:off","color:blue"]},{"model":"994dd1aa-2045-4f32-b73d-7e6c7ad30a2b","flip":false,"switches":["bogie:off","color:blue"]},{"model":"994dd1aa-2045-4f32-b73d-7e6c7ad30a2b","flip":false,"switches":["bogie:off","color:blue"]},{"model":"601a3ec4-d8f9-47db-b848-ca01ce3df3e5","flip":true,"switches":["bogie:off","color:blue"]}],"id":5,"head_anchor":{"rail":161,"dir_side":0,"pos":[-65.96397399902344,9.90301513671875,-132.27557373046875],"dir":[-0.5061250329017639,-0.001002845587208867,0.8624595403671265],"up":[0.051638491451740265,0.9981595277786255,0.031777605414390564]},"sim_speed":200,"sim_reverse":false},{"name":["Suspended1","懸垂式1"],"go":true,"back":false,"speed":60,"cars":[{"model":"91a09ccc-86d3-4fa8-b600-c616b67f87b6","flip":false,"switches":["color:orange"]},{"model":"1d3fba90-71f2-45d4-8bf9-1f747f66bfde","flip":false,"switches":["color:orange"]},{"model":"91a09ccc-86d3-4fa8-b600-c616b67f87b6","flip":true,"switches":["color:orange"]}],"id":10,"head_anchor":{"rail":257,"dir_side":0,"pos":[-27.244205474853516,10,81.1944580078125],"dir":[0.9998301863670349,0,0.01842718943953514],"up":[0,1,0]},"sim_speed":60,"sim_reverse":false},{"name":["Suspended2","懸垂式2"],"go":true,"back":true,"speed":60,"cars":[{"model":"91a09ccc-86d3-4fa8-b600-c616b67f87b6","flip":false,"switches":["color:purple"]},{"model":"1d3fba90-71f2-45d4-8bf9-1f747f66bfde","flip":false,"switches":["color:purple"]},{"model":"91a09ccc-86d3-4fa8-b600-c616b67f87b6","flip":true,"switches":["color:purple"]}],"id":11,"head_anchor":{"rail":223,"dir_side":1,"pos":[-30.981979370117188,10,175.00148010253906],"dir":[-0.9999970197677612,0,-0.0024333572946488857],"up":[0,1,0]},"sim_speed":60,"sim_reverse":true},{"name":["Straddling1","跨座式1"],"go":true,"back":true,"speed":80,"cars":[{"model":"b000ae6f-dbd4-43c0-9972-70a420fc78c3","flip":false,"switches":["color:red"]},{"model":"adff4b70-c453-49fc-bbb6-030cf3ea84d0","flip":false,"switches":["color:red"]},{"model":"b000ae6f-dbd4-43c0-9972-70a420fc78c3","flip":true,"switches":["color:red"]}],"id":12,"head_anchor":{"rail":309,"dir_side":1,"pos":[-122.54180908203125,14,-125.34605407714844],"dir":[-0.40009140968322754,0,0.916475236415863],"up":[0,1,0]},"sim_speed":80,"sim_reverse":true},{"name":["Straddling2","跨座式2"],"go":true,"back":false,"speed":80,"cars":[{"model":"b000ae6f-dbd4-43c0-9972-70a420fc78c3","flip":false,"switches":["color:blue"]},{"model":"adff4b70-c453-49fc-bbb6-030cf3ea84d0","flip":false,"switches":["color:blue"]},{"model":"b000ae6f-dbd4-43c0-9972-70a420fc78c3","flip":true,"switches":["color:blue"]}],"id":13,"head_anchor":{"rail":301,"dir_side":0,"pos":[-22.614303588867188,4.044506549835205,-143.3473358154297],"dir":[-0.9452613592147827,-0.19304999709129333,-0.263082891702652],"up":[-0.18584752082824707,0.9812007546424866,-0.05201109126210213]},"sim_speed":80,"sim_reverse":false},{"name":["SL1",""],"go":true,"back":false,"speed":50,"cars":[{"model":"06d299ae-2de0-40d0-b4f3-304011d6953f","flip":false,"switches":["smoke:on"]},{"model":"7b25a896-80f8-4bae-9ce0-2d7c5391dbc1","flip":false,"switches":["load-type:on"]}],"id":17,"head_anchor":{"rail":369,"dir_side":1,"pos":[-202.359130859375,0,-181.45001220703125],"dir":[-0.5123753547668457,0,-0.8587616086006165],"up":[0,1,0]},"sim_speed":50,"sim_reverse":false}],"cur_id":18},"struct_models":{"insts":[{"name":["House01","家屋01"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"parts":[{"model":"1d7a27cd-ec32-4a4d-8771-b7ac3446d12b","scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[],"switches":[{"id":"roof_color","label":["Roof Color","屋根色"],"default_value_id":"red","preview_value_id":"gray","values":[{"id":"red","label":["Red","赤"],"colors":[{"id":"roof","color":[0.800000011920929,0.10000000149011612,0,1]}]},{"id":"blue","label":["Blue","青"],"colors":[{"id":"roof","color":[0.20000000298023224,0.20000000298023224,0.800000011920929,1]}]},{"id":"green","label":["Green","緑"],"colors":[{"id":"roof","color":[0.30000001192092896,0.6000000238418579,0,1]}]},{"id":"yellow","label":["Yellow","黃"],"colors":[{"id":"roof","color":[1,0.699999988079071,0.10000000149011612,1]}]},{"id":"gray","label":["Gray","グレー"],"colors":[{"id":"roof","color":[0.5,0.5,0.5,1]}]}]},{"id":"wall_color","label":["Wall Color","壁色"],"default_value_id":"white","preview_value_id":"white","values":[{"id":"white","label":["White","白"],"colors":[{"id":"wall","color":[1,1,1,1]}]},{"id":"ivory","label":["Ivory","アイボリー"],"colors":[{"id":"wall","color":[1,0.9800000190734863,0.8500000238418579,1]}]},{"id":"navy","label":["Navy","紺"],"colors":[{"id":"wall","color":[0,0.20000000298023224,0.6000000238418579,1]}]},{"id":"black","label":["Black","黒"],"colors":[{"id":"wall","color":[0.10000000149011612,0.10000000149011612,0.10000000149011612,1]}]}]}],"uuid":"606a86ff-bfd1-409f-8add-4754dd2bcdc8"},{"name":["Building01","ビル01"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"parts":[{"model":"8e7c0aba-3f04-4120-b726-2cca5cb290fa","scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"accept_focus":true,"condition":{"switch_id":"","op":"is","value_id":[""]}},{"model":"8e7c0aba-3f04-4120-b726-2cca5cb290fa","scale":[1,1,1],"rotate":[0,0,0],"trans":[0,25,0],"accept_focus":true,"condition":{"switch_id":"height","op":"is","value_id":["10","15","20"]}},{"model":"8e7c0aba-3f04-4120-b726-2cca5cb290fa","scale":[1,1,1],"rotate":[0,0,0],"trans":[0,50,0],"accept_focus":true,"condition":{"switch_id":"height","op":"is","value_id":["15","20"]}},{"model":"8e7c0aba-3f04-4120-b726-2cca5cb290fa","scale":[1,1,1],"rotate":[0,0,0],"trans":[0,75,0],"accept_focus":true,"condition":{"switch_id":"height","op":"is","value_id":["20"]}}],"smokes":[],"switches":[{"id":"height","label":["Height","高さ"],"default_value_id":"10","preview_value_id":"20","values":[{"id":"5","label":["5F","5F"],"colors":[]},{"id":"10","label":["10F","10F"],"colors":[]},{"id":"15","label":["15F","15F"],"colors":[]},{"id":"20","label":["20F","20F"],"colors":[]}]},{"id":"color","label":["Color","色"],"default_value_id":"white","preview_value_id":"khaki","values":[{"id":"white","label":["White","白"],"colors":[]},{"id":"gray","label":["Gray","グレー"],"colors":[{"id":"color","color":[0.30000001192092896,0.30000001192092896,0.30000001192092896,1]}]},{"id":"khaki","label":["Khaki","カーキ"],"colors":[{"id":"color","color":[0.699999988079071,0.699999988079071,0.5,1]}]}]}],"uuid":"412a2655-98a7-4aee-98e4-d03732d2f87a"},{"name":["Mountain01","山01"],"author":{"name":"aizentranza.com","url":"https://www.aizentranza.com/"},"parts":[{"model":"99e1877a-d80a-4ee3-b580-26e7fe04c79b","scale":[1,1,1],"rotate":[0,0,0],"trans":[0,0,0],"accept_focus":false,"condition":{"switch_id":"","op":"is","value_id":[""]}}],"smokes":[],"switches":[],"uuid":"379eb356-c7eb-4254-ad18-606c00122204"}]},"structs":{"insts":[{"name":["struct",""],"model":"606a86ff-bfd1-409f-8add-4754dd2bcdc8","field_setting":"nrm","position":[-57.97909927368164,-2.976249694824218,263.80999755859375],"rotate":[0,60,0],"offset":[0,0,0],"switches":["roof_color:blue","wall_color:ivory"],"id":0,"is_put":true},{"name":["struct",""],"model":"606a86ff-bfd1-409f-8add-4754dd2bcdc8","field_setting":"pos","position":[-29.524200439453125,0,-20.08449935913086],"rotate":[0,0,0],"offset":[0,0,0],"switches":["roof_color:red","wall_color:white"],"id":1,"is_put":true},{"name":["struct",""],"model":"412a2655-98a7-4aee-98e4-d03732d2f87a","field_setting":"pos","position":[208.5330047607422,0,66.552001953125],"rotate":[0,25,0],"offset":[0,0,0],"switches":["height:10","color:gray"],"id":2,"is_put":true},{"name":["struct",""],"model":"379eb356-c7eb-4254-ad18-606c00122204","field_setting":"pos","position":[137.04220581054688,0,-382],"rotate":[0,0,0],"offset":[0,0,0],"switches":[],"id":3,"is_put":true},{"name":["struct",""],"model":"379eb356-c7eb-4254-ad18-606c00122204","field_setting":"pos","position":[272.8747863769531,0,-354.1047058105469],"rotate":[0,0,0],"offset":[0,0,0],"switches":[],"id":4,"is_put":true},{"name":["struct",""],"model":"379eb356-c7eb-4254-ad18-606c00122204","field_setting":"pos","position":[365.572998046875,0,-239.09100341796875],"rotate":[0,0,0],"offset":[0,0,0],"switches":[],"id":5,"is_put":true}],"cur_id":6}}
//embedded-data-end
  </script>
  <script>boot();</script>
</html>
